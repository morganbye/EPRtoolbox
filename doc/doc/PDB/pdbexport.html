<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of pdbexport</title>
  <meta name="keywords" content="pdbexport">
  <meta name="description" content="PDBEXPORT exports a PDB-like structure in MATLAB to a .pdb file">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">doc</a> &gt; <a href="index.html">PDB</a> &gt; pdbexport.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for doc/PDB&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>pdbexport
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>PDBEXPORT exports a PDB-like structure in MATLAB to a .pdb file</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function pdbexport(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> PDBEXPORT exports a PDB-like structure in MATLAB to a .pdb file

   PDBEXPORT (myProtein)
   PDBEXPORT (myProtein,'complete')
   PDBEXPORT (myProtein,'complete','/path/to/file/myProtein.pdb')

 PDBEXPORT allows a MATLAB PDB structure created with PDBIMPORT to be
 saved out from MATLAB to a .pdb file. By default the save location is
 selected using a graphical user interface, but can also be done using a
 command line method.

 Inputs:
    input1     - structure
                   the PDB-like structure in MATLAB 
    input2     - option
                   select between 'basic' for just the atoms or 'complete'
                   for a file with all sections included
    input3     - a file location
                   a full file location to save the file, if the user does
                   not want to use the GUI to select a location

 Outputs:
    output1    - a file
                   
 Example: 
    PDBEXPORT(myProtein)
               export the PDB structure myProtein

    PDBEXPORT(myProtein,'complete')
               export the PDB structure myProtein, with all the PDB
               information such as sequence, headers, remarks, etc

    PDBEXPORT(myProtein,'complete','/home/user/PDBs/myProtein.pdb')
               export the PDB structure myProtein, with all the PDB
               information, to the user's home directory

 Other m-files required:   none

 Subfunctions:             none

 MAT-files required:       none


 See also: EPRTOOLBOX <a href="pdbimport.html" class="code" title="function structure = pdbimport(varargin)">PDBIMPORT</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="MMMRotamerToPDB.html" class="code" title="function MMMRotamerToPDB(varargin)">MMMRotamerToPDB</a>	MMMROTAMERTOPDB This script takes a PDB from a local source or from</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function pdbexport(varargin)</a>
0002 
0003 <span class="comment">% PDBEXPORT exports a PDB-like structure in MATLAB to a .pdb file</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   PDBEXPORT (myProtein)</span>
0006 <span class="comment">%   PDBEXPORT (myProtein,'complete')</span>
0007 <span class="comment">%   PDBEXPORT (myProtein,'complete','/path/to/file/myProtein.pdb')</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% PDBEXPORT allows a MATLAB PDB structure created with PDBIMPORT to be</span>
0010 <span class="comment">% saved out from MATLAB to a .pdb file. By default the save location is</span>
0011 <span class="comment">% selected using a graphical user interface, but can also be done using a</span>
0012 <span class="comment">% command line method.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Inputs:</span>
0015 <span class="comment">%    input1     - structure</span>
0016 <span class="comment">%                   the PDB-like structure in MATLAB</span>
0017 <span class="comment">%    input2     - option</span>
0018 <span class="comment">%                   select between 'basic' for just the atoms or 'complete'</span>
0019 <span class="comment">%                   for a file with all sections included</span>
0020 <span class="comment">%    input3     - a file location</span>
0021 <span class="comment">%                   a full file location to save the file, if the user does</span>
0022 <span class="comment">%                   not want to use the GUI to select a location</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% Outputs:</span>
0025 <span class="comment">%    output1    - a file</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% Example:</span>
0028 <span class="comment">%    PDBEXPORT(myProtein)</span>
0029 <span class="comment">%               export the PDB structure myProtein</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%    PDBEXPORT(myProtein,'complete')</span>
0032 <span class="comment">%               export the PDB structure myProtein, with all the PDB</span>
0033 <span class="comment">%               information such as sequence, headers, remarks, etc</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%    PDBEXPORT(myProtein,'complete','/home/user/PDBs/myProtein.pdb')</span>
0036 <span class="comment">%               export the PDB structure myProtein, with all the PDB</span>
0037 <span class="comment">%               information, to the user's home directory</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% Other m-files required:   none</span>
0040 <span class="comment">%</span>
0041 <span class="comment">% Subfunctions:             none</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% MAT-files required:       none</span>
0044 <span class="comment">%</span>
0045 <span class="comment">%</span>
0046 <span class="comment">% See also: EPRTOOLBOX PDBIMPORT</span>
0047 
0048 
0049 <span class="comment">%                                        _                             _</span>
0050 <span class="comment">%                                       | |                           | |</span>
0051 <span class="comment">%  _ __ ___   ___  _ __ __ _  __ _ _ __ | |__  _   _  ___   _ __   ___| |_</span>
0052 <span class="comment">% | '_ ` _ \ / _ \| '__/ _` |/ _` | '_ \| '_ \| | | |/ _ \ | '_ \ / _ \ __|</span>
0053 <span class="comment">% | | | | | | (_) | | | (_| | (_| | | | | |_) | |_| |  __/_| | | |  __/ |_</span>
0054 <span class="comment">% |_| |_| |_|\___/|_|  \__, |\__,_|_| |_|_.__/ \__, |\___(_)_| |_|\___|\__|</span>
0055 <span class="comment">%                       __/ |                   __/ |</span>
0056 <span class="comment">%                      |___/                   |___/</span>
0057 <span class="comment">%</span>
0058 <span class="comment">%</span>
0059 <span class="comment">% M. Bye v12.9</span>
0060 <span class="comment">%</span>
0061 <span class="comment">% Author:       Morgan Bye</span>
0062 <span class="comment">% Work address: Henry Wellcome Unit for Biological EPR</span>
0063 <span class="comment">%               University of East Anglia</span>
0064 <span class="comment">%               NORWICH, UK</span>
0065 <span class="comment">% Email:        morgan.bye@uea.ac.uk</span>
0066 <span class="comment">% Website:      http://www.morganbye.net/eprtoolbox/</span>
0067 <span class="comment">% Aug 2012;     Last revision: 23-August-2012</span>
0068 <span class="comment">%</span>
0069 <span class="comment">% Approximate coding time of file:</span>
0070 <span class="comment">%               9 hours</span>
0071 <span class="comment">%</span>
0072 <span class="comment">%</span>
0073 <span class="comment">% Version history:</span>
0074 <span class="comment">% Aug 12        &gt; 2 arguments in for basic/complete export</span>
0075 <span class="comment">%               &gt; Better error handling</span>
0076 <span class="comment">%               &gt; More reliable export</span>
0077 <span class="comment">%               &gt; Command line addressing if required</span>
0078 <span class="comment">%</span>
0079 <span class="comment">% Feb 12        Initial release</span>
0080 <span class="comment">%</span>
0081 
0082 <span class="keyword">switch</span> nargin
0083     <span class="keyword">case</span> 0
0084         error(<span class="string">'No PDB structure has been selected for export'</span>)
0085     
0086     <span class="keyword">case</span> 1
0087         structure = varargin{1};
0088         option = <span class="string">'basic'</span>;
0089         
0090     <span class="keyword">case</span> 2
0091         structure = varargin{1};
0092         option = varargin{2};
0093         
0094         <span class="keyword">if</span> strcmp(option,<span class="string">'basic'</span>) == 0 || strcmp(option,<span class="string">'complete'</span>)
0095             error(<span class="string">'Unrecognized 2nd input, use ''basic'' or ''complete'''</span>);
0096         <span class="keyword">end</span>
0097         
0098     <span class="keyword">case</span> 3
0099         structure = varargin{1};
0100         option = varargin{2};
0101         
0102         <span class="keyword">if</span> strcmp(option,<span class="string">'basic'</span>) == 0 || strcmp(option,<span class="string">'complete'</span>)
0103             error(<span class="string">'Unrecognized 2nd input, use ''basic'' or ''complete'''</span>);
0104         <span class="keyword">end</span>
0105         
0106         out_add = varargin{3};
0107         
0108 <span class="keyword">end</span>
0109         
0110 <span class="comment">% Check input is a structure</span>
0111 <span class="keyword">if</span> ~isstruct(structure)
0112     error (<span class="string">'The input must be a valid MATLAB structure'</span>)
0113 <span class="keyword">end</span>
0114 
0115 <span class="comment">% Set output location with GUI</span>
0116 <span class="keyword">if</span> nargin &lt; 3
0117     [out_name, out_path] = uiputfile(<span class="string">'*.pdb'</span>, <span class="string">'Save PDB as...'</span>);
0118     out_add = fullfile(out_path,out_name);
0119 <span class="keyword">end</span>
0120 
0121 <span class="comment">% Check that the required fields exist</span>
0122 <span class="keyword">if</span> isfield(structure.Model,<span class="string">'Atom'</span>) == 0
0123     error (<span class="string">'The selected protein has no Atom field in the model'</span>)
0124 <span class="keyword">end</span>
0125 
0126 <span class="comment">% If user has requested the complete PDB then start writing the header.</span>
0127 <span class="comment">% Otherwise</span>
0128 <span class="keyword">if</span> strcmp(option,<span class="string">'complete'</span>)
0129 
0130     <span class="comment">% Start writing the output to &quot;output&quot; string</span>
0131     output = [];
0132     
0133     <span class="keyword">if</span> isfield(structure,<span class="string">'Header'</span>)
0134         output = [output ; structure.Header];
0135     <span class="keyword">end</span>
0136     
0137     <span class="keyword">if</span> isfield(structure,<span class="string">'Obsolete'</span>)
0138         output = [output ; structure.Obsolete];
0139     <span class="keyword">end</span>
0140     
0141     <span class="keyword">if</span> isfield(structure,<span class="string">'Title'</span>)
0142         output = [output ; sprintf(<span class="string">'%-80s'</span>,structure.Title)];
0143     <span class="keyword">end</span>
0144     
0145     <span class="keyword">if</span> isfield(structure,<span class="string">'Caveat'</span>)
0146         output = [output ; structure.Caveat];
0147     <span class="keyword">end</span>
0148     
0149     <span class="keyword">if</span> isfield(structure,<span class="string">'Compound'</span>)
0150         output = [output ; structure.Compound];
0151     <span class="keyword">end</span>
0152     
0153     <span class="keyword">if</span> isfield(structure,<span class="string">'Source'</span>)
0154         output = [output ; structure.Source];
0155     <span class="keyword">end</span>
0156     
0157     <span class="keyword">if</span> isfield(structure,<span class="string">'Keywords'</span>)
0158         output = [output ; structure.Keywords];
0159     <span class="keyword">end</span>
0160     
0161     <span class="keyword">if</span> isfield(structure,<span class="string">'ExperimentalData'</span>)
0162         output = [output ; structure.ExperimentalData];
0163     <span class="keyword">end</span>
0164     
0165     <span class="keyword">if</span> isfield(structure,<span class="string">'Authors'</span>)
0166         output = [output ; structure.Authors];
0167     <span class="keyword">end</span>
0168     
0169     <span class="keyword">if</span> isfield(structure,<span class="string">'RevisionDate'</span>)
0170         output = [output ; structure.RevisionDate];
0171     <span class="keyword">end</span>
0172     
0173     <span class="keyword">if</span> isfield(structure,<span class="string">'Superseded'</span>)
0174         output = [output ; structure.Superseded];
0175     <span class="keyword">end</span>
0176     
0177     <span class="keyword">if</span> isfield(structure,<span class="string">'Journal'</span>)
0178         output = [output ; structure.Journal];
0179     <span class="keyword">end</span>
0180     
0181     <span class="keyword">if</span> isfield(structure,<span class="string">'Remark'</span>)
0182         output = [output ; structure.Remark];
0183     <span class="keyword">end</span>
0184     
0185     <span class="keyword">if</span> isfield(structure,<span class="string">'DBReferences'</span>)
0186         output = [output ; structure.DBReferences];
0187     <span class="keyword">end</span>
0188     
0189     <span class="keyword">if</span> isfield(structure,<span class="string">'SequenceConflicts'</span>)
0190         output = [output ; structure.SequenceConflicts];
0191     <span class="keyword">end</span>
0192     
0193     <span class="comment">% Special case for Sequence</span>
0194     <span class="keyword">if</span> isfield(structure,<span class="string">'Sequence'</span>)
0195         output = [output ; structure.Sequence];
0196     <span class="keyword">end</span>
0197     
0198     <span class="keyword">if</span> isfield(structure,<span class="string">'Footnote'</span>)
0199         output = [output ; structure.Footnote];
0200     <span class="keyword">end</span>
0201     
0202     <span class="keyword">if</span> isfield(structure,<span class="string">'MODRES'</span>)
0203         output = [output ; structure.MODRES];
0204     <span class="keyword">end</span>
0205     
0206     <span class="keyword">if</span> isfield(structure,<span class="string">'Heterogen'</span>)
0207         output = [output ; structure.Heterogen];
0208     <span class="keyword">end</span>
0209     
0210     <span class="keyword">if</span> isfield(structure,<span class="string">'HeterogenName'</span>)
0211         output = [output ; structure.HeterogenName];
0212     <span class="keyword">end</span>
0213     
0214     <span class="keyword">if</span> isfield(structure,<span class="string">'HeterogenSynonym'</span>)
0215         output = [output ; structure.HeterogenSynonym];
0216     <span class="keyword">end</span>
0217     
0218     <span class="keyword">if</span> isfield(structure,<span class="string">'Formula'</span>)
0219         output = [output ; structure.Formula];
0220     <span class="keyword">end</span>
0221     
0222     <span class="keyword">if</span> isfield(structure,<span class="string">'Helix'</span>)
0223         output = [output ; structure.Helix];
0224     <span class="keyword">end</span>
0225     
0226     <span class="keyword">if</span> isfield(structure,<span class="string">'Sheet'</span>)
0227         output = [output ; structure.Sheet];
0228     <span class="keyword">end</span>
0229     
0230     <span class="keyword">if</span> isfield(structure,<span class="string">'SSBond'</span>)
0231         output = [output ; structure.SSBond];
0232     <span class="keyword">end</span>
0233     
0234     <span class="keyword">if</span> isfield(structure,<span class="string">'Link'</span>)
0235         output = [output ; structure.Link];
0236     <span class="keyword">end</span>
0237     
0238     <span class="keyword">if</span> isfield(structure,<span class="string">'HydrogenBond'</span>)
0239         output = [output ; structure.HydrogenBond];
0240     <span class="keyword">end</span>
0241     
0242     <span class="keyword">if</span> isfield(structure,<span class="string">'SaltBridge'</span>)
0243         output = [output ; structure.SaltBridge];
0244     <span class="keyword">end</span>
0245     
0246     <span class="keyword">if</span> isfield(structure,<span class="string">'CISPeptide'</span>)
0247         output = [output ; structure.CISPeptide];
0248     <span class="keyword">end</span>
0249     
0250     <span class="keyword">if</span> isfield(structure,<span class="string">'Cryst1'</span>)
0251         output = [output ; structure.Cryst1];
0252     <span class="keyword">end</span>
0253     
0254     <span class="keyword">if</span> isfield(structure,<span class="string">'TranslationVector'</span>)
0255         output = [output ; structure.TranslationVector];
0256     <span class="keyword">end</span>
0257 
0258 <span class="keyword">else</span>
0259     output = [];
0260 <span class="keyword">end</span>
0261 
0262 
0263 
0264 <span class="keyword">if</span> isfield(structure,<span class="string">'Model'</span>)              <span class="comment">% If Atoms exist</span>
0265     
0266     atoms       = [];
0267     TotalAtoms  = size(structure.Model.Atom,2);
0268     term        = cellstr(structure.Terminal);
0269     
0270     
0271     <span class="keyword">for</span> j = 1 : numel(fieldnames(structure.Sequence))
0272         <span class="comment">% For each chain</span>
0273         i = char(j-1+<span class="string">'A'</span>);
0274         
0275         <span class="keyword">for</span> k = 1 : TotalAtoms
0276             <span class="comment">% Search the atoms</span>
0277             <span class="keyword">if</span> structure.Model.Atom(k).chainID == i
0278                 <span class="comment">% For matching chain</span>
0279                 <span class="comment">%               ATOM 1234 CA  ALA B     123    X    Y    Z</span>
0280                 line = [<span class="string">'ATOM  '</span>,<span class="keyword">...</span>
0281                     (sprintf(<span class="string">'%5d %-4s%3s %1s   %5d   %8.3f%8.3f%8.3f%6.2f%6.2f          %1s'</span>, <span class="keyword">...</span>
0282                     structure.Model.Atom(k).AtomSerNo , <span class="keyword">...</span>
0283                     structure.Model.Atom(k).AtomName , <span class="keyword">...</span>
0284                     structure.Model.Atom(k).resName , <span class="keyword">...</span>
0285                     structure.Model.Atom(k).chainID , <span class="keyword">...</span>
0286                     structure.Model.Atom(k).resSeq , <span class="keyword">...</span>
0287                     structure.Model.Atom(k).X , <span class="keyword">...</span>
0288                     structure.Model.Atom(k).Y , <span class="keyword">...</span>
0289                     structure.Model.Atom(k).Z , <span class="keyword">...</span>
0290                     structure.Model.Atom(k).occupancy , <span class="keyword">...</span>
0291                     structure.Model.Atom(k).tempFactor , <span class="keyword">...</span>
0292                     structure.Model.Atom(k).element))];
0293                     <span class="comment">% Format the output</span>
0294                     
0295                     <span class="keyword">try</span>
0296                         atoms = [atoms ; sprintf(<span class="string">'%-80s'</span>,line)];
0297                     <span class="keyword">catch</span>
0298                         disp(sprintf(<span class="string">'Error %f'</span>,k))
0299                     <span class="keyword">end</span>
0300             <span class="keyword">end</span>
0301             
0302         <span class="keyword">end</span>
0303         <span class="comment">% Add TERM line after each chain</span>
0304         atoms = [atoms ; sprintf(<span class="string">'%-80s'</span>,term{j}) ];
0305     <span class="keyword">end</span>
0306     
0307     output = [output ; atoms];
0308 <span class="keyword">end</span>
0309 
0310 <span class="keyword">if</span> strcmp(option,<span class="string">'complete'</span>)
0311     
0312     <span class="keyword">if</span> isfield(structure,<span class="string">'AtomSD'</span>)
0313         output = [output ; structure.AtomSD];
0314     <span class="keyword">end</span>
0315     
0316     <span class="keyword">if</span> isfield(structure,<span class="string">'AnisotropicTemp'</span>)
0317         output = [output ; structure.AnisotropicTemp];
0318     <span class="keyword">end</span>
0319     
0320     <span class="keyword">if</span> isfield(structure,<span class="string">'AnisotropicTempSD'</span>)
0321         output = [output ; structure.AnisotropicTempSD];
0322     <span class="keyword">end</span>
0323     
0324 <span class="keyword">end</span>
0325 
0326 <span class="keyword">if</span> isfield(structure,<span class="string">'HeterogenAtom'</span>)
0327     output = [output ; structure.HeterogenAtom];
0328 <span class="keyword">end</span>
0329 
0330 <span class="comment">% if isfield(structure,'Connectivity')</span>
0331 <span class="comment">%</span>
0332 <span class="comment">%     Connect     = [];</span>
0333 <span class="comment">%     TotalCon    = size(structure.Connectivity,2);</span>
0334 <span class="comment">%     % term        = cellstr(structure.Terminal);</span>
0335 <span class="comment">%</span>
0336 <span class="comment">%     for j = 1 : TotalCon</span>
0337 <span class="comment">%         line = ['CONECT ',...</span>
0338 <span class="comment">%                     (sprintf('',...</span>
0339 <span class="comment">%        );</span>
0340 <span class="comment">%     end</span>
0341 <span class="comment">%</span>
0342 <span class="comment">%</span>
0343 <span class="comment">%     output = [output ; structure.Connectivity];</span>
0344 <span class="comment">% end</span>
0345 
0346 output = [output ; sprintf(<span class="string">'%-80s'</span>,<span class="string">'END'</span>)];
0347 
0348 
0349 <span class="comment">% File shuffling</span>
0350 <span class="comment">% ========================================================================</span>
0351 
0352 <span class="comment">% Convert to array of strings (each line in new cell)</span>
0353 output = cellstr(output);
0354 
0355 <span class="comment">% Find empty cells and remove them</span>
0356 output = output(~cellfun(@isempty,output));
0357 
0358 <span class="comment">% Convert back to string for export</span>
0359 output = char(output);
0360 
0361 <span class="comment">% Write output to file</span>
0362 <span class="comment">% ========================================================================</span>
0363 
0364 fid = fopen(out_add,<span class="string">'w+'</span>);
0365 
0366 <span class="comment">% Check file can be opened/written to</span>
0367 <span class="keyword">if</span> fid == (-1)
0368     error (<span class="string">'The file cannot be opened for writing, please check the folder''s permissions'</span>)
0369 <span class="keyword">end</span>
0370 
0371 <span class="keyword">try</span>
0372     <span class="keyword">for</span> k = 1 : length(output)
0373         fprintf(fid, [output(k,:) <span class="string">'\n'</span>]);
0374     <span class="keyword">end</span>
0375     
0376     fclose(fid);
0377     
0378 <span class="keyword">catch</span>
0379     <span class="comment">% if there's an error close the file and delete it ready for another</span>
0380     <span class="comment">% try</span>
0381     fclose(fid);
0382     delete(out_add);
0383     error (<span class="string">'The file could not be written'</span>)
0384 <span class="keyword">end</span>
0385 
0386 
0387</pre></div>
<hr><address>Generated on Sun 07-Jul-2013 12:41:22 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>