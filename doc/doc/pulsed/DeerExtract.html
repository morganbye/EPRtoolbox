<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of DeerExtract</title>
  <meta name="keywords" content="DeerExtract">
  <meta name="description" content="DEEREXTRACT Finds an open DeerAnalysis window and exports the data">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">doc</a> &gt; <a href="index.html">pulsed</a> &gt; DeerExtract.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for doc/pulsed&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>DeerExtract
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>DEEREXTRACT Finds an open DeerAnalysis window and exports the data</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [x,y] = DeerExtract(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> DEEREXTRACT Finds an open DeerAnalysis window and exports the data
 presented in the various plots into variables in MATLAB's base workspace
 for easy use in calculations/exporting/plotting

 This requires does not require anything except that you have a
 DeerAnalysis window open (and that there is data plotted - otherwise
 you'll get blank figures. Note that L-curves probably won't work - but
 why would you want them?)

 Syntax:  [x,y] = DEEREXTRACT

 Inputs:
    input1 - 'noplot'
               Extracts from DeerAnalysis with no figures plotted

 Outputs:
    output0 - 3 figures
               figures from DeerAnalysis
    output1 - x
               with the following sub-arrays
                     DistanceDistribution
                     TimeDomain or Pake
                     OriginalData
    output2 - y
               with the following sub-arrays
                     DistanceDistribution
                     TimeDomain or Pake
                     OriginalData

 Example: 
    [x,y] = DEEREXTRACT
               plots the 3 DeerAnalysis in new windows and puts the values
               for each into x and y structures

    [x,y] = DEEREXTRACT('noplot')
               exports DeerAnalysis figure values to x and y without
               any plotting

 Other m-files required:
                       none

 Subfunctions:         none

 MAT-files required:   none</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [x,y] = DeerExtract(varargin)</a>
0002 
0003 <span class="comment">% DEEREXTRACT Finds an open DeerAnalysis window and exports the data</span>
0004 <span class="comment">% presented in the various plots into variables in MATLAB's base workspace</span>
0005 <span class="comment">% for easy use in calculations/exporting/plotting</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% This requires does not require anything except that you have a</span>
0008 <span class="comment">% DeerAnalysis window open (and that there is data plotted - otherwise</span>
0009 <span class="comment">% you'll get blank figures. Note that L-curves probably won't work - but</span>
0010 <span class="comment">% why would you want them?)</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% Syntax:  [x,y] = DEEREXTRACT</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Inputs:</span>
0015 <span class="comment">%    input1 - 'noplot'</span>
0016 <span class="comment">%               Extracts from DeerAnalysis with no figures plotted</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% Outputs:</span>
0019 <span class="comment">%    output0 - 3 figures</span>
0020 <span class="comment">%               figures from DeerAnalysis</span>
0021 <span class="comment">%    output1 - x</span>
0022 <span class="comment">%               with the following sub-arrays</span>
0023 <span class="comment">%                     DistanceDistribution</span>
0024 <span class="comment">%                     TimeDomain or Pake</span>
0025 <span class="comment">%                     OriginalData</span>
0026 <span class="comment">%    output2 - y</span>
0027 <span class="comment">%               with the following sub-arrays</span>
0028 <span class="comment">%                     DistanceDistribution</span>
0029 <span class="comment">%                     TimeDomain or Pake</span>
0030 <span class="comment">%                     OriginalData</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% Example:</span>
0033 <span class="comment">%    [x,y] = DEEREXTRACT</span>
0034 <span class="comment">%               plots the 3 DeerAnalysis in new windows and puts the values</span>
0035 <span class="comment">%               for each into x and y structures</span>
0036 <span class="comment">%</span>
0037 <span class="comment">%    [x,y] = DEEREXTRACT('noplot')</span>
0038 <span class="comment">%               exports DeerAnalysis figure values to x and y without</span>
0039 <span class="comment">%               any plotting</span>
0040 <span class="comment">%</span>
0041 <span class="comment">% Other m-files required:</span>
0042 <span class="comment">%                       none</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% Subfunctions:         none</span>
0045 <span class="comment">%</span>
0046 <span class="comment">% MAT-files required:   none</span>
0047 <span class="comment">%</span>
0048 <span class="comment">%</span>
0049 
0050 <span class="comment">%                                        _                             _</span>
0051 <span class="comment">%                                       | |                           | |</span>
0052 <span class="comment">%  _ __ ___   ___  _ __ __ _  __ _ _ __ | |__  _   _  ___   _ __   ___| |_</span>
0053 <span class="comment">% | '_ ` _ \ / _ \| '__/ _` |/ _` | '_ \| '_ \| | | |/ _ \ | '_ \ / _ \ __|</span>
0054 <span class="comment">% | | | | | | (_) | | | (_| | (_| | | | | |_) | |_| |  __/_| | | |  __/ |_</span>
0055 <span class="comment">% |_| |_| |_|\___/|_|  \__, |\__,_|_| |_|_.__/ \__, |\___(_)_| |_|\___|\__|</span>
0056 <span class="comment">%                       __/ |                   __/ |</span>
0057 <span class="comment">%                      |___/                   |___/</span>
0058 <span class="comment">%</span>
0059 <span class="comment">% M. Bye v12.12</span>
0060 <span class="comment">%</span>
0061 <span class="comment">% Author:       Morgan Bye</span>
0062 <span class="comment">% Work address: Henry Wellcome Unit for Biological EPR</span>
0063 <span class="comment">%               University of East Anglia</span>
0064 <span class="comment">%               NORWICH, UK</span>
0065 <span class="comment">% Email:        morgan.bye@uea.ac.uk</span>
0066 <span class="comment">% Website:      http://www.morganbye.net/eprtoolbox</span>
0067 <span class="comment">% Dec 2012;     Last revision: 06-December-2012</span>
0068 <span class="comment">%</span>
0069 <span class="comment">% Approximate coding time of file:</span>
0070 <span class="comment">%               4 hours</span>
0071 <span class="comment">%</span>
0072 <span class="comment">% Version history:</span>
0073 <span class="comment">% Dec 12        &gt; Automatic plotting functionality added</span>
0074 <span class="comment">%</span>
0075 <span class="comment">% Jun 12        &gt; Complete rework so that handles are pulled straight from</span>
0076 <span class="comment">%                   DeerAnalysis and the figures do not have to be copied</span>
0077 <span class="comment">%                   out of DeerAnalysis and then analysed.</span>
0078 <span class="comment">%</span>
0079 <span class="comment">% Mar 12        &gt; Added functionality for &quot;Form factor&quot; figure, so that</span>
0080 <span class="comment">%                   Time domain and Dipolar Spectrum figures can also be</span>
0081 <span class="comment">%                   exported</span>
0082 <span class="comment">%</span>
0083 <span class="comment">% Dec 11        &gt; Conversion to function. Allows for single file input and</span>
0084 <span class="comment">%                   gives x and y outputs.</span>
0085 
0086 <span class="comment">% CODING NOTE: any variable that begins with a lower case &quot;h&quot; is a</span>
0087 <span class="comment">% handle for an object, ie hDA is the handles for the DeerAnalysis figure</span>
0088 <span class="comment">%</span>
0089 <span class="comment">% Handles with a lower case &quot;l&quot; are the handles for a line, ie lDD is the</span>
0090 <span class="comment">% line for the curve in the distance distribution axes.</span>
0091 
0092 <span class="keyword">if</span> exist(<span class="string">'DeerAnalysis'</span>) == 0,
0093     warndlg(sprintf(<span class="string">'The &quot;DeerAnalysis&quot; function was not found on your system.'</span>),<span class="string">'DeerAnalysis'</span>)
0094 <span class="keyword">end</span>
0095 
0096 <span class="comment">% Find all figures</span>
0097 figs = findall(0,<span class="string">'type'</span>,<span class="string">'figure'</span>);
0098 
0099 <span class="comment">% Search the figures for one with a window title that starts &quot;DeerAnalysis&quot;</span>
0100 <span class="keyword">for</span> k = 1:numel(figs)
0101     fig_name = get(figs(k) , <span class="string">'name'</span>);
0102     
0103     <span class="keyword">if</span> regexp(fig_name, <span class="string">'DeerAnalysis'</span>)
0104         hDA = get(figs(k));
0105     <span class="keyword">end</span>
0106 <span class="keyword">end</span>
0107 
0108 hAxes = findall(hDA.Children, <span class="string">'Type'</span>, <span class="string">'Axes'</span>);
0109 
0110 <span class="comment">% Distance Distribution</span>
0111 hDD = get(hAxes(1));
0112 lDD = findall(hDD.Children, <span class="string">'Type'</span>, <span class="string">'Line'</span>);
0113 
0114 <span class="comment">% Line 1: dashed cyan vertical line (high)</span>
0115 <span class="comment">% Line 2: dashed cyan vertical line (low)</span>
0116 <span class="comment">% Line 3: solid blue vertical line at window max (8.0 nm)</span>
0117 <span class="comment">% Line 4: solid blue vertical line at window min (1.5 nm)</span>
0118 <span class="comment">% Line 5: curve</span>
0119 
0120 x.DistanceDistribution = get(lDD(5), <span class="string">'xdata'</span>);
0121 x.DistanceDistribution = x.DistanceDistribution';
0122 y.DistanceDistribution = get(lDD(5), <span class="string">'ydata'</span>);
0123 y.DistanceDistribution = y.DistanceDistribution';
0124         
0125         
0126 <span class="comment">% Form factor</span>
0127 hFF = get(hAxes(2));
0128 lFF = findall(hFF.Children, <span class="string">'Type'</span>, <span class="string">'Line'</span>);
0129 
0130 <span class="comment">% Line 1: Raw data</span>
0131 <span class="comment">% Line 2: Fit</span>
0132 <span class="comment">% Line 3: Raw data again (so as to be on top)</span>
0133 
0134 <span class="keyword">switch</span> get(hFF.XLabel,<span class="string">'String'</span>)
0135     <span class="keyword">case</span> <span class="string">'f (MHz)'</span>              <span class="comment">% Dipolar spectrum</span>
0136         
0137         <span class="comment">% Line 1: Raw data</span>
0138         <span class="comment">% Line 2: Fit</span>
0139         <span class="comment">% Line 3: Raw data again (so as to be on top)</span>
0140         
0141         <span class="keyword">switch</span> size(lFF,1);
0142             
0143             <span class="keyword">case</span> 1              <span class="comment">% Pre fitting</span>
0144                 x.Pake = get(lFF(1), <span class="string">'xdata'</span>);
0145                 x.Pake = x.Pake';
0146                 y.Pake = get(lFF(1), <span class="string">'ydata'</span>);
0147                 y.Pake = y.Pake';
0148                 
0149             <span class="keyword">case</span> 3              <span class="comment">% After fitting</span>
0150                 x.Pake.real = get(lFF(1), <span class="string">'xdata'</span>);
0151                 x.Pake.real = x.Pake.real';
0152                 y.Pake.real = get(lFF(1), <span class="string">'ydata'</span>);
0153                 y.Pake.real = y.Pake.real';
0154                 
0155                 x.Pake.fit = get(lFF(2), <span class="string">'xdata'</span>);
0156                 x.Pake.fit = x.Pake.fit';
0157                 y.Pake.fit = get(lFF(2), <span class="string">'ydata'</span>);
0158                 y.Pake.fit = y.Pake.fit';
0159         <span class="keyword">end</span>
0160         
0161     <span class="keyword">otherwise</span>
0162         
0163         <span class="comment">% Line 1: Vertical red line at end of data set</span>
0164         <span class="comment">% Line 2: Blue dot</span>
0165         <span class="comment">% Line 3: Raw data</span>
0166         <span class="comment">% Line 4: Fit (in red)</span>
0167         <span class="comment">% Line 5: Blue dot again</span>
0168         <span class="comment">% Line 6: Raw data again</span>
0169         
0170         <span class="keyword">switch</span> size(lFF,1);            
0171             <span class="keyword">case</span> 6              <span class="comment">% After fitting</span>
0172                 x.TimeDomain.real = get(lFF(3), <span class="string">'xdata'</span>);
0173                 x.TimeDomain.real = x.TimeDomain.real';
0174                 y.TimeDomain.real = get(lFF(3), <span class="string">'ydata'</span>);
0175                 y.TimeDomain.real = y.TimeDomain.real';
0176                 
0177                 x.TimeDomain.fit = get(lFF(4), <span class="string">'xdata'</span>);
0178                 x.TimeDomain.fit = x.TimeDomain.fit';
0179                 y.TimeDomain.fit = get(lFF(4), <span class="string">'ydata'</span>);
0180                 y.TimeDomain.fit = y.TimeDomain.fit';
0181                 
0182             <span class="keyword">otherwise</span>
0183                 x.TimeDomain = get(lFF(3), <span class="string">'xdata'</span>);
0184                 x.TimeDomain = x.TimeDomain';
0185                 y.TimeDomain = get(lFF(3), <span class="string">'ydata'</span>);
0186                 y.TimeDomain = y.TimeDomain';
0187         <span class="keyword">end</span>
0188 <span class="keyword">end</span>
0189 
0190 <span class="comment">% Original data</span>
0191 hOD = get(hAxes(3));
0192 lOD = findall(hOD.Children, <span class="string">'Type'</span>, <span class="string">'Line'</span>);
0193 
0194 <span class="comment">% Line 1: Real data set (black line)</span>
0195 <span class="comment">% Line 2: Fitting of real data set (red dotted line)</span>
0196 <span class="comment">% Line 3: Same as 2</span>
0197 <span class="comment">% Line 4: Vertical red line at end of data set</span>
0198 <span class="comment">% Line 5: Vertical cyan line for background</span>
0199 <span class="comment">% Line 6: Vertical green line at zero time</span>
0200 <span class="comment">% Line 7: Horizontal dotted pink line at 0</span>
0201 <span class="comment">% Line 8: Imaginary data set (solid pink line)</span>
0202 
0203 x.OriginalData.real = get(lOD(1), <span class="string">'xdata'</span>);
0204 x.OriginalData.real = x.OriginalData.real';
0205 y.OriginalData.real = get(lOD(1), <span class="string">'ydata'</span>);
0206 y.OriginalData.real = y.OriginalData.real';
0207 
0208 <span class="keyword">try</span>
0209     x.OriginalData.imag = get(lOD(8), <span class="string">'xdata'</span>);
0210     x.OriginalData.imag = x.OriginalData.imag';
0211     y.OriginalData.imag = get(lOD(8), <span class="string">'ydata'</span>);
0212     y.OriginalData.imag = y.OriginalData.imag';
0213 <span class="keyword">end</span>
0214 
0215 <span class="comment">% Plotting commands - used if there are no input arguments, or if the first</span>
0216 <span class="comment">% argument is 'noplot'</span>
0217 <span class="keyword">if</span> nargin == 0 || (nargin == 1 &amp;&amp; strcmp(varargin{1},<span class="string">'noplot'</span>) == 0)
0218     figure(<span class="string">'name'</span> , <span class="string">'DeerExtract: Original data'</span>, <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>);
0219     movegui(gcf,<span class="string">'northwest'</span>);
0220     <span class="keyword">try</span>
0221         plot(x.OriginalData.real , y.OriginalData.real,<span class="string">'k-'</span>, <span class="keyword">...</span>
0222             x.OriginalData.imag , y.OriginalData.imag,<span class="string">'r-'</span>);
0223         legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>)
0224     <span class="keyword">catch</span>
0225        plot(x.OriginalData.real , y.OriginalData.real,<span class="string">'k-'</span>); 
0226     <span class="keyword">end</span>
0227     
0228     xlabel(<span class="string">'Time / \mus'</span>);
0229     ylabel(<span class="string">''</span>);
0230     set(gcf,<span class="string">'color'</span>, <span class="string">'white'</span>);
0231     axis tight;
0232     
0233     figure(<span class="string">'name'</span> , <span class="string">'DeerExtract: Form factor'</span>, <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>);
0234     movegui(gcf,<span class="string">'west'</span>);
0235     
0236     <span class="keyword">if</span> isfield(x,<span class="string">'TimeDomain'</span>)
0237         plot(x.TimeDomain.real , y.TimeDomain.real,<span class="string">'k-'</span>, <span class="keyword">...</span>
0238             x.TimeDomain.fit , y.TimeDomain.fit,<span class="string">'r-'</span>);
0239         legend(<span class="string">'Real'</span>,<span class="string">'Fit'</span>)
0240         xlabel(<span class="string">'Time / \mus'</span>);
0241         ylabel(<span class="string">''</span>);
0242         set(gcf,<span class="string">'color'</span>, <span class="string">'white'</span>);
0243         axis tight;
0244         
0245     <span class="keyword">elseif</span> isfield(x,<span class="string">'Pake'</span>)
0246         plot(x.Pake.real , y.Pake.real,<span class="string">'k-'</span>, <span class="keyword">...</span>
0247             x.Pake.fit , y.Pake.fit,<span class="string">'r-'</span>);
0248         legend(<span class="string">'Real'</span>,<span class="string">'Fit'</span>)
0249         xlabel(<span class="string">'Frequency / MHz'</span>);
0250         ylabel(<span class="string">''</span>);
0251         set(gcf,<span class="string">'color'</span>, <span class="string">'white'</span>);
0252         axis tight;
0253         set(gca,<span class="string">'YTick'</span>,[]);
0254     <span class="keyword">end</span>
0255     
0256     figure(<span class="string">'name'</span> , <span class="string">'DeerExtract: Distance distribution '</span>, <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>);
0257     movegui(gcf,<span class="string">'southwest'</span>);
0258     plot(x.DistanceDistribution , y.DistanceDistribution,<span class="string">'k-'</span>);
0259     xlabel(<span class="string">'Distance / nm'</span>);
0260     ylabel(<span class="string">''</span>);
0261     set(gcf,<span class="string">'color'</span>, <span class="string">'white'</span>);
0262     axis tight;
0263     set(gca,<span class="string">'YTick'</span>,[]);
0264 <span class="keyword">end</span>
0265</pre></div>
<hr><address>Generated on Tue 15-Apr-2014 15:10:31 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>