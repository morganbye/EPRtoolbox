<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of MMM_prototype</title>
  <meta name="keywords" content="MMM_prototype">
  <meta name="description" content="MMM_PROTOTYPE M-file for MMM_prototype.fig">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">doc</a> &gt; <a href="index.html">MMM_rotamers</a> &gt; MMM_prototype.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for doc/MMM_rotamers&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>MMM_prototype
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>MMM_PROTOTYPE M-file for MMM_prototype.fig</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = MMM_prototype(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> MMM_PROTOTYPE M-file for MMM_prototype.fig
      MMM_PROTOTYPE, by itself, creates a new MMM_PROTOTYPE or raises the existing
      singleton*.

      H = MMM_PROTOTYPE returns the handle to a new MMM_PROTOTYPE or the handle to
      the existing singleton*.

      MMM_PROTOTYPE('CALLBACK',hObject,eventData,handles,...) calls the local
      function named CALLBACK in MMM_PROTOTYPE.M with the given input arguments.

      MMM_PROTOTYPE('Property','Value',...) creates a new MMM_PROTOTYPE or raises the
      existing singleton*.  Starting from the left, property value pairs are
      applied to the GUI before MMM_prototype_OpeningFcn gets called.  An
      unrecognized property name or invalid value makes property application
      stop.  All inputs are passed to MMM_prototype_OpeningFcn via varargin.

      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one
      instance to run (singleton)&quot;.

 See also: GUIDE, GUIDATA, GUIHANDLES</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="site_scan.html" class="code" title="function varargout = site_scan(varargin)">site_scan</a>	SITE_SCAN M-file for site_scan.fig</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function MMM_prototype_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = MMM_prototype_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function edit_command_line_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function edit_command_line_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function edit_command_line_ButtonDownFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function edit_command_line_KeyPressFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function button_cam_zoom_out_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function button_cam_zoom_in_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function context_model_rotate_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function context_model_zoom_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function context_model_bckg_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function context_model_detach_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function context_model_attach_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function context_model_bckg_black_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function context_model_bckg_grey_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function context_model_bckg_white_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function context_model_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub18" class="code">function menu_file_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function menu_edit_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function menu_display_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function menu_display_fly_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function menu_display_mode_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function menu_edit_center_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function menu_edit_symmetry_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub25" class="code">function menu_edit_domain_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function menu_file_new_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub27" class="code">function menu_file_save_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub28" class="code">function menu_file_load_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub29" class="code">function menu_file_add_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub30" class="code">function menu_file_close_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub31" class="code">function pushtool_fly_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub32" class="code">function menu_EPR_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub33" class="code">function menu_biochem_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub34" class="code">function menu_biochem_crosslink_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub35" class="code">function menu_biochem_mutate_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub36" class="code">function menu_biochem_substitute_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub37" class="code">function menu_EPR_DEER_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub38" class="code">function menu_EPR_access_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub39" class="code">function menu_EPR_dynamics_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub40" class="code">function menu_EPR_P31_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub41" class="code">function menu_file_save_PDB_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub42" class="code">function menu_display_copy_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub43" class="code">function pushtool_detach_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub44" class="code">function pushtool_attach_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub45" class="code">function button_cam_down_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub46" class="code">function button_cam_up_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub47" class="code">function button_cam_right_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub48" class="code">function button_cam_left_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub49" class="code">function menu_edit_undo_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub50" class="code">function menu_edit_redo_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub51" class="code">function button_script_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub52" class="code">function button_cam_zoom_out_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub53" class="code">function button_cam_zoom_in_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub54" class="code">function button_script_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub55" class="code">function menu_Build_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub56" class="code">function menu_predict_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub57" class="code">function menu_predict_sec_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub58" class="code">function menu_predict_tert_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub59" class="code">function menu_predict_quater_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub60" class="code">function menu_predict_top_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub61" class="code">function menu_predict_disorder_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub62" class="code">function menu_predict_domain_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub63" class="code">function menu_predict_hinge_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub64" class="code">function menu_build_sidechains_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub65" class="code">function menu_edit_sec_DSSP_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub66" class="code">function menu_edit_sec_manual_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub67" class="code">function menu_build_sidechains_SCWRL3_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub68" class="code">function menu_build_sidechains_SCAP_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub69" class="code">function menu_predict_hinge_StoneHinge_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub70" class="code">function menu_predict_hinge_HingeMaster_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub71" class="code">function menu_predict_domain_DomainParser_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub72" class="code">function menu_predict_disorder_Spritz_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub73" class="code">function menu_predict_top_MEMSAT3_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub74" class="code">function menu_predict_top_TMHMM_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub75" class="code">function menu_predict_top_Philius_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub76" class="code">function menu_predict_quater_Hex_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub77" class="code">function menu_predict_quater_RosettaDock_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub78" class="code">function menu_predict_quater_HADDOCK_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub79" class="code">function menu_predict_quater_AutoDock_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub80" class="code">function menu_quater_predict_ArgusLab_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub81" class="code">function menu_predict_tert_HHpred_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub82" class="code">function menu_predict_tert_PHYRE_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub83" class="code">function menu_predict_tert_SAM_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub84" class="code">function menu_predict_sec_PHYRE_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub85" class="code">function menu_predict_sec_PsiPRED_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub86" class="code">function menu_predict_sec_SAM_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub87" class="code">function menu_predict_sec_Porter_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub88" class="code">function menu_predict_sec_Prof_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub89" class="code">function menu_predict_sec_SABLE_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub90" class="code">function menu_analysis_Callback(hObject, eventdata, ~)</a></li><li><a href="#_sub91" class="code">function menu_predict_segment_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub92" class="code">function menu_analysis_Ramachandran_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub93" class="code">function menu_analysis_accessibility_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub94" class="code">function menu_predict_tert_Modeller_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub95" class="code">function menu_analysis_contact_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub96" class="code">function menu_display_hierarchy_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub97" class="code">function menu_display_depth_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub98" class="code">function menu_display_color_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub99" class="code">function menu_display_3D_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub100" class="code">function menu_display_3D_CA_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub101" class="code">function menu_3D_display_coil_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub102" class="code">function menu_display_3D_cartoon_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub103" class="code">function menu_display_3D_ribbon_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub104" class="code">function menu_display_3D_wire_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub105" class="code">function menu_display_3D_CA_wire_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub106" class="code">function menu_file_new_pdb_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub107" class="code">function menu_file_new_sequence_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub108" class="code">function menu_file_add_pdb_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub109" class="code">function menu_file_add_sequence_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub110" class="code">function handles=exe(handles,command,hObject)</a></li><li><a href="#_sub111" class="code">function handles=undo_last(handles)</a></li><li><a href="#_sub112" class="code">function handles=redo(handles)</a></li><li><a href="#_sub113" class="code">function handles=run_script(handles,fname)</a></li><li><a href="#_sub114" class="code">function uitoggletool_select_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub115" class="code">function uitoggletool_select_OffCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub116" class="code">function uitoggletool_select_OnCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub117" class="code">function uitoggletool_rotate_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub118" class="code">function uitoggletool_rotate_OffCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub119" class="code">function uitoggletool_rotate_OnCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub120" class="code">function uitoggletool_zoom_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub121" class="code">function uitoggletool_zoom_OffCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub122" class="code">function uitoggletool_zoom_OnCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub123" class="code">function uitoggletool_pan_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub124" class="code">function uitoggletool_pan_OffCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub125" class="code">function uitoggletool_pan_OnCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub126" class="code">function context_model_select_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub127" class="code">function context_model_pan_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub128" class="code">function context_model_color_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub129" class="code">function context_model_trans_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub130" class="code">function pushtool_color_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub131" class="code">function pushtool_trans_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub132" class="code">function pushtool_fullview_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub133" class="code">function menu_display_all_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub134" class="code">function add_and_plot_pdb(hObject,handles,FileName)</a></li><li><a href="#_sub135" class="code">function uipushtool_graphics_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub136" class="code">function menu_display_transparency_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub137" class="code">function togglebutton_depth_cueing_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub138" class="code">function menu_analysis_context_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub139" class="code">function menu_analysis_distance_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub140" class="code">function menu_analysis_angle_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub141" class="code">function menu_analysis_dihedral_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub142" class="code">function uipushtool_context_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub143" class="code">function uipushtool_distance_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub144" class="code">function uipushtool_angle_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub145" class="code">function uipushtool_dihedral_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub146" class="code">function uitoggletool_lock_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub147" class="code">function menu_EPR_label_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub148" class="code">function uipushtool_label_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub149" class="code">function label_selection(hObject, eventdata, handles)</a></li><li><a href="#_sub150" class="code">function pushtool_save_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub151" class="code">function save_model(hObject, eventdata, handles, force, privacy)</a></li><li><a href="#_sub152" class="code">function pushtool_open_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub153" class="code">function open_model(hObject, eventdata, handles, display)</a></li><li><a href="#_sub154" class="code">function pushtool_print_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub155" class="code">function handles=display_model(handles,hObject,camera)</a></li><li><a href="#_sub156" class="code">function menu_epr_access_water_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub157" class="code">function menu_epr_access_oxygen_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub158" class="code">function menu_EPR_site_scan_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub159" class="code">function menu_edit_annotation_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub160" class="code">function menu_predict_CD_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub161" class="code">function uipushtool_annotation_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub162" class="code">function menu_edit_findkey_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub163" class="code">function menu_help_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub164" class="code">function menu_help_overview_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub165" class="code">function menu_help_about_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub166" class="code">function menu_help_credits_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub167" class="code">function pushbutton_main_help_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub168" class="code">function popupmenu_view_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub169" class="code">function popupmenu_view_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub170" class="code">function pushbutton_clear_msg_board_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub171" class="code">function MMM_CloseRequestFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub172" class="code">function menu_help_license_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub173" class="code">function checkbox_log_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub174" class="code">function menu_edit_magic_fit_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub175" class="code">function menu_display_density_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub176" class="code">function menu_file_density_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub177" class="code">function menu_analysis_alignment_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub178" class="code">function menu_file_share_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub179" class="code">function menu_file_share_public_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub180" class="code">function share_model(hObject, eventdata, handles, privacy)</a></li><li><a href="#_sub181" class="code">function menu_file_share_group_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub182" class="code">function menu_EPR_site_scan_chains_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub183" class="code">function menu_EPR_site_scan_residues_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub184" class="code">function menu_analysis_sites_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub185" class="code">function uipushtool_references_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub186" class="code">function menu_edit_references_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub187" class="code">function menu_file_new_pdb_local_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub188" class="code">function menu_file_new_PDB_direct_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub189" class="code">function menu_file_add_PDB_local_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub190" class="code">function menu_file_add_PDB_direct_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub191" class="code">function menu_build_bilayer_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub192" class="code">function menu_build_SAS_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub193" class="code">function menu_help_third_party_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub194" class="code">function menu_edit_bundle_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub195" class="code">function menu_build_secondary_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub196" class="code">function togglebutton_atom_graphics_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub197" class="code">function uipushtool_copy_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub198" class="code">function menu_file_export_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub199" class="code">function menu_file_export_bmp_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub200" class="code">function menu_file_export_emf_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub201" class="code">function menu_file_export_eps_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub202" class="code">function menu_file_export_jpeg_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub203" class="code">function menu_file_export_pdf_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub204" class="code">function menu_file_export_png_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub205" class="code">function menu_file_export_tiff_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub206" class="code">function menu_file_open_no_display_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub207" class="code">function menu_file_preferences_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub208" class="code">function menu_edit_report_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub209" class="code">function menu_built_view_transform_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub210" class="code">function menu_build_view_trafo_x_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub211" class="code">function menu_build_view_trafo_y_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub212" class="code">function menu_build_view_trafo_z_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub213" class="code">function menu_epr_access_NiEDDA_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub214" class="code">function menu_dynamics_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub215" class="code">function menu_dynamics_GNM_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub216" class="code">function menu_dynamics_ANM_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub217" class="code">function menu_build_fit_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub218" class="code">function menu_EPR_site_selection_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub219" class="code">function menu_sidechains_all_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub220" class="code">function menu_sidechains_selected_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub221" class="code">function menu_copy_structure_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub222" class="code">function menu_build_nonstandard_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub223" class="code">function menu_help_bug_report_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub224" class="code">function pushbutton_show_log_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub225" class="code">function menu_build_repair_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub226" class="code">function menu_analysis_crystal_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub227" class="code">function menu_analysis_CryCo_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub228" class="code">function menu_analysis_CSU_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub229" class="code">function pushbutton_view_memory_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub230" class="code">function MMM_WindowScrollWheelFcn(hObject, eventdata, handles)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = MMM_prototype(varargin)</a>
0002 <span class="comment">% MMM_PROTOTYPE M-file for MMM_prototype.fig</span>
0003 <span class="comment">%      MMM_PROTOTYPE, by itself, creates a new MMM_PROTOTYPE or raises the existing</span>
0004 <span class="comment">%      singleton*.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%      H = MMM_PROTOTYPE returns the handle to a new MMM_PROTOTYPE or the handle to</span>
0007 <span class="comment">%      the existing singleton*.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%      MMM_PROTOTYPE('CALLBACK',hObject,eventData,handles,...) calls the local</span>
0010 <span class="comment">%      function named CALLBACK in MMM_PROTOTYPE.M with the given input arguments.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%      MMM_PROTOTYPE('Property','Value',...) creates a new MMM_PROTOTYPE or raises the</span>
0013 <span class="comment">%      existing singleton*.  Starting from the left, property value pairs are</span>
0014 <span class="comment">%      applied to the GUI before MMM_prototype_OpeningFcn gets called.  An</span>
0015 <span class="comment">%      unrecognized property name or invalid value makes property application</span>
0016 <span class="comment">%      stop.  All inputs are passed to MMM_prototype_OpeningFcn via varargin.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%      *See GUI Options on GUIDE's Tools menu.  Choose &quot;GUI allows only one</span>
0019 <span class="comment">%      instance to run (singleton)&quot;.</span>
0020 <span class="comment">%</span>
0021 <span class="comment">% See also: GUIDE, GUIDATA, GUIHANDLES</span>
0022 
0023 <span class="comment">% Edit the above text to modify the response to help MMM_prototype</span>
0024 
0025 <span class="comment">% Last Modified by GUIDE v2.5 13-Dec-2010 17:15:17</span>
0026 
0027 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0028 gui_Singleton = 1;
0029 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0030                    <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0031                    <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction MMM_prototype_OpeningFcn(hObject, eventdata, handles, varargin)">MMM_prototype_OpeningFcn</a>, <span class="keyword">...</span>
0032                    <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = MMM_prototype_OutputFcn(hObject, eventdata, handles)">MMM_prototype_OutputFcn</a>, <span class="keyword">...</span>
0033                    <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0034                    <span class="string">'gui_Callback'</span>,   []);
0035 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0036     gui_State.gui_Callback = str2func(varargin{1});
0037 <span class="keyword">end</span>
0038 
0039 <span class="keyword">if</span> nargout
0040     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0041 <span class="keyword">else</span>
0042     gui_mainfcn(gui_State, varargin{:});
0043 <span class="keyword">end</span>
0044 <span class="comment">% End initialization code - DO NOT EDIT</span>
0045 
0046 
0047 <span class="comment">% --- Executes just before MMM_prototype is made visible.</span>
0048 <a name="_sub1" href="#_subfunctions" class="code">function MMM_prototype_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0049 <span class="comment">% This function has no output args, see OutputFcn.</span>
0050 <span class="comment">% hObject    handle to figure</span>
0051 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0052 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0053 <span class="comment">% varargin   command line arguments to MMM_prototype (see VARARGIN)</span>
0054 
0055 <span class="comment">% Choose default command line output for MMM_prototype</span>
0056 handles.output = hObject;
0057 handles.zoom_step=1.05; <span class="comment">% scaling factor for camera angle on zoom out</span>
0058 handles.view_step=5;
0059 
0060 <span class="comment">% declare global structure variables for all figures</span>
0061 
0062 <span class="keyword">global</span> hMain
0063 <span class="keyword">global</span> MMM_info
0064 <span class="keyword">global</span> MMM_icon
0065 <span class="keyword">global</span> rootdir
0066 <span class="keyword">global</span> third_party
0067 
0068 initialize_MMM
0069 
0070 
0071 set(handles.MMM,<span class="string">'Name'</span>,MMM_info.title);
0072 
0073 hMain=handles;
0074 hMain.scriptpath=strcat(rootdir,<span class="string">'scripts/'</span>);
0075 hMain.figure=handles.MMM;
0076 hMain.detached=0;
0077 hMain.edit_command_line=handles.edit_command_line;
0078 hMain.text_message_board=handles.text_message_board;
0079 hMain.uitoggletool_rotate=handles.uitoggletool_rotate;
0080 hMain.uitoggletool_zoom=handles.uitoggletool_zoom;
0081 hMain.uitoggletool_select=handles.uitoggletool_select;
0082 hMain.uitoggletool_pan=handles.uitoggletool_pan;
0083 hMain.color=<span class="string">'black'</span>;
0084 hMain.store_undo=1;
0085 hMain.history_num=20;
0086 hMain.depth_cue=0;
0087 <span class="keyword">for</span> k=1:hMain.history_num, hMain.history{k}=<span class="string">''</span>; <span class="keyword">end</span>;
0088 <span class="keyword">for</span> k=1:hMain.history_num, hMain.undo{k}=<span class="string">''</span>; <span class="keyword">end</span>;
0089 <span class="keyword">for</span> k=1:hMain.history_num, hMain.redo{k}=<span class="string">''</span>; <span class="keyword">end</span>;
0090 hMain.history_poi=1;
0091 hMain.edit_poi=1;
0092 hMain.undo_poi=1;
0093 hMain.redo_poi=1;
0094 hMain.selected=[];
0095 hMain.axes_model=handles.axes_model;
0096 hMain.axes_frame=handles.axes_frame;
0097 hMain.hierarchy_display=0;
0098 hMain.current_reference=0;
0099 hMain.alpha=1;
0100 hMain.color_selection=[0,0,1];
0101 hMain.z_analysis=0;
0102 hMain.statistics=0;
0103 hMain.rotamer_PDB=0;
0104 hMain.graph_update=0;
0105 hMain.current_tag=<span class="string">''</span>;
0106 hMain.virgin=1;
0107 hMain.site_scan_residue=0;
0108 hMain.annotation_open=[];
0109 hMain.reference_open=[];
0110 hMain.auxiliary=[];
0111 hMain.atom_graphics_mode=1;
0112 hMain.atom_graphics_auto=false;
0113 hMain.atom_graphics_requested=1;
0114 hMain.keyword_request=<span class="string">''</span>; <span class="comment">% for keyword request to annotation window</span>
0115 hMain.report_file=<span class="string">''</span>;
0116 hMain.ANM_plot=false;
0117 
0118 axes(handles.axes_model);
0119 cla reset
0120 [img,map]=imread(<span class="string">'MMM_title.jpg'</span>);
0121 colormap(map);
0122 image(img);
0123 axis off
0124 axis equal
0125 
0126 hMain.view_memory_camup=get(hMain.axes_model,<span class="string">'CameraUpVector'</span>);
0127 hMain.view_memory_campos=get(hMain.axes_model,<span class="string">'CameraPosition'</span>);
0128 hMain.view_memory_camtar=get(hMain.axes_model,<span class="string">'CameraTarget'</span>);
0129 hMain.view_memory_camview=get(hMain.axes_model,<span class="string">'CameraViewAngle'</span>);
0130 hMain.view_memory_camproj=get(hMain.axes_model,<span class="string">'Projection'</span>);
0131 
0132 session_start=datestr(now,<span class="string">'yyyy-mm-dd_HH-MM-SS'</span>);
0133 defname=sprintf(<span class="string">'MMM_%s.log'</span>,session_start);
0134 pathname=strcat(rootdir,<span class="string">'tmp/'</span>);
0135 hMain.logfile=strcat(pathname,defname);
0136 <span class="keyword">if</span> get(handles.checkbox_log,<span class="string">'Value'</span>),
0137     fid=fopen(hMain.logfile,<span class="string">'w'</span>);
0138     fprintf(fid,<span class="string">'--- MMM logfile %s ---\n\nver&gt; %s, %s\n'</span>,defname,MMM_info.title,MMM_info.date);
0139     [comp,maxsize]=computer;
0140     fprintf(fid,<span class="string">'env&gt; running on Matlab version %s on %s\nenv&gt; with %g MByte maximum array size.\n'</span>,version,comp,maxsize/1e6);
0141     fclose(fid);
0142     diary(hMain.logfile);
0143 <span class="keyword">end</span>;
0144 
0145 add_msg_board(<span class="string">'MMM initalized'</span>);
0146 
0147 command=sprintf(<span class="string">'bckg grey'</span>);
0148 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0149 
0150 load helpicon
0151 set(handles.pushbutton_main_help,<span class="string">'CData'</span>,cdata);
0152 
0153 tmp_check;
0154 
0155 <span class="keyword">if</span> ~third_party.msms,
0156     set(handles.menu_EPR_access,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0157     set(handles.menu_analysis_accessibility,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0158     set(handles.menu_build_SAS,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0159     set(handles.menu_build_bilayer,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0160 <span class="keyword">end</span>;
0161 
0162 <span class="keyword">if</span> ~third_party.scwrl4,
0163     set(handles.menu_build_repair,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0164     set(handles.menu_build_sidechains,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0165     set(handles.menu_biochem_mutate,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0166     set(handles.menu_analysis_crystal,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0167 <span class="keyword">end</span>;
0168 
0169 <span class="keyword">if</span> ~third_party.dssp,
0170     set(handles.menu_build_secondary,<span class="string">'Enable'</span>,<span class="string">'off'</span>);
0171 <span class="keyword">end</span>;
0172 
0173 j = get(handles.MMM,<span class="string">'javaframe'</span>);    
0174 j.setFigureIcon(javax.swing.ImageIcon(im2java(MMM_icon)));  <span class="comment">%create a java image and set the figure icon</span>
0175     
0176 <span class="comment">% Update handles structure</span>
0177 guidata(hObject, handles);
0178 
0179 <span class="comment">% UIWAIT makes MMM_prototype wait for user response (see UIRESUME)</span>
0180 <span class="comment">% uiwait(handles.MMM);</span>
0181 
0182 
0183 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0184 <a name="_sub2" href="#_subfunctions" class="code">function varargout = MMM_prototype_OutputFcn(hObject, eventdata, handles) </a>
0185 <span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
0186 <span class="comment">% hObject    handle to figure</span>
0187 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0188 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0189 
0190 <span class="comment">% Get default command line output from handles structure</span>
0191 varargout{1} = handles.output;
0192 
0193 <a name="_sub3" href="#_subfunctions" class="code">function edit_command_line_Callback(hObject, eventdata, handles)</a>
0194 <span class="comment">% hObject    handle to edit_command_line (see GCBO)</span>
0195 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0196 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0197 
0198 <span class="comment">% Hints: get(hObject,'String') returns contents of edit_command_line as text</span>
0199 <span class="comment">%        str2double(get(hObject,'String')) returns contents of edit_command_line as a double</span>
0200 command_line=get(hObject,<span class="string">'String'</span>);
0201 [command,args]=strtok(command_line); <span class="comment">% check for commands that are not treated by the interpreter</span>
0202 <span class="keyword">switch</span> command
0203     <span class="keyword">case</span> <span class="string">'undo'</span>
0204         handles=<a href="#_sub111" class="code" title="subfunction handles=undo_last(handles)">undo_last</a>(handles);
0205     <span class="keyword">case</span> <span class="string">'redo'</span>
0206         handles=<a href="#_sub112" class="code" title="subfunction handles=redo(handles)">redo</a>(handles);
0207     <span class="keyword">otherwise</span>
0208         handles=cmd(handles,command_line);
0209 <span class="keyword">end</span>;
0210 set(hObject,<span class="string">'String'</span>,<span class="string">''</span>);
0211 guidata(hObject, handles);
0212 
0213 
0214 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0215 <a name="_sub4" href="#_subfunctions" class="code">function edit_command_line_CreateFcn(hObject, eventdata, handles)</a>
0216 <span class="comment">% hObject    handle to edit_command_line (see GCBO)</span>
0217 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0218 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0219 
0220 <span class="comment">% Hint: edit controls usually have a white background on Windows.</span>
0221 <span class="comment">%       See ISPC and COMPUTER.</span>
0222 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0223     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0224 <span class="keyword">end</span>
0225 
0226 <span class="comment">% --- If Enable == 'on', executes on mouse press in 5 pixel border.</span>
0227 <span class="comment">% --- Otherwise, executes on mouse press in 5 pixel border or over edit_command_line.</span>
0228 <a name="_sub5" href="#_subfunctions" class="code">function edit_command_line_ButtonDownFcn(hObject, eventdata, handles)</a>
0229 <span class="comment">% hObject    handle to edit_command_line (see GCBO)</span>
0230 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0231 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0232 set(hObject,<span class="string">'String'</span>,<span class="string">''</span>);
0233 set(hObject,<span class="string">'ForegroundColor'</span>,<span class="string">'k'</span>);
0234 set(hObject,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
0235 guidata(hObject, handles);
0236 
0237 <span class="comment">% --- Executes on key press with focus on edit_command_line and none of its controls.</span>
0238 <a name="_sub6" href="#_subfunctions" class="code">function edit_command_line_KeyPressFcn(hObject, eventdata, handles)</a>
0239 <span class="comment">% hObject    handle to edit_command_line (see GCBO)</span>
0240 <span class="comment">% eventdata  structure with the following fields (see UICONTROL)</span>
0241 <span class="comment">%    Key: name of the key that was pressed, in lower case</span>
0242 <span class="comment">%    Character: character interpretation of the key(s) that was pressed</span>
0243 <span class="comment">%    Modifier: name(s) of the modifier key(s) (i.e., control, shift) pressed</span>
0244 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0245 
0246 <span class="keyword">global</span> hMain
0247 
0248 
0249 <span class="keyword">switch</span> eventdata.Key
0250     <span class="keyword">case</span> <span class="string">'uparrow'</span>
0251         command=hMain.history{hMain.edit_poi};
0252         hMain.edit_poi=hMain.edit_poi-1;
0253         <span class="keyword">if</span> hMain.edit_poi&lt;1,
0254             hMain.edit_poi=hMain.history_num;
0255         <span class="keyword">end</span>;
0256         set(hObject,<span class="string">'String'</span>,command);
0257     <span class="keyword">case</span> <span class="string">'downarrow'</span>
0258         <span class="keyword">if</span> ~isempty(eventdata.Modifier)
0259             command=<span class="string">''</span>;
0260         <span class="keyword">else</span>
0261             command=hMain.history{hMain.edit_poi};
0262             hMain.edit_poi=hMain.edit_poi+1;
0263             <span class="keyword">if</span> hMain.edit_poi&gt;hMain.history_num,
0264                 hMain.edit_poi=1;
0265             <span class="keyword">end</span>;
0266         <span class="keyword">end</span>;
0267         set(hObject,<span class="string">'String'</span>,command);
0268 <span class="keyword">end</span>;
0269 
0270 <span class="comment">% --- Executes on button press in button_cam_zoom_out.</span>
0271 <a name="_sub7" href="#_subfunctions" class="code">function button_cam_zoom_out_Callback(hObject, eventdata, handles)</a>
0272 <span class="comment">% hObject    handle to button_cam_zoom_out (see GCBO)</span>
0273 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0274 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0275 
0276 command=sprintf(<span class="string">'zoom out'</span>);
0277 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0278 
0279 <span class="comment">% --- Executes on button press in button_cam_zoom_in.</span>
0280 <a name="_sub8" href="#_subfunctions" class="code">function button_cam_zoom_in_Callback(hObject, eventdata, handles)</a>
0281 <span class="comment">% hObject    handle to button_cam_zoom_in (see GCBO)</span>
0282 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0283 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0284 
0285 command=sprintf(<span class="string">'zoom in'</span>);
0286 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0287 
0288 <span class="comment">% --------------------------------------------------------------------</span>
0289 <a name="_sub9" href="#_subfunctions" class="code">function context_model_rotate_Callback(hObject, eventdata, handles)</a>
0290 <span class="comment">% hObject    handle to context_model_rotate (see GCBO)</span>
0291 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0292 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0293 
0294 <span class="keyword">global</span> hMain
0295 <span class="keyword">global</span> hModel
0296 
0297 <span class="keyword">if</span> hMain.detached
0298     fig=hModel.figure;
0299 <span class="keyword">else</span>
0300     fig=hMain.figure;
0301 <span class="keyword">end</span>;
0302 
0303 set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'on'</span>);
0304 set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'off'</span>);
0305 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'off'</span>);
0306 set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'off'</span>);
0307 set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
0308 set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0309 set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0310 set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0311 view3D(fig,<span class="string">'rot'</span>);
0312     
0313 guidata(hObject,handles);
0314 
0315 
0316 <span class="comment">% --------------------------------------------------------------------</span>
0317 <a name="_sub10" href="#_subfunctions" class="code">function context_model_zoom_Callback(hObject, eventdata, handles)</a>
0318 <span class="comment">% hObject    handle to context_model_zoom (see GCBO)</span>
0319 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0320 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0321 
0322 <span class="keyword">global</span> hMain
0323 <span class="keyword">global</span> hModel
0324 
0325 <span class="keyword">if</span> hMain.detached
0326     fig=hModel.figure;
0327 <span class="keyword">else</span>
0328     fig=hMain.figure;
0329 <span class="keyword">end</span>;
0330 
0331 set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'off'</span>);
0332 set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'on'</span>);
0333 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'off'</span>);
0334 set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'off'</span>);
0335 set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0336 set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
0337 set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0338 set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
0339 view3D(fig,<span class="string">'zoom'</span>);
0340     
0341 guidata(hObject,handles);
0342 
0343 <span class="comment">% --------------------------------------------------------------------</span>
0344 <a name="_sub11" href="#_subfunctions" class="code">function context_model_bckg_Callback(hObject, eventdata, handles)</a>
0345 <span class="comment">% hObject    handle to context_model_bckg (see GCBO)</span>
0346 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0347 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0348 
0349 
0350 <span class="comment">% --------------------------------------------------------------------</span>
0351 <a name="_sub12" href="#_subfunctions" class="code">function context_model_detach_Callback(hObject, eventdata, handles)</a>
0352 <span class="comment">% hObject    handle to context_model_detach (see GCBO)</span>
0353 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0354 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0355 <span class="comment">% global hMain</span>
0356 <span class="comment">% global hModel</span>
0357 
0358 command=sprintf(<span class="string">'detach'</span>);
0359 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0360 
0361 <span class="comment">% --------------------------------------------------------------------</span>
0362 <a name="_sub13" href="#_subfunctions" class="code">function context_model_attach_Callback(hObject, eventdata, handles)</a>
0363 <span class="comment">% hObject    handle to context_model_attach (see GCBO)</span>
0364 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0365 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0366 <span class="comment">% global hMain</span>
0367 <span class="comment">% global hModel</span>
0368 
0369 command=sprintf(<span class="string">'attach'</span>);
0370 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0371 
0372 <span class="comment">% --------------------------------------------------------------------</span>
0373 <a name="_sub14" href="#_subfunctions" class="code">function context_model_bckg_black_Callback(hObject, eventdata, handles)</a>
0374 <span class="comment">% hObject    handle to context_model_bckg_black (see GCBO)</span>
0375 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0376 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0377 
0378 command=sprintf(<span class="string">'bckg black'</span>);
0379 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0380 
0381 
0382 
0383 <span class="comment">% --------------------------------------------------------------------</span>
0384 <a name="_sub15" href="#_subfunctions" class="code">function context_model_bckg_grey_Callback(hObject, eventdata, handles)</a>
0385 <span class="comment">% hObject    handle to context_model_bckg_grey (see GCBO)</span>
0386 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0387 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0388 
0389 command=sprintf(<span class="string">'bckg grey'</span>);
0390 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0391 
0392 
0393 <span class="comment">% --------------------------------------------------------------------</span>
0394 <a name="_sub16" href="#_subfunctions" class="code">function context_model_bckg_white_Callback(hObject, eventdata, handles)</a>
0395 <span class="comment">% hObject    handle to context_model_bckg_white (see GCBO)</span>
0396 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0397 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0398 command=sprintf(<span class="string">'bckg white'</span>);
0399 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0400 
0401 
0402 <span class="comment">% --------------------------------------------------------------------</span>
0403 <a name="_sub17" href="#_subfunctions" class="code">function context_model_Callback(hObject, eventdata, handles)</a>
0404 <span class="comment">% hObject    handle to context_model (see GCBO)</span>
0405 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0406 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0407 
0408 
0409 <span class="comment">% --------------------------------------------------------------------</span>
0410 <a name="_sub18" href="#_subfunctions" class="code">function menu_file_Callback(hObject, eventdata, handles)</a>
0411 <span class="comment">% hObject    handle to menu_file (see GCBO)</span>
0412 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0413 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0414 
0415 
0416 <span class="comment">% --------------------------------------------------------------------</span>
0417 <a name="_sub19" href="#_subfunctions" class="code">function menu_edit_Callback(hObject, eventdata, handles)</a>
0418 <span class="comment">% hObject    handle to menu_edit (see GCBO)</span>
0419 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0420 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0421 
0422 
0423 <span class="comment">% --------------------------------------------------------------------</span>
0424 <a name="_sub20" href="#_subfunctions" class="code">function menu_display_Callback(hObject, eventdata, handles)</a>
0425 <span class="comment">% hObject    handle to menu_display (see GCBO)</span>
0426 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0427 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0428 
0429 
0430 <span class="comment">% --------------------------------------------------------------------</span>
0431 <a name="_sub21" href="#_subfunctions" class="code">function menu_display_fly_Callback(hObject, eventdata, handles)</a>
0432 <span class="comment">% hObject    handle to menu_display_fly (see GCBO)</span>
0433 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0434 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0435 
0436 command=sprintf(<span class="string">'zoom in'</span>);
0437 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0438 
0439 <span class="comment">% --------------------------------------------------------------------</span>
0440 <a name="_sub22" href="#_subfunctions" class="code">function menu_display_mode_Callback(hObject, eventdata, handles)</a>
0441 <span class="comment">% hObject    handle to menu_display_mode (see GCBO)</span>
0442 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0443 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0444 
0445 
0446 <span class="comment">% --------------------------------------------------------------------</span>
0447 <a name="_sub23" href="#_subfunctions" class="code">function menu_edit_center_Callback(hObject, eventdata, handles)</a>
0448 <span class="comment">% hObject    handle to menu_edit_center (see GCBO)</span>
0449 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0450 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0451 
0452 <span class="keyword">global</span> model
0453 <span class="keyword">global</span> hMain
0454 
0455 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
0456 drawnow;
0457 snum=model.current_structure;
0458 [msg,coor]=get_object(snum,<span class="string">'xyz'</span>);
0459 <span class="keyword">if</span> iscell(coor),
0460     coor=coor{1};
0461 <span class="keyword">end</span>;
0462 center=mean(coor,1);
0463 transmat=affine(<span class="string">'translation'</span>,-center);
0464 transform_structure(snum,transmat);
0465 
0466 model.info{snum}.center=[0,0,0];
0467 camera.pos  = get(hMain.axes_model,<span class="string">'cameraposition'</span> );
0468 camera.targ = get(hMain.axes_model,<span class="string">'cameratarget'</span>   );
0469 camera.dar  = get(hMain.axes_model,<span class="string">'dataaspectratio'</span>);
0470 camera.up   = get(hMain.axes_model,<span class="string">'cameraupvector'</span> );
0471 <a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles, hObject,camera);
0472 guidata(handles.axes_model,hMain);
0473 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
0474 drawnow;
0475 
0476 
0477 <span class="comment">% --------------------------------------------------------------------</span>
0478 <a name="_sub24" href="#_subfunctions" class="code">function menu_edit_symmetry_Callback(hObject, eventdata, handles)</a>
0479 <span class="comment">% hObject    handle to menu_edit_symmetry (see GCBO)</span>
0480 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0481 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0482 
0483 <span class="keyword">global</span> model
0484 <span class="keyword">global</span> hMain
0485 
0486 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
0487 drawnow;
0488 snum=model.current_structure;
0489 
0490 [p0,v,msg]=symmetry_axis;
0491 <span class="keyword">if</span> ~isempty(p0) &amp;&amp; ~isempty(v),
0492     <span class="keyword">if</span> msg.error,
0493         add_msg_board(msg.text);
0494     <span class="keyword">end</span>;
0495     v=v/norm(v);
0496     th=acos(v(3));
0497     <span class="keyword">if</span> norm(v(1:2))&gt;1e-6,
0498         v=v(1:2)/norm(v(1:2));
0499     <span class="keyword">else</span>
0500         v=[0,0];
0501     <span class="keyword">end</span>;
0502     phi=atan2(v(2),v(1));
0503     transmat1=affine(<span class="string">'translation'</span>,-p0);
0504     transmat2=affine(<span class="string">'Euler'</span>,[-phi,-th,0]);
0505     transform_structure(snum,{transmat1,transmat2});
0506     [msg,coor]=get_object(snum,<span class="string">'xyz'</span>);
0507     <span class="keyword">if</span> iscell(coor),
0508         coor=coor{1};
0509     <span class="keyword">end</span>;
0510     center=mean(coor,1);
0511     transmat=affine(<span class="string">'translation'</span>,-center);
0512     transform_structure(snum,transmat);
0513     <a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles, hObject);
0514 <span class="keyword">else</span>
0515     add_msg_board(<span class="string">'Selected objects do not define a symmetry axis or nothing selected.'</span>);
0516 <span class="keyword">end</span>;
0517 
0518 guidata(handles.axes_model,hMain);
0519 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
0520 drawnow;
0521 
0522 
0523 <span class="comment">% --------------------------------------------------------------------</span>
0524 <a name="_sub25" href="#_subfunctions" class="code">function menu_edit_domain_Callback(hObject, eventdata, handles)</a>
0525 <span class="comment">% hObject    handle to menu_edit_domain (see GCBO)</span>
0526 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0527 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0528 
0529 [indices,msg]=resolve_address(<span class="string">'*'</span>);
0530 <span class="keyword">if</span> msg.error&gt;0,
0531     add_msg_board(<span class="string">'Domain definition requires selection of residues'</span>);
0532     add_msg_board(sprintf(<span class="string">'ERROR: %s'</span>,msg.text));
0533     <span class="keyword">return</span>;
0534 <span class="keyword">end</span>;
0535 <span class="keyword">if</span> isempty(indices),
0536     add_msg_board(<span class="string">'Domain definition requires selection of residues'</span>);
0537     add_msg_board(<span class="string">'ERROR: No object selected.'</span>);
0538     <span class="keyword">return</span>;
0539 <span class="keyword">end</span>;
0540 [m,n]=size(indices);
0541 fail=0;
0542 <span class="keyword">for</span> k=1:m,
0543     cindices=indices(k,:);
0544     cindices=cindices(cindices&gt;0);
0545     <span class="keyword">if</span> length(cindices)~=4,
0546         fail=1; <span class="keyword">break</span>;
0547     <span class="keyword">end</span>;
0548 <span class="keyword">end</span>;
0549 <span class="keyword">if</span> fail,
0550     add_msg_board(<span class="string">'Domain definition requires selection of residues'</span>);
0551     add_msg_board(<span class="string">'ERROR: Objects other than residues are selected.'</span>);
0552     <span class="keyword">return</span>;
0553 <span class="keyword">end</span>;
0554 
0555 name=inputdlg(<span class="string">'Domain name'</span>,<span class="string">'Domain definition from selected objects'</span>);
0556 
0557 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,sprintf(<span class="string">'domain * %s'</span>,char(name{1})),hObject);
0558 
0559 <span class="comment">% --------------------------------------------------------------------</span>
0560 <a name="_sub26" href="#_subfunctions" class="code">function menu_file_new_Callback(hObject, eventdata, handles)</a>
0561 <span class="comment">% hObject    handle to menu_file_new (see GCBO)</span>
0562 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0563 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0564 
0565 
0566 <span class="comment">% --------------------------------------------------------------------</span>
0567 <a name="_sub27" href="#_subfunctions" class="code">function menu_file_save_Callback(hObject, eventdata, handles)</a>
0568 <span class="comment">% hObject    handle to menu_file_save (see GCBO)</span>
0569 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0570 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0571 
0572 <a href="#_sub151" class="code" title="subfunction save_model(hObject, eventdata, handles, force, privacy)">save_model</a>(hObject, eventdata, handles);
0573 
0574 <span class="comment">% --------------------------------------------------------------------</span>
0575 <a name="_sub28" href="#_subfunctions" class="code">function menu_file_load_Callback(hObject, eventdata, handles)</a>
0576 <span class="comment">% hObject    handle to menu_file_load (see GCBO)</span>
0577 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0578 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0579 
0580 <span class="keyword">global</span> model
0581 
0582 doit=0;
0583 <span class="keyword">if</span> ~exist(<span class="string">'model'</span>,<span class="string">'var'</span>) || isempty(model),
0584     doit=1;
0585 <span class="keyword">else</span>
0586     button = questdlg(<span class="string">'Do you want to delete old model?'</span>,<span class="string">'New model will overwrite existing model'</span>,<span class="string">'No'</span>);
0587     <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
0588         doit=1;
0589     <span class="keyword">end</span>;
0590 <span class="keyword">end</span>;
0591 
0592 <span class="keyword">if</span> doit,
0593     <a href="#_sub153" class="code" title="subfunction open_model(hObject, eventdata, handles, display)">open_model</a>(hObject, eventdata, handles);
0594 <span class="keyword">else</span>
0595     add_msg_board(<span class="string">'Opening new model cancelled by user'</span>);
0596 <span class="keyword">end</span>;
0597 
0598 add_msg_board(<span class="string">'Model loaded.'</span>);
0599 drawnow
0600 
0601 <span class="comment">% --------------------------------------------------------------------</span>
0602 <a name="_sub29" href="#_subfunctions" class="code">function menu_file_add_Callback(hObject, eventdata, handles)</a>
0603 <span class="comment">% hObject    handle to menu_file_add (see GCBO)</span>
0604 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0605 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0606 
0607 
0608 <span class="comment">% --------------------------------------------------------------------</span>
0609 <a name="_sub30" href="#_subfunctions" class="code">function menu_file_close_Callback(hObject, eventdata, handles)</a>
0610 <span class="comment">% hObject    handle to menu_file_close (see GCBO)</span>
0611 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0612 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0613 
0614 <span class="keyword">global</span> hMain
0615 <span class="keyword">global</span> hModel
0616 
0617 <span class="keyword">if</span> hMain.detached,
0618     set(handles.axes_model,<span class="string">'Position'</span>,hMain.oldpos);
0619     set(handles.axes_model,<span class="string">'Parent'</span>,hMain.figure);
0620     set(handles.panel_model,<span class="string">'Title'</span>,<span class="string">'Model'</span>);
0621     view3D(hModel.figure,<span class="string">'off'</span>);
0622     close(hModel.figure);
0623 <span class="keyword">end</span>;
0624 <span class="keyword">if</span> hMain.hierarchy_display,
0625     close(hMain.hierarchy_window);
0626 <span class="keyword">end</span>;
0627 close(handles.MMM);
0628 
0629 <span class="comment">% --------------------------------------------------------------------</span>
0630 <a name="_sub31" href="#_subfunctions" class="code">function pushtool_fly_ClickedCallback(hObject, eventdata, handles)</a>
0631 <span class="comment">% hObject    handle to pushtool_fly (see GCBO)</span>
0632 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0633 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0634 
0635 command=sprintf(<span class="string">'zoom in'</span>);
0636 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0637 
0638 <span class="comment">% [msg,all_graphics]=get_object('*','graphics'); % get graphics information for all objects</span>
0639 <span class="comment">% m=length(all_graphics);</span>
0640 <span class="comment">% if m&lt;1,</span>
0641 <span class="comment">%     return;</span>
0642 <span class="comment">% end;</span>
0643 <span class="comment">% ghandles=zeros(1,10000);</span>
0644 <span class="comment">% poi=0;</span>
0645 <span class="comment">% if m==1,</span>
0646 <span class="comment">%     ghandles=all_graphics.objects;</span>
0647 <span class="comment">%     poi2=length(ghandles);</span>
0648 <span class="comment">% else</span>
0649 <span class="comment">%     for k=1:m,</span>
0650 <span class="comment">%         poi2=poi+length(all_graphics{k}.objects);</span>
0651 <span class="comment">%         ghandles(poi+1:poi2)=all_graphics{k}.objects;</span>
0652 <span class="comment">%         poi=poi2;</span>
0653 <span class="comment">%     end;</span>
0654 <span class="comment">% end;</span>
0655 <span class="comment">% ghandles=ghandles(1:poi2);</span>
0656 <span class="comment">% camlookat(ghandles);</span>
0657 
0658 
0659 <span class="comment">% --------------------------------------------------------------------</span>
0660 <a name="_sub32" href="#_subfunctions" class="code">function menu_EPR_Callback(hObject, eventdata, handles)</a>
0661 <span class="comment">% hObject    handle to menu_EPR (see GCBO)</span>
0662 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0663 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0664 
0665 
0666 <span class="comment">% --------------------------------------------------------------------</span>
0667 <a name="_sub33" href="#_subfunctions" class="code">function menu_biochem_Callback(hObject, eventdata, handles)</a>
0668 <span class="comment">% hObject    handle to menu_biochem (see GCBO)</span>
0669 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0670 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0671 
0672 
0673 <span class="comment">% --------------------------------------------------------------------</span>
0674 <a name="_sub34" href="#_subfunctions" class="code">function menu_biochem_crosslink_Callback(hObject, eventdata, handles)</a>
0675 <span class="comment">% hObject    handle to menu_biochem_crosslink (see GCBO)</span>
0676 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0677 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0678 
0679 
0680 <span class="comment">% --------------------------------------------------------------------</span>
0681 <a name="_sub35" href="#_subfunctions" class="code">function menu_biochem_mutate_Callback(hObject, eventdata, handles)</a>
0682 <span class="comment">% hObject    handle to menu_biochem_mutate (see GCBO)</span>
0683 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0684 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0685 
0686 <span class="keyword">global</span> exchange_container
0687 
0688 select_type;
0689 
0690 mutate(<span class="string">'*'</span>,exchange_container);
0691 guidata(hObject,handles);
0692 
0693 
0694 <span class="comment">% --------------------------------------------------------------------</span>
0695 <a name="_sub36" href="#_subfunctions" class="code">function menu_biochem_substitute_Callback(hObject, eventdata, handles)</a>
0696 <span class="comment">% hObject    handle to menu_biochem_substitute (see GCBO)</span>
0697 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0698 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0699 
0700 
0701 <span class="comment">% --------------------------------------------------------------------</span>
0702 <a name="_sub37" href="#_subfunctions" class="code">function menu_EPR_DEER_Callback(hObject, eventdata, handles)</a>
0703 <span class="comment">% hObject    handle to menu_EPR_DEER (see GCBO)</span>
0704 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0705 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0706 
0707 deer_window;
0708 guidata(hObject,handles);
0709 
0710 
0711 <span class="comment">% --------------------------------------------------------------------</span>
0712 <a name="_sub38" href="#_subfunctions" class="code">function menu_EPR_access_Callback(hObject, eventdata, handles)</a>
0713 <span class="comment">% hObject    handle to menu_EPR_access (see GCBO)</span>
0714 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0715 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0716 
0717 
0718 <span class="comment">% --------------------------------------------------------------------</span>
0719 <a name="_sub39" href="#_subfunctions" class="code">function menu_EPR_dynamics_Callback(hObject, eventdata, handles)</a>
0720 <span class="comment">% hObject    handle to menu_EPR_dynamics (see GCBO)</span>
0721 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0722 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0723 command=sprintf(<span class="string">'EPRdyn'</span>);
0724 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0725 
0726 
0727 <span class="comment">% --------------------------------------------------------------------</span>
0728 <a name="_sub40" href="#_subfunctions" class="code">function menu_EPR_P31_Callback(hObject, eventdata, handles)</a>
0729 <span class="comment">% hObject    handle to menu_EPR_P31 (see GCBO)</span>
0730 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0731 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0732 
0733 ENDOR_window;
0734 
0735 <span class="comment">% --------------------------------------------------------------------</span>
0736 <a name="_sub41" href="#_subfunctions" class="code">function menu_file_save_PDB_Callback(hObject, eventdata, handles)</a>
0737 <span class="comment">% hObject    handle to menu_file_save_PDB (see GCBO)</span>
0738 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0739 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0740 
0741 <span class="keyword">global</span> model
0742 
0743 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
0744 
0745 <span class="keyword">if</span> model.current_structure&lt;1,
0746     add_msg_board(<span class="string">'### ERROR ### No structure available'</span>);
0747     guidata(hObject,handles);
0748     <span class="keyword">return</span>;
0749 <span class="keyword">else</span>
0750     idCode=model.info{model.current_structure}.idCode;
0751     <span class="keyword">if</span> isempty(idCode), idCode=<span class="string">'AMMM'</span>; <span class="keyword">end</span>;
0752     idCode(1)=char(idCode(1)+16);
0753 <span class="keyword">end</span>;
0754 default_name=sprintf(<span class="string">'%s.pdb'</span>,idCode);
0755 
0756 [filename, pathname] = uiputfile(default_name, <span class="string">'Save current structure as PDB'</span>);
0757 <span class="keyword">if</span> isequal(filename,0) || isequal(pathname,0)
0758     message.text=<span class="string">'Save as PDB cancelled by user'</span>;
0759     message.error=1;
0760 <span class="keyword">else</span>
0761     fname=fullfile(pathname, filename);
0762     msg=sprintf(<span class="string">'Current structure saved as PDB file: %s'</span>,fname);
0763     add_msg_board(msg);
0764     message=wr_pdb(fname,idCode);
0765 <span class="keyword">end</span>
0766 
0767 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
0768 
0769 <span class="keyword">if</span> message.error,
0770     add_msg_board(message.text);
0771 <span class="keyword">end</span>;
0772 
0773 guidata(hObject,handles);
0774 
0775 <span class="comment">% --------------------------------------------------------------------</span>
0776 <a name="_sub42" href="#_subfunctions" class="code">function menu_display_copy_Callback(hObject, eventdata, handles)</a>
0777 <span class="comment">% hObject    handle to menu_display_copy (see GCBO)</span>
0778 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0779 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0780 print(handles.MMM,<span class="string">'-dmeta'</span>);
0781 
0782 <span class="comment">% --------------------------------------------------------------------</span>
0783 <a name="_sub43" href="#_subfunctions" class="code">function pushtool_detach_ClickedCallback(hObject, eventdata, handles)</a>
0784 <span class="comment">% hObject    handle to pushtool_detach (see GCBO)</span>
0785 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0786 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0787 
0788 command=sprintf(<span class="string">'detach'</span>);
0789 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0790 
0791 <span class="comment">% --------------------------------------------------------------------</span>
0792 <a name="_sub44" href="#_subfunctions" class="code">function pushtool_attach_ClickedCallback(hObject, eventdata, handles)</a>
0793 <span class="comment">% hObject    handle to pushtool_attach (see GCBO)</span>
0794 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0795 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0796 
0797 command=sprintf(<span class="string">'attach'</span>);
0798 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
0799 
0800 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0801 <a name="_sub45" href="#_subfunctions" class="code">function button_cam_down_CreateFcn(hObject, eventdata, handles)</a>
0802 <span class="comment">% hObject    handle to button_cam_down (see GCBO)</span>
0803 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0804 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0805 load down_button
0806 set(hObject,<span class="string">'CData'</span>,icon_data);
0807 
0808 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0809 <a name="_sub46" href="#_subfunctions" class="code">function button_cam_up_CreateFcn(hObject, eventdata, handles)</a>
0810 <span class="comment">% hObject    handle to button_cam_up (see GCBO)</span>
0811 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0812 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0813 load up_button
0814 set(hObject,<span class="string">'CData'</span>,icon_data);
0815 
0816 
0817 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0818 <a name="_sub47" href="#_subfunctions" class="code">function button_cam_right_CreateFcn(hObject, eventdata, handles)</a>
0819 <span class="comment">% hObject    handle to button_cam_right (see GCBO)</span>
0820 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0821 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0822 load right_button
0823 set(hObject,<span class="string">'CData'</span>,icon_data);
0824 
0825 
0826 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0827 <a name="_sub48" href="#_subfunctions" class="code">function button_cam_left_CreateFcn(hObject, eventdata, handles)</a>
0828 <span class="comment">% hObject    handle to button_cam_left (see GCBO)</span>
0829 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0830 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0831 load left_button
0832 set(hObject,<span class="string">'CData'</span>,icon_data);
0833 
0834 
0835 <span class="comment">% --------------------------------------------------------------------</span>
0836 <a name="_sub49" href="#_subfunctions" class="code">function menu_edit_undo_Callback(hObject, eventdata, handles)</a>
0837 <span class="comment">% hObject    handle to menu_edit_undo (see GCBO)</span>
0838 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0839 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0840 handles=<a href="#_sub111" class="code" title="subfunction handles=undo_last(handles)">undo_last</a>(handles);
0841 guidata(hObject,handles);
0842 
0843 <span class="comment">% --------------------------------------------------------------------</span>
0844 <a name="_sub50" href="#_subfunctions" class="code">function menu_edit_redo_Callback(hObject, eventdata, handles)</a>
0845 <span class="comment">% hObject    handle to menu_edit_redo (see GCBO)</span>
0846 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0847 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0848 handles=<a href="#_sub112" class="code" title="subfunction handles=redo(handles)">redo</a>(handles);
0849 guidata(hObject,handles);
0850 
0851 <span class="comment">% --- Executes on button press in button_script.</span>
0852 <a name="_sub51" href="#_subfunctions" class="code">function button_script_Callback(hObject, eventdata, handles)</a>
0853 <span class="comment">% hObject    handle to button_script (see GCBO)</span>
0854 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0855 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0856 <span class="keyword">global</span> hMain
0857 
0858 currdir=pwd;
0859 cd(hMain.scriptpath);
0860 [fname,pname,findex]=uigetfile(<span class="string">'*.mmm'</span>,<span class="string">'Run script file'</span>);
0861 <span class="keyword">if</span> isequal(fname,0) || isequal(pname,0)
0862     add_msg_board(<span class="string">'Script loading cancelled by user'</span>);
0863 <span class="keyword">else</span>
0864     hMain.scriptpath=pname;
0865     handles=<a href="#_sub113" class="code" title="subfunction handles=run_script(handles,fname)">run_script</a>(handles,fullfile(pname,fname));
0866 <span class="keyword">end</span>;
0867 cd(currdir);
0868 guidata(hObject,handles);
0869 
0870 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0871 <a name="_sub52" href="#_subfunctions" class="code">function button_cam_zoom_out_CreateFcn(hObject, eventdata, handles)</a>
0872 <span class="comment">% hObject    handle to button_cam_zoom_out (see GCBO)</span>
0873 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0874 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0875 load view_zoom_out_button
0876 set(hObject,<span class="string">'CData'</span>,icon_data);
0877 
0878 
0879 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0880 <a name="_sub53" href="#_subfunctions" class="code">function button_cam_zoom_in_CreateFcn(hObject, eventdata, handles)</a>
0881 <span class="comment">% hObject    handle to button_cam_zoom_in (see GCBO)</span>
0882 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0883 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0884 load view_zoom_in_button
0885 set(hObject,<span class="string">'CData'</span>,icon_data);
0886 
0887 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0888 <a name="_sub54" href="#_subfunctions" class="code">function button_script_CreateFcn(hObject, eventdata, handles)</a>
0889 <span class="comment">% hObject    handle to button_script (see GCBO)</span>
0890 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0891 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0892 load script_button
0893 set(hObject,<span class="string">'CData'</span>,icon_data);
0894 
0895 
0896 <span class="comment">% --------------------------------------------------------------------</span>
0897 <a name="_sub55" href="#_subfunctions" class="code">function menu_Build_Callback(hObject, eventdata, handles)</a>
0898 <span class="comment">% hObject    handle to menu_Build (see GCBO)</span>
0899 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0900 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0901 
0902 
0903 <span class="comment">% --------------------------------------------------------------------</span>
0904 <a name="_sub56" href="#_subfunctions" class="code">function menu_predict_Callback(hObject, eventdata, handles)</a>
0905 <span class="comment">% hObject    handle to menu_predict (see GCBO)</span>
0906 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0907 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0908 
0909 
0910 <span class="comment">% --------------------------------------------------------------------</span>
0911 <a name="_sub57" href="#_subfunctions" class="code">function menu_predict_sec_Callback(hObject, eventdata, handles)</a>
0912 <span class="comment">% hObject    handle to menu_predict_sec (see GCBO)</span>
0913 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0914 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0915 
0916 
0917 <span class="comment">% --------------------------------------------------------------------</span>
0918 <a name="_sub58" href="#_subfunctions" class="code">function menu_predict_tert_Callback(hObject, eventdata, handles)</a>
0919 <span class="comment">% hObject    handle to menu_predict_tert (see GCBO)</span>
0920 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0921 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0922 
0923 
0924 <span class="comment">% --------------------------------------------------------------------</span>
0925 <a name="_sub59" href="#_subfunctions" class="code">function menu_predict_quater_Callback(hObject, eventdata, handles)</a>
0926 <span class="comment">% hObject    handle to menu_predict_quater (see GCBO)</span>
0927 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0928 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0929 
0930 
0931 <span class="comment">% --------------------------------------------------------------------</span>
0932 <a name="_sub60" href="#_subfunctions" class="code">function menu_predict_top_Callback(hObject, eventdata, handles)</a>
0933 <span class="comment">% hObject    handle to menu_predict_top (see GCBO)</span>
0934 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0935 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0936 
0937 
0938 <span class="comment">% --------------------------------------------------------------------</span>
0939 <a name="_sub61" href="#_subfunctions" class="code">function menu_predict_disorder_Callback(hObject, eventdata, handles)</a>
0940 <span class="comment">% hObject    handle to menu_predict_disorder (see GCBO)</span>
0941 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0942 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0943 
0944 
0945 <span class="comment">% --------------------------------------------------------------------</span>
0946 <a name="_sub62" href="#_subfunctions" class="code">function menu_predict_domain_Callback(hObject, eventdata, handles)</a>
0947 <span class="comment">% hObject    handle to menu_predict_domain (see GCBO)</span>
0948 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0949 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0950 
0951 
0952 <span class="comment">% --------------------------------------------------------------------</span>
0953 <a name="_sub63" href="#_subfunctions" class="code">function menu_predict_hinge_Callback(hObject, eventdata, handles)</a>
0954 <span class="comment">% hObject    handle to menu_predict_hinge (see GCBO)</span>
0955 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0956 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0957 
0958 
0959 <span class="comment">% --------------------------------------------------------------------</span>
0960 <a name="_sub64" href="#_subfunctions" class="code">function menu_build_sidechains_Callback(hObject, eventdata, handles)</a>
0961 <span class="comment">% hObject    handle to menu_build_sidechains (see GCBO)</span>
0962 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0963 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0964 
0965 <span class="keyword">global</span> model
0966 
0967 snum=model.current_structure;
0968 models=length(model.structures{snum}(1).residues);
0969 <span class="keyword">for</span> modnum=1:models, <span class="comment">% repack all models of current structure</span>
0970     repack(snum,modnum);
0971 <span class="keyword">end</span>;
0972 
0973 guidata(hObject,handles);
0974 
0975 
0976 <span class="comment">% --------------------------------------------------------------------</span>
0977 <a name="_sub65" href="#_subfunctions" class="code">function menu_edit_sec_DSSP_Callback(hObject, eventdata, handles)</a>
0978 <span class="comment">% hObject    handle to menu_edit_sec_DSSP (see GCBO)</span>
0979 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0980 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0981 
0982 cmdpath=which(<span class="string">'dssp.exe'</span>);
0983 <span class="keyword">if</span> isempty(cmdpath),
0984     add_msg_board(<span class="string">'DSSP not implemented on this computer'</span>);
0985 <span class="keyword">else</span>
0986     input_file=<span class="string">'p:/MMM/2JLN/2JLN_cut_471.pdb'</span>;
0987     output_file=<span class="string">'p:/MMM/2JLN/2JLN.dssp'</span>;
0988     cmd=sprintf(<span class="string">'%s %s %s %s'</span>,cmdpath,input_file,output_file);
0989     [status,result]=dos(cmd);
0990     <span class="keyword">if</span> status,
0991         add_msg_board(sprintf(<span class="string">'Error %i in DSSP call.'</span>,status));
0992     <span class="keyword">else</span>
0993         add_msg_board(result);
0994     <span class="keyword">end</span>;
0995 <span class="keyword">end</span>;
0996 guidata(hObject,handles);
0997     
0998 <span class="comment">% --------------------------------------------------------------------</span>
0999 <a name="_sub66" href="#_subfunctions" class="code">function menu_edit_sec_manual_Callback(hObject, eventdata, handles)</a>
1000 <span class="comment">% hObject    handle to menu_edit_sec_manual (see GCBO)</span>
1001 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1002 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1003 
1004 
1005 <span class="comment">% --------------------------------------------------------------------</span>
1006 <a name="_sub67" href="#_subfunctions" class="code">function menu_build_sidechains_SCWRL3_Callback(hObject, eventdata, handles)</a>
1007 <span class="comment">% hObject    handle to menu_build_sidechains_SCWRL3 (see GCBO)</span>
1008 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1009 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1010 
1011 
1012 <span class="comment">% --------------------------------------------------------------------</span>
1013 <a name="_sub68" href="#_subfunctions" class="code">function menu_build_sidechains_SCAP_Callback(hObject, eventdata, handles)</a>
1014 <span class="comment">% hObject    handle to menu_build_sidechains_SCAP (see GCBO)</span>
1015 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1016 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1017 
1018 
1019 <span class="comment">% --------------------------------------------------------------------</span>
1020 <a name="_sub69" href="#_subfunctions" class="code">function menu_predict_hinge_StoneHinge_Callback(hObject, eventdata, handles)</a>
1021 <span class="comment">% hObject    handle to menu_predict_hinge_StoneHinge (see GCBO)</span>
1022 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1023 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1024 
1025 <span class="keyword">global</span> web_adr
1026 
1027 <span class="comment">% pname=pwd;</span>
1028 <span class="comment">% fname=strcat(pname,'\1ZCD\1zcd.pdb');</span>
1029 <span class="comment">% clipboard('copy',fname);</span>
1030 webcall(web_adr.StoneHinge);
1031 
1032 
1033 <span class="comment">% --------------------------------------------------------------------</span>
1034 <a name="_sub70" href="#_subfunctions" class="code">function menu_predict_hinge_HingeMaster_Callback(hObject, eventdata, handles)</a>
1035 <span class="comment">% hObject    handle to menu_predict_hinge_HingeMaster (see GCBO)</span>
1036 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1037 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1038 
1039 <span class="keyword">global</span> web_adr
1040 
1041 webcall(web_adr.HingeMaster);
1042 
1043 <span class="comment">% --------------------------------------------------------------------</span>
1044 <a name="_sub71" href="#_subfunctions" class="code">function menu_predict_domain_DomainParser_Callback(hObject, eventdata, handles)</a>
1045 <span class="comment">% hObject    handle to menu_predict_domain_DomainParser (see GCBO)</span>
1046 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1047 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1048 
1049 <span class="comment">%DomainParser2 (Linux)</span>
1050 
1051 <span class="comment">% --------------------------------------------------------------------</span>
1052 <a name="_sub72" href="#_subfunctions" class="code">function menu_predict_disorder_Spritz_Callback(hObject, eventdata, handles)</a>
1053 <span class="comment">% hObject    handle to menu_predict_disorder_Spritz (see GCBO)</span>
1054 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1055 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1056 
1057 <span class="keyword">global</span> web_adr
1058 
1059 <span class="comment">% copy FASTA sequence without header to clipboard</span>
1060 webcall(web_adr.Spritz);
1061 
1062 
1063 <span class="comment">% --------------------------------------------------------------------</span>
1064 <a name="_sub73" href="#_subfunctions" class="code">function menu_predict_top_MEMSAT3_Callback(hObject, eventdata, handles)</a>
1065 <span class="comment">% hObject    handle to menu_predict_top_MEMSAT3 (see GCBO)</span>
1066 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1067 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1068 
1069 <span class="keyword">global</span> web_adr
1070 
1071 <span class="comment">% copy FASTA sequence without header to clipboard</span>
1072 <span class="comment">% clipboard('copy',sequence);</span>
1073 webcall(web_adr.MEMSAT3);
1074 
1075 
1076 <span class="comment">% --------------------------------------------------------------------</span>
1077 <a name="_sub74" href="#_subfunctions" class="code">function menu_predict_top_TMHMM_Callback(hObject, eventdata, handles)</a>
1078 <span class="comment">% hObject    handle to menu_predict_top_TMHMM (see GCBO)</span>
1079 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1080 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1081 
1082 <span class="keyword">global</span> web_adr
1083 
1084 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1085 <span class="comment">% fasta=sprintf('%s\n%s\n',header,sequence);</span>
1086 <span class="comment">% clipboard('copy',fasta);</span>
1087 webcall(web_adr.TMHMM);
1088 
1089 
1090 <span class="comment">% --------------------------------------------------------------------</span>
1091 <a name="_sub75" href="#_subfunctions" class="code">function menu_predict_top_Philius_Callback(hObject, eventdata, handles)</a>
1092 <span class="comment">% hObject    handle to menu_predict_top_Philius (see GCBO)</span>
1093 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1094 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1095 
1096 <span class="keyword">global</span> web_adr
1097 
1098 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1099 <span class="comment">% fasta=sprintf('%s\n%s\n',header,sequence);</span>
1100 <span class="comment">% clipboard('copy',fasta);</span>
1101 webcall(web_adr.Philius);
1102 
1103 <span class="comment">% --------------------------------------------------------------------</span>
1104 <a name="_sub76" href="#_subfunctions" class="code">function menu_predict_quater_Hex_Callback(hObject, eventdata, handles)</a>
1105 <span class="comment">% hObject    handle to menu_predict_quater_Hex (see GCBO)</span>
1106 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1107 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1108 
1109 <span class="keyword">global</span> web_adr
1110 
1111 webcall(web_adr.Hex);
1112 
1113 <span class="comment">% --------------------------------------------------------------------</span>
1114 <a name="_sub77" href="#_subfunctions" class="code">function menu_predict_quater_RosettaDock_Callback(hObject, eventdata, handles)</a>
1115 <span class="comment">% hObject    handle to menu_predict_quater_RosettaDock (see GCBO)</span>
1116 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1117 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1118 <span class="keyword">global</span> web_adr
1119 
1120 webcall(web_adr.RosettaDock);
1121 
1122 <span class="comment">% --------------------------------------------------------------------</span>
1123 <a name="_sub78" href="#_subfunctions" class="code">function menu_predict_quater_HADDOCK_Callback(hObject, eventdata, handles)</a>
1124 <span class="comment">% hObject    handle to menu_predict_quater_HADDOCK (see GCBO)</span>
1125 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1126 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1127 
1128 <span class="keyword">global</span> web_adr
1129 
1130 webcall(web_adr.Haddock);
1131 
1132 <span class="comment">% --------------------------------------------------------------------</span>
1133 <a name="_sub79" href="#_subfunctions" class="code">function menu_predict_quater_AutoDock_Callback(hObject, eventdata, handles)</a>
1134 <span class="comment">% hObject    handle to menu_predict_quater_AutoDock (see GCBO)</span>
1135 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1136 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1137 
1138 
1139 <span class="comment">% --------------------------------------------------------------------</span>
1140 <a name="_sub80" href="#_subfunctions" class="code">function menu_quater_predict_ArgusLab_Callback(hObject, eventdata, handles)</a>
1141 <span class="comment">% hObject    handle to menu_quater_predict_ArgusLab (see GCBO)</span>
1142 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1143 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1144 
1145 
1146 <span class="comment">% --------------------------------------------------------------------</span>
1147 <a name="_sub81" href="#_subfunctions" class="code">function menu_predict_tert_HHpred_Callback(hObject, eventdata, handles)</a>
1148 <span class="comment">% hObject    handle to menu_predict_tert_HHpred (see GCBO)</span>
1149 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1150 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1151 
1152 <span class="keyword">global</span> web_adr
1153 
1154 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1155 <span class="comment">% fasta=sprintf('%s\n%s\n',header,sequence);</span>
1156 <span class="comment">% clipboard('copy',fasta);</span>
1157 webcall(web_adr.HHpred);
1158 
1159 <span class="comment">% --------------------------------------------------------------------</span>
1160 <a name="_sub82" href="#_subfunctions" class="code">function menu_predict_tert_PHYRE_Callback(hObject, eventdata, handles)</a>
1161 <span class="comment">% hObject    handle to menu_predict_tert_PHYRE (see GCBO)</span>
1162 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1163 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1164 
1165 <span class="keyword">global</span> web_adr
1166 
1167 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1168 <span class="comment">% clipboard('copy',sequence);</span>
1169 webcall(web_adr.Phyre);
1170 
1171 <span class="comment">% --------------------------------------------------------------------</span>
1172 <a name="_sub83" href="#_subfunctions" class="code">function menu_predict_tert_SAM_Callback(hObject, eventdata, handles)</a>
1173 <span class="comment">% hObject    handle to menu_predict_tert_SAM (see GCBO)</span>
1174 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1175 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1176 
1177 <span class="keyword">global</span> web_adr
1178 
1179 <span class="comment">% [header,sequence]=read_fasta('2JLN.fasta.txt');</span>
1180 <span class="comment">% fasta=sprintf('%s\n%s\n',header,sequence);</span>
1181 <span class="comment">% clipboard('copy',fasta);</span>
1182 webcall(web_adr.SAM_tert);
1183 
1184 <span class="comment">% --------------------------------------------------------------------</span>
1185 <a name="_sub84" href="#_subfunctions" class="code">function menu_predict_sec_PHYRE_Callback(hObject, eventdata, handles)</a>
1186 <span class="comment">% hObject    handle to menu_predict_sec_PHYRE (see GCBO)</span>
1187 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1188 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1189 
1190 <span class="keyword">global</span> web_adr
1191 
1192 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1193 <span class="comment">% clipboard('copy',sequence);</span>
1194 webcall(web_adr.Phyre);
1195 
1196 <span class="comment">% --------------------------------------------------------------------</span>
1197 <a name="_sub85" href="#_subfunctions" class="code">function menu_predict_sec_PsiPRED_Callback(hObject, eventdata, handles)</a>
1198 <span class="comment">% hObject    handle to menu_predict_sec_PsiPRED (see GCBO)</span>
1199 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1200 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1201 
1202 <span class="keyword">global</span> web_adr
1203 
1204 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1205 <span class="comment">% clipboard('copy',sequence);</span>
1206 webcall(web_adr.PSIpred);
1207 
1208 <span class="comment">% --------------------------------------------------------------------</span>
1209 <a name="_sub86" href="#_subfunctions" class="code">function menu_predict_sec_SAM_Callback(hObject, eventdata, handles)</a>
1210 <span class="comment">% hObject    handle to menu_predict_sec_SAM (see GCBO)</span>
1211 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1212 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1213 
1214 <span class="keyword">global</span> web_adr
1215 
1216 <span class="comment">% copy FASTA sequence WITH header to clipboard</span>
1217 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1218 <span class="comment">% fasta=sprintf('%s\n%s\n',header,sequence);</span>
1219 <span class="comment">% clipboard('copy',fasta);</span>
1220 webcall(web_adr.SAM_sec);
1221 
1222 <span class="comment">% --------------------------------------------------------------------</span>
1223 <a name="_sub87" href="#_subfunctions" class="code">function menu_predict_sec_Porter_Callback(hObject, eventdata, handles)</a>
1224 <span class="comment">% hObject    handle to menu_predict_sec_Porter (see GCBO)</span>
1225 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1226 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1227 
1228 <span class="keyword">global</span> web_adr
1229 
1230 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1231 <span class="comment">% clipboard('copy',sequence);</span>
1232 webcall(web_adr.Porter);
1233 
1234 <span class="comment">% --------------------------------------------------------------------</span>
1235 <a name="_sub88" href="#_subfunctions" class="code">function menu_predict_sec_Prof_Callback(hObject, eventdata, handles)</a>
1236 <span class="comment">% hObject    handle to menu_predict_sec_Prof (see GCBO)</span>
1237 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1238 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1239 
1240 <span class="keyword">global</span> web_adr
1241 
1242 <span class="comment">% [header,sequence]=read_fasta('1ZCD.fasta.txt');</span>
1243 <span class="comment">% fasta=sprintf('%s\n%s\n',header,sequence);</span>
1244 <span class="comment">% clipboard('copy',fasta);</span>
1245 webcall(web_adr.PredictProtein);
1246 
1247 <span class="comment">% --------------------------------------------------------------------</span>
1248 <a name="_sub89" href="#_subfunctions" class="code">function menu_predict_sec_SABLE_Callback(hObject, eventdata, handles)</a>
1249 <span class="comment">% hObject    handle to menu_predict_sec_SABLE (see GCBO)</span>
1250 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1251 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1252 
1253 <span class="keyword">global</span> web_adr
1254 
1255 <span class="comment">% [header,sequence]=read_fasta('2JLN.fasta.txt');</span>
1256 <span class="comment">% fasta=sprintf('%s\n',sequence);</span>
1257 <span class="comment">% clipboard('copy',fasta);</span>
1258 webcall(web_adr.Sable);
1259 
1260 
1261 <span class="comment">% --------------------------------------------------------------------</span>
1262 <a name="_sub90" href="#_subfunctions" class="code">function menu_analysis_Callback(hObject, eventdata, ~)</a>
1263 <span class="comment">% hObject    handle to menu_analysis (see GCBO)</span>
1264 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1265 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1266 
1267 
1268 <span class="comment">% --------------------------------------------------------------------</span>
1269 <a name="_sub91" href="#_subfunctions" class="code">function menu_predict_segment_Callback(hObject, eventdata, handles)</a>
1270 <span class="comment">% hObject    handle to menu_predict_segment (see GCBO)</span>
1271 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1272 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1273 
1274 
1275 <span class="comment">% --------------------------------------------------------------------</span>
1276 <a name="_sub92" href="#_subfunctions" class="code">function menu_analysis_Ramachandran_Callback(hObject, eventdata, handles)</a>
1277 <span class="comment">% hObject    handle to menu_analysis_Ramachandran (see GCBO)</span>
1278 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1279 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1280 
1281 
1282 <span class="comment">% --------------------------------------------------------------------</span>
1283 <a name="_sub93" href="#_subfunctions" class="code">function menu_analysis_accessibility_Callback(hObject, eventdata, handles)</a>
1284 <span class="comment">% hObject    handle to menu_analysis_accessibility (see GCBO)</span>
1285 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1286 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1287 
1288 <span class="keyword">global</span> hMain
1289 
1290 [fname,access]=accessibility_report;
1291 hMain.report_file=fname;
1292 report_editor;
1293 
1294 <span class="comment">% --------------------------------------------------------------------</span>
1295 <a name="_sub94" href="#_subfunctions" class="code">function menu_predict_tert_Modeller_Callback(hObject, eventdata, handles)</a>
1296 <span class="comment">% hObject    handle to menu_predict_tert_Modeller (see GCBO)</span>
1297 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1298 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1299 
1300 
1301 <span class="comment">% --------------------------------------------------------------------</span>
1302 <a name="_sub95" href="#_subfunctions" class="code">function menu_analysis_contact_Callback(hObject, eventdata, handles)</a>
1303 <span class="comment">% hObject    handle to menu_analysis_contact (see GCBO)</span>
1304 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1305 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1306 
1307 
1308 <span class="comment">% --------------------------------------------------------------------</span>
1309 <a name="_sub96" href="#_subfunctions" class="code">function menu_display_hierarchy_Callback(hObject, eventdata, handles)</a>
1310 <span class="comment">% hObject    handle to menu_display_hierarchy (see GCBO)</span>
1311 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1312 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1313 
1314 hierarchy_window;
1315 
1316 <span class="comment">% --------------------------------------------------------------------</span>
1317 <a name="_sub97" href="#_subfunctions" class="code">function menu_display_depth_Callback(hObject, eventdata, handles)</a>
1318 <span class="comment">% hObject    handle to menu_display_depth (see GCBO)</span>
1319 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1320 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1321 
1322 h=depth_cue_control;
1323 
1324 <span class="comment">% --------------------------------------------------------------------</span>
1325 <a name="_sub98" href="#_subfunctions" class="code">function menu_display_color_Callback(hObject, eventdata, handles)</a>
1326 <span class="comment">% hObject    handle to menu_display_color (see GCBO)</span>
1327 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1328 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1329 
1330 <span class="keyword">global</span> hMain
1331 
1332 color_selection;
1333 <span class="keyword">if</span> isempty(hMain.color_selection),
1334     add_msg_board(<span class="string">'Color selection cancelled by user.'</span>);
1335 <span class="keyword">else</span>
1336     <span class="keyword">if</span> isfloat(hMain.color_selection),
1337         command_line=sprintf(<span class="string">'color * %6.3f%6.3f%6.3f'</span>,hMain.color_selection);
1338     <span class="keyword">else</span>
1339         command_line=sprintf(<span class="string">'colorscheme * %s'</span>,hMain.color_selection);
1340     <span class="keyword">end</span>;
1341     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command_line,hObject);
1342 <span class="keyword">end</span>;
1343 
1344 <span class="comment">% --------------------------------------------------------------------</span>
1345 <a name="_sub99" href="#_subfunctions" class="code">function menu_display_3D_Callback(hObject, eventdata, handles)</a>
1346 <span class="comment">% hObject    handle to menu_display_3D (see GCBO)</span>
1347 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1348 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1349 
1350 <span class="keyword">global</span> model
1351 
1352 <span class="keyword">if</span> ~isfield(model,<span class="string">'selections'</span>) || ~isfield(model,<span class="string">'selected'</span>) || isempty(model.selected);
1353     add_msg_board(<span class="string">'### Warning ###. Nothing is selected.'</span>);
1354     model.selections=0;
1355     model.selected={};
1356 <span class="keyword">else</span>
1357     graphics_selection;
1358 <span class="keyword">end</span>;
1359 
1360 
1361 <span class="comment">% --------------------------------------------------------------------</span>
1362 <a name="_sub100" href="#_subfunctions" class="code">function menu_display_3D_CA_Callback(hObject, eventdata, handles)</a>
1363 <span class="comment">% hObject    handle to menu_display_3D_CA (see GCBO)</span>
1364 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1365 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1366 
1367 
1368 <span class="comment">% --------------------------------------------------------------------</span>
1369 <a name="_sub101" href="#_subfunctions" class="code">function menu_3D_display_coil_Callback(hObject, eventdata, handles)</a>
1370 <span class="comment">% hObject    handle to menu_3D_display_coil (see GCBO)</span>
1371 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1372 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1373 
1374 
1375 <span class="comment">% --------------------------------------------------------------------</span>
1376 <a name="_sub102" href="#_subfunctions" class="code">function menu_display_3D_cartoon_Callback(hObject, eventdata, handles)</a>
1377 <span class="comment">% hObject    handle to menu_display_3D_cartoon (see GCBO)</span>
1378 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1379 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1380 
1381 
1382 <span class="comment">% --------------------------------------------------------------------</span>
1383 <a name="_sub103" href="#_subfunctions" class="code">function menu_display_3D_ribbon_Callback(hObject, eventdata, handles)</a>
1384 <span class="comment">% hObject    handle to menu_display_3D_ribbon (see GCBO)</span>
1385 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1386 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1387 
1388 
1389 <span class="comment">% --------------------------------------------------------------------</span>
1390 <a name="_sub104" href="#_subfunctions" class="code">function menu_display_3D_wire_Callback(hObject, eventdata, handles)</a>
1391 <span class="comment">% hObject    handle to menu_display_3D_wire (see GCBO)</span>
1392 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1393 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1394 
1395 
1396 <span class="comment">% --------------------------------------------------------------------</span>
1397 <a name="_sub105" href="#_subfunctions" class="code">function menu_display_3D_CA_wire_Callback(hObject, eventdata, handles)</a>
1398 <span class="comment">% hObject    handle to menu_display_3D_CA_wire (see GCBO)</span>
1399 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1400 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1401 
1402 
1403 <span class="comment">% --------------------------------------------------------------------</span>
1404 <a name="_sub106" href="#_subfunctions" class="code">function menu_file_new_pdb_Callback(hObject, eventdata, handles)</a>
1405 <span class="comment">% hObject    handle to menu_file_new_pdb (see GCBO)</span>
1406 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1407 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1408 
1409 <span class="comment">% code for proper reset and question to user still missing</span>
1410 <span class="comment">% command=sprintf('reset');</span>
1411 <span class="comment">% exe(handles,command,hObject);</span>
1412 
1413 <span class="comment">% --------------------------------------------------------------------</span>
1414 <a name="_sub107" href="#_subfunctions" class="code">function menu_file_new_sequence_Callback(hObject, eventdata, handles)</a>
1415 <span class="comment">% hObject    handle to menu_file_new_sequence (see GCBO)</span>
1416 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1417 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1418 
1419 <span class="comment">% --------------------------------------------------------------------</span>
1420 <a name="_sub108" href="#_subfunctions" class="code">function menu_file_add_pdb_Callback(hObject, eventdata, handles)</a>
1421 <span class="comment">% hObject    handle to menu_file_add_pdb (see GCBO)</span>
1422 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1423 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1424 
1425 
1426 
1427 
1428 <span class="comment">% --------------------------------------------------------------------</span>
1429 <a name="_sub109" href="#_subfunctions" class="code">function menu_file_add_sequence_Callback(hObject, eventdata, handles)</a>
1430 <span class="comment">% hObject    handle to menu_file_add_sequence (see GCBO)</span>
1431 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1432 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1433 
1434 
1435 <span class="comment">% --------------------------------------------------------------------</span>
1436 <a name="_sub110" href="#_subfunctions" class="code">function handles=exe(handles,command,hObject)</a>
1437 <span class="comment">% Echoes and executes a command and updates the handle structure</span>
1438 set(handles.edit_command_line,<span class="string">'String'</span>,command);
1439 set(handles.edit_command_line,<span class="string">'ForegroundColor'</span>,[168,168,168]/255);
1440 set(handles.edit_command_line,<span class="string">'Enable'</span>,<span class="string">'Off'</span>);
1441 handles=cmd(handles,command);
1442 guidata(hObject,handles);
1443 
1444 <a name="_sub111" href="#_subfunctions" class="code">function handles=undo_last(handles)</a>
1445 <span class="comment">% Undo of the last command stored in command history</span>
1446 <span class="keyword">global</span> hMain
1447 
1448 set(handles.edit_command_line,<span class="string">'String'</span>,<span class="string">'undo'</span>);
1449 set(handles.edit_command_line,<span class="string">'ForegroundColor'</span>,[168,168,168]/255);
1450 set(handles.edit_command_line,<span class="string">'Enable'</span>,<span class="string">'Off'</span>);
1451 to_undo=hMain.undo_poi-1; <span class="comment">% find out which command performs undo</span>
1452 <span class="keyword">if</span> to_undo&lt;1, to_undo=hMain.history_num; <span class="keyword">end</span>;
1453 command=hMain.undo{to_undo};
1454 hMain.undo{to_undo}=<span class="string">''</span>; <span class="comment">% delete that command from undo list</span>
1455 <span class="keyword">if</span> isempty(command)
1456     add_msg_board(<span class="string">'### ERROR ### No undo available.'</span>);
1457 <span class="keyword">else</span>
1458     hMain.store_undo=0; <span class="comment">% make sure the inverse command is not stored in the undo list</span>
1459     hMain.undo_poi=to_undo; <span class="comment">% go back one step in undo list</span>
1460     handles=cmd(handles,command);  <span class="comment">% undo</span>
1461     done=hMain.history_poi-1; <span class="comment">% find out which command is needed for redo</span>
1462     <span class="keyword">if</span> done&lt;1, done=hMain.history_num; <span class="keyword">end</span>;
1463     command=hMain.history{done};
1464     hMain.history{done}=<span class="string">''</span>; <span class="comment">% this command does no longer belong to history</span>
1465     hMain.history_poi=hMain.history_poi-1; <span class="comment">% set back history ;-)</span>
1466     <span class="keyword">if</span> hMain.history_poi&lt;1, hMain.history_poi=hMain.history_num; <span class="keyword">end</span>;
1467     hMain.redo{hMain.redo_poi}=command;
1468     hMain.redo_poi=hMain.redo_poi+1;
1469     <span class="keyword">if</span> hMain.redo_poi&gt;hMain.history_num,
1470         hMain.redo_poi=1;
1471     <span class="keyword">end</span>;
1472 <span class="keyword">end</span>;
1473 
1474 <a name="_sub112" href="#_subfunctions" class="code">function handles=redo(handles)</a>
1475 <span class="comment">% Redo of the last undone command</span>
1476 <span class="keyword">global</span> hMain
1477 
1478 set(handles.edit_command_line,<span class="string">'String'</span>,<span class="string">'redo'</span>);
1479 set(handles.edit_command_line,<span class="string">'ForegroundColor'</span>,[168,168,168]/255);
1480 set(handles.edit_command_line,<span class="string">'Enable'</span>,<span class="string">'Off'</span>);
1481 to_redo=hMain.redo_poi-1; <span class="comment">% find out which command performs undo</span>
1482 <span class="keyword">if</span> to_redo&lt;1, to_redo=hMain.history_num; <span class="keyword">end</span>;
1483 command=hMain.redo{to_redo};
1484 hMain.redo{to_redo}=<span class="string">''</span>; <span class="comment">% delete that command from redo list</span>
1485 <span class="keyword">if</span> isempty(command)
1486     add_msg_board(<span class="string">'### Warning ### No redo available.'</span>);
1487 <span class="keyword">else</span>
1488     hMain.redo_poi=to_redo; <span class="comment">% go back one step in redo list</span>
1489     handles=cmd(handles,command);  <span class="comment">% redo</span>
1490 <span class="keyword">end</span>;
1491 
1492 <a name="_sub113" href="#_subfunctions" class="code">function handles=run_script(handles,fname)</a>
1493 <span class="comment">% Runs a script file by repeated calls to the command interpreter</span>
1494 <span class="comment">% undo or redo are ignored in scripts</span>
1495 <span class="comment">% the script is echoed in the command line window</span>
1496 
1497 <span class="keyword">global</span> hMain
1498 
1499 old_undo=hMain.store_undo;
1500 
1501 [rfile,msg]=fopen(fname,<span class="string">'rt'</span>);
1502 <span class="keyword">while</span> 1
1503     command_line=fgetl(rfile);
1504     <span class="keyword">if</span> ~ischar(command_line) || isempty(command_line), <span class="keyword">break</span>, <span class="keyword">end</span>
1505     command_line=strtrim(command_line);
1506     <span class="keyword">if</span> strcmp(command_line(1),<span class="string">'%'</span>),
1507         comment=command_line;
1508         command_line=<span class="string">''</span>;
1509     <span class="keyword">else</span>
1510         [command_line,comment]=strtok(command_line,<span class="string">'%'</span>);
1511     <span class="keyword">end</span>;
1512     <span class="keyword">if</span> ~isempty(comment),
1513         add_msg_board(comment);
1514     <span class="keyword">end</span>;
1515     [command,args]=strtok(command_line);
1516     <span class="keyword">if</span> ~isempty(command) &amp;&amp; ~strcmp(command,<span class="string">' '</span>), <span class="comment">% test for problems at file end</span>
1517         <span class="keyword">switch</span> command <span class="comment">% test for exceptions that may not be executed from scripts</span>
1518             <span class="keyword">case</span> <span class="string">'undo'</span>
1519                 add_msg_board(<span class="string">'undo cannot be executed from scripts'</span>);
1520             <span class="keyword">case</span> <span class="string">'redo'</span>
1521                 add_msg_board(<span class="string">'redo cannot be executed from scripts'</span>);
1522             <span class="keyword">otherwise</span>    
1523                 set(handles.edit_command_line,<span class="string">'String'</span>,command_line);
1524                 set(handles.edit_command_line,<span class="string">'ForegroundColor'</span>,[168,168,168]/255);
1525                 set(handles.edit_command_line,<span class="string">'Enable'</span>,<span class="string">'Off'</span>);
1526                 hMain.store_undo=0;
1527                 handles=cmd(handles,command_line);
1528         <span class="keyword">end</span>;
1529     <span class="keyword">end</span>;
1530 <span class="keyword">end</span>
1531 fclose(rfile);
1532 
1533 <span class="keyword">if</span> isfield(hMain,<span class="string">'camlight'</span>),
1534     camlight(hMain.camlight);
1535 <span class="keyword">end</span>;
1536 hMain.store_undo=old_undo;
1537 
1538 fclose(<span class="string">'all'</span>);
1539 guidata(handles.edit_command_line,handles);
1540 
1541 <span class="comment">% --------------------------------------------------------------------</span>
1542 <a name="_sub114" href="#_subfunctions" class="code">function uitoggletool_select_ClickedCallback(hObject, eventdata, handles)</a>
1543 <span class="comment">% hObject    handle to uitoggletool_select (see GCBO)</span>
1544 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1545 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1546 
1547 
1548 <span class="comment">% --------------------------------------------------------------------</span>
1549 <a name="_sub115" href="#_subfunctions" class="code">function uitoggletool_select_OffCallback(hObject, eventdata, handles)</a>
1550 <span class="comment">% hObject    handle to uitoggletool_select (see GCBO)</span>
1551 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1552 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1553 
1554 
1555 <span class="comment">% --------------------------------------------------------------------</span>
1556 <a name="_sub116" href="#_subfunctions" class="code">function uitoggletool_select_OnCallback(hObject, eventdata, handles)</a>
1557 <span class="comment">% hObject    handle to uitoggletool_select (see GCBO)</span>
1558 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1559 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1560 
1561 <span class="keyword">global</span> hMain
1562 <span class="keyword">global</span> hModel
1563 
1564 <span class="keyword">if</span> hMain.detached
1565     fig=hModel.figure;
1566 <span class="keyword">else</span>
1567     fig=hMain.figure;
1568 <span class="keyword">end</span>;
1569 
1570 rot_state=get(handles.uitoggletool_rotate,<span class="string">'State'</span>);
1571 <span class="keyword">if</span> strcmp(rot_state,<span class="string">'on'</span>),
1572     set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'off'</span>);
1573     view3D(fig,<span class="string">'off'</span>);
1574 <span class="keyword">end</span>;
1575     
1576 zoom_state=get(handles.uitoggletool_zoom,<span class="string">'State'</span>);
1577 <span class="keyword">if</span> strcmp(zoom_state,<span class="string">'on'</span>),
1578     set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'off'</span>);
1579     view3D(fig,<span class="string">'off'</span>);
1580 <span class="keyword">end</span>;
1581 
1582 pan_state=get(handles.uitoggletool_pan,<span class="string">'State'</span>);
1583 <span class="keyword">if</span> strcmp(pan_state,<span class="string">'on'</span>),
1584     set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'off'</span>);
1585     view3D(fig,<span class="string">'off'</span>);
1586 <span class="keyword">end</span>;
1587     
1588 <span class="keyword">if</span> hMain.detached,
1589     set(hModel.context_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1590     set(hModel.context_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1591     set(hModel.context_select,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1592     set(hModel.context_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1593 <span class="keyword">else</span>
1594     set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1595     set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1596     set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1597     set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1598 <span class="keyword">end</span>;
1599 
1600 guidata(hObject,handles);
1601 
1602 <span class="comment">% --------------------------------------------------------------------</span>
1603 <a name="_sub117" href="#_subfunctions" class="code">function uitoggletool_rotate_ClickedCallback(hObject, eventdata, handles)</a>
1604 <span class="comment">% hObject    handle to uitoggletool_rotate (see GCBO)</span>
1605 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1606 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1607 
1608 
1609 <span class="comment">% --------------------------------------------------------------------</span>
1610 <a name="_sub118" href="#_subfunctions" class="code">function uitoggletool_rotate_OffCallback(hObject, eventdata, handles)</a>
1611 <span class="comment">% hObject    handle to uitoggletool_rotate (see GCBO)</span>
1612 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1613 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1614 
1615 <span class="keyword">global</span> hMain
1616 <span class="keyword">global</span> hModel
1617 
1618 <span class="keyword">if</span> hMain.detached
1619     fig=hModel.figure;
1620 <span class="keyword">else</span>
1621     fig=hMain.figure;
1622 <span class="keyword">end</span>;
1623 <span class="comment">% view3D(fig,'off');</span>
1624 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'on'</span>);
1625 
1626 guidata(hObject,handles);
1627 
1628 <span class="comment">% --------------------------------------------------------------------</span>
1629 <a name="_sub119" href="#_subfunctions" class="code">function uitoggletool_rotate_OnCallback(hObject, eventdata, handles)</a>
1630 <span class="comment">% hObject    handle to uitoggletool_rotate (see GCBO)</span>
1631 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1632 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1633 
1634 <span class="keyword">global</span> hMain
1635 <span class="keyword">global</span> hModel
1636 
1637 <span class="keyword">if</span> hMain.detached
1638     fig=hModel.figure;
1639 <span class="keyword">else</span>
1640     fig=hMain.figure;
1641 <span class="keyword">end</span>;
1642 
1643 set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'off'</span>);
1644 set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'off'</span>);
1645 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'off'</span>);
1646 set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'on'</span>);
1647 <span class="keyword">if</span> hMain.detached,
1648     set(hModel.context_rotate,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1649     set(hModel.context_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1650     set(hModel.context_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1651     set(hModel.context_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1652 <span class="keyword">else</span>
1653     set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1654     set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1655     set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1656     set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1657 <span class="keyword">end</span>;
1658 
1659 view3D(fig,<span class="string">'rot'</span>);
1660     
1661 guidata(hObject,handles);
1662 
1663 <span class="comment">% --------------------------------------------------------------------</span>
1664 <a name="_sub120" href="#_subfunctions" class="code">function uitoggletool_zoom_ClickedCallback(hObject, eventdata, handles)</a>
1665 <span class="comment">% hObject    handle to uitoggletool_zoom (see GCBO)</span>
1666 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1667 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1668 
1669 
1670 <span class="comment">% --------------------------------------------------------------------</span>
1671 <a name="_sub121" href="#_subfunctions" class="code">function uitoggletool_zoom_OffCallback(hObject, eventdata, handles)</a>
1672 <span class="comment">% hObject    handle to uitoggletool_zoom (see GCBO)</span>
1673 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1674 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1675 
1676 <span class="keyword">global</span> hMain
1677 <span class="keyword">global</span> hModel
1678 
1679 <span class="keyword">if</span> hMain.detached
1680     fig=hModel.figure;
1681 <span class="keyword">else</span>
1682     fig=hMain.figure;
1683 <span class="keyword">end</span>;
1684 <span class="comment">% view3D(fig,'off');</span>
1685 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'on'</span>);
1686 
1687 guidata(hObject,handles);
1688 
1689 <span class="comment">% --------------------------------------------------------------------</span>
1690 <a name="_sub122" href="#_subfunctions" class="code">function uitoggletool_zoom_OnCallback(hObject, eventdata, handles)</a>
1691 <span class="comment">% hObject    handle to uitoggletool_zoom (see GCBO)</span>
1692 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1693 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1694 
1695 <span class="keyword">global</span> hMain
1696 <span class="keyword">global</span> hModel
1697 
1698 <span class="keyword">if</span> hMain.detached
1699     fig=hModel.figure;
1700 <span class="keyword">else</span>
1701     fig=hMain.figure;
1702 <span class="keyword">end</span>;
1703 
1704 set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'off'</span>);
1705 set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'off'</span>);
1706 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'off'</span>);
1707 set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'on'</span>);
1708 <span class="keyword">if</span> hMain.detached,
1709     set(hModel.context_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1710     set(hModel.context_zoom,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1711     set(hModel.context_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1712     set(hModel.context_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1713 <span class="keyword">else</span>
1714     set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1715     set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1716     set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1717     set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1718 <span class="keyword">end</span>;
1719 view3D(fig,<span class="string">'zoom'</span>);
1720     
1721 guidata(hObject,handles);
1722 
1723 <span class="comment">% --------------------------------------------------------------------</span>
1724 <a name="_sub123" href="#_subfunctions" class="code">function uitoggletool_pan_ClickedCallback(hObject, eventdata, handles)</a>
1725 <span class="comment">% hObject    handle to uitoggletool_pan (see GCBO)</span>
1726 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1727 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1728 
1729 
1730 <span class="comment">% --------------------------------------------------------------------</span>
1731 <a name="_sub124" href="#_subfunctions" class="code">function uitoggletool_pan_OffCallback(hObject, eventdata, handles)</a>
1732 <span class="comment">% hObject    handle to uitoggletool_pan (see GCBO)</span>
1733 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1734 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1735 
1736 
1737 <span class="keyword">global</span> hMain
1738 <span class="keyword">global</span> hModel
1739 
1740 <span class="keyword">if</span> hMain.detached
1741     fig=hModel.figure;
1742 <span class="keyword">else</span>
1743     fig=hMain.figure;
1744 <span class="keyword">end</span>;
1745 <span class="comment">% view3D(fig,'off');</span>
1746 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'on'</span>);
1747 
1748 guidata(hObject,handles);
1749 
1750 <span class="comment">% --------------------------------------------------------------------</span>
1751 <a name="_sub125" href="#_subfunctions" class="code">function uitoggletool_pan_OnCallback(hObject, eventdata, handles)</a>
1752 <span class="comment">% hObject    handle to uitoggletool_pan (see GCBO)</span>
1753 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1754 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1755 
1756 <span class="keyword">global</span> hMain
1757 <span class="keyword">global</span> hModel
1758 
1759 <span class="keyword">if</span> hMain.detached
1760     fig=hModel.figure;
1761 <span class="keyword">else</span>
1762     fig=hMain.figure;
1763 <span class="keyword">end</span>;
1764 
1765 set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'off'</span>);
1766 set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'off'</span>);
1767 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'off'</span>);
1768 set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'on'</span>);
1769 <span class="keyword">if</span> hMain.detached,
1770     set(hModel.context_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1771     set(hModel.context_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1772     set(hModel.context_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1773     set(hModel.context_pan,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1774 <span class="keyword">else</span>
1775     set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1776     set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1777     set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1778     set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1779 <span class="keyword">end</span>;
1780 view3D(fig,<span class="string">'pan'</span>);
1781     
1782 guidata(hObject,handles);
1783 
1784 
1785 <span class="comment">% --------------------------------------------------------------------</span>
1786 <a name="_sub126" href="#_subfunctions" class="code">function context_model_select_Callback(hObject, eventdata, handles)</a>
1787 <span class="comment">% hObject    handle to context_model_select (see GCBO)</span>
1788 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1789 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1790 
1791 <span class="keyword">global</span> hMain
1792 <span class="keyword">global</span> hModel
1793 
1794 <span class="keyword">if</span> hMain.detached
1795     fig=hModel.figure;
1796 <span class="keyword">else</span>
1797     fig=hMain.figure;
1798 <span class="keyword">end</span>;
1799 
1800 view3D(fig,<span class="string">'off'</span>);
1801 
1802 rot_state=get(handles.uitoggletool_rotate,<span class="string">'State'</span>);
1803 <span class="keyword">if</span> strcmp(rot_state,<span class="string">'on'</span>),
1804     set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'off'</span>);
1805 <span class="keyword">end</span>;
1806     
1807 zoom_state=get(handles.uitoggletool_zoom,<span class="string">'State'</span>);
1808 <span class="keyword">if</span> strcmp(zoom_state,<span class="string">'on'</span>),
1809     set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'off'</span>);
1810 <span class="keyword">end</span>;
1811 
1812 pan_state=get(handles.uitoggletool_pan,<span class="string">'State'</span>);
1813 <span class="keyword">if</span> strcmp(pan_state,<span class="string">'on'</span>),
1814     set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'off'</span>);
1815 <span class="keyword">end</span>;
1816     
1817 set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1818 set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1819 set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1820 set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1821 
1822 guidata(hObject,handles);
1823 
1824 <span class="comment">% --------------------------------------------------------------------</span>
1825 <a name="_sub127" href="#_subfunctions" class="code">function context_model_pan_Callback(hObject, eventdata, handles)</a>
1826 <span class="comment">% hObject    handle to context_model_pan (see GCBO)</span>
1827 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1828 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1829 
1830 <span class="keyword">global</span> hMain
1831 <span class="keyword">global</span> hModel
1832 
1833 <span class="keyword">if</span> hMain.detached
1834     fig=hModel.figure;
1835 <span class="keyword">else</span>
1836     fig=hMain.figure;
1837 <span class="keyword">end</span>;
1838 
1839 set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'off'</span>);
1840 set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'off'</span>);
1841 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'off'</span>);
1842 set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'on'</span>);
1843 set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1844 set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1845 set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
1846 set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
1847 view3D(fig,<span class="string">'pan'</span>);
1848     
1849 guidata(hObject,handles);
1850 
1851 
1852 <span class="comment">% --------------------------------------------------------------------</span>
1853 <a name="_sub128" href="#_subfunctions" class="code">function context_model_color_Callback(hObject, eventdata, handles)</a>
1854 <span class="comment">% hObject    handle to context_model_color (see GCBO)</span>
1855 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1856 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1857 
1858 <span class="keyword">global</span> hMain
1859 
1860 color_selection;
1861 <span class="keyword">if</span> isempty(hMain.color_selection),
1862     add_msg_board(<span class="string">'Color selection cancelled by user.'</span>);
1863 <span class="keyword">else</span>
1864     <span class="keyword">if</span> isfloat(hMain.color_selection),
1865         command_line=sprintf(<span class="string">'color * %6.3f%6.3f%6.3f'</span>,hMain.color_selection);
1866     <span class="keyword">else</span>
1867         command_line=sprintf(<span class="string">'colorscheme * %s'</span>,hMain.color_selection);
1868     <span class="keyword">end</span>;
1869     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command_line,hObject);
1870 <span class="keyword">end</span>;
1871 
1872 <span class="comment">% --------------------------------------------------------------------</span>
1873 <a name="_sub129" href="#_subfunctions" class="code">function context_model_trans_Callback(hObject, eventdata, handles)</a>
1874 <span class="comment">% hObject    handle to context_model_trans (see GCBO)</span>
1875 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1876 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1877 
1878 <span class="keyword">global</span> hMain
1879 
1880 transparency_selection;
1881 <span class="keyword">if</span> ~isempty(hMain.alpha),
1882     command_line=sprintf(<span class="string">'transparency * %4.2f'</span>,hMain.alpha);
1883     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command_line,hObject);
1884 <span class="keyword">else</span>
1885     add_msg_board(<span class="string">'Transparency selection cancelled by user.'</span>);
1886 <span class="keyword">end</span>;
1887 
1888 <span class="comment">% --------------------------------------------------------------------</span>
1889 <a name="_sub130" href="#_subfunctions" class="code">function pushtool_color_ClickedCallback(hObject, eventdata, handles)</a>
1890 <span class="comment">% hObject    handle to pushtool_color (see GCBO)</span>
1891 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1892 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1893 
1894 <span class="keyword">global</span> hMain
1895 
1896 color_selection;
1897 <span class="keyword">if</span> isempty(hMain.color_selection),
1898     add_msg_board(<span class="string">'Color selection cancelled by user.'</span>);
1899 <span class="keyword">else</span>
1900     <span class="keyword">if</span> isfloat(hMain.color_selection),
1901         command_line=sprintf(<span class="string">'color * %6.3f%6.3f%6.3f'</span>,hMain.color_selection);
1902     <span class="keyword">else</span>
1903         command_line=sprintf(<span class="string">'colorscheme * %s'</span>,hMain.color_selection);
1904     <span class="keyword">end</span>;
1905     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command_line,hObject);
1906 <span class="keyword">end</span>;
1907 
1908 <span class="comment">% --------------------------------------------------------------------</span>
1909 <a name="_sub131" href="#_subfunctions" class="code">function pushtool_trans_ClickedCallback(hObject, eventdata, handles)</a>
1910 <span class="comment">% hObject    handle to pushtool_trans (see GCBO)</span>
1911 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1912 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1913 
1914 <span class="keyword">global</span> hMain
1915 
1916 transparency_selection;
1917 <span class="keyword">if</span> ~isempty(hMain.alpha),
1918     command_line=sprintf(<span class="string">'transparency * %4.2f'</span>,hMain.alpha);
1919     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command_line,hObject);
1920 <span class="keyword">else</span>
1921     add_msg_board(<span class="string">'Transparency selection cancelled by user.'</span>);
1922 <span class="keyword">end</span>;
1923 
1924 
1925 <span class="comment">% --------------------------------------------------------------------</span>
1926 <a name="_sub132" href="#_subfunctions" class="code">function pushtool_fullview_ClickedCallback(hObject, eventdata, handles)</a>
1927 <span class="comment">% hObject    handle to pushtool_fullview (see GCBO)</span>
1928 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1929 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1930 
1931 command=sprintf(<span class="string">'zoom out'</span>);
1932 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
1933 
1934 
1935 <span class="comment">% --------------------------------------------------------------------</span>
1936 <a name="_sub133" href="#_subfunctions" class="code">function menu_display_all_Callback(hObject, eventdata, handles)</a>
1937 <span class="comment">% hObject    handle to menu_display_all (see GCBO)</span>
1938 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
1939 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
1940 
1941 command=sprintf(<span class="string">'zoom out'</span>);
1942 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
1943 
1944 
1945 <a name="_sub134" href="#_subfunctions" class="code">function add_and_plot_pdb(hObject,handles,FileName)</a>
1946 <span class="comment">% Provides a file open dialog, loads a PDB file, and plots the structure</span>
1947 <span class="comment">% after loading, the loaded structure and its first chain are the current</span>
1948 <span class="comment">% structure and chain</span>
1949 
1950 <span class="keyword">global</span> model
1951 <span class="keyword">global</span> hMain
1952 <span class="keyword">global</span> graph_settings
1953 
1954 <span class="keyword">if</span> hMain.virgin,
1955     hMain.virgin=0;
1956     <span class="comment">% initialize display</span>
1957     axes(handles.axes_model);
1958     cla reset;
1959     axis equal
1960     axis off
1961     set(gca,<span class="string">'Clipping'</span>,<span class="string">'off'</span>);
1962     set(gcf,<span class="string">'Renderer'</span>,<span class="string">'opengl'</span>);
1963     hold on
1964     hMain.camlight=camlight;
1965     guidata(handles.axes_model,hMain);
1966 <span class="keyword">end</span>;
1967 
1968 <span class="keyword">if</span> nargin&lt;3,
1969     [FileName,PathName,FilterIndex] = uigetfile({<span class="string">'*.pdb;*.pdb1;*.ent'</span>},<span class="string">'Select PDB file'</span>);
1970     <span class="keyword">if</span> isequal(FileName,0) || isequal(PathName,0),
1971         add_msg_board(<span class="string">'Loading of PDB file canceled by user.'</span>);
1972         <span class="keyword">return</span>;
1973     <span class="keyword">end</span>;
1974     cd(PathName);
1975 <span class="keyword">end</span>;
1976 set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
1977 set(handles.popupmenu_view,<span class="string">'Value'</span>,1);
1978 drawnow;
1979 [message,snum]=add_pdb(FileName);
1980 model.selected=[]; <span class="comment">% nothing is selected on load</span>
1981 model.selections=0;
1982 model.secondary_selected={};
1983 model.secondary_indices={};
1984 
1985 command=sprintf(<span class="string">'attach'</span>);
1986 <span class="keyword">if</span> hMain.hierarchy_display,
1987     disp_hierarchy=1;
1988     <span class="keyword">try</span>
1989         close(hMain.hierarchy_window);
1990     <span class="keyword">catch</span> exception
1991         <span class="keyword">return</span>
1992     <span class="keyword">end</span>;
1993 <span class="keyword">else</span>
1994     disp_hierarchy=0;
1995 <span class="keyword">end</span>;
1996 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
1997 
1998 fig=hMain.figure;
1999 
2000 rot_state=get(handles.uitoggletool_rotate,<span class="string">'State'</span>);
2001 <span class="keyword">if</span> strcmp(rot_state,<span class="string">'on'</span>),
2002     set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'off'</span>);
2003     view3D(fig,<span class="string">'off'</span>);
2004 <span class="keyword">end</span>;
2005     
2006 zoom_state=get(handles.uitoggletool_zoom,<span class="string">'State'</span>);
2007 <span class="keyword">if</span> strcmp(zoom_state,<span class="string">'on'</span>),
2008     set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'off'</span>);
2009     view3D(fig,<span class="string">'off'</span>);
2010 <span class="keyword">end</span>;
2011 
2012 pan_state=get(handles.uitoggletool_pan,<span class="string">'State'</span>);
2013 <span class="keyword">if</span> strcmp(pan_state,<span class="string">'on'</span>),
2014     set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'off'</span>);
2015     view3D(fig,<span class="string">'off'</span>);
2016 <span class="keyword">end</span>;
2017     
2018 set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
2019 set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
2020 set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
2021 set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
2022 
2023 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'on'</span>);
2024 
2025 <span class="keyword">if</span> ~isempty(hMain.auxiliary),
2026     <span class="keyword">for</span> k=1:length(hMain.auxiliary),
2027         <span class="keyword">try</span>
2028             delete(hMain.auxiliary(k));
2029         <span class="keyword">catch</span> my_exception
2030         <span class="keyword">end</span>;
2031     <span class="keyword">end</span>;
2032     hMain.auxiliary=[];
2033 <span class="keyword">end</span>;
2034 
2035 <span class="comment">% initialize display</span>
2036 axes(handles.axes_model);
2037 axis equal
2038 axis off
2039 set(gca,<span class="string">'Clipping'</span>,<span class="string">'off'</span>);
2040 set(gcf,<span class="string">'Renderer'</span>,<span class="string">'opengl'</span>);
2041 hold on
2042 guidata(handles.axes_model,hMain);
2043 
2044 view(graph_settings.az,graph_settings.el);
2045 lighting gouraud 
2046 material shiny
2047 
2048 guidata(handles.axes_model,handles);
2049 
2050 axes(handles.axes_frame);
2051 cla reset;
2052 axis equal
2053 axis off
2054 hold on
2055 
2056 plot3([0 1],[0 0],[0 0],<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2); <span class="comment">% x axis</span>
2057 plot3([0 0],[0 1],[0 0],<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2); <span class="comment">% y axis</span>
2058 plot3([0 0],[0 0],[0 1],<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,2); <span class="comment">% z axis</span>
2059 axis([-0.1,1.1,-0.1,1.1,-0.1,1.1]);
2060 
2061 guidata(handles.axes_frame,handles);
2062 
2063 set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
2064 drawnow;
2065 
2066 stag=id2tag(snum,model.structure_tags);
2067 ScriptName=[basname(FileName) <span class="string">'.mmm'</span>];
2068 <span class="keyword">if</span> exist(ScriptName,<span class="string">'file'</span>)
2069     button = questdlg(<span class="string">'Do you want to run this script?'</span>,<span class="string">'Initialization script exists'</span>,<span class="string">'Yes'</span>);
2070     set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
2071     add_msg_board(<span class="string">'Computing graphics... Please be patient.'</span>);
2072     drawnow;
2073     <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
2074         <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,<span class="string">'unlock'</span>,hObject);
2075         handles=<a href="#_sub113" class="code" title="subfunction handles=run_script(handles,fname)">run_script</a>(handles,ScriptName);
2076     <span class="keyword">else</span>
2077         command=sprintf(<span class="string">'show [%s] ribbon'</span>,stag);
2078         handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);        
2079     <span class="keyword">end</span>;
2080 <span class="keyword">else</span>
2081     set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
2082     drawnow;
2083     command=sprintf(<span class="string">'show [%s] ribbon'</span>,stag);
2084     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
2085 <span class="keyword">end</span>;
2086 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,<span class="string">'lock'</span>,hObject);
2087 <span class="keyword">if</span> isfield(hMain,<span class="string">'camlight'</span>),
2088     hMain.camlight=camlight(hMain.camlight);
2089 <span class="keyword">else</span>
2090     hMain.camlight=camlight;
2091 <span class="keyword">end</span>;
2092 camlookat(hMain.axes_model);
2093 guidata(handles.axes_model,hMain);
2094 
2095 <span class="keyword">if</span> disp_hierarchy,
2096     hierarchy_window;
2097 <span class="keyword">end</span>;
2098 
2099 set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
2100 drawnow;
2101 
2102 set_view;
2103 
2104 guidata(hObject,handles);
2105 
2106 
2107 <span class="comment">% --------------------------------------------------------------------</span>
2108 <a name="_sub135" href="#_subfunctions" class="code">function uipushtool_graphics_ClickedCallback(hObject, eventdata, handles)</a>
2109 <span class="comment">% hObject    handle to uipushtool_graphics (see GCBO)</span>
2110 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2111 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2112 
2113 <span class="keyword">global</span> model
2114 
2115 <span class="keyword">if</span> ~isfield(model,<span class="string">'selections'</span>) || ~isfield(model,<span class="string">'selected'</span>) || isempty(model.selected);
2116     add_msg_board(<span class="string">'### Warning ###. Nothing is selected.'</span>);
2117     model.selections=0;
2118     model.selected={};
2119 <span class="keyword">else</span>
2120     graphics_selection;
2121 <span class="keyword">end</span>;
2122 
2123 
2124 <span class="comment">% --------------------------------------------------------------------</span>
2125 <a name="_sub136" href="#_subfunctions" class="code">function menu_display_transparency_Callback(hObject, eventdata, handles)</a>
2126 <span class="comment">% hObject    handle to menu_display_transparency (see GCBO)</span>
2127 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2128 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2129 
2130 <span class="keyword">global</span> hMain
2131 
2132 transparency_selection;
2133 <span class="keyword">if</span> ~isempty(hMain.alpha),
2134     command_line=sprintf(<span class="string">'transparency * %4.2f'</span>,hMain.alpha);
2135     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command_line,hObject);
2136 <span class="keyword">else</span>
2137     add_msg_board(<span class="string">'Transparency selection cancelled by user.'</span>);
2138 <span class="keyword">end</span>;
2139 
2140 <span class="comment">% --- Executes on button press in togglebutton_depth_cueing.</span>
2141 <a name="_sub137" href="#_subfunctions" class="code">function togglebutton_depth_cueing_Callback(hObject, eventdata, handles)</a>
2142 <span class="comment">% hObject    handle to togglebutton_depth_cueing (see GCBO)</span>
2143 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2144 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2145 
2146 <span class="comment">% Hint: get(hObject,'Value') returns toggle state of togglebutton_depth_cueing</span>
2147 
2148 <span class="keyword">global</span> hMain
2149 
2150 <span class="keyword">if</span> get(hObject,<span class="string">'Value'</span>)
2151     hMain.depth_cue=1;
2152     h=depth_cue_control;
2153 <span class="keyword">else</span>
2154     hMain.depth_cue=0;
2155     handles=guidata(hMain.depthcue_control);
2156     depth_cue_control(<span class="string">'pushbutton_cancel_Callback'</span>,hMain.depthcue_control,eventdata,handles);
2157 <span class="keyword">end</span>;
2158     
2159 
2160 
2161 <span class="comment">% --------------------------------------------------------------------</span>
2162 <a name="_sub138" href="#_subfunctions" class="code">function menu_analysis_context_Callback(hObject, eventdata, handles)</a>
2163 <span class="comment">% hObject    handle to menu_analysis_context (see GCBO)</span>
2164 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2165 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2166 
2167 selection_context;
2168 
2169 <span class="comment">% --------------------------------------------------------------------</span>
2170 <a name="_sub139" href="#_subfunctions" class="code">function menu_analysis_distance_Callback(hObject, eventdata, handles)</a>
2171 <span class="comment">% hObject    handle to menu_analysis_distance (see GCBO)</span>
2172 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2173 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2174 display_distance;
2175 
2176 <span class="comment">% --------------------------------------------------------------------</span>
2177 <a name="_sub140" href="#_subfunctions" class="code">function menu_analysis_angle_Callback(hObject, eventdata, handles)</a>
2178 <span class="comment">% hObject    handle to menu_analysis_angle (see GCBO)</span>
2179 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2180 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2181 display_angle;
2182 
2183 <span class="comment">% --------------------------------------------------------------------</span>
2184 <a name="_sub141" href="#_subfunctions" class="code">function menu_analysis_dihedral_Callback(hObject, eventdata, handles)</a>
2185 <span class="comment">% hObject    handle to menu_analysis_dihedral (see GCBO)</span>
2186 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2187 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2188 display_dihedral;
2189 
2190 <span class="comment">% --------------------------------------------------------------------</span>
2191 <a name="_sub142" href="#_subfunctions" class="code">function uipushtool_context_ClickedCallback(hObject, eventdata, handles)</a>
2192 <span class="comment">% hObject    handle to uipushtool_context (see GCBO)</span>
2193 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2194 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2195 
2196 selection_context;
2197 
2198 <span class="comment">% --------------------------------------------------------------------</span>
2199 <a name="_sub143" href="#_subfunctions" class="code">function uipushtool_distance_ClickedCallback(hObject, eventdata, handles)</a>
2200 <span class="comment">% hObject    handle to uipushtool_distance (see GCBO)</span>
2201 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2202 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2203 display_distance;
2204 
2205 <span class="comment">% --------------------------------------------------------------------</span>
2206 <a name="_sub144" href="#_subfunctions" class="code">function uipushtool_angle_ClickedCallback(hObject, eventdata, handles)</a>
2207 <span class="comment">% hObject    handle to uipushtool_angle (see GCBO)</span>
2208 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2209 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2210 display_angle;
2211 
2212 <span class="comment">% --------------------------------------------------------------------</span>
2213 <a name="_sub145" href="#_subfunctions" class="code">function uipushtool_dihedral_ClickedCallback(hObject, eventdata, handles)</a>
2214 <span class="comment">% hObject    handle to uipushtool_dihedral (see GCBO)</span>
2215 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2216 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2217 display_dihedral;
2218 
2219 
2220 <span class="comment">% --------------------------------------------------------------------</span>
2221 <a name="_sub146" href="#_subfunctions" class="code">function uitoggletool_lock_ClickedCallback(hObject, eventdata, handles)</a>
2222 <span class="comment">% hObject    handle to uitoggletool_lock (see GCBO)</span>
2223 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2224 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2225 
2226 mystate=get(hObject,<span class="string">'State'</span>);
2227 <span class="keyword">if</span> strcmpi(mystate,<span class="string">'on'</span>),
2228     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,<span class="string">'lock'</span>,hObject);
2229 <span class="keyword">else</span>
2230     handles=<a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,<span class="string">'unlock'</span>,hObject);
2231 <span class="keyword">end</span>;
2232 guidata(hObject,handles);
2233 
2234 
2235 <span class="comment">% --------------------------------------------------------------------</span>
2236 <a name="_sub147" href="#_subfunctions" class="code">function menu_EPR_label_Callback(hObject, eventdata, handles)</a>
2237 <span class="comment">% hObject    handle to menu_EPR_label (see GCBO)</span>
2238 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2239 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2240 
2241 <span class="keyword">global</span> hMain
2242 
2243 hMain.label_selection=<span class="string">'all selected residues'</span>;
2244 <a href="#_sub149" class="code" title="subfunction label_selection(hObject, eventdata, handles)">label_selection</a>(hObject, eventdata, handles);
2245 
2246 
2247 <span class="comment">% --------------------------------------------------------------------</span>
2248 <a name="_sub148" href="#_subfunctions" class="code">function uipushtool_label_ClickedCallback(hObject, eventdata, handles)</a>
2249 <span class="comment">% hObject    handle to uipushtool_label (see GCBO)</span>
2250 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2251 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2252 
2253 <span class="keyword">global</span> hMain
2254 
2255 hMain.label_selection=<span class="string">'all selected residues'</span>;
2256 <a href="#_sub149" class="code" title="subfunction label_selection(hObject, eventdata, handles)">label_selection</a>(hObject, eventdata, handles)
2257 
2258 
2259 <a name="_sub149" href="#_subfunctions" class="code">function label_selection(hObject, eventdata, handles)</a>
2260 
2261 <span class="keyword">global</span> hMain
2262 
2263 [allindices,message]=resolve_address(<span class="string">'*'</span>); <span class="comment">% get indices of all selected objects</span>
2264 
2265 <span class="keyword">if</span> message.error,
2266     add_msg_board(message.text);
2267     guidata(hObject,handles);
2268     <span class="keyword">return</span>
2269 <span class="keyword">end</span>;
2270 
2271 labeling_conditions;
2272 
2273 <span class="keyword">if</span> isempty(hMain.library),
2274     add_msg_board(<span class="string">'Labeling request cancelled by user.'</span>);
2275 <span class="keyword">else</span>
2276     load(hMain.library);
2277     
2278     calc_positions=rotamer_populations(allindices,rot_lib,hMain.temperature,true);
2279 
2280     set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
2281 
2282     n=length(calc_positions);
2283     <span class="keyword">if</span> n&gt;=1,
2284         <span class="keyword">for</span> k=1:n,
2285             [msg,indices]=get_residue(calc_positions(k).indices,<span class="string">'children'</span>);
2286             set_object(indices,<span class="string">'hide'</span>);
2287             set_residue(calc_positions(k).indices,<span class="string">'label'</span>,{calc_positions(k).label,calc_positions(k).rotamers});
2288             text=sprintf(<span class="string">'label attached: %s using library %s at a temperature of %4.0f K'</span>,calc_positions(k).label,hMain.library,hMain.temperature);
2289             add_annotation(calc_positions(k).indices,<span class="string">'Spin'</span>,text,{<span class="string">'spin label attached'</span>});
2290         <span class="keyword">end</span>;
2291     <span class="keyword">end</span>;
2292 
2293     set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
2294 <span class="keyword">end</span>;
2295 
2296 guidata(hObject,handles);
2297 
2298 
2299 <span class="comment">% --------------------------------------------------------------------</span>
2300 <a name="_sub150" href="#_subfunctions" class="code">function pushtool_save_ClickedCallback(hObject, eventdata, handles)</a>
2301 <span class="comment">% hObject    handle to pushtool_save (see GCBO)</span>
2302 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2303 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2304 
2305 <a href="#_sub151" class="code" title="subfunction save_model(hObject, eventdata, handles, force, privacy)">save_model</a>(hObject, eventdata, handles, 1);
2306 
2307 <a name="_sub151" href="#_subfunctions" class="code">function save_model(hObject, eventdata, handles, force, privacy)</a>
2308 
2309 <span class="keyword">global</span> hMain
2310 <span class="keyword">global</span> rootdir
2311 <span class="keyword">global</span> model
2312 
2313 
2314 <span class="keyword">if</span> nargin&lt;4,
2315     force=0;
2316 <span class="keyword">end</span>;
2317 
2318 <span class="keyword">if</span> nargin&lt;5,
2319     privacy=2;
2320 <span class="keyword">end</span>;
2321 
2322 <span class="keyword">switch</span> privacy
2323     <span class="keyword">case</span> 0
2324         title=<span class="string">'Share model in MMM format with public'</span>;
2325     <span class="keyword">case</span> 1
2326         title=<span class="string">'Share model in MMM format with group'</span>;
2327     <span class="keyword">case</span> 2
2328         title=<span class="string">'Save model in MMM format'</span>;
2329 <span class="keyword">end</span>;
2330 
2331 format_spec=<span class="string">'MMM'</span>;
2332 
2333 camera.dar=get(hMain.axes_model,<span class="string">'DataAspectRatio'</span>);
2334 camera.up=get(hMain.axes_model,<span class="string">'CameraUpVector'</span>);
2335 camera.pos=get(hMain.axes_model,<span class="string">'CameraPosition'</span>);
2336 camera.targ=get(hMain.axes_model,<span class="string">'CameraTarget'</span>);
2337 camera.view=get(hMain.axes_model,<span class="string">'CameraViewAngle'</span>);
2338 camera.proj=get(hMain.axes_model,<span class="string">'Projection'</span>);
2339 camera.detached=hMain.detached;
2340 
2341 defname=sprintf(<span class="string">'MMM_%s.mat'</span>,datestr(now,<span class="string">'yyyy-mm-dd_HH-MM-SS'</span>));
2342 
2343 <span class="keyword">if</span> force,
2344     filename=defname;
2345     pathname=strcat(rootdir,<span class="string">'/tmp/'</span>);
2346 <span class="keyword">else</span>
2347     [filename,pathname] = uiputfile(<span class="string">'.mat'</span>,title,defname);
2348 <span class="keyword">end</span>;
2349 
2350 <span class="keyword">if</span> isequal(filename,0) || isequal(pathname,0)
2351     add_msg_board(<span class="string">'Saving of model canceled by user'</span>);
2352 <span class="keyword">else</span>
2353     <span class="comment">% this is a combined Windows Vist/Matlab bug handling</span>
2354     <span class="keyword">try</span>
2355         fclose(<span class="string">'all'</span>);
2356         save(fullfile(pathname,filename),<span class="string">'model'</span>,<span class="string">'camera'</span>,<span class="string">'format_spec'</span>);
2357     <span class="keyword">catch</span> my_exception
2358         <span class="keyword">try</span>
2359             fclose(<span class="string">'all'</span>);
2360             still_there=true;
2361             trials=0;
2362             <span class="keyword">while</span> still_there &amp;&amp; trials&lt;=10,
2363                 still_there=false;
2364                 trials=trials+1;
2365                 <span class="keyword">if</span> exist(fullfile(pathname,filename),<span class="string">'file'</span>),
2366                     still_there=true;
2367                     delete(fullfile(pathname,filename));
2368                 <span class="keyword">end</span>;
2369             <span class="keyword">end</span>;
2370             save(fullfile(pathname,filename),<span class="string">'model'</span>,<span class="string">'camera'</span>,<span class="string">'format_spec'</span>);
2371         <span class="keyword">catch</span> my_exception2
2372             add_msg_board(<span class="string">'ERROR: Saving of model failed. Permission denied.'</span>);
2373             msgbox(<span class="string">'Saving of model failed. Permission denied. Please try to save again.'</span>,<span class="string">'This is a Windows/Matlab bug.'</span>,<span class="string">'error'</span>);
2374             <span class="keyword">return</span>
2375         <span class="keyword">end</span>;
2376     <span class="keyword">end</span>;
2377     <span class="keyword">switch</span> privacy
2378         <span class="keyword">case</span> 0
2379             msg=<span class="string">'Model saved with only public annotations.'</span>;
2380         <span class="keyword">case</span> 1
2381             msg=<span class="string">'Model saved with group annotations but no user annotations.'</span>;
2382         <span class="keyword">case</span> 2
2383             msg=<span class="string">'Model saved with all annotations.'</span>;
2384     <span class="keyword">end</span>;
2385 
2386     add_msg_board(msg);
2387 <span class="keyword">end</span>;
2388 guidata(hObject,handles);
2389 
2390 <span class="comment">% --------------------------------------------------------------------</span>
2391 <a name="_sub152" href="#_subfunctions" class="code">function pushtool_open_ClickedCallback(hObject, eventdata, handles)</a>
2392 <span class="comment">% hObject    handle to pushtool_open (see GCBO)</span>
2393 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2394 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2395 
2396 <a href="#_sub153" class="code" title="subfunction open_model(hObject, eventdata, handles, display)">open_model</a>(hObject, eventdata, handles);
2397 add_msg_board(<span class="string">'Model loaded.'</span>);
2398 drawnow;
2399 
2400 <a name="_sub153" href="#_subfunctions" class="code">function open_model(hObject, eventdata, handles, display)</a>
2401 
2402 <span class="keyword">global</span> model
2403 
2404 <span class="keyword">if</span> nargin&lt;4,
2405     display=true;
2406 <span class="keyword">end</span>;
2407 
2408 set(handles.popupmenu_view,<span class="string">'Value'</span>,1);
2409 
2410 [filename,pathname] = uigetfile(<span class="string">'.mat'</span>,<span class="string">'Load model in MMM format'</span>);
2411 
2412 <span class="keyword">if</span> isequal(filename,0) || isequal(pathname,0)
2413     add_msg_board(<span class="string">'Loading of model canceled by user'</span>);
2414 <span class="keyword">else</span>
2415     cd(pathname);
2416     load(fullfile(pathname,filename));
2417     <span class="keyword">if</span> ~exist(<span class="string">'format_spec'</span>,<span class="string">'var'</span>),
2418         add_msg_board(<span class="string">'Selected file is not an MMM model file'</span>);
2419         <span class="keyword">return</span>;
2420     <span class="keyword">end</span>;
2421     <span class="keyword">if</span> ~strcmpi(format_spec,<span class="string">'MMM'</span>),
2422         add_msg_board(<span class="string">'Selected file is not an MMM model file'</span>);
2423         <span class="keyword">return</span>;
2424     <span class="keyword">end</span>;
2425     add_msg_board(sprintf(<span class="string">'Model %s loaded.'</span>,filename));
2426     <span class="keyword">if</span> ~isfield(model,<span class="string">'graphics_lookup_pointer'</span>), <span class="comment">%#ok</span>
2427         <span class="keyword">if</span> isfield(model,<span class="string">'graphics_lookup'</span>),
2428             model.graphics_lookup_pointer=length(find(model.graphics_lookup(:,1)&gt;0));
2429         <span class="keyword">end</span>;
2430     <span class="keyword">end</span>;
2431     <span class="keyword">if</span> display,
2432         set(gcf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
2433         drawnow;
2434         auto_search;
2435         set(gcf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
2436         drawnow;
2437         handles=<a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles,hObject,camera);
2438         add_msg_board(<span class="string">'Graphics displayed.'</span>);
2439     <span class="keyword">else</span>
2440         add_msg_board(<span class="string">'Graphics display and reference autosearch are suppressed.'</span>);
2441     <span class="keyword">end</span>;
2442     guidata(hObject,handles);
2443 <span class="keyword">end</span>;
2444 
2445 <span class="comment">% --------------------------------------------------------------------</span>
2446 <a name="_sub154" href="#_subfunctions" class="code">function pushtool_print_ClickedCallback(hObject, eventdata, handles)</a>
2447 <span class="comment">% hObject    handle to pushtool_print (see GCBO)</span>
2448 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2449 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2450 
2451 
2452 <a name="_sub155" href="#_subfunctions" class="code">function handles=display_model(handles,hObject,camera)</a>
2453 <span class="comment">% Displays a loaded model</span>
2454 <span class="comment">% initialize display</span>
2455 <span class="comment">%</span>
2456 <span class="comment">% camera parameteres are optional</span>
2457 
2458 <span class="keyword">global</span> hMain
2459 <span class="keyword">global</span> model
2460 
2461 <span class="keyword">if</span> ~isfield(model,<span class="string">'current_structure'</span>),
2462     add_msg_board(<span class="string">'No structure defined in this model.'</span>);
2463     <span class="keyword">return</span>
2464 <span class="keyword">end</span>;
2465 
2466 add_msg_board(<span class="string">'Computing graphics for display...'</span>);
2467 drawnow;
2468 
2469 <span class="comment">% initialize display</span>
2470 axes(handles.axes_model);
2471 cla reset;
2472 axis equal
2473 axis off
2474 set(gca,<span class="string">'Clipping'</span>,<span class="string">'off'</span>);
2475 set(gcf,<span class="string">'Renderer'</span>,<span class="string">'opengl'</span>);
2476 hold on
2477 hMain.camlight=camlight;
2478 guidata(handles.axes_model,hMain);
2479 hMain.virgin=0;
2480 
2481 snum=model.current_structure;
2482 <span class="keyword">if</span> isfield(model.info{snum},<span class="string">'resolution'</span>) &amp;&amp; ~isempty(model.info{snum}.resolution),
2483     resstring=sprintf(<span class="string">'%4.2f �,model.info{snum}.resolution);</span>
2484 <span class="keyword">else</span>
2485     resstring=<span class="string">'not specified'</span>;
2486 <span class="keyword">end</span>;
2487     
2488 set(hMain.MMM,<span class="string">'Name'</span>,sprintf(<span class="string">'MMM - [%s](%s) Resolution %s'</span>,model.info{snum}.idCode,model.current_chain,resstring));
2489 set(hMain.menu_file_save_PDB,<span class="string">'Enable'</span>,<span class="string">'on'</span>);
2490 
2491 command=sprintf(<span class="string">'attach'</span>);
2492 <span class="keyword">if</span> hMain.hierarchy_display,
2493     disp_hierarchy=1;
2494     <span class="keyword">try</span>
2495         close(hMain.hierarchy_window);
2496     <span class="keyword">catch</span> exception
2497         <span class="keyword">return</span>
2498     <span class="keyword">end</span>;
2499 <span class="keyword">else</span>
2500     disp_hierarchy=0;
2501 <span class="keyword">end</span>;
2502 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
2503 
2504 fig=hMain.figure;
2505 
2506 rot_state=get(handles.uitoggletool_rotate,<span class="string">'State'</span>);
2507 <span class="keyword">if</span> strcmp(rot_state,<span class="string">'on'</span>),
2508     set(handles.uitoggletool_rotate,<span class="string">'State'</span>,<span class="string">'off'</span>);
2509     view3D(fig,<span class="string">'off'</span>);
2510 <span class="keyword">end</span>;
2511     
2512 zoom_state=get(handles.uitoggletool_zoom,<span class="string">'State'</span>);
2513 <span class="keyword">if</span> strcmp(zoom_state,<span class="string">'on'</span>),
2514     set(handles.uitoggletool_zoom,<span class="string">'State'</span>,<span class="string">'off'</span>);
2515     view3D(fig,<span class="string">'off'</span>);
2516 <span class="keyword">end</span>;
2517 
2518 pan_state=get(handles.uitoggletool_pan,<span class="string">'State'</span>);
2519 <span class="keyword">if</span> strcmp(pan_state,<span class="string">'on'</span>),
2520     set(handles.uitoggletool_pan,<span class="string">'State'</span>,<span class="string">'off'</span>);
2521     view3D(fig,<span class="string">'off'</span>);
2522 <span class="keyword">end</span>;
2523 
2524 set(handles.context_model_rotate,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
2525 set(handles.context_model_zoom,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
2526 set(handles.context_model_select,<span class="string">'Checked'</span>,<span class="string">'on'</span>);
2527 set(handles.context_model_pan,<span class="string">'Checked'</span>,<span class="string">'off'</span>);
2528 
2529 set(handles.uitoggletool_select,<span class="string">'State'</span>,<span class="string">'on'</span>);
2530 
2531 <span class="keyword">if</span> ~isempty(hMain.auxiliary),
2532     <span class="keyword">for</span> k=1:length(hMain.auxiliary),
2533         <span class="keyword">try</span>
2534             delete(hMain.auxiliary(k));
2535         <span class="keyword">catch</span> my_exception
2536         <span class="keyword">end</span>;
2537     <span class="keyword">end</span>;
2538     hMain.auxiliary=[];
2539 <span class="keyword">end</span>;
2540 
2541 set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
2542 drawnow;
2543 
2544 plot_model;
2545 
2546 <span class="keyword">if</span> nargin&gt;2,
2547     <span class="keyword">if</span> ~isfield(camera,<span class="string">'view'</span>),
2548         set(hMain.axes_model,<span class="string">'cameraposition'</span>, camera.pos );
2549         set(hMain.axes_model,<span class="string">'cameratarget'</span>,camera.targ   );
2550         set(hMain.axes_model,<span class="string">'dataaspectratio'</span>, camera.dar );
2551         set(hMain.axes_model,<span class="string">'cameraupvector'</span>, camera.up );
2552     <span class="keyword">else</span>
2553         <span class="keyword">if</span> camera.detached,
2554             <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,<span class="string">'detach'</span>,hObject);
2555         <span class="keyword">end</span>;
2556         set(hMain.axes_model,<span class="string">'DataAspectRatio'</span>,camera.dar);
2557         set(hMain.axes_model,<span class="string">'CameraUpVector'</span>,camera.up);
2558         set(hMain.axes_model,<span class="string">'CameraPosition'</span>,camera.pos);
2559         set(hMain.axes_model,<span class="string">'CameraTarget'</span>,camera.targ);
2560         set(hMain.axes_model,<span class="string">'CameraViewAngle'</span>,camera.view);
2561         set(hMain.axes_model,<span class="string">'Projection'</span>,camera.proj);
2562     <span class="keyword">end</span>;
2563 <span class="keyword">end</span>;
2564 
2565 lighting gouraud 
2566 material shiny
2567 
2568 axes(handles.axes_frame);
2569 cla reset;
2570 axis equal
2571 axis off
2572 hold on
2573 
2574 plot3([0 1],[0 0],[0 0],<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2); <span class="comment">% x axis</span>
2575 plot3([0 0],[0 1],[0 0],<span class="string">'g'</span>,<span class="string">'LineWidth'</span>,2); <span class="comment">% y axis</span>
2576 plot3([0 0],[0 0],[0 1],<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,2); <span class="comment">% z axis</span>
2577 axis([-0.1,1.1,-0.1,1.1,-0.1,1.1]);
2578 
2579 set(hMain.popupmenu_view,<span class="string">'Value'</span>,1);
2580 
2581 <span class="comment">% cam_up=get(hMain.axes_model,'CameraUpVector');</span>
2582 <span class="comment">% set(hMain.axes_frame,'CameraUpVector',cam_up);</span>
2583 <span class="comment">% cam_pos=get(hMain.axes_model,'CameraPosition');</span>
2584 <span class="comment">% set(hMain.axes_frame,'CameraPosition',cam_pos);</span>
2585 
2586 set_view;
2587 
2588 guidata(handles.axes_frame,handles);
2589 
2590 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,<span class="string">'lock'</span>,hObject);
2591 hMain.camlight=camlight(hMain.camlight);
2592 <span class="keyword">if</span> ~exist(<span class="string">'camera'</span>,<span class="string">'var'</span>) || ~isfield(camera,<span class="string">'view'</span>),
2593     camlookat(hMain.axes_model);
2594 <span class="keyword">end</span>;
2595 guidata(handles.axes_model,hMain);
2596 
2597 <span class="keyword">if</span> disp_hierarchy,
2598     hierarchy_window;
2599 <span class="keyword">end</span>;
2600 
2601 hMain.graph_update=0;
2602 
2603 set(handles.MMM,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
2604 set(fig,<span class="string">'WindowScrollWheelFcn'</span>,@view3DScrollFcn);
2605 
2606 drawnow;
2607 
2608 
2609 <span class="comment">% --------------------------------------------------------------------</span>
2610 <a name="_sub156" href="#_subfunctions" class="code">function menu_epr_access_water_Callback(hObject, eventdata, handles)</a>
2611 <span class="comment">% hObject    handle to menu_epr_access_water (see GCBO)</span>
2612 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2613 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2614 
2615 <span class="keyword">global</span> hMain
2616 <span class="keyword">global</span> eav
2617 
2618 fname=label_ESEEM_accessibility(eav.water);
2619 hMain.report_file=fname;
2620 report_editor;
2621 
2622 <span class="comment">% --------------------------------------------------------------------</span>
2623 <a name="_sub157" href="#_subfunctions" class="code">function menu_epr_access_oxygen_Callback(hObject, eventdata, handles)</a>
2624 <span class="comment">% hObject    handle to menu_epr_access_oxygen (see GCBO)</span>
2625 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2626 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2627 
2628 <span class="keyword">global</span> hMain
2629 <span class="keyword">global</span> eav
2630 
2631 fname=label_accessibility(eav.O2);
2632 hMain.report_file=fname;
2633 report_editor;
2634 
2635 
2636 <span class="comment">% --------------------------------------------------------------------</span>
2637 <a name="_sub158" href="#_subfunctions" class="code">function menu_EPR_site_scan_Callback(hObject, eventdata, handles)</a>
2638 <span class="comment">% hObject    handle to menu_EPR_site_scan (see GCBO)</span>
2639 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2640 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2641 
2642 
2643 
2644 <span class="comment">% --------------------------------------------------------------------</span>
2645 <a name="_sub159" href="#_subfunctions" class="code">function menu_edit_annotation_Callback(hObject, eventdata, handles)</a>
2646 <span class="comment">% hObject    handle to menu_edit_annotation (see GCBO)</span>
2647 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2648 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2649 
2650 annotation_window;
2651 
2652 <span class="comment">% --------------------------------------------------------------------</span>
2653 <a name="_sub160" href="#_subfunctions" class="code">function menu_predict_CD_Callback(hObject, eventdata, handles)</a>
2654 <span class="comment">% hObject    handle to menu_predict_CD (see GCBO)</span>
2655 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2656 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2657 
2658 <span class="keyword">global</span> web_adr
2659 
2660 webcall(web_adr.DichroCalc);
2661 
2662 
2663 <span class="comment">% --------------------------------------------------------------------</span>
2664 <a name="_sub161" href="#_subfunctions" class="code">function uipushtool_annotation_ClickedCallback(hObject, eventdata, handles)</a>
2665 <span class="comment">% hObject    handle to uipushtool_annotation (see GCBO)</span>
2666 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2667 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2668 
2669 annotation_window;
2670 
2671 
2672 <span class="comment">% --------------------------------------------------------------------</span>
2673 <a name="_sub162" href="#_subfunctions" class="code">function menu_edit_findkey_Callback(hObject, eventdata, handles)</a>
2674 <span class="comment">% hObject    handle to menu_edit_findkey (see GCBO)</span>
2675 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2676 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2677 
2678 <span class="keyword">global</span> model
2679 
2680 <span class="keyword">if</span> isfield(model,<span class="string">'keys'</span>),
2681     find_by_key;
2682 <span class="keyword">else</span>
2683     add_msg_board(<span class="string">'### ERROR ### No keywords defined yet.'</span>);
2684 <span class="keyword">end</span>;
2685 
2686 <span class="comment">% --------------------------------------------------------------------</span>
2687 <a name="_sub163" href="#_subfunctions" class="code">function menu_help_Callback(hObject, eventdata, handles)</a>
2688 <span class="comment">% hObject    handle to menu_help (see GCBO)</span>
2689 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2690 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2691 
2692 
2693 <span class="comment">% --------------------------------------------------------------------</span>
2694 <a name="_sub164" href="#_subfunctions" class="code">function menu_help_overview_Callback(hObject, eventdata, handles)</a>
2695 <span class="comment">% hObject    handle to menu_help_overview (see GCBO)</span>
2696 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2697 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2698 
2699 <span class="keyword">global</span> help_files
2700 
2701 entry=strcat(help_files,<span class="string">'overview.html'</span>);
2702 webcall(entry,<span class="string">'-helpbrowser'</span>);
2703 
2704 <span class="comment">% --------------------------------------------------------------------</span>
2705 <a name="_sub165" href="#_subfunctions" class="code">function menu_help_about_Callback(hObject, eventdata, handles)</a>
2706 <span class="comment">% hObject    handle to menu_help_about (see GCBO)</span>
2707 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2708 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2709 
2710 h=figure;
2711 set(h,<span class="string">'NumberTitle'</span>,<span class="string">'off'</span>);
2712 set(h,<span class="string">'Name'</span>,<span class="string">'About MMM.'</span>);
2713 set(h,<span class="string">'Color'</span>,[20,43,140]/255);
2714 set(h,<span class="string">'MenuBar'</span>,<span class="string">'none'</span>);
2715 set(h,<span class="string">'ToolBar'</span>,<span class="string">'none'</span>);
2716 [img,map]=imread(<span class="string">'MMM_title.jpg'</span>);
2717 colormap(map);
2718 image(img);
2719 axis off
2720 axis equal
2721 
2722 <span class="comment">% --------------------------------------------------------------------</span>
2723 <a name="_sub166" href="#_subfunctions" class="code">function menu_help_credits_Callback(hObject, eventdata, handles)</a>
2724 <span class="comment">% hObject    handle to menu_help_credits (see GCBO)</span>
2725 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2726 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2727 
2728 <span class="keyword">global</span> help_files
2729 
2730 entry=strcat(help_files,<span class="string">'credits.html'</span>);
2731 webcall(entry,<span class="string">'-helpbrowser'</span>);
2732 
2733 <span class="comment">% --- Executes on button press in pushbutton_main_help.</span>
2734 <a name="_sub167" href="#_subfunctions" class="code">function pushbutton_main_help_Callback(hObject, eventdata, handles)</a>
2735 <span class="comment">% hObject    handle to pushbutton_main_help (see GCBO)</span>
2736 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2737 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2738 
2739 <span class="keyword">global</span> help_files
2740 
2741 entry=strcat(help_files,<span class="string">'main_window.html'</span>);
2742 webcall(entry,<span class="string">'-helpbrowser'</span>);
2743 
2744 
2745 <span class="comment">% --- Executes on selection change in popupmenu_view.</span>
2746 <a name="_sub168" href="#_subfunctions" class="code">function popupmenu_view_Callback(hObject, eventdata, handles)</a>
2747 <span class="comment">% hObject    handle to popupmenu_view (see GCBO)</span>
2748 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2749 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2750 
2751 <span class="comment">% Hints: contents = get(hObject,'String') returns popupmenu_view contents as cell array</span>
2752 <span class="comment">%        contents{get(hObject,'Value')} returns selected item from popupmenu_view</span>
2753 
2754 contents = get(hObject,<span class="string">'String'</span>);
2755 mode=contents{get(hObject,<span class="string">'Value'</span>)};
2756 
2757 cmd=sprintf(<span class="string">'view %s'</span>,mode);
2758 
2759 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,cmd,hObject);
2760 
2761 guidata(hObject,handles);
2762 
2763 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
2764 <a name="_sub169" href="#_subfunctions" class="code">function popupmenu_view_CreateFcn(hObject, eventdata, handles)</a>
2765 <span class="comment">% hObject    handle to popupmenu_view (see GCBO)</span>
2766 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2767 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
2768 
2769 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
2770 <span class="comment">%       See ISPC and COMPUTER.</span>
2771 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
2772     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
2773 <span class="keyword">end</span>
2774 
2775 
2776 <span class="comment">% --- Executes on button press in pushbutton_clear_msg_board.</span>
2777 <a name="_sub170" href="#_subfunctions" class="code">function pushbutton_clear_msg_board_Callback(hObject, eventdata, handles)</a>
2778 <span class="comment">% hObject    handle to pushbutton_clear_msg_board (see GCBO)</span>
2779 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2780 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2781 
2782 <span class="keyword">global</span> hMain
2783 
2784 set(hMain.text_message_board,<span class="string">'String'</span>,<span class="string">'Message board cleared.'</span>);
2785 
2786 
2787 <span class="comment">% --- Executes when user attempts to close MMM.</span>
2788 <a name="_sub171" href="#_subfunctions" class="code">function MMM_CloseRequestFcn(hObject, eventdata, handles)</a>
2789 <span class="comment">% hObject    handle to MMM (see GCBO)</span>
2790 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2791 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2792 
2793 <span class="comment">% Hint: delete(hObject) closes the figure</span>
2794 <span class="keyword">global</span> hMain
2795 
2796 <span class="keyword">if</span> exist(<span class="string">'model'</span>,<span class="string">'var'</span>) &amp;&amp; ~isempty(model),
2797     button = questdlg(<span class="string">'Do you want to save model?'</span>,<span class="string">'Closing MMM may cause loss of information'</span>,<span class="string">'Yes'</span>);
2798     <span class="keyword">if</span> strcmpi(button,<span class="string">'Cancel'</span>),
2799         <span class="keyword">return</span>
2800     <span class="keyword">end</span>;
2801     <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
2802         <a href="#_sub151" class="code" title="subfunction save_model(hObject, eventdata, handles, force, privacy)">save_model</a>(hObject, eventdata, handles);
2803     <span class="keyword">end</span>;
2804 <span class="keyword">end</span>;
2805 <span class="keyword">if</span> ~isempty(hMain.auxiliary),
2806     <span class="keyword">for</span> k=1:length(hMain.auxiliary),
2807         <span class="keyword">try</span>
2808             delete(hMain.auxiliary(k));
2809         <span class="keyword">catch</span> my_exception
2810         <span class="keyword">end</span>;
2811     <span class="keyword">end</span>;
2812     hMain.auxiliary=[];
2813 <span class="keyword">end</span>;
2814 delete(hObject);
2815 
2816 
2817 <span class="comment">% --------------------------------------------------------------------</span>
2818 <a name="_sub172" href="#_subfunctions" class="code">function menu_help_license_Callback(hObject, eventdata, handles)</a>
2819 <span class="comment">% hObject    handle to menu_help_license (see GCBO)</span>
2820 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2821 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2822 
2823 <span class="keyword">global</span> help_files
2824 
2825 entry=strcat(help_files,<span class="string">'license.html'</span>);
2826 webcall(entry,<span class="string">'-helpbrowser'</span>);
2827 
2828 
2829 <span class="comment">% --- Executes on button press in checkbox_log.</span>
2830 <a name="_sub173" href="#_subfunctions" class="code">function checkbox_log_Callback(hObject, eventdata, handles)</a>
2831 <span class="comment">% hObject    handle to checkbox_log (see GCBO)</span>
2832 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2833 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2834 
2835 <span class="comment">% Hint: get(hObject,'Value') returns toggle state of checkbox_log</span>
2836 
2837 <span class="keyword">global</span> rootdir
2838 <span class="keyword">global</span> hMain
2839 
2840 <span class="keyword">if</span> get(hObject,<span class="string">'Value'</span>),
2841     defname=sprintf(<span class="string">'MMM_%s.log'</span>,datestr(now,<span class="string">'yyyy-mm-dd_HH-MM-SS'</span>));
2842     pathname=strcat(rootdir,<span class="string">'/tmp/'</span>);
2843     outname=strcat(pathname,defname);
2844     hMain.logfile=outname;
2845     fid=fopen(outname,<span class="string">'w'</span>);
2846     fprintf(fid,<span class="string">'MMM logfile %s\n\n'</span>,defname);
2847     fclose(fid);
2848 <span class="keyword">else</span>
2849     msg=sprintf(<span class="string">'Log file closed: %s\n'</span>,datestr(now,<span class="string">'yyyy-mm-dd_HH-MM-SS'</span>));
2850     fid=fopen(hMain.logfile,<span class="string">'a+'</span>);
2851     fprintf(fid,<span class="string">'%s\n'</span>,msg);
2852     fclose(fid);
2853     add_msg_board(msg);
2854 <span class="keyword">end</span>;
2855 
2856 
2857 <span class="comment">% --------------------------------------------------------------------</span>
2858 <a name="_sub174" href="#_subfunctions" class="code">function menu_edit_magic_fit_Callback(hObject, eventdata, handles)</a>
2859 <span class="comment">% hObject    handle to menu_edit_magic_fit (see GCBO)</span>
2860 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2861 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2862 
2863 <span class="keyword">global</span> model
2864 <span class="keyword">global</span> hMain
2865 
2866 <span class="keyword">if</span> length(model.structures)&lt;2,
2867     add_msg_board(<span class="string">'ERROR: Magic fit requires at least two structures.'</span>);
2868 <span class="keyword">else</span>
2869     magic_fit;
2870     <span class="keyword">if</span> hMain.graph_update,
2871        <a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles, hObject);
2872     <span class="keyword">end</span>;
2873 <span class="keyword">end</span>;
2874 
2875 
2876 <span class="comment">% --------------------------------------------------------------------</span>
2877 <a name="_sub175" href="#_subfunctions" class="code">function menu_display_density_Callback(hObject, eventdata, handles)</a>
2878 <span class="comment">% hObject    handle to menu_display_density (see GCBO)</span>
2879 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2880 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2881 
2882 display_density;
2883 
2884 <span class="comment">% --------------------------------------------------------------------</span>
2885 <a name="_sub176" href="#_subfunctions" class="code">function menu_file_density_Callback(hObject, eventdata, handles)</a>
2886 <span class="comment">% hObject    handle to menu_file_density (see GCBO)</span>
2887 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2888 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2889 
2890 import_density;
2891 
2892 
2893 <span class="comment">% --------------------------------------------------------------------</span>
2894 <a name="_sub177" href="#_subfunctions" class="code">function menu_analysis_alignment_Callback(hObject, eventdata, handles)</a>
2895 <span class="comment">% hObject    handle to menu_analysis_alignment (see GCBO)</span>
2896 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
2897 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
2898 
2899 <span class="keyword">global</span> model
2900 
2901 indices=resolve_address(<span class="string">'*'</span>);
2902 seq1=model.structures{indices(1,1)}(indices(1,2)).sequence;
2903 seq2=model.structures{indices(2,1)}(indices(2,2)).sequence;
2904 adr1=mk_address(indices(1,1:2));
2905 adr2=mk_address(indices(2,1:2));
2906 diff=length(seq1)-length(seq2);
2907 
2908 n=min([length(seq1),length(seq2)]);
2909 n1=max([length(seq1),length(seq2)]);
2910 nonmatch1=zeros(n1,1);
2911 nonmatch2=zeros(n1,1);
2912 <span class="keyword">for</span> k=1:n,
2913     <span class="keyword">if</span> seq1(k)~=seq2(k),
2914         nonmatch1(k)=1;
2915     <span class="keyword">end</span>;
2916 <span class="keyword">end</span>;
2917 <span class="keyword">if</span> diff&lt;0, k0=1+abs(diff); <span class="keyword">else</span> k0=1; <span class="keyword">end</span>;
2918 <span class="keyword">for</span> k=k0:k0+n-1,
2919     <span class="keyword">if</span> seq1(k+diff)~=seq2(k),
2920         nonmatch2(k)=1;
2921     <span class="keyword">end</span>;
2922 <span class="keyword">end</span>;
2923 <span class="keyword">if</span> sum(nonmatch1)&lt;=sum(nonmatch2),
2924     nonmatch=nonmatch1;
2925     k0=1;
2926     dk=0;
2927 <span class="keyword">else</span>
2928     nonmatch=nonmatch2;
2929     k0=1+abs(diff);
2930     dk=diff;
2931 <span class="keyword">end</span>;
2932 ka=0;
2933 ke=0;
2934 <span class="keyword">if</span> diff&lt;0, ka=diff; <span class="keyword">end</span>;
2935 <span class="keyword">if</span> diff&gt;0, ke=diff; <span class="keyword">end</span>; 
2936 diff0=diff;
2937 <span class="keyword">if</span> ke&gt;ka,
2938     <span class="keyword">for</span> diff=ka:ke,
2939         nonmatchx=zeros(n1,1);
2940         <span class="keyword">if</span> diff&lt;0, k0=1+abs(diff); <span class="keyword">else</span> k0=1; <span class="keyword">end</span>;
2941         <span class="keyword">for</span> k=k0:k0+n-1,
2942             <span class="keyword">if</span> seq1(k+diff)~=seq2(k),
2943                 nonmatchx(k)=1;
2944             <span class="keyword">end</span>;
2945         <span class="keyword">end</span>;
2946         <span class="keyword">if</span> sum(nonmatchx)&lt;sum(nonmatch),
2947             nonmatch=nonmatchx;
2948             dk=diff;
2949         <span class="keyword">end</span>;
2950     <span class="keyword">end</span>;
2951 <span class="keyword">end</span>;
2952 
2953 add_msg_board(<span class="string">'--- Sequence comparison for two very similar sequences ---'</span>);
2954 add_msg_board(<span class="string">'(no gaps allowed, maximum shift is difference in sequence length)'</span>);
2955 <span class="keyword">if</span> diff0&lt;0,
2956     add_msg_board(sprintf(<span class="string">'Sequence %s is by %i residues'</span>,adr1,abs(diff0)));
2957     add_msg_board(sprintf(<span class="string">'shorter than sequence %s.'</span>,adr2));
2958 <span class="keyword">end</span>;
2959 <span class="keyword">if</span> diff0==0,
2960     add_msg_board(sprintf(<span class="string">'Sequences %s and %s have the same length.'</span>,adr1,adr2));
2961 <span class="keyword">end</span>;
2962 <span class="keyword">if</span> diff0&gt;0,
2963     add_msg_board(sprintf(<span class="string">'Sequence %s is by %i residues'</span>,adr1,abs(diff0)));
2964     add_msg_board(sprintf(<span class="string">'longer than sequence %s.'</span>,adr2));
2965 <span class="keyword">end</span>;
2966 <span class="keyword">if</span> dk==0,
2967     add_msg_board(<span class="string">'Best match for alignment at N terminus.'</span>);
2968 <span class="keyword">elseif</span> dk==diff,
2969     add_msg_board(<span class="string">'Better match for alignment at C terminus.'</span>);
2970 <span class="keyword">else</span>
2971     add_msg_board(sprintf(<span class="string">'Best match for shift by %i residues.'</span>,dk));    
2972 <span class="keyword">end</span>;
2973 <span class="keyword">if</span> sum(nonmatch),
2974     add_msg_board(sprintf(<span class="string">'Sequences differ in %i residues.'</span>,sum(nonmatch)));
2975 <span class="keyword">elseif</span> dk==0
2976     add_msg_board(sprintf(<span class="string">'Sequences are identical.'</span>));
2977 <span class="keyword">else</span>
2978     add_msg_board(sprintf(<span class="string">'Overlapping subsequences are identical.'</span>));
2979 <span class="keyword">end</span>;
2980 <span class="keyword">if</span> sum(nonmatch)&gt;20,
2981     add_msg_board(<span class="string">'Sequences to dissimilar for detailed analysis.'</span>);
2982     add_msg_board(<span class="string">'Please use more sophisticated alignment tools, e.g. Clustal'</span>);
2983 <span class="keyword">else</span>
2984     differ=find(nonmatch);
2985     msg=<span class="string">''</span>;
2986     fail=0;
2987     k=0;
2988     <span class="keyword">while</span> ~fail,
2989         k=k+1;
2990         <span class="keyword">if</span> k&gt;length(differ)
2991             fail=1;
2992             add_msg_board(msg);
2993         <span class="keyword">else</span>
2994             com=sprintf(<span class="string">'%i:%s/%s'</span>,differ(k),seq1(differ(k)+dk),seq2(differ(k)));
2995             <span class="keyword">if</span> length(msg)+length(com)&lt;60,
2996                 <span class="keyword">if</span> isempty(msg),
2997                     msg=com;
2998                 <span class="keyword">else</span>
2999                     msg=sprintf(<span class="string">'%s %s'</span>,msg,com);
3000                 <span class="keyword">end</span>;
3001             <span class="keyword">else</span>
3002                 add_msg_board(msg);
3003                 msg=com;
3004             <span class="keyword">end</span>;
3005         <span class="keyword">end</span>;
3006     <span class="keyword">end</span>;
3007 <span class="keyword">end</span>;
3008 guidata(hObject,handles);    
3009 
3010 
3011 <span class="comment">% --------------------------------------------------------------------</span>
3012 <a name="_sub178" href="#_subfunctions" class="code">function menu_file_share_Callback(hObject, eventdata, handles)</a>
3013 <span class="comment">% hObject    handle to menu_file_share (see GCBO)</span>
3014 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3015 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3016 
3017 
3018 <span class="comment">% --------------------------------------------------------------------</span>
3019 <a name="_sub179" href="#_subfunctions" class="code">function menu_file_share_public_Callback(hObject, eventdata, handles)</a>
3020 <span class="comment">% hObject    handle to menu_file_share_public (see GCBO)</span>
3021 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3022 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3023 
3024 privacy=0;
3025 <a href="#_sub180" class="code" title="subfunction share_model(hObject, eventdata, handles, privacy)">share_model</a>(hObject, eventdata, handles, privacy);
3026 
3027 <a name="_sub180" href="#_subfunctions" class="code">function share_model(hObject, eventdata, handles, privacy)</a>
3028 
3029 <span class="keyword">global</span> model
3030 
3031 annotations0=model.annotations;
3032 references0=model.references;
3033 keywords0=model.keywords;
3034 keys0=model.keys;
3035 
3036 true_privacy=0;
3037 
3038 <span class="comment">% clear up annotations</span>
3039 poi=0;
3040 mm=length(annotations0);
3041 <span class="keyword">for</span> k=1:mm,
3042     privacies=annotations0(k).info.privacy;
3043     store=0;
3044     clear newanno
3045     npoi=0;
3046     <span class="keyword">for</span> kk=1:length(privacies),
3047         <span class="keyword">if</span> privacies(kk)&lt;=privacy,
3048             store=1;
3049             npoi=npoi+1;
3050             newanno.indices=annotations0(k).indices;
3051             newanno.info.privacy(npoi)=privacies(kk);
3052             newanno.info.keywords=annotations0(k).info.keywords;
3053             newanno.info.references=annotations0(k).info.references;
3054             newanno.info.text{npoi}=annotations0(k).info.text{kk};
3055         <span class="keyword">else</span>
3056             <span class="keyword">if</span> privacies(kk)&gt;true_privacy,
3057                 true_privacy=privacies(kk);
3058             <span class="keyword">end</span>;
3059         <span class="keyword">end</span>;
3060     <span class="keyword">end</span>;
3061     <span class="keyword">if</span> store,
3062         poi=poi+1;
3063         annotations(poi)=newanno;
3064     <span class="keyword">end</span>;
3065 <span class="keyword">end</span>;
3066 
3067 
3068 references(1)=model.references(1);
3069 keys=[];
3070 keymap=zeros(1,length(model.keys));
3071 refmap=zeros(1,length(model.references));
3072 <span class="keyword">if</span> poi&lt;mm, <span class="comment">% there were private annotations, hence references keys, and keywords have to be cleared</span>
3073     <span class="keyword">for</span> k=1:poi,
3074         ckeys=annotations(k).info.keywords;
3075         <span class="keyword">for</span> kk=1:length(ckeys), <span class="comment">% mark all keywords that are still used</span>
3076             keymap(ckeys(kk))=1;
3077         <span class="keyword">end</span>;
3078         crefs=annotations(k).info.references;
3079         <span class="keyword">for</span> kk=1:length(crefs), <span class="comment">% mark all references that are still used</span>
3080             refmap(crefs(kk))=1;
3081         <span class="keyword">end</span>;
3082     <span class="keyword">end</span>;
3083     <span class="comment">% make new reference list and key list and translation tables</span>
3084     keytrans=zeros(1,length(model.keys));
3085     npoi=0;
3086     <span class="keyword">for</span> k=1:length(keymap),
3087         <span class="keyword">if</span> keymap(k),
3088             npoi=npoi+1;
3089             keys(npoi).indices=[];
3090             keytrans(k)=npoi;
3091         <span class="keyword">end</span>;
3092     <span class="keyword">end</span>;
3093     reftrans=zeros(1,length(model.keys));
3094     npoi=0;
3095     <span class="keyword">for</span> k=1:length(refmap),
3096         <span class="keyword">if</span> refmap(k),
3097             npoi=npoi+1;
3098             references(npoi)=references0(k);
3099             reftrans(k)=npoi;
3100         <span class="keyword">end</span>;
3101     <span class="keyword">end</span>;
3102     <span class="comment">% translate key and reference numbers in annotations</span>
3103     <span class="keyword">for</span> k=1:length(annotations),
3104         reffy=[];
3105         <span class="keyword">for</span> kk=1:length(annotations(k).info.references),
3106             <span class="keyword">if</span> reftrans(annotations(k).info.references(kk))&gt;0,
3107                 reffy=[reffy reftrans(annotations(k).info.references(kk))];
3108             <span class="keyword">end</span>;
3109         <span class="keyword">end</span>;
3110         annotations(k).info.references=reffy; <span class="comment">% all nonexisting references deleted</span>
3111         keyfy=[];
3112         <span class="keyword">for</span> kk=1:length(annotations(k).info.keywords),
3113             <span class="keyword">if</span> keytrans(annotations(k).info.keywords(kk))&gt;0,
3114                 keyfy=[keyfy keytrans(annotations(k).info.keywords(kk))];
3115             <span class="keyword">end</span>;
3116         <span class="keyword">end</span>;
3117         annotations(k).info.keywords=keyfy; <span class="comment">% all nonexisting keywords deleted</span>
3118         <span class="comment">% register keys</span>
3119         <span class="keyword">for</span> kk=1:length(annotations(k).info.keywords),
3120             ind=annotations(k).info.keywords(kk);
3121             keys(ind).indices=[keys(ind).indices; annotations(k).indices];
3122         <span class="keyword">end</span>;
3123     <span class="keyword">end</span>;
3124     <span class="comment">% make the new keyword string</span>
3125     keywords=<span class="string">':'</span>;
3126     <span class="keyword">for</span> k=1:length(keytrans),
3127         <span class="keyword">if</span> keytrans(k)&gt;0,
3128             cref=id2tag(k,keywords0);
3129             keywords=sprintf(<span class="string">'%s%s:'</span>,keywords,cref);
3130         <span class="keyword">end</span>;
3131     <span class="keyword">end</span>;
3132 <span class="keyword">else</span>
3133     keywords=keywords0;
3134     keys=keys0;
3135     references=references0;
3136 <span class="keyword">end</span>;
3137 
3138 model.annotations=annotations;
3139 model.references=references;
3140 model.keywords=keywords;
3141 model.keys=keys;
3142 
3143 <span class="keyword">switch</span> true_privacy
3144     <span class="keyword">case</span> 0
3145         msg=<span class="string">'Model has no user or group annotations.'</span>;
3146     <span class="keyword">case</span> 1
3147         msg=<span class="string">'Model has group annotations but no user annotations.'</span>;
3148     <span class="keyword">case</span> 2
3149         msg=<span class="string">'Model has both group and user annotations.'</span>;
3150 <span class="keyword">end</span>;
3151 
3152 add_msg_board(msg);
3153 <a href="#_sub151" class="code" title="subfunction save_model(hObject, eventdata, handles, force, privacy)">save_model</a>(hObject, eventdata, handles, 0, privacy);
3154 
3155 model.annotations=annotations0;
3156 model.references=references0;
3157 model.keywords=keywords0;
3158 model.keys=keys0;
3159 
3160 
3161 
3162 <span class="comment">% --------------------------------------------------------------------</span>
3163 <a name="_sub181" href="#_subfunctions" class="code">function menu_file_share_group_Callback(hObject, eventdata, handles)</a>
3164 <span class="comment">% hObject    handle to menu_file_share_group (see GCBO)</span>
3165 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3166 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3167 
3168 privacy=1;
3169 <a href="#_sub180" class="code" title="subfunction share_model(hObject, eventdata, handles, privacy)">share_model</a>(hObject, eventdata, handles, privacy);
3170 
3171 
3172 <span class="comment">% --------------------------------------------------------------------</span>
3173 <a name="_sub182" href="#_subfunctions" class="code">function menu_EPR_site_scan_chains_Callback(hObject, eventdata, handles)</a>
3174 <span class="comment">% hObject    handle to menu_EPR_site_scan_chains (see GCBO)</span>
3175 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3176 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3177 
3178 <span class="keyword">global</span> model
3179 <span class="keyword">global</span> hMain
3180 <span class="keyword">global</span> third_party
3181 
3182 chain_models=zeros(1,3);
3183 
3184 <span class="comment">% check whether the user has selected any chains or chain models</span>
3185 [allindices,message]=resolve_address(<span class="string">'*'</span>); <span class="comment">% get indices of all selected objects</span>
3186 
3187 poi=0;
3188 <span class="keyword">if</span> ~isempty(allindices),
3189     [m,n]=size(allindices);
3190     <span class="keyword">for</span> k=1:m,
3191         cindices=allindices(k,:);
3192         cindices=cindices(cindices&gt;0);
3193         <span class="keyword">if</span> length(cindices)==3, <span class="comment">% user selected chain model</span>
3194             poi=poi+1;
3195             chain_models(poi,:)=cindices;
3196         <span class="keyword">elseif</span> length(cindices)==2, <span class="comment">% user selected chain</span>
3197             models=length(model.structures{cindices(1)}(cindices(2)).residues);
3198             cmodel=1;
3199             <span class="keyword">if</span> models&gt;1, <span class="comment">% ask, which chain model</span>
3200                 adr=mk_address(cindices);
3201                 answer = inputdlg(sprintf(<span class="string">'Several models exist for chain %s'</span>,adr),<span class="string">'Select coordinate set'</span>,1,{<span class="string">'1'</span>});
3202                 <span class="keyword">if</span> ~isempty(answer)
3203                     cmodel=round(str2num(answer{1}));
3204                     <span class="keyword">if</span> isempty(cmodel), <span class="comment">% replace wrong replies with default value</span>
3205                         cmodel=1;
3206                     <span class="keyword">elseif</span> isnan(cmodel) || cmodel&lt;1 || cmodel&gt;models
3207                         cmodel=1;
3208                     <span class="keyword">end</span>;
3209                     poi=poi+1;
3210                     chain_models(poi,1:2)=cindices;
3211                     chain_models(poi,3)=cmodel;
3212                 <span class="keyword">end</span>;
3213             <span class="keyword">else</span>
3214                 poi=poi+1;
3215                 chain_models(poi,1:2)=cindices;
3216                 chain_models(poi,3)=1;
3217             <span class="keyword">end</span>;
3218         <span class="keyword">end</span>;
3219     <span class="keyword">end</span>;
3220 <span class="keyword">end</span>;
3221 
3222 chain_models=chain_models(1:poi,:);
3223 
3224 <span class="keyword">if</span> isempty(chain_models),
3225     cindices=zeros(1,2);
3226     cindices(1)=model.current_structure;
3227     ctags=model.chain_tags{cindices(1)};
3228     cindices(2)=tag2id(model.current_chain,ctags);
3229     models=length(model.structures{cindices(1)}(cindices(2)).residues);
3230     cmodel=1;
3231     <span class="keyword">if</span> models&gt;1, <span class="comment">% ask, which chain model</span>
3232         adr=mk_address(cindices);
3233         answer = inputdlg(sprintf(<span class="string">'Several models exist for chain %s'</span>,adr),<span class="string">'Select coordinate set'</span>,1,{<span class="string">'1'</span>});
3234         <span class="keyword">if</span> ~isempty(answer)
3235             cmodel=round(str2num(answer{1}));
3236             <span class="keyword">if</span> isempty(cmodel), <span class="comment">% replace wrong replies with default value</span>
3237                 cmodel=1;
3238             <span class="keyword">elseif</span> isnan(cmodel) || cmodel&lt;1 || cmodel&gt;models
3239                 cmodel=1;
3240             <span class="keyword">end</span>;
3241             poi=1;
3242             chain_models(1,1:2)=cindices;
3243             chain_models(1,3)=cmodel;
3244         <span class="keyword">end</span>;
3245     <span class="keyword">else</span>
3246         poi=1;
3247         chain_models(1,1:2)=cindices;
3248         chain_models(1,3)=1;
3249     <span class="keyword">end</span>;
3250 <span class="keyword">end</span>;
3251 
3252 chain_models=chain_models(1:poi,:);
3253 
3254 <span class="keyword">if</span> isempty(chain_models),
3255     msgbox(<span class="string">'At least one chain model must be selected.'</span>,<span class="string">'No chain model selected for site scan'</span>,<span class="string">'warn'</span>);
3256 <span class="keyword">else</span>
3257     <a href="site_scan.html" class="code" title="function varargout = site_scan(varargin)">site_scan</a>;
3258     <span class="keyword">if</span> ~hMain.site_scan,
3259         add_msg_board(<span class="string">'Site scan cancelled by user.'</span>);
3260     <span class="keyword">else</span>
3261         labeling_site_scan(chain_models);
3262     <span class="keyword">end</span>;
3263 <span class="keyword">end</span>;
3264 
3265 <span class="comment">% add the reference, if it does not yet exist</span>
3266 sitescan_ref=true;
3267 id=tag2id(<span class="string">'Polyhach:2010_site_scan'</span>,third_party.tags,[],<span class="string">'|'</span>);
3268 <span class="keyword">if</span> ~isempty(id),
3269     <span class="keyword">if</span> isfield(model,<span class="string">'auto_references'</span>),
3270         <span class="keyword">if</span> ~isempty(find(id==model.auto_references, 1)),
3271             sitescan_ref=false;
3272         <span class="keyword">end</span>;
3273     <span class="keyword">else</span>
3274         model.auto_references=[];
3275     <span class="keyword">end</span>;
3276     <span class="keyword">if</span> sitescan_ref,
3277         <span class="keyword">if</span> ~isfield(model,<span class="string">'references'</span>),
3278             model.references(1)=third_party.references(id);
3279         <span class="keyword">else</span>
3280             model.references(end+1)=third_party.references(id);
3281         <span class="keyword">end</span>;
3282         model.auto_references(end+1)=id;
3283     <span class="keyword">end</span>;
3284 <span class="keyword">end</span>;
3285 
3286 guidata(hObject,handles);
3287 
3288 <span class="comment">% --------------------------------------------------------------------</span>
3289 <a name="_sub183" href="#_subfunctions" class="code">function menu_EPR_site_scan_residues_Callback(hObject, eventdata, handles)</a>
3290 <span class="comment">% hObject    handle to menu_EPR_site_scan_residues (see GCBO)</span>
3291 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3292 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3293 
3294 <span class="keyword">global</span> hMain
3295 
3296 residues=zeros(10000,4);
3297 
3298 <span class="comment">% check whether the user has selected any chains or chain models</span>
3299 [allindices,message]=resolve_address(<span class="string">'*'</span>); <span class="comment">% get indices of all selected objects</span>
3300 
3301 poi=0;
3302 <span class="keyword">if</span> ~isempty(allindices),
3303     [m,n]=size(allindices);
3304     <span class="keyword">for</span> k=1:m,
3305         cindices=allindices(k,:);
3306         cindices=cindices(cindices&gt;0);
3307         <span class="keyword">if</span> length(cindices)==4, <span class="comment">% user selected residue</span>
3308             poi=poi+1;
3309             residues(poi,:)=cindices;
3310         <span class="keyword">end</span>;
3311     <span class="keyword">end</span>;
3312 <span class="keyword">end</span>;
3313 
3314 residues=residues(1:poi,:);
3315 
3316 <span class="keyword">if</span> isempty(residues),
3317     msgbox(<span class="string">'At least one residue must be selected.'</span>,<span class="string">'No residue selected for site scan'</span>,<span class="string">'warn'</span>);
3318     add_msg_board(<span class="string">'Site scan cancelled since no residues are selected.'</span>);
3319 
3320 <span class="comment">% % ----------- new 120111-------------</span>
3321 <span class="comment">% else</span>
3322 <span class="comment">%     hMain.site_scan_residue=1;</span>
3323 <span class="comment">%     site_scan;</span>
3324 <span class="comment">%     if ~hMain.site_scan,</span>
3325 <span class="comment">%         add_msg_board('Site scan cancelled by user.');</span>
3326 <span class="comment">%     else</span>
3327 <span class="comment">%         labeling_site_scan(residues);</span>
3328 <span class="comment">%     end;</span>
3329 <span class="comment">%     hMain.site_scan_residue=0;</span>
3330 <span class="comment">% end;</span>
3331 
3332 <span class="keyword">else</span>
3333     hMain.site_scan_residue=1;
3334     <a href="site_scan.html" class="code" title="function varargout = site_scan(varargin)">site_scan</a>;
3335     <span class="keyword">if</span> ~hMain.site_scan,
3336         add_msg_board(<span class="string">'Site scan cancelled by user.'</span>);
3337     <span class="keyword">elseif</span> hMain.no_rot_pop
3338         transform_rotamers(residues);
3339     <span class="keyword">else</span>
3340         labeling_site_scan(residues);
3341     <span class="keyword">end</span>;
3342 <span class="comment">% % -----------------------------------</span>
3343     
3344     hMain.site_scan_residue=0;
3345 <span class="keyword">end</span>;
3346 guidata(hObject,handles);
3347 
3348 
3349 <span class="comment">% --------------------------------------------------------------------</span>
3350 <a name="_sub184" href="#_subfunctions" class="code">function menu_analysis_sites_Callback(hObject, eventdata, handles)</a>
3351 <span class="comment">% hObject    handle to menu_analysis_sites (see GCBO)</span>
3352 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3353 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3354 
3355 sites_window;
3356 
3357 
3358 <span class="comment">% --------------------------------------------------------------------</span>
3359 <a name="_sub185" href="#_subfunctions" class="code">function uipushtool_references_ClickedCallback(hObject, eventdata, handles)</a>
3360 <span class="comment">% hObject    handle to uipushtool_references (see GCBO)</span>
3361 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3362 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3363 
3364 <span class="keyword">global</span> model
3365 <span class="keyword">global</span> hMain
3366 
3367 <span class="keyword">if</span> isfield(model,<span class="string">'references'</span>),
3368     hMain.current_reference=length(model.references);
3369 <span class="keyword">else</span>
3370     hMain.current_reference=0;
3371 <span class="keyword">end</span>;
3372 
3373 reference_window;
3374 
3375 
3376 <span class="comment">% --------------------------------------------------------------------</span>
3377 <a name="_sub186" href="#_subfunctions" class="code">function menu_edit_references_Callback(hObject, eventdata, handles)</a>
3378 <span class="comment">% hObject    handle to menu_edit_references (see GCBO)</span>
3379 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3380 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3381 
3382 <span class="keyword">global</span> model
3383 <span class="keyword">global</span> hMain
3384 
3385 <span class="keyword">if</span> isfield(model,<span class="string">'references'</span>),
3386     hMain.current_reference=length(model.references);
3387 <span class="keyword">else</span>
3388     hMain.current_reference=0;
3389 <span class="keyword">end</span>;
3390 
3391 reference_window;
3392 
3393 
3394 <span class="comment">% --------------------------------------------------------------------</span>
3395 <a name="_sub187" href="#_subfunctions" class="code">function menu_file_new_pdb_local_Callback(hObject, eventdata, handles)</a>
3396 <span class="comment">% hObject    handle to menu_file_new_pdb_local (see GCBO)</span>
3397 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3398 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3399 
3400 <span class="keyword">global</span> model
3401 <span class="keyword">global</span> hMain
3402 
3403 doit=0;
3404 
3405 <span class="keyword">if</span> ~exist(<span class="string">'model'</span>,<span class="string">'var'</span>) || isempty(model),
3406     doit=1;
3407 <span class="keyword">else</span>
3408     button = questdlg(<span class="string">'Do you want to delete old model?'</span>,<span class="string">'New model will overwrite existing model'</span>,<span class="string">'No'</span>);
3409     <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
3410         doit=1;
3411     <span class="keyword">end</span>;
3412 <span class="keyword">end</span>;
3413 
3414 <span class="keyword">if</span> doit,
3415     model=[]; 
3416 
3417     command=sprintf(<span class="string">'attach'</span>);
3418     <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
3419 
3420     <span class="comment">% initialize display</span>
3421     axes(handles.axes_model);
3422     cla reset;
3423     axis equal
3424     axis off
3425     set(gca,<span class="string">'Clipping'</span>,<span class="string">'off'</span>);
3426     set(gcf,<span class="string">'Renderer'</span>,<span class="string">'opengl'</span>);
3427     hold on
3428     hMain.camlight=camlight;
3429     guidata(handles.axes_model,hMain);
3430     hMain.virgin=0;
3431 
3432     <a href="#_sub134" class="code" title="subfunction add_and_plot_pdb(hObject,handles,FileName)">add_and_plot_pdb</a>(hObject,handles);
3433 <span class="keyword">end</span>;
3434 
3435 
3436 <span class="comment">% --------------------------------------------------------------------</span>
3437 <a name="_sub188" href="#_subfunctions" class="code">function menu_file_new_PDB_direct_Callback(hObject, eventdata, handles)</a>
3438 <span class="comment">% hObject    handle to menu_file_new_PDB_direct (see GCBO)</span>
3439 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3440 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3441 
3442 <span class="keyword">global</span> model
3443 <span class="keyword">global</span> hMain
3444 
3445 doit=0;
3446 
3447 <span class="keyword">if</span> ~exist(<span class="string">'model'</span>,<span class="string">'var'</span>) || isempty(model),
3448     doit=1;
3449 <span class="keyword">else</span>
3450     button = questdlg(<span class="string">'Do you want to delete old model?'</span>,<span class="string">'New model will overwrite existing model'</span>,<span class="string">'No'</span>);
3451     <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
3452         doit=1;
3453     <span class="keyword">end</span>;
3454 <span class="keyword">end</span>;
3455 
3456 <span class="keyword">if</span> doit,
3457     model=[]; 
3458 
3459     command=sprintf(<span class="string">'attach'</span>);
3460     <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
3461 
3462     <span class="comment">% initialize display</span>
3463     axes(handles.axes_model);
3464     cla reset;
3465     axis equal
3466     axis off
3467     set(gca,<span class="string">'Clipping'</span>,<span class="string">'off'</span>);
3468     set(gcf,<span class="string">'Renderer'</span>,<span class="string">'opengl'</span>);
3469     hold on
3470     hMain.camlight=camlight;
3471     guidata(handles.axes_model,hMain);
3472     hMain.virgin=0;
3473     answer = inputdlg(<span class="string">'Please provide PDB identifier (four characters)'</span>,<span class="string">'Direct PDB download'</span>);
3474     PDBID=strtrim(char(answer));
3475     <span class="keyword">if</span> length(PDBID)~=4,
3476         add_msg_board(<span class="string">'ERROR: PDB identifier must have four characters'</span>);
3477         <span class="keyword">return</span>
3478     <span class="keyword">end</span>;
3479     set(gcf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
3480     drawnow;
3481     fname=get_pdb_file(PDBID);
3482     set(gcf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
3483     <span class="keyword">if</span> ~isempty(fname),
3484         <a href="#_sub134" class="code" title="subfunction add_and_plot_pdb(hObject,handles,FileName)">add_and_plot_pdb</a>(hObject,handles,fname);
3485     <span class="keyword">end</span>;
3486 <span class="keyword">end</span>;
3487 
3488 <span class="comment">% --------------------------------------------------------------------</span>
3489 <a name="_sub189" href="#_subfunctions" class="code">function menu_file_add_PDB_local_Callback(hObject, eventdata, handles)</a>
3490 <span class="comment">% hObject    handle to menu_file_add_PDB_local (see GCBO)</span>
3491 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3492 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3493 
3494 <a href="#_sub134" class="code" title="subfunction add_and_plot_pdb(hObject,handles,FileName)">add_and_plot_pdb</a>(hObject,handles);
3495 
3496 <span class="comment">% --------------------------------------------------------------------</span>
3497 <a name="_sub190" href="#_subfunctions" class="code">function menu_file_add_PDB_direct_Callback(hObject, eventdata, handles)</a>
3498 <span class="comment">% hObject    handle to menu_file_add_PDB_direct (see GCBO)</span>
3499 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3500 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3501 
3502 answer = inputdlg(<span class="string">'Please provide PDB identifier (four characters)'</span>,<span class="string">'Direct PDB download'</span>);
3503 PDBID=strtrim(char(answer));
3504 <span class="keyword">if</span> length(PDBID)~=4,
3505     add_msg_board(<span class="string">'ERROR: PDB identifier must have four characters'</span>);
3506     <span class="keyword">return</span>
3507 <span class="keyword">end</span>;
3508 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
3509 drawnow;
3510 fname=get_pdb_file(PDBID);
3511 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
3512 <span class="keyword">if</span> ~isempty(fname),
3513     <a href="#_sub134" class="code" title="subfunction add_and_plot_pdb(hObject,handles,FileName)">add_and_plot_pdb</a>(hObject,handles,fname);
3514 <span class="keyword">end</span>;
3515 
3516 
3517 <span class="comment">% --------------------------------------------------------------------</span>
3518 <a name="_sub191" href="#_subfunctions" class="code">function menu_build_bilayer_Callback(hObject, eventdata, handles)</a>
3519 <span class="comment">% hObject    handle to menu_build_bilayer (see GCBO)</span>
3520 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3521 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3522 
3523 <span class="keyword">global</span> hMain
3524 
3525 build_bilayer;
3526 <span class="keyword">if</span> hMain.graph_update,
3527     <a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles,hObject);
3528     set_view([1,0,0]);
3529 <span class="keyword">end</span>;
3530 
3531 <span class="comment">% --------------------------------------------------------------------</span>
3532 <a name="_sub192" href="#_subfunctions" class="code">function menu_build_SAS_Callback(hObject, eventdata, handles)</a>
3533 <span class="comment">% hObject    handle to menu_build_SAS (see GCBO)</span>
3534 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3535 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3536 
3537 <span class="keyword">global</span> graph_settings
3538 <span class="keyword">global</span> model
3539 <span class="keyword">global</span> chemistry
3540 <span class="keyword">global</span> general
3541 <span class="keyword">global</span> hMain
3542 <span class="keyword">global</span> help_files
3543 <span class="keyword">global</span> third_party
3544 
3545 entry=strcat(help_files,<span class="string">'third_party.html#MSMS'</span>);
3546 
3547 dospath=which(<span class="string">'msms.exe'</span>);
3548 <span class="keyword">if</span> isempty(dospath),
3549     add_msg_board(<span class="string">'ERROR: MSMS could not be found on the Matlab path.'</span>);
3550     add_msg_board(<span class="string">'Please check whether MSMS is installed and the path set.'</span>);
3551     add_msg_board(<span class="string">'(see also help browser)'</span>);
3552     webcall(entry,<span class="string">'-helpbrowser'</span>);
3553     <span class="keyword">return</span>
3554 <span class="keyword">end</span>;
3555 
3556 indices=resolve_address(<span class="string">'*'</span>);
3557 indices=indices(indices&gt;0);
3558 [m,n]=size(indices);
3559 <span class="keyword">if</span> m==1,
3560     <span class="keyword">if</span> n&lt;=4,
3561         <span class="keyword">if</span> n&lt;2,
3562             adr=[mk_address(indices(1)) <span class="string">'(:){1}'</span>];
3563             add_msg_board(<span class="string">'Considering first coordinate set of each chain'</span>);
3564         <span class="keyword">elseif</span> n&lt;3,
3565             adr=[mk_address(indices(1:2)) <span class="string">'{1}'</span>];
3566             add_msg_board(<span class="string">'Considering first coordinate set of the chain'</span>);
3567         <span class="keyword">else</span>
3568             adr=mk_address(indices);
3569         <span class="keyword">end</span>;
3570         indices=resolve_address(adr);
3571     <span class="keyword">else</span>
3572         add_msg_board(<span class="string">'Selection addresses an atom or location'</span>);
3573         add_msg_board(<span class="string">'Computing surface for current structure'</span>);
3574         adr=[mk_address(model.current_structure) <span class="string">'(:){1}'</span>];
3575         indices=resolve_address(adr);
3576     <span class="keyword">end</span>;
3577 <span class="keyword">else</span>
3578     add_msg_board(<span class="string">'Selection does not address a single object'</span>);
3579     add_msg_board(<span class="string">'Computing surface for current structure'</span>);
3580     adr=[mk_address(model.current_structure) <span class="string">'(:){1}'</span>];
3581     indices=resolve_address(adr);
3582 <span class="keyword">end</span>;
3583 [msg,coor]=get_object(indices,<span class="string">'xyz'</span>);
3584 <span class="keyword">if</span> iscell(coor),
3585     coor=cat(1,coor{:});
3586 <span class="keyword">end</span>;
3587 
3588 <span class="comment">% A piece of code that may be useful for coarse-grained visualization</span>
3589 <span class="comment">% [k,v]=convhulln(coor);</span>
3590 <span class="comment">% add_msg_board(sprintf('Volume of convex hull: %6.1f',v));</span>
3591 <span class="comment">% h=trisurf(k,coor(:,1),coor(:,2),coor(:,3));</span>
3592 <span class="comment">% set(h, 'FaceColor', [0,0,1], 'EdgeColor', 'none', 'FaceAlpha',0.75,'FaceLighting','gouraud','Clipping','off');</span>
3593 <span class="comment">% set(h, 'CDataMapping','direct','AlphaDataMapping','none');</span>
3594 
3595 
3596 [msg,elements]=get_object(indices,<span class="string">'elements'</span>);
3597 <span class="keyword">if</span> iscell(elements),
3598     elements=cat(1,elements{:});
3599 <span class="keyword">end</span>;
3600 vdW=zeros(size(elements));
3601 <span class="keyword">for</span> k=1:length(elements),
3602     <span class="keyword">if</span> elements(k)&gt;0 &amp;&amp; elements(k)&lt;length(chemistry.pse),
3603         vdW(k)=chemistry.pse(elements(k)).vdW;
3604     <span class="keyword">end</span>;
3605 <span class="keyword">end</span>;
3606 
3607 density=round(5000/length(elements));
3608 <span class="keyword">if</span> density&gt;3, density=3; <span class="keyword">end</span>;
3609 <span class="keyword">if</span> density&lt;1, density=1; <span class="keyword">end</span>;
3610 dstring=sprintf(<span class="string">' -density %i'</span>,density);
3611 
3612 <span class="keyword">if</span> isfield(model,<span class="string">'SAS'</span>),
3613     poi=length(model.SAS)+1;
3614 <span class="keyword">else</span>
3615     poi=1;
3616 <span class="keyword">end</span>;
3617 
3618 answer = inputdlg(<span class="string">'Please provide a tag for this surface'</span>,sprintf(<span class="string">'Solvent accessible surface for %s'</span>,adr),1,{sprintf(<span class="string">'SAS_%i'</span>,poi)});
3619 stag=strtrim(char(answer));
3620 found=0;
3621 <span class="keyword">if</span> poi&gt;1,
3622     <span class="keyword">for</span> k=1:poi-1,
3623         <span class="keyword">if</span> strcmp(stag,model.SAS(k).tag),
3624             found=1;
3625         <span class="keyword">end</span>;
3626     <span class="keyword">end</span>;
3627 <span class="keyword">end</span>;
3628 <span class="keyword">if</span> found,
3629     add_msg_board(<span class="string">'ERROR: Surface tag already existed.'</span>);
3630     add_msg_board(<span class="string">'Please provide a new (unique) tag.'</span>);
3631     <span class="keyword">return</span>
3632 <span class="keyword">end</span>;
3633 <span class="keyword">if</span> isempty(answer),
3634     add_msg_board(<span class="string">'Surface computation canceled (no tag).'</span>);
3635     <span class="keyword">return</span>
3636 <span class="keyword">end</span>;
3637 
3638 set(hMain.MMM,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
3639 drawnow;
3640 outfile=[general.tmp_files stag <span class="string">'.xyzr'</span>];
3641 fid=fopen(outfile,<span class="string">'w'</span>);
3642 <span class="keyword">if</span> fid==-1,
3643     add_msg_board(<span class="string">'ERROR: Coordinate file could not be opened for writing.'</span>);
3644     <span class="keyword">return</span>
3645 <span class="keyword">end</span>;
3646 <span class="keyword">for</span> k=1:length(vdW),
3647     <span class="keyword">if</span> vdW(k)&gt;0,
3648         fprintf(fid,<span class="string">'%12.3f%12.3f%12.3f%6.2f'</span>,coor(k,1),coor(k,2),coor(k,3),vdW(k));
3649         <span class="keyword">if</span> k&lt;length(vdW),
3650             fprintf(fid,<span class="string">'\n'</span>);
3651         <span class="keyword">end</span>;
3652     <span class="keyword">end</span>;
3653 <span class="keyword">end</span>;
3654 fclose(fid);
3655 
3656 [pathstr, name, ext, versn] = fileparts(outfile);
3657 outfile=fullfile(pathstr,[name ext versn]);
3658 
3659 msmsfile=[general.tmp_files stag];
3660 [pathstr, name, ext, versn] = fileparts(msmsfile);
3661 msmsfile=fullfile(pathstr,[name ext versn]);
3662 cmd=[dospath <span class="string">' -if '</span> outfile <span class="string">' -of '</span> msmsfile dstring];
3663 [s, w] = dos(cmd);
3664 <span class="keyword">if</span> s~=0,
3665     add_msg_board(<span class="string">'ERROR: MSMS did not run successfully.'</span>);
3666     set(hMain.MMM,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
3667     <span class="keyword">return</span>
3668 <span class="keyword">else</span>
3669     comments=textscan(w,<span class="string">'%s'</span>,<span class="string">'Delimiter'</span>,<span class="string">'\n'</span>);
3670     lines=comments{1};
3671     <span class="keyword">for</span> k=1:length(lines),
3672         msg=char(lines(k));
3673         add_msg_board(msg);
3674     <span class="keyword">end</span>;
3675 <span class="keyword">end</span>;
3676 
3677 <span class="comment">% add the reference, if it does not yet exist</span>
3678 msms_ref=true;
3679 id=tag2id(<span class="string">'Sanner:1996_msms'</span>,third_party.tags,[],<span class="string">'|'</span>);
3680 <span class="keyword">if</span> isfield(model,<span class="string">'auto_references'</span>),
3681     <span class="keyword">if</span> ~isempty(find(id==model.auto_references, 1)),
3682         msms_ref=false;
3683     <span class="keyword">end</span>;
3684 <span class="keyword">else</span>
3685     model.auto_references=[];
3686 <span class="keyword">end</span>;
3687 <span class="keyword">if</span> msms_ref,
3688     <span class="keyword">if</span> ~isfield(model,<span class="string">'references'</span>),
3689         model.references(1)=third_party.references(id);
3690     <span class="keyword">else</span>
3691         model.references(end+1)=third_party.references(id);
3692     <span class="keyword">end</span>;
3693     model.auto_references(end+1)=id;
3694 <span class="keyword">end</span>;
3695 
3696 axes(handles.axes_model);
3697 
3698 [tri,x,y,z,info]=rd_msms(msmsfile);
3699 obj = trisurf(tri,x,y,z);
3700 set(obj, <span class="string">'FaceColor'</span>, graph_settings.SAS_color, <span class="string">'EdgeColor'</span>, <span class="string">'none'</span>, <span class="string">'FaceAlpha'</span>,graph_settings.SAS_transparency,<span class="string">'FaceLighting'</span>,<span class="string">'gouraud'</span>,<span class="string">'Clipping'</span>,<span class="string">'off'</span>);
3701 set(obj, <span class="string">'CDataMapping'</span>,<span class="string">'direct'</span>,<span class="string">'AlphaDataMapping'</span>,<span class="string">'none'</span>);
3702 
3703 dg.gobjects=obj;
3704 dg.tag=[<span class="string">'SAS:'</span> stag];
3705 dg.color=graph_settings.SAS_color;
3706 dg.level=info.probe_r;
3707 dg.transparency=graph_settings.SAS_transparency;
3708 dg.active=true;
3709 
3710 <span class="keyword">if</span> isfield(model,<span class="string">'surfaces'</span>) &amp;&amp; ~isempty(model.surfaces),
3711     model.surfaces(end+1)=dg;
3712 <span class="keyword">else</span>
3713     <span class="keyword">if</span> isfield(model,<span class="string">'surfaces'</span>),
3714         model=rmfield(model,<span class="string">'surfaces'</span>);
3715     <span class="keyword">end</span>;
3716     model.surfaces(1)=dg;
3717 <span class="keyword">end</span>;
3718 
3719 <span class="keyword">if</span> ~isfield(model,<span class="string">'SAS'</span>)
3720     model.SAS(1).tri=tri;
3721     model.SAS(1).x=x;
3722     model.SAS(1).y=y;
3723     model.SAS(1).z=z;
3724     model.SAS(1).info=info;
3725     model.SAS(1).tag=stag;
3726     model.SAS(1).snum=indices(1);
3727 <span class="keyword">else</span>
3728     poi=length(model.SAS)+1;
3729     model.SAS(poi).tri=tri;
3730     model.SAS(poi).x=x;
3731     model.SAS(poi).y=y;
3732     model.SAS(poi).z=z;
3733     model.SAS(poi).info=info;
3734     model.SAS(poi).tag=stag;
3735     model.SAS(poi).snum=indices(1);
3736 <span class="keyword">end</span>;
3737 
3738 set(hMain.MMM,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
3739 
3740 
3741 guidata(hObject,handles);
3742 
3743 
3744 <span class="comment">% --------------------------------------------------------------------</span>
3745 <a name="_sub193" href="#_subfunctions" class="code">function menu_help_third_party_Callback(hObject, eventdata, handles)</a>
3746 <span class="comment">% hObject    handle to menu_help_third_party (see GCBO)</span>
3747 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3748 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3749 
3750 webcall(<span class="string">'third_party.html'</span>,<span class="string">'-helpbrowser'</span>);
3751 
3752 
3753 <span class="comment">% --------------------------------------------------------------------</span>
3754 <a name="_sub194" href="#_subfunctions" class="code">function menu_edit_bundle_Callback(hObject, eventdata, handles)</a>
3755 <span class="comment">% hObject    handle to menu_edit_bundle (see GCBO)</span>
3756 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3757 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3758 
3759 <span class="keyword">global</span> hMain
3760 <span class="keyword">global</span> model
3761 
3762 snum=model.current_structure;
3763 
3764 hMain.origin=[];
3765 hMain.z_axis=[];
3766 
3767 assign_TM;
3768 
3769 p0=hMain.origin;
3770 v=hMain.z_axis;
3771 
3772 <span class="keyword">if</span> ~isempty(p0) &amp;&amp; ~isempty(v),
3773     set(gcf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
3774     drawnow;
3775     v=v/norm(v);
3776     th=acos(v(3));
3777     <span class="keyword">if</span> norm(v(1:2))&gt;1e-6,
3778         v=v(1:2)/norm(v(1:2));
3779     <span class="keyword">else</span>
3780         v=[0,0];
3781     <span class="keyword">end</span>;
3782     phi=atan2(v(2),v(1));
3783     transmat1=affine(<span class="string">'translation'</span>,-p0);
3784     transmat2=affine(<span class="string">'Euler'</span>,[-phi,-th,0]);
3785     transform_structure(snum,{transmat1,transmat2});
3786     <a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles, hObject);
3787     set(gcf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
3788     drawnow;
3789 <span class="keyword">else</span>
3790     add_msg_board(<span class="string">'No membrane normal defined. No coordinate transform.'</span>);
3791 <span class="keyword">end</span>;
3792 
3793 guidata(hObject,handles);
3794 
3795 <span class="comment">% --------------------------------------------------------------------</span>
3796 <a name="_sub195" href="#_subfunctions" class="code">function menu_build_secondary_Callback(hObject, eventdata, handles)</a>
3797 <span class="comment">% hObject    handle to menu_build_secondary (see GCBO)</span>
3798 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3799 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3800 
3801 <span class="keyword">global</span> model
3802 
3803 snum=model.current_structure;
3804 ctag=model.current_chain;
3805 cnum=tag2id(ctag,model.chain_tags{snum});
3806 reassign_secondary([snum,cnum]);
3807 guidata(hObject,handles);
3808 
3809 <span class="comment">% --- Executes on button press in togglebutton_atom_graphics.</span>
3810 <a name="_sub196" href="#_subfunctions" class="code">function togglebutton_atom_graphics_Callback(hObject, eventdata, handles)</a>
3811 <span class="comment">% hObject    handle to togglebutton_atom_graphics (see GCBO)</span>
3812 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3813 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3814 
3815 <span class="comment">% Hint: get(hObject,'Value') returns toggle state of togglebutton_atom_graphics</span>
3816 
3817 <span class="keyword">global</span> hMain
3818 
3819 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'watch'</span>);
3820 
3821 <span class="keyword">if</span> ~isfield(hMain,<span class="string">'atom_graphics'</span>) ||  ~ishandle(hMain.atom_graphics),
3822     switch_it=false;
3823 <span class="keyword">else</span>
3824     switch_it=true;
3825 <span class="keyword">end</span>;
3826 <span class="keyword">if</span> ~isfield(hMain,<span class="string">'atom_graphics_reduced'</span>) ||  ~ishandle(hMain.atom_graphics_reduced),
3827     switch_it=false;
3828 <span class="keyword">end</span>;
3829 state=get(hObject,<span class="string">'Value'</span>);
3830 <span class="keyword">if</span> state,
3831     <span class="keyword">if</span> switch_it,
3832         add_msg_board(<span class="string">'Display update may take a while...'</span>);
3833         <span class="keyword">try</span>
3834             set(hMain.atom_graphics_reduced,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
3835             set(hMain.atom_graphics,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
3836         <span class="keyword">catch</span> myException
3837         <span class="keyword">end</span>;
3838     <span class="keyword">end</span>;
3839     hMain.atom_graphics_mode=1;
3840     set(hObject,<span class="string">'String'</span>,<span class="string">'Atom graphics on'</span>,<span class="string">'ForegroundColor'</span>,[0,0.6,0]);
3841 <span class="keyword">else</span>
3842     <span class="keyword">if</span> hMain.atom_graphics_mode==1,
3843         <span class="keyword">if</span> switch_it,
3844             add_msg_board(<span class="string">'Display update may take a while...'</span>);
3845             <span class="keyword">try</span>
3846                 set(hMain.atom_graphics,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
3847                 set(hMain.atom_graphics_reduced,<span class="string">'Visible'</span>,<span class="string">'on'</span>);
3848             <span class="keyword">catch</span> myException
3849             <span class="keyword">end</span>;
3850         <span class="keyword">end</span>;
3851         hMain.atom_graphics_mode=2;
3852         set(hObject,<span class="string">'String'</span>,<span class="string">'Atom graphics low'</span>,<span class="string">'ForegroundColor'</span>,[0.75,0.6,0]); <span class="comment">% 250-250-210</span>
3853         set(hObject,<span class="string">'Value'</span>,1);
3854     <span class="keyword">else</span>
3855         <span class="keyword">if</span> switch_it,
3856             <span class="keyword">try</span>
3857                 set(hMain.atom_graphics_reduced,<span class="string">'Visible'</span>,<span class="string">'off'</span>);
3858             <span class="keyword">catch</span> myException
3859             <span class="keyword">end</span>;
3860         <span class="keyword">end</span>;
3861         hMain.atom_graphics_mode=0;
3862         set(hObject,<span class="string">'String'</span>,<span class="string">'Atom graphics off'</span>,<span class="string">'ForegroundColor'</span>,<span class="string">'r'</span>);
3863     <span class="keyword">end</span>;
3864 <span class="keyword">end</span>;
3865 set(gcf,<span class="string">'Pointer'</span>,<span class="string">'arrow'</span>);
3866 guidata(hObject,handles);
3867 
3868 
3869 <span class="comment">% --------------------------------------------------------------------</span>
3870 <a name="_sub197" href="#_subfunctions" class="code">function uipushtool_copy_ClickedCallback(hObject, eventdata, handles)</a>
3871 <span class="comment">% hObject    handle to uipushtool_copy (see GCBO)</span>
3872 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3873 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3874 
3875 <span class="keyword">global</span> hModel
3876 <span class="keyword">global</span> hMain
3877 
3878 <span class="keyword">if</span> hMain.atom_graphics_auto,
3879     switch_it=true;
3880     adjust_atom_graphics(false);
3881 <span class="keyword">else</span>
3882     switch_it=false;
3883 <span class="keyword">end</span>;
3884 print(hModel.figure,<span class="string">'-dmeta'</span>);
3885 <span class="keyword">if</span> switch_it,
3886     adjust_atom_graphics(true);
3887 <span class="keyword">end</span>;
3888 
3889 guidata(hObject,handles);
3890 
3891 
3892 <span class="comment">% --------------------------------------------------------------------</span>
3893 <a name="_sub198" href="#_subfunctions" class="code">function menu_file_export_Callback(hObject, eventdata, handles)</a>
3894 <span class="comment">% hObject    handle to menu_file_export (see GCBO)</span>
3895 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3896 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3897 
3898 
3899 <span class="comment">% --------------------------------------------------------------------</span>
3900 <a name="_sub199" href="#_subfunctions" class="code">function menu_file_export_bmp_Callback(hObject, eventdata, handles)</a>
3901 <span class="comment">% hObject    handle to menu_file_export_bmp (see GCBO)</span>
3902 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3903 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3904 
3905 format=<span class="string">'-dbmp'</span>;
3906 extension=<span class="string">'.bmp'</span>;
3907 handles=export(handles,format,extension);
3908 guidata(hObject,handles);
3909 
3910 <span class="comment">% --------------------------------------------------------------------</span>
3911 <a name="_sub200" href="#_subfunctions" class="code">function menu_file_export_emf_Callback(hObject, eventdata, handles)</a>
3912 <span class="comment">% hObject    handle to menu_file_export_emf (see GCBO)</span>
3913 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3914 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3915 
3916 format=<span class="string">'-dmeta'</span>;
3917 extension=<span class="string">'.emf'</span>;
3918 resolution=<span class="string">'-r300'</span>;
3919 handles=export(handles,format,extension,resolution);
3920 guidata(hObject,handles);
3921 
3922 
3923 <span class="comment">% --------------------------------------------------------------------</span>
3924 <a name="_sub201" href="#_subfunctions" class="code">function menu_file_export_eps_Callback(hObject, eventdata, handles)</a>
3925 <span class="comment">% hObject    handle to menu_file_export_eps (see GCBO)</span>
3926 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3927 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3928 
3929 format=<span class="string">'-depsc2'</span>;
3930 resolution=<span class="string">'-r300'</span>;
3931 extension=<span class="string">'.eps'</span>;
3932 handles=export(handles,format,extension,resolution,<span class="string">'-tiff'</span>);
3933 guidata(hObject,handles);
3934 
3935 <span class="comment">% --------------------------------------------------------------------</span>
3936 <a name="_sub202" href="#_subfunctions" class="code">function menu_file_export_jpeg_Callback(hObject, eventdata, handles)</a>
3937 <span class="comment">% hObject    handle to menu_file_export_jpeg (see GCBO)</span>
3938 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3939 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3940 
3941 format=<span class="string">'-djpeg'</span>;
3942 resolution=<span class="string">'-r300'</span>;
3943 extension=<span class="string">'.jpeg'</span>;
3944 handles=export(handles,format,extension,resolution);
3945 guidata(hObject,handles);
3946 
3947 
3948 <span class="comment">% --------------------------------------------------------------------</span>
3949 <a name="_sub203" href="#_subfunctions" class="code">function menu_file_export_pdf_Callback(hObject, eventdata, handles)</a>
3950 <span class="comment">% hObject    handle to menu_file_export_pdf (see GCBO)</span>
3951 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3952 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3953 
3954 format=<span class="string">'-dpdf'</span>;
3955 resolution=<span class="string">'-r300'</span>;
3956 extension=<span class="string">'.pdf'</span>;
3957 handles=export(handles,format,extension,resolution,<span class="string">''</span>);
3958 guidata(hObject,handles);
3959 
3960 <span class="comment">% --------------------------------------------------------------------</span>
3961 <a name="_sub204" href="#_subfunctions" class="code">function menu_file_export_png_Callback(hObject, eventdata, handles)</a>
3962 <span class="comment">% hObject    handle to menu_file_export_png (see GCBO)</span>
3963 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3964 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3965 
3966 format=<span class="string">'-dpng'</span>;
3967 extension=<span class="string">'.png'</span>;
3968 handles=export(handles,format,extension);
3969 guidata(hObject,handles);
3970 
3971 
3972 <span class="comment">% --------------------------------------------------------------------</span>
3973 <a name="_sub205" href="#_subfunctions" class="code">function menu_file_export_tiff_Callback(hObject, eventdata, handles)</a>
3974 <span class="comment">% hObject    handle to menu_file_export_tiff (see GCBO)</span>
3975 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3976 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3977 
3978 format=<span class="string">'-dtiff'</span>;
3979 resolution=<span class="string">'-r300'</span>;
3980 extension=<span class="string">'.tiff'</span>;
3981 handles=export(handles,format,extension,resolution);
3982 guidata(hObject,handles);
3983 
3984 
3985 
3986 <span class="comment">% --------------------------------------------------------------------</span>
3987 <a name="_sub206" href="#_subfunctions" class="code">function menu_file_open_no_display_Callback(hObject, eventdata, handles)</a>
3988 <span class="comment">% hObject    handle to menu_file_open_no_display (see GCBO)</span>
3989 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
3990 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
3991 
3992 <span class="keyword">global</span> model
3993 <span class="keyword">global</span> hMain
3994 
3995 doit=0;
3996 <span class="keyword">if</span> ~exist(<span class="string">'model'</span>,<span class="string">'var'</span>) || isempty(model),
3997     doit=1;
3998 <span class="keyword">else</span>
3999     button = questdlg(<span class="string">'Do you want to delete old model?'</span>,<span class="string">'New model will overwrite existing model'</span>,<span class="string">'No'</span>);
4000     <span class="keyword">if</span> strcmpi(button,<span class="string">'Yes'</span>)
4001         doit=1;
4002     <span class="keyword">end</span>;
4003 <span class="keyword">end</span>;
4004 
4005 <span class="keyword">if</span> doit,
4006     <a href="#_sub153" class="code" title="subfunction open_model(hObject, eventdata, handles, display)">open_model</a>(hObject, eventdata, handles, false);
4007     axes(handles.axes_model);
4008     cla reset;
4009     axis equal
4010     axis off
4011     set(gca,<span class="string">'Clipping'</span>,<span class="string">'off'</span>);
4012     set(gcf,<span class="string">'Renderer'</span>,<span class="string">'opengl'</span>);
4013     hold on
4014     hMain.camlight=camlight;
4015     guidata(handles.axes_model,handles);
4016 <span class="keyword">else</span>
4017     add_msg_board(<span class="string">'Opening of new model cancelled by user'</span>);
4018 <span class="keyword">end</span>;
4019 
4020 add_msg_board(<span class="string">'Model loaded with display suppressed.'</span>);
4021 drawnow
4022 
4023 
4024 <span class="comment">% --------------------------------------------------------------------</span>
4025 <a name="_sub207" href="#_subfunctions" class="code">function menu_file_preferences_Callback(hObject, eventdata, handles)</a>
4026 <span class="comment">% hObject    handle to menu_file_preferences (see GCBO)</span>
4027 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4028 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4029 
4030 preferences;
4031 
4032 
4033 <span class="comment">% --------------------------------------------------------------------</span>
4034 <a name="_sub208" href="#_subfunctions" class="code">function menu_edit_report_Callback(hObject, eventdata, handles)</a>
4035 <span class="comment">% hObject    handle to menu_edit_report (see GCBO)</span>
4036 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4037 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4038 
4039 report_editor;
4040 
4041 
4042 <span class="comment">% --------------------------------------------------------------------</span>
4043 <a name="_sub209" href="#_subfunctions" class="code">function menu_built_view_transform_Callback(hObject, eventdata, handles)</a>
4044 <span class="comment">% hObject    handle to menu_built_view_transform (see GCBO)</span>
4045 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4046 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4047 
4048 <span class="comment">% --------------------------------------------------------------------</span>
4049 <a name="_sub210" href="#_subfunctions" class="code">function menu_build_view_trafo_x_Callback(hObject, eventdata, handles)</a>
4050 <span class="comment">% hObject    handle to menu_build_view_trafo_x (see GCBO)</span>
4051 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4052 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4053 
4054 <span class="keyword">global</span> model
4055 
4056 center=model.info{model.current_structure}.center;
4057 transmat0=affine(<span class="string">'translation'</span>,-center);
4058 
4059 transmat=view_transform(<span class="string">'x'</span>);
4060 transform_model({transmat0,transmat});
4061 <a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles, hObject);
4062 set_view([1,0,0]);
4063 
4064 <span class="comment">% --------------------------------------------------------------------</span>
4065 <a name="_sub211" href="#_subfunctions" class="code">function menu_build_view_trafo_y_Callback(hObject, eventdata, handles)</a>
4066 <span class="comment">% hObject    handle to menu_build_view_trafo_y (see GCBO)</span>
4067 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4068 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4069 
4070 <span class="keyword">global</span> model
4071 
4072 center=model.info{model.current_structure}.center;
4073 transmat0=affine(<span class="string">'translation'</span>,-center);
4074 
4075 transmat=view_transform(<span class="string">'y'</span>);
4076 <span class="comment">% transform_structure(model.current_structure,{transmat0,transmat});</span>
4077 transform_model({transmat0,transmat});
4078 <a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles, hObject);
4079 set_view([0,1,0]);
4080 
4081 <span class="comment">% --------------------------------------------------------------------</span>
4082 <a name="_sub212" href="#_subfunctions" class="code">function menu_build_view_trafo_z_Callback(hObject, eventdata, handles)</a>
4083 <span class="comment">% hObject    handle to menu_build_view_trafo_z (see GCBO)</span>
4084 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4085 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4086 
4087 <span class="keyword">global</span> model
4088 
4089 center=model.info{model.current_structure}.center;
4090 transmat0=affine(<span class="string">'translation'</span>,-center);
4091 
4092 transmat=view_transform(<span class="string">'z'</span>);
4093 transform_model({transmat0,transmat});
4094 <span class="comment">% transform_structure(model.current_structure,{transmat0,transmat});</span>
4095 <a href="#_sub155" class="code" title="subfunction handles=display_model(handles,hObject,camera)">display_model</a>(handles, hObject);
4096 set_view([0,0,1]);
4097 
4098 
4099 <span class="comment">% --------------------------------------------------------------------</span>
4100 <a name="_sub213" href="#_subfunctions" class="code">function menu_epr_access_NiEDDA_Callback(hObject, eventdata, handles)</a>
4101 <span class="comment">% hObject    handle to menu_epr_access_NiEDDA (see GCBO)</span>
4102 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4103 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4104 
4105 <span class="keyword">global</span> hMain
4106 <span class="keyword">global</span> eav
4107 
4108 fname=label_accessibility(eav.NiEDDA);
4109 hMain.report_file=fname;
4110 report_editor;
4111 
4112 
4113 <span class="comment">% --------------------------------------------------------------------</span>
4114 <a name="_sub214" href="#_subfunctions" class="code">function menu_dynamics_Callback(hObject, eventdata, handles)</a>
4115 <span class="comment">% hObject    handle to menu_dynamics (see GCBO)</span>
4116 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4117 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4118 
4119 
4120 <span class="comment">% --------------------------------------------------------------------</span>
4121 <a name="_sub215" href="#_subfunctions" class="code">function menu_dynamics_GNM_Callback(hObject, eventdata, handles)</a>
4122 <span class="comment">% hObject    handle to menu_dynamics_GNM (see GCBO)</span>
4123 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4124 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4125 
4126 GNM;
4127 
4128 
4129 <span class="comment">% --------------------------------------------------------------------</span>
4130 <a name="_sub216" href="#_subfunctions" class="code">function menu_dynamics_ANM_Callback(hObject, eventdata, handles)</a>
4131 <span class="comment">% hObject    handle to menu_dynamics_ANM (see GCBO)</span>
4132 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4133 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4134 
4135 ANM;
4136 
4137 
4138 <span class="comment">% --------------------------------------------------------------------</span>
4139 <a name="_sub217" href="#_subfunctions" class="code">function menu_build_fit_Callback(hObject, eventdata, handles)</a>
4140 <span class="comment">% hObject    handle to menu_build_fit (see GCBO)</span>
4141 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4142 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4143 
4144 
4145 fit_from_template;
4146 
4147 
4148 <span class="comment">% --------------------------------------------------------------------</span>
4149 <a name="_sub218" href="#_subfunctions" class="code">function menu_EPR_site_selection_Callback(hObject, eventdata, handles)</a>
4150 <span class="comment">% hObject    handle to menu_EPR_site_selection (see GCBO)</span>
4151 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4152 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4153 
4154 select_sites;
4155 
4156 
4157 <span class="comment">% --------------------------------------------------------------------</span>
4158 <a name="_sub219" href="#_subfunctions" class="code">function menu_sidechains_all_Callback(hObject, eventdata, handles)</a>
4159 <span class="comment">% hObject    handle to menu_sidechains_all (see GCBO)</span>
4160 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4161 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4162 
4163 
4164 
4165 <span class="comment">% --------------------------------------------------------------------</span>
4166 <a name="_sub220" href="#_subfunctions" class="code">function menu_sidechains_selected_Callback(hObject, eventdata, handles)</a>
4167 <span class="comment">% hObject    handle to menu_sidechains_selected (see GCBO)</span>
4168 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4169 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4170 
4171 <span class="keyword">global</span> model
4172 
4173 <span class="keyword">for</span> k=1:model.selections,
4174     cindices=model.selected{k};
4175     <span class="keyword">if</span> length(cindices)==2, <span class="comment">% selected chain, repack all models</span>
4176         snum=cindices(1);
4177         cnum=cindices(2);
4178         sets=length(model.structures{snum}(cnum).residues);
4179         <span class="keyword">for</span> mnum=1:sets,
4180             repacked_copy(snum,<span class="string">''</span>,modnum,cnum);
4181         <span class="keyword">end</span>;
4182     <span class="keyword">end</span>;
4183     <span class="keyword">if</span> length(cindices)==3, <span class="comment">% selected chain model, repack this one</span>
4184         snum=cindices(1);
4185         cnum=cindices(2);
4186         modnum=cindices(3);
4187         repacked_copy(snum,<span class="string">''</span>,modnum,cnum);
4188     <span class="keyword">end</span>;
4189 <span class="keyword">end</span>;
4190 
4191 guidata(hObject,handles);
4192 
4193 
4194 <span class="comment">% --------------------------------------------------------------------</span>
4195 <a name="_sub221" href="#_subfunctions" class="code">function menu_copy_structure_Callback(hObject, eventdata, handles)</a>
4196 <span class="comment">% hObject    handle to menu_copy_structure (see GCBO)</span>
4197 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4198 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4199 
4200 <span class="keyword">global</span> model
4201 
4202 snum=model.current_structure;
4203 stag=id2tag(snum,model.structure_tags);
4204 idCode=model.info{snum}.idCode;
4205 <span class="keyword">if</span> isempty(idCode), idCode=<span class="string">'AMMM'</span>; <span class="keyword">end</span>;
4206 idCode(1)=char(idCode(1)+16);
4207 
4208 answer = inputdlg(sprintf(<span class="string">'Please provide tag for copy of structure %s'</span>,stag),<span class="string">'New structure tag required'</span>,1,{idCode});
4209 <span class="keyword">if</span> ~isempty(answer),
4210     idCode=answer{1};
4211 <span class="keyword">end</span>;
4212 [snum1,message]=copy_structure(snum,idCode);
4213 <span class="keyword">if</span> message.error==0,
4214     model.current_structure=snum1;
4215     <span class="keyword">if</span> isfield(model.info{snum1},<span class="string">'resolution'</span>) &amp;&amp; ~isempty(model.info{snum1}.resolution),
4216         resstring=sprintf(<span class="string">'%4.2f �,model.info{snum1}.resolution);</span>
4217     <span class="keyword">else</span>
4218         resstring=<span class="string">'not specified'</span>;
4219     <span class="keyword">end</span>;
4220     stag=id2tag(snum1,model.structure_tags);
4221     ctag=model.current_chain;
4222     set(handles.MMM,<span class="string">'Name'</span>,sprintf(<span class="string">'MMM - [%s](%s) Resolution %s'</span>,stag,ctag,resstring));
4223 <span class="keyword">else</span>
4224     add_msg_board(<span class="string">'ERROR: Copying of structure failed.'</span>);
4225     add_msg_board(message.text);
4226 <span class="keyword">end</span>;
4227 
4228 guidata(hObject,handles);
4229 
4230 
4231 <span class="comment">% --------------------------------------------------------------------</span>
4232 <a name="_sub222" href="#_subfunctions" class="code">function menu_build_nonstandard_Callback(hObject, eventdata, handles)</a>
4233 <span class="comment">% hObject    handle to menu_build_nonstandard (see GCBO)</span>
4234 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4235 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4236 
4237 <span class="keyword">global</span> replacements
4238 <span class="keyword">global</span> model
4239 
4240 snum=model.current_structure;
4241 
4242 nonstandard_replacement;
4243 
4244 <span class="keyword">if</span> ~isempty(replacements),
4245     <span class="keyword">if</span> strcmpi(replacements(1),<span class="string">'S'</span>),
4246         selected=true;
4247     <span class="keyword">else</span>
4248         selected=false;
4249     <span class="keyword">end</span>;
4250     replacements=replacements(2:end);
4251     [repnum,msg]=replace(snum,replacements,selected);
4252     <span class="keyword">if</span> ~msg.error,
4253         add_msg_board(sprintf(<span class="string">'%i residues were replaced.'</span>,repnum));
4254     <span class="keyword">else</span>
4255         add_msg_board(<span class="string">'ERROR in residue replacement.'</span>);
4256         add_msg_board(msg.text);
4257     <span class="keyword">end</span>;
4258 <span class="keyword">else</span>
4259     add_msg_board(<span class="string">'Warning: No replacement of non-standard residues'</span>);
4260 <span class="keyword">end</span>;
4261 
4262 guidata(hObject,handles);
4263 
4264 
4265 <span class="comment">% --------------------------------------------------------------------</span>
4266 <a name="_sub223" href="#_subfunctions" class="code">function menu_help_bug_report_Callback(hObject, eventdata, handles)</a>
4267 <span class="comment">% hObject    handle to menu_help_bug_report (see GCBO)</span>
4268 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4269 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4270 
4271 bug_report;
4272 guidata(hObject,handles);
4273 
4274 
4275 <span class="comment">% --- Executes on button press in pushbutton_show_log.</span>
4276 <a name="_sub224" href="#_subfunctions" class="code">function pushbutton_show_log_Callback(hObject, eventdata, handles)</a>
4277 <span class="comment">% hObject    handle to pushbutton_show_log (see GCBO)</span>
4278 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4279 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4280 
4281 <span class="keyword">global</span> hMain
4282 
4283 hMain.report_file=hMain.logfile;
4284 report_editor;
4285 guidata(hObject,handles);
4286 
4287 
4288 <span class="comment">% --------------------------------------------------------------------</span>
4289 <a name="_sub225" href="#_subfunctions" class="code">function menu_build_repair_Callback(hObject, eventdata, handles)</a>
4290 <span class="comment">% hObject    handle to menu_build_repair (see GCBO)</span>
4291 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4292 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4293 
4294 <span class="keyword">global</span> model
4295 
4296 repair_sidechains(model.current_structure);
4297 guidata(hObject,handles);
4298 
4299 
4300 <span class="comment">% --------------------------------------------------------------------</span>
4301 <a name="_sub226" href="#_subfunctions" class="code">function menu_analysis_crystal_Callback(hObject, eventdata, handles)</a>
4302 <span class="comment">% hObject    handle to menu_analysis_crystal (see GCBO)</span>
4303 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4304 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4305 
4306 <span class="keyword">global</span> model
4307 
4308 snum=model.current_structure;
4309 <span class="keyword">if</span> ~isfield(model.info{snum},<span class="string">'cryst'</span>),
4310     add_msg_board(<span class="string">'ERROR: Unit cell information does not exist or was destroyed by a coodinate transformation.'</span>);
4311     guidata(hObject,handles);
4312     <span class="keyword">return</span>
4313 <span class="keyword">end</span>;
4314 pdbid=id2tag(snum,model.structure_tags);
4315 command=sprintf(<span class="string">'hide [%s]'</span>,pdbid);
4316 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
4317 tag1=mk_structure_tag;
4318 [snum1,message]=copy_structure(snum,tag1);
4319 tag2=mk_structure_tag;
4320 [snum2,message]=copy_structure(snum,tag2);
4321 message=repack(snum1,1);
4322 message=repack(snum2,1,true);
4323 command=sprintf(<span class="string">'show [%s] ribbon'</span>,tag1);
4324 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
4325 command=sprintf(<span class="string">'colorscheme [%s] difference [%s]'</span>,tag1,tag2);
4326 <a href="#_sub110" class="code" title="subfunction handles=exe(handles,command,hObject)">exe</a>(handles,command,hObject);
4327 guidata(hObject,handles);
4328 
4329 <span class="comment">% --------------------------------------------------------------------</span>
4330 <a name="_sub227" href="#_subfunctions" class="code">function menu_analysis_CryCo_Callback(hObject, eventdata, handles)</a>
4331 <span class="comment">% hObject    handle to menu_analysis_CryCo (see GCBO)</span>
4332 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4333 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4334 
4335 <span class="keyword">global</span> model
4336 <span class="keyword">global</span> web_adr
4337 <span class="keyword">global</span> queries
4338 
4339 snum=model.current_structure;
4340 pdbid=id2tag(snum,model.structure_tags);
4341 url=[web_adr.CryCo queries.CryCo pdbid];
4342 
4343 webcall(url);
4344 guidata(hObject,handles);
4345 
4346 
4347 <span class="comment">% --------------------------------------------------------------------</span>
4348 <a name="_sub228" href="#_subfunctions" class="code">function menu_analysis_CSU_Callback(hObject, eventdata, handles)</a>
4349 <span class="comment">% hObject    handle to menu_analysis_CSU (see GCBO)</span>
4350 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4351 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4352 
4353 <span class="keyword">global</span> model
4354 <span class="keyword">global</span> web_adr
4355 <span class="keyword">global</span> queries
4356 
4357 snum=model.current_structure;
4358 pdbid=id2tag(snum,model.structure_tags);
4359 url=[web_adr.OCA queries.CSU pdbid];
4360 
4361 webcall(url);
4362 guidata(hObject,handles);
4363 
4364 
4365 <span class="comment">% --- Executes on button press in pushbutton_view_memory.</span>
4366 <a name="_sub229" href="#_subfunctions" class="code">function pushbutton_view_memory_Callback(hObject, eventdata, handles)</a>
4367 <span class="comment">% hObject    handle to pushbutton_view_memory (see GCBO)</span>
4368 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
4369 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4370 
4371 <span class="keyword">global</span> hMain
4372 
4373 hMain.view_memory_camup=get(hMain.axes_model,<span class="string">'CameraUpVector'</span>);
4374 hMain.view_memory_campos=get(hMain.axes_model,<span class="string">'CameraPosition'</span>);
4375 hMain.view_memory_camtar=get(hMain.axes_model,<span class="string">'CameraTarget'</span>);
4376 hMain.view_memory_camview=get(hMain.axes_model,<span class="string">'CameraViewAngle'</span>);
4377 hMain.view_memory_camproj=get(hMain.axes_model,<span class="string">'Projection'</span>);
4378 
4379 guidata(hObject,handles);
4380 
4381 
4382 <span class="comment">% --- Executes on scroll wheel click while the figure is in focus.</span>
4383 <a name="_sub230" href="#_subfunctions" class="code">function MMM_WindowScrollWheelFcn(hObject, eventdata, handles)</a>
4384 <span class="comment">% hObject    handle to MMM (see GCBO)</span>
4385 <span class="comment">% eventdata  structure with the following fields (see FIGURE)</span>
4386 <span class="comment">%    VerticalScrollCount: signed integer indicating direction and number of clicks</span>
4387 <span class="comment">%    VerticalScrollAmount: number of lines scrolled for each click</span>
4388 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
4389 
4390 view3DScrollFcn(hObject,eventdata);</pre></div>
<hr><address>Generated on Fri 05-Apr-2013 12:00:44 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>