<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of PulseGen</title>
  <meta name="keywords" content="PulseGen">
  <meta name="description" content="PULSEGEN A graphical user interface for the generation of Electron">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">pulsed</a> &gt; PulseGen.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for pulsed&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>PulseGen
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>PULSEGEN A graphical user interface for the generation of Electron</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = PulseGen(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> PULSEGEN A graphical user interface for the generation of Electron
       Paramagnetic Resonance (EPR) pulse sequence figures.

 PULSEGEN's initial idea and command line script coding was written by Dr. Frederic Mentink (Weizmann,
 IL) the user interface was generated by Dr. Morgan Bye.

 Syntax:  PULSEGEN

 Inputs:
    input1 - n/a

 Outputs:
    output1 - n/a

 Example: 
    see http://morganbye.net/PulseGen

 Other m-files required:
    none

 Subfunctions:
    none

 MAT-files required: none

 See also:</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function PulseGen_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = PulseGen_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function figure1_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function button_tbl_pulses_add_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function button_tbl_pulses_rm_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function pushbutton_pulses_help_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function tbl_pulses_CellEditCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function pushbutton_delays_add_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function pushbutton_delays_rm_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function pushbutton_delays_help_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function tbl_delays_CellEditCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function button_tbl_echoes_add_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function button_tbl_echoes_rm_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function pushbutton_echo_help_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function tbl_echoes_CellEditCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function menu_file_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function menu_file_open_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub18" class="code">function menu_file_save_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function menu_file_export_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function menu_file_clear_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function menu_file_close_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function menu_defaults_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function menu_defaults_2PESEEM_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function menu_defaults_IR_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub25" class="code">function menu_defaults_DEER_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function menu_help_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub27" class="code">function menu_help_about_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub28" class="code">function toolbar_new_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub29" class="code">function toolbar_save_ClickedCallback(hObject, eventdata, handles)</a></li><li><a href="#_sub30" class="code">function PulseGenPlot(hObject, eventdata, handles)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = PulseGen(varargin)</a>
0002 
0003 <span class="comment">% PULSEGEN A graphical user interface for the generation of Electron</span>
0004 <span class="comment">%       Paramagnetic Resonance (EPR) pulse sequence figures.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% PULSEGEN's initial idea and command line script coding was written by Dr. Frederic Mentink (Weizmann,</span>
0007 <span class="comment">% IL) the user interface was generated by Dr. Morgan Bye.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Syntax:  PULSEGEN</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Inputs:</span>
0012 <span class="comment">%    input1 - n/a</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Outputs:</span>
0015 <span class="comment">%    output1 - n/a</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Example:</span>
0018 <span class="comment">%    see http://morganbye.net/PulseGen</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Other m-files required:</span>
0021 <span class="comment">%    none</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Subfunctions:</span>
0024 <span class="comment">%    none</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% MAT-files required: none</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% See also:</span>
0029 
0030 <span class="comment">%                                        _                             _</span>
0031 <span class="comment">%                                       | |                           | |</span>
0032 <span class="comment">%  _ __ ___   ___  _ __ __ _  __ _ _ __ | |__  _   _  ___   _ __   ___| |_</span>
0033 <span class="comment">% | '_ ` _ \ / _ \| '__/ _` |/ _` | '_ \| '_ \| | | |/ _ \ | '_ \ / _ \ __|</span>
0034 <span class="comment">% | | | | | | (_) | | | (_| | (_| | | | | |_) | |_| |  __/_| | | |  __/ |_</span>
0035 <span class="comment">% |_| |_| |_|\___/|_|  \__, |\__,_|_| |_|_.__/ \__, |\___(_)_| |_|\___|\__|</span>
0036 <span class="comment">%                       __/ |                   __/ |</span>
0037 <span class="comment">%                      |___/                   |___/</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% M. Bye v13.12</span>
0040 <span class="comment">%</span>
0041 <span class="comment">% v13.09 - current</span>
0042 <span class="comment">%               Chemical Physics Department</span>
0043 <span class="comment">%               Weizmann Institute of Science</span>
0044 <span class="comment">%               76100 REHOVOT, Israel</span>
0045 <span class="comment">%</span>
0046 <span class="comment">% Email:        morgan.bye@weizmann.ac.il</span>
0047 <span class="comment">% Website:      http://morganbye.net/eprtoolbox</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% Last updated  10-December-2013</span>
0050 
0051 <span class="comment">% Edit the above text to modify the response to help PulseGen</span>
0052 
0053 <span class="comment">% Last Modified by GUIDE v2.5 11-Dec-2013 10:26:13</span>
0054 
0055 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0056 gui_Singleton = 1;
0057 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0058                    <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0059                    <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction PulseGen_OpeningFcn(hObject, eventdata, handles, varargin)">PulseGen_OpeningFcn</a>, <span class="keyword">...</span>
0060                    <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = PulseGen_OutputFcn(hObject, eventdata, handles)">PulseGen_OutputFcn</a>, <span class="keyword">...</span>
0061                    <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0062                    <span class="string">'gui_Callback'</span>,   []);
0063 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0064     gui_State.gui_Callback = str2func(varargin{1});
0065 <span class="keyword">end</span>
0066 
0067 <span class="keyword">if</span> nargout
0068     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0069 <span class="keyword">else</span>
0070     gui_mainfcn(gui_State, varargin{:});
0071 <span class="keyword">end</span>
0072 <span class="comment">% End initialization code - DO NOT EDIT</span>
0073 
0074 
0075 <span class="comment">% --- Executes just before PulseGen is made visible.</span>
0076 <a name="_sub1" href="#_subfunctions" class="code">function PulseGen_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0077 <span class="comment">% This function has no output args, see OutputFcn.</span>
0078 <span class="comment">% hObject    handle to figure</span>
0079 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0080 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0081 <span class="comment">% varargin   command line arguments to PulseGen (see VARARGIN)</span>
0082 
0083 <span class="comment">% Choose default command line output for PulseGen</span>
0084 handles.output = hObject;
0085 
0086 <span class="comment">% Name the window</span>
0087 set(gcf,<span class="string">'Name'</span>,<span class="string">'PulseGen - v13.12'</span>)
0088 
0089 <span class="comment">% Clear the axes</span>
0090 axes(handles.axes_pulses);
0091 <span class="comment">% axis off;</span>
0092 set(gca, <span class="string">'YTick'</span>, []);
0093 xlabel(<span class="string">'Time / ns'</span>);
0094 
0095 <span class="comment">% Set up the tables</span>
0096 set(handles.tbl_pulses,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'16'</span> <span class="string">'10'</span> <span class="string">'100'</span>;<span class="keyword">...</span>
0097                                 <span class="string">'1'</span> <span class="string">'32'</span> <span class="string">'10'</span> <span class="string">'200'</span>});
0098                             
0099 set(handles.tbl_delays,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'10'</span>});
0100                             
0101 set(handles.tbl_echoes,<span class="string">'Data'</span>, {<span class="string">'32'</span> <span class="string">'10'</span> <span class="string">'1'</span>});
0102 
0103 <a href="#_sub30" class="code" title="subfunction PulseGenPlot(hObject, eventdata, handles)">PulseGenPlot</a>(hObject, eventdata, handles);
0104 
0105 <span class="comment">% Update handles structure</span>
0106 guidata(hObject, handles);
0107 
0108 <span class="comment">% UIWAIT makes PulseGen wait for user response (see UIRESUME)</span>
0109 <span class="comment">% uiwait(handles.figure1);</span>
0110 
0111 
0112 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0113 <a name="_sub2" href="#_subfunctions" class="code">function varargout = PulseGen_OutputFcn(hObject, eventdata, handles) </a>
0114 <span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
0115 <span class="comment">% hObject    handle to figure</span>
0116 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0117 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0118 
0119 <span class="comment">% Get default command line output from handles structure</span>
0120 varargout{1} = handles.output;
0121 
0122 
0123 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0124 <a name="_sub3" href="#_subfunctions" class="code">function figure1_CreateFcn(hObject, eventdata, handles)</a>
0125 <span class="comment">% hObject    handle to figure1 (see GCBO)</span>
0126 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0127 <span class="comment">% handles    empty - handles not created until after all CreateFcns called</span>
0128 
0129 
0130 
0131 <span class="comment">%   _______    _     _</span>
0132 <span class="comment">%  |__   __|  | |   | |</span>
0133 <span class="comment">%     | | __ _| |__ | | ___  ___</span>
0134 <span class="comment">%     | |/ _` | '_ \| |/ _ \/ __|</span>
0135 <span class="comment">%     | | (_| | |_) | |  __/\__ \</span>
0136 <span class="comment">%     |_|\__,_|_.__/|_|\___||___/</span>
0137 <span class="comment">%</span>
0138 <span class="comment">%</span>
0139 
0140 <span class="comment">% --- Executes on button press in button_tbl_pulses_add.</span>
0141 <a name="_sub4" href="#_subfunctions" class="code">function button_tbl_pulses_add_Callback(hObject, eventdata, handles)</a>
0142 <span class="comment">% hObject    handle to button_tbl_pulses_add (see GCBO)</span>
0143 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0144 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0145 
0146 tbl_pulses_value = get(handles.tbl_pulses,<span class="string">'Data'</span>);
0147 set(handles.tbl_pulses,<span class="string">'Data'</span>,<span class="keyword">...</span>
0148     [tbl_pulses_value;{<span class="string">'1'</span> <span class="string">'0'</span> <span class="string">'0'</span> <span class="string">'0'</span>}]);
0149 
0150 <span class="comment">% --- Executes on button press in button_tbl_pulses_rm.</span>
0151 <a name="_sub5" href="#_subfunctions" class="code">function button_tbl_pulses_rm_Callback(hObject, eventdata, handles)</a>
0152 <span class="comment">% hObject    handle to button_tbl_pulses_rm (see GCBO)</span>
0153 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0154 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0155 a = get(handles.tbl_pulses,<span class="string">'Data'</span>);
0156 tbl_pulses_value = a(1:(size(a,1)-1),:);
0157 set(handles.tbl_pulses,<span class="string">'Data'</span>,tbl_pulses_value);
0158 
0159 <span class="comment">% --- Executes on button press in pushbutton_pulses_help.</span>
0160 <a name="_sub6" href="#_subfunctions" class="code">function pushbutton_pulses_help_Callback(hObject, eventdata, handles)</a>
0161 <span class="comment">% hObject    handle to pushbutton_pulses_help (see GCBO)</span>
0162 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0163 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0164 
0165 helpdlg(<span class="string">'This table contains all of the pulse information. The channel column dictates which channel the pulse appears in. The delay column dictates the time after this pulse before the next pulse.'</span><span class="keyword">...</span>
0166     ,<span class="string">'PulseGen: Pulses table help'</span>);
0167 
0168 <span class="comment">% --- Executes when entered data in editable cell(s) in tbl_pulses.</span>
0169 <a name="_sub7" href="#_subfunctions" class="code">function tbl_pulses_CellEditCallback(hObject, eventdata, handles)</a>
0170 <span class="comment">% hObject    handle to tbl_pulses (see GCBO)</span>
0171 <span class="comment">% eventdata  structure with the following fields (see UITABLE)</span>
0172 <span class="comment">%    Indices: row and column indices of the cell(s) edited</span>
0173 <span class="comment">%    PreviousData: previous data for the cell(s) edited</span>
0174 <span class="comment">%    EditData: string(s) entered by the user</span>
0175 <span class="comment">%    NewData: EditData or its converted form set on the Data property. Empty if Data was not changed</span>
0176 <span class="comment">%    Error: error string when failed to convert EditData to appropriate value for Data</span>
0177 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0178 
0179 <a href="#_sub30" class="code" title="subfunction PulseGenPlot(hObject, eventdata, handles)">PulseGenPlot</a>(hObject, eventdata, handles);
0180 
0181 <span class="comment">% --- Executes on button press in pushbutton_delays_add.</span>
0182 <a name="_sub8" href="#_subfunctions" class="code">function pushbutton_delays_add_Callback(hObject, eventdata, handles)</a>
0183 <span class="comment">% hObject    handle to pushbutton_delays_add (see GCBO)</span>
0184 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0185 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0186 
0187 tbl_delays_value = get(handles.tbl_delays,<span class="string">'Data'</span>);
0188 set(handles.tbl_delays,<span class="string">'Data'</span>,<span class="keyword">...</span>
0189     [tbl_delays_value;{<span class="string">'1'</span> <span class="string">'0'</span>}]);
0190 
0191 <span class="comment">% --- Executes on button press in pushbutton_delays_rm.</span>
0192 <a name="_sub9" href="#_subfunctions" class="code">function pushbutton_delays_rm_Callback(hObject, eventdata, handles)</a>
0193 <span class="comment">% hObject    handle to pushbutton_delays_rm (see GCBO)</span>
0194 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0195 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0196 
0197 a = get(handles.tbl_delays,<span class="string">'Data'</span>);
0198 tbl_pulses_value = a(1:(size(a,1)-1),:);
0199 set(handles.tbl_delays,<span class="string">'Data'</span>,tbl_pulses_value);
0200 
0201 <span class="comment">% --- Executes on button press in pushbutton_delays_help.</span>
0202 <a name="_sub10" href="#_subfunctions" class="code">function pushbutton_delays_help_Callback(hObject, eventdata, handles)</a>
0203 <span class="comment">% hObject    handle to pushbutton_delays_help (see GCBO)</span>
0204 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0205 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0206 <span class="comment">% --- Executes when entered data in editable cell(s) in tbl_delays.</span>
0207 
0208 helpdlg(<span class="string">'This table contains the delay information for each channel before the first pulse appears'</span><span class="keyword">...</span>
0209     ,<span class="string">'PulseGen: Delays table help'</span>);
0210 
0211 <a name="_sub11" href="#_subfunctions" class="code">function tbl_delays_CellEditCallback(hObject, eventdata, handles)</a>
0212 <span class="comment">% hObject    handle to tbl_delays (see GCBO)</span>
0213 <span class="comment">% eventdata  structure with the following fields (see UITABLE)</span>
0214 <span class="comment">%    Indices: row and column indices of the cell(s) edited</span>
0215 <span class="comment">%    PreviousData: previous data for the cell(s) edited</span>
0216 <span class="comment">%    EditData: string(s) entered by the user</span>
0217 <span class="comment">%    NewData: EditData or its converted form set on the Data property. Empty if Data was not changed</span>
0218 <span class="comment">%    Error: error string when failed to convert EditData to appropriate value for Data</span>
0219 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0220 
0221 <a href="#_sub30" class="code" title="subfunction PulseGenPlot(hObject, eventdata, handles)">PulseGenPlot</a>(hObject, eventdata, handles);
0222 
0223 <span class="comment">% --- Executes on button press in button_tbl_pulses_add.</span>
0224 <a name="_sub12" href="#_subfunctions" class="code">function button_tbl_echoes_add_Callback(hObject, eventdata, handles)</a>
0225 <span class="comment">% hObject    handle to button_tbl_pulses_add (see GCBO)</span>
0226 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0227 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0228 
0229 warndlg(<span class="string">'In this version of PulseGen only 1 echo is supported'</span>,<span class="string">'PulseGen: Echo error'</span>);
0230 
0231 <span class="comment">% tbl_echoes_value = get(handles.tbl_echoes,'Data');</span>
0232 <span class="comment">% set(handles.tbl_echoes,'Data',...</span>
0233 <span class="comment">%     [tbl_echoes_value;{'1' '0' '0'}]);</span>
0234 
0235 <span class="comment">% --- Executes on button press in button_tbl_echoes_rm.</span>
0236 <a name="_sub13" href="#_subfunctions" class="code">function button_tbl_echoes_rm_Callback(hObject, eventdata, handles)</a>
0237 <span class="comment">% hObject    handle to button_tbl_echoes_rm (see GCBO)</span>
0238 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0239 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0240 
0241 warndlg(<span class="string">'In this version of PulseGen only 1 echo is supported'</span>,<span class="string">'PulseGen: Echo error'</span>);
0242 
0243 <span class="comment">% a = get(handles.tbl_echoes,'Data');</span>
0244 <span class="comment">% tbl_echoes_value = a(1:(size(a,1)-1),:);</span>
0245 <span class="comment">% set(handles.tbl_echoes,'Data',tbl_echoes_value);</span>
0246 
0247 <span class="comment">% --- Executes on button press in pushbutton_echo_help.</span>
0248 <a name="_sub14" href="#_subfunctions" class="code">function pushbutton_echo_help_Callback(hObject, eventdata, handles)</a>
0249 <span class="comment">% hObject    handle to pushbutton_echo_help (see GCBO)</span>
0250 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0251 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0252 
0253 helpdlg(<span class="string">'This table contains the detection echo parameters - it will always appear in channel 1'</span><span class="keyword">...</span>
0254     ,<span class="string">'PulseGen: Echoes table help'</span>);
0255 
0256 <span class="comment">% --- Executes when entered data in editable cell(s) in tbl_echoes.</span>
0257 <a name="_sub15" href="#_subfunctions" class="code">function tbl_echoes_CellEditCallback(hObject, eventdata, handles)</a>
0258 <span class="comment">% hObject    handle to tbl_echoes (see GCBO)</span>
0259 <span class="comment">% eventdata  structure with the following fields (see UITABLE)</span>
0260 <span class="comment">%    Indices: row and column indices of the cell(s) edited</span>
0261 <span class="comment">%    PreviousData: previous data for the cell(s) edited</span>
0262 <span class="comment">%    EditData: string(s) entered by the user</span>
0263 <span class="comment">%    NewData: EditData or its converted form set on the Data property. Empty if Data was not changed</span>
0264 <span class="comment">%    Error: error string when failed to convert EditData to appropriate value for Data</span>
0265 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0266 
0267 <a href="#_sub30" class="code" title="subfunction PulseGenPlot(hObject, eventdata, handles)">PulseGenPlot</a>(hObject, eventdata, handles);
0268 
0269 
0270 <span class="comment">%   __  __</span>
0271 <span class="comment">%  |  \/  |</span>
0272 <span class="comment">%  | \  / | ___ _ __  _   _</span>
0273 <span class="comment">%  | |\/| |/ _ \ '_ \| | | |</span>
0274 <span class="comment">%  | |  | |  __/ | | | |_| |</span>
0275 <span class="comment">%  |_|  |_|\___|_| |_|\__,_|</span>
0276 <span class="comment">%</span>
0277 
0278 <span class="comment">% --------------------------------------------------------------------</span>
0279 <a name="_sub16" href="#_subfunctions" class="code">function menu_file_Callback(hObject, eventdata, handles)</a>
0280 <span class="comment">% hObject    handle to menu_file (see GCBO)</span>
0281 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0282 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0283 
0284 
0285 <span class="comment">% --------------------------------------------------------------------</span>
0286 <a name="_sub17" href="#_subfunctions" class="code">function menu_file_open_Callback(hObject, eventdata, handles)</a>
0287 <span class="comment">% hObject    handle to menu_file_open (see GCBO)</span>
0288 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0289 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0290 
0291 
0292 <span class="comment">% --------------------------------------------------------------------</span>
0293 <a name="_sub18" href="#_subfunctions" class="code">function menu_file_save_Callback(hObject, eventdata, handles)</a>
0294 <span class="comment">% hObject    handle to menu_file_save (see GCBO)</span>
0295 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0296 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0297 
0298 
0299 <span class="comment">% --------------------------------------------------------------------</span>
0300 <a name="_sub19" href="#_subfunctions" class="code">function menu_file_export_Callback(hObject, eventdata, handles)</a>
0301 <span class="comment">% hObject    handle to menu_file_export (see GCBO)</span>
0302 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0303 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0304 
0305 <span class="comment">% stores savepath for the phase plot</span>
0306 [filename, pathname] = uiputfile({ <span class="string">'*.eps'</span>,<span class="string">'Encapsulated Postscript (*.eps)'</span>;<span class="keyword">...</span>
0307         <span class="string">'*.png'</span>,<span class="string">'Portable Network Graphic (*.png)'</span>;<span class="keyword">...</span>
0308         <span class="string">'*.bmp'</span>,<span class="string">'Bitmap (*.bmp)'</span>; <span class="string">'*.fig'</span>,<span class="string">'Figure (*.fig)'</span>}, <span class="keyword">...</span><span class="comment"> </span>
0309         <span class="string">'Save picture as'</span>,<span class="string">'default'</span>);
0310 
0311 <span class="comment">% if user cancels save, nothing happens</span>
0312 <span class="keyword">if</span> isequal(filename,0) || isequal(pathname,0)
0313     <span class="keyword">return</span>
0314 <span class="keyword">end</span>
0315 
0316 <span class="comment">% Set axes to copy</span>
0317 axesObject = gca;
0318 
0319 <span class="comment">% create a new figure</span>
0320 newFig = figure;
0321 
0322 <span class="comment">% get the units and position of the axes object</span>
0323 <span class="comment">%axes_units = get(axesObject,'Units');</span>
0324 <span class="comment">% axes_pos = get(axesObject,'Position');</span>
0325 
0326 <span class="comment">% copies axesObject onto new figure</span>
0327 axesObject2 = copyobj(axesObject,newFig);
0328 
0329 <span class="comment">% realign the axes object on the new figure</span>
0330 <span class="comment">% set(axesObject2,'Units',);</span>
0331 <span class="comment">% set(axesObject2,'Position',[15 5 axes_pos(3) axes_pos(4)]);</span>
0332 
0333 <span class="comment">% adjusts the new figure accordingly</span>
0334 set(newFig,<span class="string">'Units'</span>,<span class="string">'normalized'</span>);
0335 set(gca,<span class="string">'Position'</span>,[0.1 0.1 0.8 0.8]);
0336 
0337 <span class="comment">% Tidy it up</span>
0338 set(gcf,<span class="string">'color'</span>, <span class="string">'white'</span>);
0339 
0340 <span class="comment">% Save the plot</span>
0341 saveas(newFig,[pathname filename]) 
0342 
0343 <span class="comment">% Closes the figure</span>
0344 close(newFig)
0345 
0346 <span class="comment">% --------------------------------------------------------------------</span>
0347 <a name="_sub20" href="#_subfunctions" class="code">function menu_file_clear_Callback(hObject, eventdata, handles)</a>
0348 <span class="comment">% hObject    handle to menu_file_clear (see GCBO)</span>
0349 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0350 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0351 
0352 set(handles.tbl_pulses,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'0'</span> <span class="string">'0'</span> <span class="string">'0'</span>});
0353 
0354 set(handles.tbl_delays,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'10'</span>});
0355 
0356 set(handles.tbl_echoes,<span class="string">'Data'</span>,<span class="keyword">...</span>
0357     [tbl_echoes_value;{<span class="string">'1'</span> <span class="string">'0'</span> <span class="string">'0'</span>}]);
0358 
0359 
0360 <span class="comment">% --------------------------------------------------------------------</span>
0361 <a name="_sub21" href="#_subfunctions" class="code">function menu_file_close_Callback(hObject, eventdata, handles)</a>
0362 <span class="comment">% hObject    handle to menu_file_close (see GCBO)</span>
0363 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0364 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0365 
0366 close(gcf);
0367 
0368 <span class="comment">% --------------------------------------------------------------------</span>
0369 <a name="_sub22" href="#_subfunctions" class="code">function menu_defaults_Callback(hObject, eventdata, handles)</a>
0370 <span class="comment">% hObject    handle to menu_defaults (see GCBO)</span>
0371 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0372 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0373 
0374 
0375 <span class="comment">% --------------------------------------------------------------------</span>
0376 <a name="_sub23" href="#_subfunctions" class="code">function menu_defaults_2PESEEM_Callback(hObject, eventdata, handles)</a>
0377 <span class="comment">% hObject    handle to menu_defaults_2PESEEM (see GCBO)</span>
0378 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0379 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0380 
0381 set(handles.tbl_pulses,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'16'</span> <span class="string">'10'</span> <span class="string">'75'</span>;<span class="keyword">...</span>
0382                                 <span class="string">'1'</span> <span class="string">'32'</span> <span class="string">'10'</span> <span class="string">'75'</span>});
0383                             
0384 set(handles.tbl_delays,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'10'</span>});
0385 
0386 set(handles.tbl_echoes,<span class="string">'Data'</span>, {<span class="string">'32'</span> <span class="string">'10'</span> <span class="string">'1'</span>});
0387 
0388 <a href="#_sub30" class="code" title="subfunction PulseGenPlot(hObject, eventdata, handles)">PulseGenPlot</a>(hObject, eventdata, handles)
0389 
0390 
0391 <span class="comment">% --------------------------------------------------------------------</span>
0392 <a name="_sub24" href="#_subfunctions" class="code">function menu_defaults_IR_Callback(hObject, eventdata, handles)</a>
0393 <span class="comment">% hObject    handle to menu_defaults_IR (see GCBO)</span>
0394 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0395 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0396 
0397 set(handles.tbl_pulses,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'32'</span> <span class="string">'-10'</span> <span class="string">'150'</span>;<span class="keyword">...</span>
0398                                 <span class="string">'1'</span> <span class="string">'16'</span> <span class="string">'10'</span>  <span class="string">'75'</span>;<span class="keyword">...</span>
0399                                 <span class="string">'1'</span> <span class="string">'32'</span> <span class="string">'10'</span>  <span class="string">'75'</span>});
0400                             
0401 set(handles.tbl_delays,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'10'</span>});
0402 
0403 set(handles.tbl_echoes,<span class="string">'Data'</span>, {<span class="string">'32'</span> <span class="string">'10'</span> <span class="string">'1'</span>});
0404 
0405 <a href="#_sub30" class="code" title="subfunction PulseGenPlot(hObject, eventdata, handles)">PulseGenPlot</a>(hObject, eventdata, handles)
0406 
0407 
0408 <span class="comment">% --------------------------------------------------------------------</span>
0409 <a name="_sub25" href="#_subfunctions" class="code">function menu_defaults_DEER_Callback(hObject, eventdata, handles)</a>
0410 <span class="comment">% hObject    handle to menu_defaults_DEER (see GCBO)</span>
0411 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0412 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0413 
0414 set(handles.tbl_pulses,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'16'</span> <span class="string">'10'</span>  <span class="string">'100'</span>;<span class="keyword">...</span>
0415                                 <span class="string">'1'</span> <span class="string">'32'</span> <span class="string">'10'</span>  <span class="string">'200'</span>;<span class="keyword">...</span>
0416                                 <span class="string">'2'</span> <span class="string">'32'</span> <span class="string">'10'</span>  <span class="string">'300'</span>;<span class="keyword">...</span>
0417                                 <span class="string">'1'</span> <span class="string">'32'</span> <span class="string">'10'</span>  <span class="string">'200'</span>});
0418                             
0419 set(handles.tbl_delays,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'10'</span>;<span class="keyword">...</span>
0420                                 <span class="string">'2'</span> <span class="string">'200'</span>});
0421                            
0422 set(handles.tbl_echoes,<span class="string">'Data'</span>, {<span class="string">'32'</span> <span class="string">'10'</span> <span class="string">'1'</span>});
0423 <a href="#_sub30" class="code" title="subfunction PulseGenPlot(hObject, eventdata, handles)">PulseGenPlot</a>(hObject, eventdata, handles)
0424 
0425 
0426 <span class="comment">% --------------------------------------------------------------------</span>
0427 <a name="_sub26" href="#_subfunctions" class="code">function menu_help_Callback(hObject, eventdata, handles)</a>
0428 <span class="comment">% hObject    handle to menu_help (see GCBO)</span>
0429 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0430 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0431 
0432 
0433 <span class="comment">% --------------------------------------------------------------------</span>
0434 <a name="_sub27" href="#_subfunctions" class="code">function menu_help_about_Callback(hObject, eventdata, handles)</a>
0435 <span class="comment">% hObject    handle to menu_help_about (see GCBO)</span>
0436 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0437 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0438 
0439 about = [<span class="keyword">...</span>
0440 <span class="string">' PulseGen v13.12                                                          '</span>;<span class="keyword">...</span>
0441 <span class="string">' ===============                                                          '</span>;<span class="keyword">...</span>
0442 <span class="string">'                                                                          '</span>;<span class="keyword">...</span>
0443 <span class="string">' PulseGen is a program for the easy and quick plotting of EPR pulse       '</span>;<span class="keyword">...</span>
0444 <span class="string">' patterns across multiple channels without having to manually draw them.  '</span>;<span class="keyword">...</span>
0445 <span class="string">' This program was born out of frustration of easy and accurate pulse      '</span>;<span class="keyword">...</span>
0446 <span class="string">' drawing options.                                                         '</span>;<span class="keyword">...</span>
0447 <span class="string">'                                                                          '</span>;<span class="keyword">...</span>
0448 <span class="string">' The original command line version of this program was written by Dr. F.  '</span>;<span class="keyword">...</span>
0449 <span class="string">' Mentink and can be found commented in the program code.                  '</span>;<span class="keyword">...</span>
0450 <span class="string">'                                                                          '</span>;<span class="keyword">...</span>
0451 <span class="string">' The graphical user interface and several minor adjustments were made by  '</span>;<span class="keyword">...</span>
0452 <span class="string">' Dr. M. Bye                                                               '</span>;<span class="keyword">...</span>
0453 <span class="string">'                                                                          '</span>;<span class="keyword">...</span>
0454 <span class="string">' Both authors are members of the Goldfarb group in the Department of      '</span>;<span class="keyword">...</span>
0455 <span class="string">' Chemical Physics at the Weizmann Institute of Science, IL                '</span>;<span class="keyword">...</span>
0456 <span class="string">'                                                                          '</span>;<span class="keyword">...</span>
0457 <span class="string">' morgan.bye@weizmann.ac.il                                                '</span>;<span class="keyword">...</span>
0458 <span class="string">' frederic.mentink@weizmann.ac.il                                          '</span>;<span class="keyword">...</span>
0459 <span class="string">'                                                                          '</span>;<span class="keyword">...</span>
0460 <span class="string">' This program is distributed under a Creative Commons share-alike, non-   '</span>;<span class="keyword">...</span>
0461 <span class="string">' commerical, attribution license with no warranty.                        '</span>];
0462 msgbox(about,<span class="string">'PulseGen: Help'</span>)
0463 
0464 
0465 <span class="comment">%   _______          _ _</span>
0466 <span class="comment">%  |__   __|        | | |</span>
0467 <span class="comment">%     | | ___   ___ | | |__   __ _ _ __</span>
0468 <span class="comment">%     | |/ _ \ / _ \| | '_ \ / _` | '__|</span>
0469 <span class="comment">%     | | (_) | (_) | | |_) | (_| | |</span>
0470 <span class="comment">%     |_|\___/ \___/|_|_.__/ \__,_|_|</span>
0471 <span class="comment">%</span>
0472 <span class="comment">%</span>
0473 
0474 <span class="comment">% --------------------------------------------------------------------</span>
0475 <a name="_sub28" href="#_subfunctions" class="code">function toolbar_new_ClickedCallback(hObject, eventdata, handles)</a>
0476 <span class="comment">% hObject    handle to toolbar_new (see GCBO)</span>
0477 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0478 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0479 
0480 <span class="comment">% Set up the tables</span>
0481 set(handles.tbl_pulses,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'0'</span> <span class="string">'0'</span> <span class="string">'0'</span>});
0482                             
0483 set(handles.tbl_delays,<span class="string">'Data'</span>, {<span class="string">'1'</span> <span class="string">'10'</span>});
0484                             
0485 set(handles.tbl_echoes,<span class="string">'Data'</span>, {<span class="string">'0'</span> <span class="string">'10'</span> <span class="string">'1'</span>});
0486 
0487 <span class="comment">% --------------------------------------------------------------------</span>
0488 <a name="_sub29" href="#_subfunctions" class="code">function toolbar_save_ClickedCallback(hObject, eventdata, handles)</a>
0489 <span class="comment">% hObject    handle to toolbar_save (see GCBO)</span>
0490 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0491 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0492 
0493 <a href="#_sub19" class="code" title="subfunction menu_file_export_Callback(hObject, eventdata, handles)">menu_file_export_Callback</a>(hObject, eventdata, handles);
0494 
0495 <span class="comment">%   ______                _   _</span>
0496 <span class="comment">%  |  ____|              | | (_)</span>
0497 <span class="comment">%  | |__ _   _ _ __   ___| |_ _  ___  _ __  ___</span>
0498 <span class="comment">%  |  __| | | | '_ \ / __| __| |/ _ \| '_ \/ __|</span>
0499 <span class="comment">%  | |  | |_| | | | | (__| |_| | (_) | | | \__ \</span>
0500 <span class="comment">%  |_|   \__,_|_| |_|\___|\__|_|\___/|_| |_|___/</span>
0501 <span class="comment">%</span>
0502 <span class="comment">%</span>
0503 
0504 <a name="_sub30" href="#_subfunctions" class="code">function PulseGenPlot(hObject, eventdata, handles)</a>
0505 
0506 <span class="comment">%% Original command line code from Fred</span>
0507 <span class="comment">%</span>
0508 <span class="comment">% %% Pulse  sequence drawing</span>
0509 <span class="comment">% % this codes aim at drawing any kind of EPR sequence including the echo, in</span>
0510 <span class="comment">% % a quite easy way</span>
0511 <span class="comment">% % version 1, developed by F. Mentink-Vigier for D. Goldfarb Group</span>
0512 <span class="comment">%</span>
0513 <span class="comment">% clear</span>
0514 <span class="comment">%</span>
0515 <span class="comment">% %% Definition of the sequence</span>
0516 <span class="comment">% % sequence is a 2 dimension array, first column contains the pulse height</span>
0517 <span class="comment">% % second column contain the pulse lenght,</span>
0518 <span class="comment">% % third column contains the distance between pulses, except last value that</span>
0519 <span class="comment">% % gives echo position</span>
0520 <span class="comment">%</span>
0521 <span class="comment">% %% input user</span>
0522 <span class="comment">% sequence{1}=[1,8,100;</span>
0523 <span class="comment">%     1,16,100;</span>
0524 <span class="comment">%     1,16,100];</span>
0525 <span class="comment">% %</span>
0526 <span class="comment">% sequence{2}=[1,20,10;</span>
0527 <span class="comment">%             2,20,10];</span>
0528 <span class="comment">% sequence{3}=[2,20,50];</span>
0529 <span class="comment">% delay{1}=10;</span>
0530 <span class="comment">% delay{2}=60;</span>
0531 <span class="comment">% delay{3}=90;</span>
0532 <span class="comment">%</span>
0533 <span class="comment">%</span>
0534 <span class="comment">% channel_Detect=1;</span>
0535 <span class="comment">% echoWidth=sequence{channel_Detect}(end,2)/4;</span>
0536 <span class="comment">% echoHeight=0.6;</span>
0537 <span class="comment">% shift=0;</span>
0538 <span class="comment">%</span>
0539 <span class="comment">% % initialization of parameters</span>
0540 <span class="comment">% for channel=1:size(sequence,2)</span>
0541 <span class="comment">%     %delay{channel}=10;</span>
0542 <span class="comment">%     time{channel}=0;%[1:sum(sum(a,2))];</span>
0543 <span class="comment">%     b=0;</span>
0544 <span class="comment">%     if channel&gt;=2</span>
0545 <span class="comment">%     shift=-max(sequence{channel}(:,1))+min((int{channel-1}))-1;</span>
0546 <span class="comment">%     end</span>
0547 <span class="comment">%     for J=1:size(sequence{channel},1)</span>
0548 <span class="comment">%         %int(delay)=0;</span>
0549 <span class="comment">%         time{channel}=[time{channel},delay{channel},delay{channel},delay{channel}+sequence{channel}(J,2),delay{channel}+sequence{channel}(J,2)];</span>
0550 <span class="comment">%         int{channel}(b+1)=shift;</span>
0551 <span class="comment">%         int{channel}(b+2)=shift;</span>
0552 <span class="comment">%         int{channel}(b+3)=sequence{channel}(J,1)+shift;</span>
0553 <span class="comment">%         int{channel}(b+4)=sequence{channel}(J,1)+shift;</span>
0554 <span class="comment">%         b=b+4;</span>
0555 <span class="comment">%         delay{channel}=delay{channel}+sequence{channel}(J,2)+sequence{channel}(J,3);</span>
0556 <span class="comment">%     end</span>
0557 <span class="comment">%     if channel==channel_Detect</span>
0558 <span class="comment">%         time{channel}=[time{channel},time{channel}(end)+sequence{channel}(end,2)+sequence{channel}(end,3)-2*pi*echoWidth];</span>
0559 <span class="comment">%         int{channel}(end+1)=0;int{channel}(end+1)=0;</span>
0560 <span class="comment">%         data{channel}=[time{channel}',int{channel}'];</span>
0561 <span class="comment">%         a=-2*pi*echoWidth:0.1:echoWidth*2*pi;</span>
0562 <span class="comment">%         f=(sin(a/echoWidth)./a);</span>
0563 <span class="comment">%         time{channel}=[time{channel},time{channel}(end)+2*pi*echoWidth+a,time{channel}(end)+2*pi*echoWidth+a(end)+10];</span>
0564 <span class="comment">%         int{channel}=[int{channel},f/max(f)*echoHeight,0];</span>
0565 <span class="comment">%         else</span>
0566 <span class="comment">%         int{channel}(end+1)=shift;</span>
0567 <span class="comment">%         int{channel}(end+1)=shift;</span>
0568 <span class="comment">%         time{channel}(end+1)=time{channel_Detect}(end);</span>
0569 <span class="comment">%         %time{channel}(end+1)=time{channel_Detect}(end);</span>
0570 <span class="comment">%     end</span>
0571 <span class="comment">%     figure(1); hold on; plot(time{channel},int{channel});</span>
0572 <span class="comment">% end</span>
0573 <span class="comment">% %plot(time,int);</span>
0574 
0575 <span class="comment">%% Select and clear axis</span>
0576 axes(handles.axes_pulses);
0577 cla;
0578 
0579 <span class="comment">%% Load tables</span>
0580 pulse_def = get(handles.tbl_pulses,<span class="string">'Data'</span>);
0581 delay_def = get(handles.tbl_delays,<span class="string">'Data'</span>);
0582 echo_def  = get(handles.tbl_echoes,<span class="string">'Data'</span>);
0583 
0584 <span class="comment">%% Pulses</span>
0585 
0586 <span class="comment">% Get number of pulses and channels</span>
0587 noPulses   = size(pulse_def,1);
0588 noChannels = max(str2double(pulse_def(:,1)));
0589 noDelays   = size(delay_def,1);
0590 
0591 <span class="comment">% Safety catch, if a new channel is added, then add a new line to the</span>
0592 <span class="comment">% delays table</span>
0593 <span class="keyword">if</span> noChannels &gt; noDelays
0594     
0595     <span class="comment">% Add new row to table with the channel number</span>
0596     set(handles.tbl_delays,<span class="string">'Data'</span>,<span class="keyword">...</span>
0597         [delay_def;{num2str(noChannels) <span class="string">'10'</span>}]);
0598     
0599     <span class="comment">% Reload the table data</span>
0600     delay_def = get(handles.tbl_delays,<span class="string">'Data'</span>);  
0601     
0602     noDelays   = size(delay_def,1);
0603 <span class="keyword">end</span>
0604 
0605 <span class="comment">% For each pulse pulse</span>
0606 <span class="keyword">for</span> k = 1:noPulses
0607     <span class="comment">%     sequence{str2double(pulse_def{k,1})}(k(k,1:3)) = ...</span>
0608     <span class="comment">%         [str2double(pulse_def{k,2}) ...</span>
0609     <span class="comment">%          str2double(pulse_def{k,3}) ...</span>
0610     <span class="comment">%          str2double(pulse_def{k,4})];</span>
0611     sequence{str2double(pulse_def{k,1})}(k,1) = str2double(pulse_def{k,3});
0612     sequence{str2double(pulse_def{k,1})}(k,2) = str2double(pulse_def{k,2});
0613     sequence{str2double(pulse_def{k,1})}(k,3) = str2double(pulse_def{k,4});
0614 <span class="keyword">end</span>
0615 
0616 <span class="comment">% Remove blank rows from sequence - NOT NEEDED</span>
0617 <span class="comment">% for k = 1:noChannels</span>
0618 <span class="comment">%     sequence{1,k}(all(sequence{1,k}==0,2),:)=[];</span>
0619 <span class="comment">% end</span>
0620 
0621 <span class="comment">%% Delays</span>
0622 
0623 <span class="keyword">for</span> k = 1:noDelays
0624    delay{str2double(delay_def{k,1})} = str2double(delay_def{k,2});
0625 <span class="keyword">end</span>
0626 
0627 
0628 <span class="comment">%% Echoes</span>
0629 
0630 <span class="comment">% Echo only in channel 1 in current version</span>
0631 channel_Detect=1;
0632 
0633 <span class="comment">% Future versions may have mutli echo support</span>
0634 <span class="comment">% for k = 1:noEchoes</span>
0635 echoWidth  = str2double(echo_def{1,1})/(2*pi);
0636 echoHeight = str2double(echo_def{1,2});
0637 echoShape  = str2double(echo_def{1,3});
0638 shift = 0;
0639 <span class="comment">% end</span>
0640 
0641 <span class="comment">%% Plotting</span>
0642 
0643 <span class="comment">% initialization of parameters</span>
0644 <span class="keyword">for</span> channel=1:size(sequence,2)
0645     <span class="comment">% delay{channel}=10;</span>
0646     time{channel}=0;<span class="comment">%[1:sum(sum(a,2))];</span>
0647     b=0;
0648     
0649     <span class="comment">% If multiple channels then a shift needs to occur to spread them</span>
0650     <span class="keyword">if</span> channel&gt;=2
0651         shift=-max(sequence{channel}(:,1))+min((int{channel-1}))-1;
0652     <span class="keyword">end</span>
0653     
0654     <span class="comment">% For each pulse in a channel, add it to the plot</span>
0655     <span class="keyword">for</span> J=1:size(sequence{channel},1)
0656         <span class="comment">%int(delay)=0;</span>
0657         time{channel}=[time{channel},delay{channel},delay{channel},delay{channel}+sequence{channel}(J,2),delay{channel}+sequence{channel}(J,2)];
0658         int{channel}(b+1)=shift;
0659         int{channel}(b+2)=shift;
0660         int{channel}(b+3)=sequence{channel}(J,1)+shift;
0661         int{channel}(b+4)=sequence{channel}(J,1)+shift;
0662         <span class="comment">% int{channel}(b+5)=shift;    % added so that int and time are same size</span>
0663         b=b+4;
0664         delay{channel}=delay{channel}+sequence{channel}(J,2)+sequence{channel}(J,3);
0665     <span class="keyword">end</span>
0666     
0667     <span class="comment">% If this channel has the echo, add echo to the end</span>
0668     <span class="keyword">if</span> channel==channel_Detect
0669         time{channel}=[time{channel},time{channel}(end)+sequence{channel}(<span class="keyword">end</span>,2)+sequence{channel}(<span class="keyword">end</span>,3)-2*pi*echoWidth];
0670         time{channel}=[time{channel},time{channel}(end)];
0671         int{channel}(end+1)=0;int{channel}(end+1)=0;
0672         int{channel}(end+1)=0;
0673         data{channel}=[time{channel}',int{channel}'];
0674         a=-2*pi*echoWidth:0.1:echoWidth*2*pi;
0675         f=(sin(a/echoWidth*echoShape)./a);
0676         time{channel}=[time{channel},time{channel}(end)+2*pi*echoWidth+a,time{channel}(end)+2*pi*echoWidth+a(end)+10];
0677         int{channel}=[int{channel},f/max(f)*echoHeight,0];
0678 
0679         
0680     <span class="comment">% Otherwise add baseline to that channel to match the echo time</span>
0681     <span class="keyword">else</span>
0682         int{channel}(end+1)=shift;
0683         int{channel}(end+1)=shift;
0684         time{channel}(end+1)=time{channel_Detect}(end);
0685         <span class="comment">%time{channel}(end+1)=time{channel_Detect}(end);</span>
0686     <span class="keyword">end</span>
0687     
0688     <span class="comment">% Plot the channel</span>
0689     hold on;
0690     plot(time{channel},int{channel});
0691 <span class="keyword">end</span>
0692 
0693 
0694 <span class="comment">%% Figure presentation</span>
0695 axis on;
0696 axis tight;
0697 
0698 ylims = get(gca,<span class="string">'YLim'</span>);
0699 ylim([ylims(1)*1.1 ylims(2)*1.1]);
0700 
0701 set(gca, <span class="string">'YTick'</span>, []);
0702 xlabel(<span class="string">'Time / ns'</span>);
0703 hold off;
0704 
0705</pre></div>
<hr><address>Generated on Tue 15-Apr-2014 15:10:31 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>