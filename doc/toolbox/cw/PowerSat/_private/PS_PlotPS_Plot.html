<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of PS_PlotPS_Plot</title>
  <meta name="keywords" content="PS_PlotPS_Plot">
  <meta name="description" content="PS_PLOTPS_Plot Plot the power saturation curves">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="../../../index.html">toolbox</a> &gt; <a href="../../index.html">cw</a> &gt; <a href="../index.html">PowerSat</a> &gt; <a href="index.html">_private</a> &gt; PS_PlotPS_Plot.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for toolbox/cw/PowerSat/_private&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>PS_PlotPS_Plot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>PS_PLOTPS_Plot Plot the power saturation curves</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function PS_PlotPS_Plot(handles,exp,color) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> PS_PLOTPS_Plot Plot the power saturation curves

 Syntax:  PS_PLOTPS(handles)

 Inputs:
    input1 - handles
               define the GUI area (ie gcf for PowerSat)

 Outputs:
    output1 - Power saturation curves plotted in PowerSat GUI

 Example: 
    see http://morganbye.net/PowerSat

 Other m-files required:
    PowerSat.m

 Subfunctions:         PS_PLOTPS_SCATTER
                       PS_PLOTPS_CURVES
                       PS_PLOTPS_SD
                       PS_PLOTPS_CALCULATEPOINTS

 MAT-files required:   none</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="PS_Plot1_Gaussian.html" class="code" title="function PS_Plot1_Gaussian(handles,Exp)">PS_Plot1_Gaussian</a>	PS_Plot1_Gaussian Use a Gaussian fitting model to fit the model high and</li><li><a href="PS_Plot1_GaussianDeriv.html" class="code" title="function PS_Plot1_GaussianDeriv(handles,Exp)">PS_Plot1_GaussianDeriv</a>	PS_PLOT1_GAUSSIAN Use a Gaussian fitting model to fit the model high</li><li><a href="PS_Plot1_Lorentzian.html" class="code" title="function PS_Plot1_Lorentzian(handles,Exp)">PS_Plot1_Lorentzian</a>	PS_PLOT1_LORENTZIAN Use a Lorentzian fitting model to fit the model high</li><li><a href="PS_Plot1_LorentzianDeriv.html" class="code" title="function PS_Plot1_LorentzianDeriv(handles,Exp)">PS_Plot1_LorentzianDeriv</a>	PS_PLOT1_LORENTZIAN Use a Lorentzian fitting model to fit the model high</li><li><a href="PS_PlotPS_CalculatePoints.html" class="code" title="function [sqrtPower , Y] = PS_PlotPS_CalculatePoints(handles,exp,x,y,mwPower,maxpeak,minpeak)">PS_PlotPS_CalculatePoints</a>	PS_PLOTPS Plot the power saturation curves</li><li><a href="PS_PlotPS_Curves.html" class="code" title="function PS_PlotPS_Curves(x,y,exp,color)">PS_PlotPS_Curves</a>	PS_PLOTPS_CURVES Calculates and plots the power saturation curves</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="PS_PlotPS.html" class="code" title="function PS_PlotPS(handles)">PS_PlotPS</a>	PS_PLOTPS Plot the power saturation curves</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function PS_PlotPS_Plot(handles,exp,color)</a>
0002 
0003 <span class="comment">% PS_PLOTPS_Plot Plot the power saturation curves</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Syntax:  PS_PLOTPS(handles)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Inputs:</span>
0008 <span class="comment">%    input1 - handles</span>
0009 <span class="comment">%               define the GUI area (ie gcf for PowerSat)</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Outputs:</span>
0012 <span class="comment">%    output1 - Power saturation curves plotted in PowerSat GUI</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% Example:</span>
0015 <span class="comment">%    see http://morganbye.net/PowerSat</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Other m-files required:</span>
0018 <span class="comment">%    PowerSat.m</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Subfunctions:         PS_PLOTPS_SCATTER</span>
0021 <span class="comment">%                       PS_PLOTPS_CURVES</span>
0022 <span class="comment">%                       PS_PLOTPS_SD</span>
0023 <span class="comment">%                       PS_PLOTPS_CALCULATEPOINTS</span>
0024 <span class="comment">%</span>
0025 <span class="comment">% MAT-files required:   none</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%</span>
0028 
0029 <span class="comment">%                                        _                             _</span>
0030 <span class="comment">%                                       | |                           | |</span>
0031 <span class="comment">%  _ __ ___   ___  _ __ __ _  __ _ _ __ | |__  _   _  ___   _ __   ___| |_</span>
0032 <span class="comment">% | '_ ` _ \ / _ \| '__/ _` |/ _` | '_ \| '_ \| | | |/ _ \ | '_ \ / _ \ __|</span>
0033 <span class="comment">% | | | | | | (_) | | | (_| | (_| | | | | |_) | |_| |  __/_| | | |  __/ |_</span>
0034 <span class="comment">% |_| |_| |_|\___/|_|  \__, |\__,_|_| |_|_.__/ \__, |\___(_)_| |_|\___|\__|</span>
0035 <span class="comment">%                       __/ |                   __/ |</span>
0036 <span class="comment">%                      |___/                   |___/</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%</span>
0039 <span class="comment">% M. Bye v12.8</span>
0040 <span class="comment">%</span>
0041 <span class="comment">% Author:       Morgan Bye</span>
0042 <span class="comment">% Work address: Henry Wellcome Unit for Biological EPR</span>
0043 <span class="comment">%               University of East Anglia</span>
0044 <span class="comment">%               NORWICH, UK</span>
0045 <span class="comment">% Email:        morgan.bye@uea.ac.uk</span>
0046 <span class="comment">% Website:      http://www.morganbye.net/PowerSat</span>
0047 <span class="comment">% Aug 2012;     Last revision: 15-August-2012</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% Version history:</span>
0050 <span class="comment">% Aug 12        &gt; Change from Gaussian tickbox to a fitting dropdown menu</span>
0051 <span class="comment">%                   for Lorentzian fitting</span>
0052 <span class="comment">%</span>
0053 <span class="comment">% Jul 12        &gt; Error check for Gaussian fitting added</span>
0054 <span class="comment">%</span>
0055 <span class="comment">% Jun 12        &gt; Switch introduced for handling of single file / folder of</span>
0056 <span class="comment">%                   files handling, as mwPower is in different locations</span>
0057 <span class="comment">%</span>
0058 <span class="comment">% Oct 11        &gt; Initial release</span>
0059 
0060 <span class="keyword">global</span> vars
0061 
0062 <span class="comment">% Error check: if file was loaded without fitting (single point), but has</span>
0063 <span class="comment">% now been changed to a fitting method then the dataset needs to be fitted</span>
0064 
0065 <span class="keyword">switch</span> get(handles.dropdown_fitting,<span class="string">'Value'</span>)
0066     
0067         <span class="comment">% GAUSSIAN</span>
0068     <span class="keyword">case</span> 1
0069         <span class="keyword">if</span> isfield(vars.(exp),<span class="string">'FitGaussian'</span>) == 0
0070             <a href="PS_Plot1_Gaussian.html" class="code" title="function PS_Plot1_Gaussian(handles,Exp)">PS_Plot1_Gaussian</a>(handles,exp);
0071         <span class="keyword">end</span>
0072         
0073         <span class="comment">% LORENTZIAN</span>
0074     <span class="keyword">case</span> 2
0075         <span class="keyword">if</span> isfield(vars.(exp),<span class="string">'FitLorentzian'</span>) == 0
0076             <a href="PS_Plot1_Lorentzian.html" class="code" title="function PS_Plot1_Lorentzian(handles,Exp)">PS_Plot1_Lorentzian</a>(handles,exp);
0077         <span class="keyword">end</span>
0078         
0079         <span class="comment">% SINGLE POINT</span>
0080     <span class="keyword">case</span> 3
0081         <span class="comment">% Do nothing</span>
0082         
0083         <span class="comment">% GAUSSIAN DERIVATIVE</span>
0084     <span class="keyword">case</span> 4
0085         <span class="keyword">if</span> isfield(vars.(exp),<span class="string">'FitGaussianDeriv'</span>) == 0
0086             <a href="PS_Plot1_GaussianDeriv.html" class="code" title="function PS_Plot1_GaussianDeriv(handles,Exp)">PS_Plot1_GaussianDeriv</a>(handles,exp);
0087         <span class="keyword">end</span>
0088         
0089         <span class="comment">% LORENTZIAN DERIVATIVE</span>
0090     <span class="keyword">case</span> 5
0091         <span class="keyword">if</span> isfield(vars.(exp),<span class="string">'FitLorentzianDeriv'</span>) == 0
0092             <a href="PS_Plot1_LorentzianDeriv.html" class="code" title="function PS_Plot1_LorentzianDeriv(handles,Exp)">PS_Plot1_LorentzianDeriv</a>(handles,exp);
0093         <span class="keyword">end</span>
0094 <span class="keyword">end</span>
0095 
0096 <span class="comment">% Calculate points first</span>
0097 <span class="keyword">try</span>
0098     <span class="keyword">switch</span> size(vars.(exp).x,2)
0099         <span class="comment">% For single file</span>
0100         <span class="keyword">case</span> 1
0101             [vars.(exp).sqrtPower,vars.(exp).Y] = <a href="PS_PlotPS_CalculatePoints.html" class="code" title="function [sqrtPower , Y] = PS_PlotPS_CalculatePoints(handles,exp,x,y,mwPower,maxpeak,minpeak)">PS_PlotPS_CalculatePoints</a>(<span class="keyword">...</span>
0102                 handles , <span class="keyword">...</span>
0103                 exp , <span class="keyword">...</span>
0104                 vars.(exp).x , <span class="keyword">...</span>
0105                 vars.(exp).y , <span class="keyword">...</span>
0106                 vars.(exp).info.z_axis , <span class="keyword">...</span>
0107                 str2num(get(handles.([<span class="string">'edit_'</span> exp <span class="string">'High'</span>]),<span class="string">'String'</span>)),<span class="keyword">...</span>
0108                 str2num(get(handles.([<span class="string">'edit_'</span> exp <span class="string">'Low'</span>]),<span class="string">'String'</span>)));
0109         
0110         <span class="comment">% For folder of files</span>
0111         <span class="keyword">otherwise</span>
0112             [vars.(exp).sqrtPower,vars.(exp).Y] = <a href="PS_PlotPS_CalculatePoints.html" class="code" title="function [sqrtPower , Y] = PS_PlotPS_CalculatePoints(handles,exp,x,y,mwPower,maxpeak,minpeak)">PS_PlotPS_CalculatePoints</a>(<span class="keyword">...</span>
0113                 handles , <span class="keyword">...</span>
0114                 exp , <span class="keyword">...</span>
0115                 vars.(exp).x , <span class="keyword">...</span>
0116                 vars.(exp).y , <span class="keyword">...</span>
0117                 vars.(exp).info.MWPW , <span class="keyword">...</span>
0118                 str2num(get(handles.([<span class="string">'edit_'</span> exp <span class="string">'High'</span>]),<span class="string">'String'</span>)),<span class="keyword">...</span>
0119                 str2num(get(handles.([<span class="string">'edit_'</span> exp <span class="string">'Low'</span>]),<span class="string">'String'</span>)));
0120     <span class="keyword">end</span>
0121     
0122     
0123 <span class="keyword">catch</span>
0124     error(<span class="string">'PowerSat:PS_PlotPS_Plot'</span>, <span class="keyword">...</span>
0125         [<span class="string">'A high and low peak value need to be selected for the Power '</span> <span class="keyword">...</span>
0126         <span class="string">'Saturation Curves to be plotted'</span>])
0127 <span class="keyword">end</span>
0128 
0129 <span class="comment">% Switch for errorbars checkbox. If off then plot a simple scatter</span>
0130 <span class="comment">% plot. If on then calculate the SD of each point and then plot.</span>
0131 
0132 <span class="keyword">switch</span> get(handles.checkbox_errorbars,<span class="string">'Value'</span>)
0133     <span class="keyword">case</span> 0
0134         scatter(vars.(exp).sqrtPower,vars.(exp).Y,<span class="keyword">...</span>
0135             <span class="string">'ok'</span>,<span class="string">'MarkerFaceColor'</span>, color,  <span class="string">'MarkerEdgeColor'</span>, color)
0136         
0137     <span class="keyword">case</span> 1
0138         
0139         <span class="comment">% v11.11 - below is the old way of calculating the error bars which shows</span>
0140         <span class="comment">% the error bar as the peak intensity relative to spectral noise.</span>
0141         
0142         <span class="comment">%         vars.(exp).SD = PS_SD(vars.(exp).y , 10);</span>
0143         <span class="comment">%</span>
0144         <span class="comment">%         vars.(exp).SD1 = vars.(exp).SD * str2num(get(handles.edit_SDs,'String'));</span>
0145         <span class="comment">%</span>
0146         <span class="comment">%         errorbar(vars.(exp).sqrtPower, vars.(exp).Y , vars.(exp).SD1, ...</span>
0147         <span class="comment">%             ['o' color],'MarkerFaceColor', color,  'MarkerEdgeColor', color);</span>
0148        
0149         <span class="comment">% v12.7 - The new error bars use the error from the fitting routine</span>
0150         
0151         <span class="comment">% Create a matrix of the same size as Y with the repeating value of P</span>
0152         P_error = repmat(vars.(exp).FitConfidence.P,1,numel(vars.(exp).Y));
0153         
0154         errorbar(vars.(exp).sqrtPower, vars.(exp).Y , P_error, <span class="keyword">...</span>
0155             [<span class="string">'o'</span> color],<span class="string">'MarkerFaceColor'</span>, color,  <span class="string">'MarkerEdgeColor'</span>, color);
0156         
0157 <span class="keyword">end</span>
0158 
0159 <span class="comment">% Calculate the fits. If the &quot;Fitting&quot; checkbox is off then the Curve</span>
0160 <span class="comment">% Fitting display boxes are returned as '-'. If box is ticked but the user</span>
0161 <span class="comment">% does not have the Curve Fitting Toolbox is not installed then</span>
0162 <span class="comment">% PS_PlotPS_Curves, catches the error and returns nothing. Otherwise the</span>
0163 <span class="comment">% curve is calculated and global variables are updated which are then read</span>
0164 <span class="comment">% into the CF boxes.</span>
0165 
0166 <span class="keyword">switch</span> get(handles.checkbox_PSfits,<span class="string">'Value'</span>)
0167     <span class="keyword">case</span> 0              <span class="comment">% No fit</span>
0168         set(handles.([<span class="string">'CF'</span> exp <span class="string">'P'</span>] ),<span class="string">'String'</span>,<span class="string">'-'</span>);
0169         set(handles.([<span class="string">'CF'</span> exp <span class="string">'PM'</span>]),<span class="string">'String'</span>,<span class="string">'-'</span>);
0170         set(handles.([<span class="string">'CF'</span> exp <span class="string">'A'</span>] ),<span class="string">'String'</span>,<span class="string">'-'</span>);
0171         set(handles.([<span class="string">'CF'</span> exp <span class="string">'B'</span>] ),<span class="string">'String'</span>,<span class="string">'-'</span>);
0172         
0173     <span class="keyword">case</span> 1              <span class="comment">% Calculate fits and update display</span>
0174         <span class="keyword">try</span>
0175             <a href="PS_PlotPS_Curves.html" class="code" title="function PS_PlotPS_Curves(x,y,exp,color)">PS_PlotPS_Curves</a>(vars.(exp).sqrtPower , vars.(exp).Y, exp , color);
0176         <span class="keyword">catch</span>
0177             warndlg(<span class="string">'The Curve Fitting Toolbox could not be accessed, make sure it is installed and on the active path. Otherwise, deselect &quot;Fitting&quot;.'</span>,<span class="string">'Curve Fitting Toolbox'</span>)
0178             <span class="keyword">return</span>
0179         <span class="keyword">end</span>
0180         
0181         set(handles.([<span class="string">'CF'</span> exp <span class="string">'P'</span>] ),<span class="string">'String'</span>,num2str(vars.(exp).FitResults.P   ,<span class="string">'%2.4f'</span>));
0182         set(handles.([<span class="string">'CF'</span> exp <span class="string">'PM'</span>]),<span class="string">'String'</span>,num2str(vars.(exp).FitConfidence.P,<span class="string">'%2.4f'</span>));
0183         set(handles.([<span class="string">'CF'</span> exp <span class="string">'A'</span>] ),<span class="string">'String'</span>,num2str(vars.(exp).FitResults.A   ,<span class="string">'%2.4f'</span>));
0184         set(handles.([<span class="string">'CF'</span> exp <span class="string">'B'</span>] ),<span class="string">'String'</span>,num2str(vars.(exp).FitResults.B   ,<span class="string">'%2.4f'</span>));
0185 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 25-Oct-2012 18:03:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>