<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of EasyRefiner</title>
  <meta name="keywords" content="EasyRefiner">
  <meta name="description" content="EASYREFINER a simple GUI interface for refining EasySpin simulations">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">misc</a> &gt; EasyRefiner.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for misc&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>EasyRefiner
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>EASYREFINER a simple GUI interface for refining EasySpin simulations</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = EasyRefiner(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> EASYREFINER a simple GUI interface for refining EasySpin simulations

   EASYREFINER takes a file or folders of files and queues them for
       fitting with EasySpin (easyspin.org).

       Furthermore it allows for rough initial parameters to be used and
       the best fit results to be put back into EasySpin with finer search
       parameters to get the best possible fit.

       Results are automatically calculated, saved, logged and formatted
       for easy plotting.

 Syntax:  EASYREFINER

 Inputs:
    input1     - n/a

 Outputs:
    output1    - n/a

 Example: 
    see http://morganbye.net/eprtoolbox/easyrefiner

 Other m-files required:   BrukerRead

 Subfunctions:             n/a

 MAT-files required:       none

 To-do list:               


 See also: EASYSPIN <a href="BrukerRead.html" class="code" title="function varargout = BrukerRead(varargin)">BRUKERREAD</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="BrukerRead.html" class="code" title="function varargout = BrukerRead(varargin)">BrukerRead</a>	BRUKERREAD Open Bruker BE3ST files (.DTA / .DSC , .spc / .par) into the</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function EasyRefiner_OpeningFcn(hObject, eventdata, handles, varargin)</a></li><li><a href="#_sub2" class="code">function figure1_CloseRequestFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub3" class="code">function varargout = EasyRefiner_OutputFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub4" class="code">function button_loadFile_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub5" class="code">function button_loadFolder_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub6" class="code">function listbox_files_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub7" class="code">function listbox_files_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub8" class="code">function edit_system_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub9" class="code">function edit_system_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub10" class="code">function popupmenu_defaults_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub11" class="code">function popupmenu_defaults_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub12" class="code">function button_systemLoad_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub13" class="code">function edit_exp_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub14" class="code">function edit_exp_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub15" class="code">function button_expHelp_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub16" class="code">function button_output_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub17" class="code">function edit_outputAddress_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub18" class="code">function edit_outputAddress_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub19" class="code">function checkbox_figureOpen_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub20" class="code">function checkbox_figureSave_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub21" class="code">function checkbox_delay_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub22" class="code">function checkbox_log_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub23" class="code">function edit_delay_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub24" class="code">function edit_delay_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub25" class="code">function popupmenu_esFitting_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub26" class="code">function popupmenu_esFitting_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub27" class="code">function popupmenu_esFitMethod_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub28" class="code">function popupmenu_esFitMethod_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub29" class="code">function edit_opt_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub30" class="code">function edit_opt_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub31" class="code">function edit_var1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub32" class="code">function edit_var1_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub33" class="code">function checkbox_var1_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub34" class="code">function edit_var2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub35" class="code">function edit_var2_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub36" class="code">function checkbox_var2_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub37" class="code">function edit_var3_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub38" class="code">function edit_var3_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub39" class="code">function checkbox_var3_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub40" class="code">function edit_info_Callback(hObject, eventdata, handles)</a></li><li><a href="#_sub41" class="code">function edit_info_CreateFcn(hObject, eventdata, handles)</a></li><li><a href="#_sub42" class="code">function defaultSelection(hObject, eventdata, handles)</a></li><li><a href="#_sub43" class="code">function button_RUN_Callback(hObject, eventdata, handles)</a></li></ul>
<h2><a name="_download"></a>DOWNLOAD <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<p><a href="EasyRefiner.m">EasyRefiner.m</a></p>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = EasyRefiner(varargin)</a>
0002 
0003 <span class="comment">% EASYREFINER a simple GUI interface for refining EasySpin simulations</span>
0004 <span class="comment">%</span>
0005 <span class="comment">%   EASYREFINER takes a file or folders of files and queues them for</span>
0006 <span class="comment">%       fitting with EasySpin (easyspin.org).</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%       Furthermore it allows for rough initial parameters to be used and</span>
0009 <span class="comment">%       the best fit results to be put back into EasySpin with finer search</span>
0010 <span class="comment">%       parameters to get the best possible fit.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%       Results are automatically calculated, saved, logged and formatted</span>
0013 <span class="comment">%       for easy plotting.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Syntax:  EASYREFINER</span>
0016 <span class="comment">%</span>
0017 <span class="comment">% Inputs:</span>
0018 <span class="comment">%    input1     - n/a</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% Outputs:</span>
0021 <span class="comment">%    output1    - n/a</span>
0022 <span class="comment">%</span>
0023 <span class="comment">% Example:</span>
0024 <span class="comment">%    see http://morganbye.net/eprtoolbox/easyrefiner</span>
0025 <span class="comment">%</span>
0026 <span class="comment">% Other m-files required:   BrukerRead</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% Subfunctions:             n/a</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% MAT-files required:       none</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% To-do list:</span>
0033 <span class="comment">%</span>
0034 <span class="comment">%</span>
0035 <span class="comment">% See also: EASYSPIN BRUKERREAD</span>
0036 
0037 <span class="comment">%                                        _                             _</span>
0038 <span class="comment">%                                       | |                           | |</span>
0039 <span class="comment">%  _ __ ___   ___  _ __ __ _  __ _ _ __ | |__  _   _  ___   _ __   ___| |_</span>
0040 <span class="comment">% | '_ ` _ \ / _ \| '__/ _` |/ _` | '_ \| '_ \| | | |/ _ \ | '_ \ / _ \ __|</span>
0041 <span class="comment">% | | | | | | (_) | | | (_| | (_| | | | | |_) | |_| |  __/_| | | |  __/ |_</span>
0042 <span class="comment">% |_| |_| |_|\___/|_|  \__, |\__,_|_| |_|_.__/ \__, |\___(_)_| |_|\___|\__|</span>
0043 <span class="comment">%                       __/ |                   __/ |</span>
0044 <span class="comment">%                      |___/                   |___/</span>
0045 <span class="comment">%</span>
0046 <span class="comment">%</span>
0047 <span class="comment">% M. Bye v13.02</span>
0048 <span class="comment">%</span>
0049 <span class="comment">% Author:       Morgan Bye</span>
0050 <span class="comment">% Work address: Henry Wellcome Unit for Biological EPR</span>
0051 <span class="comment">%               University of East Anglia</span>
0052 <span class="comment">%               NORWICH, UK</span>
0053 <span class="comment">% Email:        morgan.bye@uea.ac.uk</span>
0054 <span class="comment">% Website:      http://www.morganbye.net/eprtoolbox/cwviewer</span>
0055 <span class="comment">% Feb 2013;     Last revision: 03-February-2013</span>
0056 <span class="comment">%</span>
0057 <span class="comment">% Approximate coding time of file:</span>
0058 <span class="comment">%               1 hours</span>
0059 <span class="comment">%</span>
0060 <span class="comment">%</span>
0061 <span class="comment">% Version history:</span>
0062 <span class="comment">% Feb 13        Initial release</span>
0063 
0064 <span class="comment">% Edit the above text to modify the response to help EasyRefiner</span>
0065 
0066 <span class="comment">% Last Modified by GUIDE v2.5 06-Feb-2013 09:21:15</span>
0067 
0068 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0069 gui_Singleton = 1;
0070 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0071                    <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0072                    <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction EasyRefiner_OpeningFcn(hObject, eventdata, handles, varargin)">EasyRefiner_OpeningFcn</a>, <span class="keyword">...</span>
0073                    <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub3" class="code" title="subfunction varargout = EasyRefiner_OutputFcn(hObject, eventdata, handles)">EasyRefiner_OutputFcn</a>, <span class="keyword">...</span>
0074                    <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0075                    <span class="string">'gui_Callback'</span>,   []);
0076 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0077     gui_State.gui_Callback = str2func(varargin{1});
0078 <span class="keyword">end</span>
0079 
0080 <span class="keyword">if</span> nargout
0081     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0082 <span class="keyword">else</span>
0083     gui_mainfcn(gui_State, varargin{:});
0084 <span class="keyword">end</span>
0085 <span class="comment">% End initialization code - DO NOT EDIT</span>
0086 
0087 
0088 <span class="comment">% --- Executes just before EasyRefiner is made visible.</span>
0089 <a name="_sub1" href="#_subfunctions" class="code">function EasyRefiner_OpeningFcn(hObject, eventdata, handles, varargin)</a>
0090 <span class="comment">% This function has no output args, see OutputFcn.</span>
0091 <span class="comment">% hObject    handle to figure</span>
0092 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0093 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0094 <span class="comment">% varargin   command line arguments to EasyRefiner (see VARARGIN)</span>
0095 
0096 <span class="comment">% Choose default command line output for EasyRefiner</span>
0097 handles.output = hObject;
0098 
0099 <span class="comment">% Update handles structure</span>
0100 guidata(hObject, handles);
0101 
0102 <span class="comment">% Name the window</span>
0103 set(gcf,<span class="string">'Name'</span>,<span class="string">'EasyRefiner - v13.02'</span>);
0104 
0105 <span class="comment">% Update output location edit box to current folder</span>
0106 set(handles.edit_outputAddress,<span class="string">'String'</span>,pwd);
0107 set(handles.edit_outputAddress,<span class="string">'Tooltipstring'</span>,pwd);
0108 
0109 <span class="comment">% Set edit boxes to accept multiline input</span>
0110 set(handles.edit_system,<span class="string">'Max'</span>,2);
0111 set(handles.edit_exp ,<span class="string">'Max'</span>,2);
0112 set(handles.edit_opt ,<span class="string">'Max'</span>,2);
0113 set(handles.edit_var1,<span class="string">'Max'</span>,2);
0114 set(handles.edit_var2,<span class="string">'Max'</span>,2);
0115 set(handles.edit_var3,<span class="string">'Max'</span>,2);
0116 set(handles.edit_info,<span class="string">'Max'</span>,2);
0117 
0118 <span class="comment">% Create global variable</span>
0119 <span class="keyword">global</span> ER;
0120 
0121 <span class="comment">% --- Executes when user attempts to close figure1.</span>
0122 <a name="_sub2" href="#_subfunctions" class="code">function figure1_CloseRequestFcn(hObject, eventdata, handles)</a>
0123 
0124 <span class="comment">% Hint: delete(hObject) closes the figure</span>
0125 delete(hObject);
0126 
0127 <span class="comment">% Clear global variable, else files wont clear if ER is reopened</span>
0128 clear <span class="keyword">global</span> ER
0129 
0130 
0131 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0132 <a name="_sub3" href="#_subfunctions" class="code">function varargout = EasyRefiner_OutputFcn(hObject, eventdata, handles) </a>
0133 <span class="comment">% varargout  cell array for returning output args (see VARARGOUT);</span>
0134 <span class="comment">% hObject    handle to figure</span>
0135 <span class="comment">% eventdata  reserved - to be defined in a future version of MATLAB</span>
0136 <span class="comment">% handles    structure with handles and user data (see GUIDATA)</span>
0137 
0138 <span class="comment">% Get default command line output from handles structure</span>
0139 varargout{1} = handles.output;
0140 
0141 <span class="comment">% oooooooooooo  o8o  oooo</span>
0142 <span class="comment">% `888'     `8  `&quot;'  `888</span>
0143 <span class="comment">%  888         oooo   888   .ooooo.   .oooo.o</span>
0144 <span class="comment">%  888oooo8    `888   888  d88' `88b d88(  &quot;8</span>
0145 <span class="comment">%  888    &quot;     888   888  888ooo888 `&quot;Y88b.</span>
0146 <span class="comment">%  888          888   888  888    .o o.  )88b</span>
0147 <span class="comment">% o888o        o888o o888o `Y8bod8P' 8&quot;&quot;888P'</span>
0148 
0149 
0150 <span class="comment">% --- Executes on button press in button_loadFile.</span>
0151 <a name="_sub4" href="#_subfunctions" class="code">function button_loadFile_Callback(hObject, eventdata, handles)</a>
0152 
0153 <span class="keyword">global</span> ER
0154 
0155 <span class="keyword">try</span>
0156     ER.fileNum = size(fieldnames(ER.data),1) +1;
0157 <span class="keyword">catch</span>
0158     ER.fileNum = 1;
0159 <span class="keyword">end</span>
0160 
0161 <span class="comment">% Load the file</span>
0162 [x , y , info] = <a href="BrukerRead.html" class="code" title="function varargout = BrukerRead(varargin)">BrukerRead</a>;
0163 
0164 <span class="comment">% Move the file to data structure</span>
0165 ER.data.([<span class="string">'File'</span> mat2str(ER.fileNum)]).x = x;
0166 ER.data.([<span class="string">'File'</span> mat2str(ER.fileNum)]).y = y;
0167 ER.data.([<span class="string">'File'</span> mat2str(ER.fileNum)]).info = info;
0168 
0169 <span class="comment">% Get string in File Details window listbox</span>
0170 files = get(handles.listbox_files,<span class="string">'String'</span>);
0171 
0172 <span class="comment">% See if files have been listed previously</span>
0173 <span class="keyword">if</span> strcmp(files , <span class="string">'-- No file loaded --'</span>)
0174     files = [<span class="string">'1: '</span> , regexprep(info.TITL , <span class="string">''''</span>,<span class="string">''</span>)];
0175     files = sscanf(files,<span class="string">'%c'</span>,25);      <span class="comment">% Cuts down to 25 characters</span>
0176     files = sprintf(<span class="string">'%-25s'</span>,files);     <span class="comment">% Makes up to 25 characters</span>
0177     
0178     <span class="comment">% Write out new string to File Details listbox</span>
0179     set(handles.listbox_files,<span class="string">'String'</span>,files)
0180     
0181     <span class="comment">% Change focus of listbox to the new file</span>
0182     set(handles.listbox_files,<span class="string">'Value'</span>, 1)
0183 
0184 <span class="comment">% If previous file then get string, add new string title to a new line</span>
0185 <span class="keyword">else</span>
0186     Num = mat2str(ER.fileNum);
0187     next_line = [Num , <span class="string">': '</span> , regexprep(info.TITL , <span class="string">''''</span>,<span class="string">''</span>)];
0188     next_formated = sscanf(next_line,<span class="string">'%c'</span>,25);
0189     next_formated = sprintf(<span class="string">'%-25s'</span>,next_formated);
0190     files = [files ; next_formated];
0191     
0192     <span class="comment">% Write out new string to File Details listbox</span>
0193     set(handles.listbox_files,<span class="string">'String'</span>,files)
0194     
0195     <span class="comment">% Change focus of listbox to the new file</span>
0196     set(handles.listbox_files,<span class="string">'Value'</span>, str2num(Num));
0197 
0198 <span class="keyword">end</span>
0199 
0200 ER.files = files;
0201 
0202 
0203 <span class="comment">% --- Executes on button press in button_loadFolder.</span>
0204 <a name="_sub5" href="#_subfunctions" class="code">function button_loadFolder_Callback(hObject, eventdata, handles)</a>
0205 
0206 <span class="keyword">global</span> ER
0207 
0208 <span class="comment">% Find all the spectra</span>
0209 folder = uigetdir;
0210 dtaFiles = dir([folder <span class="string">'/*.DTA'</span>]);
0211 
0212 <span class="keyword">if</span> numel(dtaFiles) ~= 0
0213     <span class="keyword">for</span> k=1:numel(dtaFiles)
0214                 
0215         <span class="comment">% Set file number for file</span>
0216         <span class="keyword">try</span>
0217             ER.fileNum = size(fieldnames(ER.data),1) +1;
0218         <span class="keyword">catch</span>
0219             ER.fileNum = 1;
0220         <span class="keyword">end</span>
0221         
0222         <span class="comment">% Load the file</span>
0223         [x , y , info] = <a href="BrukerRead.html" class="code" title="function varargout = BrukerRead(varargin)">BrukerRead</a>([folder <span class="string">'/'</span> dtaFiles(k).name]);
0224         
0225         <span class="comment">% Move the file to data structure</span>
0226         ER.data.([<span class="string">'File'</span> mat2str(ER.fileNum)]).x = x;
0227         ER.data.([<span class="string">'File'</span> mat2str(ER.fileNum)]).y = y;
0228         ER.data.([<span class="string">'File'</span> mat2str(ER.fileNum)]).info = info;
0229         
0230         <span class="comment">% Get string in File Details window listbox</span>
0231         files = get(handles.listbox_files,<span class="string">'String'</span>);
0232         
0233         <span class="comment">% See if files have been listed previously</span>
0234         <span class="keyword">if</span> strcmp(files , <span class="string">'-- No file loaded --'</span>)
0235             files = [<span class="string">'1: '</span> , regexprep(info.TITL , <span class="string">''''</span>,<span class="string">''</span>)];
0236             files = sscanf(files,<span class="string">'%c'</span>,25);      <span class="comment">% Cuts down to 25 characters</span>
0237             files = sprintf(<span class="string">'%-25s'</span>,files);     <span class="comment">% Makes up to 25 characters</span>
0238             
0239             <span class="comment">% Write out new string to File Details listbox</span>
0240             set(handles.listbox_files,<span class="string">'String'</span>,files)
0241             
0242             <span class="comment">% If previous file then get string, add new string title to a new line</span>
0243         <span class="keyword">else</span>
0244             Num = mat2str(ER.fileNum);
0245             next_line = [Num , <span class="string">': '</span> , regexprep(info.TITL , <span class="string">''''</span>,<span class="string">''</span>)];
0246             next_formated = sscanf(next_line,<span class="string">'%c'</span>,25);
0247             next_formated = sprintf(<span class="string">'%-25s'</span>,next_formated);
0248             files = [files ; next_formated];
0249             
0250             <span class="comment">% Write out new string to File Details listbox</span>
0251             set(handles.listbox_files,<span class="string">'String'</span>,files)
0252                         
0253         <span class="keyword">end</span>
0254     <span class="keyword">end</span>
0255     
0256     <span class="comment">% Change focus of listbox to the new file</span>
0257     set(handles.listbox_files,<span class="string">'Value'</span>, ER.fileNum);
0258     
0259 <span class="keyword">else</span>
0260     msgbox(<span class="string">'No .DTA files could be found in that folder!'</span>,<span class="string">'Folder load error'</span>,<span class="string">'warn'</span>);
0261 <span class="keyword">end</span>
0262 
0263 
0264 <span class="comment">% --- Executes on selection change in listbox_files.</span>
0265 <a name="_sub6" href="#_subfunctions" class="code">function listbox_files_Callback(hObject, eventdata, handles)</a>
0266 
0267 
0268 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0269 <a name="_sub7" href="#_subfunctions" class="code">function listbox_files_CreateFcn(hObject, eventdata, handles)</a>
0270 
0271 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0272     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0273 <span class="keyword">end</span>
0274 
0275 <span class="comment">%  .oooooo..o                          .</span>
0276 <span class="comment">% d8P'    `Y8                        .o8</span>
0277 <span class="comment">% Y88bo.      oooo    ooo  .oooo.o .o888oo  .ooooo.  ooo. .oo.  .oo.</span>
0278 <span class="comment">%  `&quot;Y8888o.   `88.  .8'  d88(  &quot;8   888   d88' `88b `888P&quot;Y88bP&quot;Y88b</span>
0279 <span class="comment">%      `&quot;Y88b   `88..8'   `&quot;Y88b.    888   888ooo888  888   888   888</span>
0280 <span class="comment">% oo     .d8P    `888'    o.  )88b   888 . 888    .o  888   888   888</span>
0281 <span class="comment">% 8&quot;&quot;88888P'      .8'     8&quot;&quot;888P'   &quot;888&quot; `Y8bod8P' o888o o888o o888o</span>
0282 <span class="comment">%             .o..P'</span>
0283 <span class="comment">%             `Y8P'</span>
0284 
0285 <span class="comment">% --- Executes on selection change in edit_system.</span>
0286 <a name="_sub8" href="#_subfunctions" class="code">function edit_system_Callback(hObject, eventdata, handles)</a>
0287 
0288 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0289 <a name="_sub9" href="#_subfunctions" class="code">function edit_system_CreateFcn(hObject, eventdata, handles)</a>
0290 
0291 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0292     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0293 <span class="keyword">end</span>
0294 
0295 
0296 
0297 <span class="comment">% --- Executes on selection change in popupmenu_defaults.</span>
0298 <a name="_sub10" href="#_subfunctions" class="code">function popupmenu_defaults_Callback(hObject, eventdata, handles)</a>
0299 
0300 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0301 <a name="_sub11" href="#_subfunctions" class="code">function popupmenu_defaults_CreateFcn(hObject, eventdata, handles)</a>
0302 
0303 
0304 <span class="comment">% Hint: popupmenu controls usually have a white background on Windows.</span>
0305 <span class="comment">%       See ISPC and COMPUTER.</span>
0306 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0307     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0308 <span class="keyword">end</span>
0309 
0310 <span class="comment">% --- Executes on button press in button_systemLoad.</span>
0311 <a name="_sub12" href="#_subfunctions" class="code">function button_systemLoad_Callback(hObject, eventdata, handles)</a>
0312 
0313 <a href="#_sub42" class="code" title="subfunction defaultSelection(hObject, eventdata, handles)">defaultSelection</a>(hObject, eventdata, handles);
0314 
0315 
0316 <span class="comment">% oooooooooooo                                            o8o</span>
0317 <span class="comment">% `888'     `8                                            `&quot;'</span>
0318 <span class="comment">%  888         oooo    ooo oo.ooooo.   .ooooo.  oooo d8b oooo</span>
0319 <span class="comment">%  888oooo8     `88b..8P'   888' `88b d88' `88b `888&quot;&quot;8P `888</span>
0320 <span class="comment">%  888    &quot;       Y888'     888   888 888ooo888  888      888</span>
0321 <span class="comment">%  888       o  .o8&quot;'88b    888   888 888    .o  888      888</span>
0322 <span class="comment">% o888ooooood8 o88'   888o  888bod8P' `Y8bod8P' d888b    o888o</span>
0323 <span class="comment">%                           888</span>
0324 <span class="comment">%                          o888o</span>
0325 
0326 <span class="comment">% --- Executes on selection change in edit_exp.</span>
0327 <a name="_sub13" href="#_subfunctions" class="code">function edit_exp_Callback(hObject, eventdata, handles)</a>
0328 
0329 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0330 <a name="_sub14" href="#_subfunctions" class="code">function edit_exp_CreateFcn(hObject, eventdata, handles)</a>
0331 
0332 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0333     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0334 <span class="keyword">end</span>
0335 
0336 
0337 <span class="comment">% --- Executes on button press in button_expHelp.</span>
0338 <a name="_sub15" href="#_subfunctions" class="code">function button_expHelp_Callback(hObject, eventdata, handles)</a>
0339 
0340 msgbox(sprintf(<span class="string">'Experiment does not need field or frequency information as this will be automatically taken from the .DSC files\n\nYou must use Exp as the variable name'</span>)<span class="keyword">...</span>
0341     ,<span class="string">'Experiment help'</span>);
0342 
0343 
0344 <span class="comment">%</span>
0345 <span class="comment">%   .oooooo.                  .    o8o</span>
0346 <span class="comment">%  d8P'  `Y8b               .o8    `&quot;'</span>
0347 <span class="comment">% 888      888 oo.ooooo.  .o888oo oooo   .ooooo.  ooo. .oo.    .oooo.o</span>
0348 <span class="comment">% 888      888  888' `88b   888   `888  d88' `88b `888P&quot;Y88b  d88(  &quot;8</span>
0349 <span class="comment">% 888      888  888   888   888    888  888   888  888   888  `&quot;Y88b.</span>
0350 <span class="comment">% `88b    d88'  888   888   888 .  888  888   888  888   888  o.  )88b</span>
0351 <span class="comment">%  `Y8bood8P'   888bod8P'   &quot;888&quot; o888o `Y8bod8P' o888o o888o 8&quot;&quot;888P'</span>
0352 <span class="comment">%               888</span>
0353 <span class="comment">%              o888o</span>
0354 <span class="comment">%</span>
0355 
0356 <span class="comment">% --- Executes on button press in button_output.</span>
0357 <a name="_sub16" href="#_subfunctions" class="code">function button_output_Callback(hObject, eventdata, handles)</a>
0358 
0359 path = uigetdir(get(handles.edit_outputAddress,<span class="string">'String'</span>),<span class="string">'EasyRefiner: Load folder'</span>);
0360 set(handles.edit_outputAddress,<span class="string">'String'</span>,path);
0361 
0362 
0363 <a name="_sub17" href="#_subfunctions" class="code">function edit_outputAddress_Callback(hObject, eventdata, handles)</a>
0364 
0365 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0366 <a name="_sub18" href="#_subfunctions" class="code">function edit_outputAddress_CreateFcn(hObject, eventdata, handles)</a>
0367 
0368 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0369     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0370 <span class="keyword">end</span>
0371 
0372 <span class="comment">% --- Executes on button press in checkbox_figureOpen.</span>
0373 <a name="_sub19" href="#_subfunctions" class="code">function checkbox_figureOpen_Callback(hObject, eventdata, handles)</a>
0374 
0375 <span class="keyword">switch</span> get(handles.checkbox_figureOpen,<span class="string">'Value'</span>)
0376     <span class="keyword">case</span> 0
0377         <span class="comment">% Do nothing</span>
0378     <span class="keyword">case</span> 1
0379         set(handles.checkbox_figureSave,<span class="string">'Value'</span>,1);
0380 <span class="keyword">end</span>
0381 
0382 
0383 
0384 <span class="comment">% --- Executes on button press in checkbox_figureSave.</span>
0385 <a name="_sub20" href="#_subfunctions" class="code">function checkbox_figureSave_Callback(hObject, eventdata, handles)</a>
0386 
0387 
0388 <span class="comment">% --- Executes on button press in checkbox_delay.</span>
0389 <a name="_sub21" href="#_subfunctions" class="code">function checkbox_delay_Callback(hObject, eventdata, handles)</a>
0390 
0391 
0392 <span class="comment">% --- Executes on button press in checkbox_log.</span>
0393 <a name="_sub22" href="#_subfunctions" class="code">function checkbox_log_Callback(hObject, eventdata, handles)</a>
0394 
0395 
0396 <a name="_sub23" href="#_subfunctions" class="code">function edit_delay_Callback(hObject, eventdata, handles)</a>
0397 
0398 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0399 <a name="_sub24" href="#_subfunctions" class="code">function edit_delay_CreateFcn(hObject, eventdata, handles)</a>
0400 
0401 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0402     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0403 <span class="keyword">end</span>
0404 
0405 <span class="comment">% --- Executes on selection change in popupmenu_esFitting.</span>
0406 <a name="_sub25" href="#_subfunctions" class="code">function popupmenu_esFitting_Callback(hObject, eventdata, handles)</a>
0407 
0408 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0409 <a name="_sub26" href="#_subfunctions" class="code">function popupmenu_esFitting_CreateFcn(hObject, eventdata, handles)</a>
0410 
0411 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0412     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0413 <span class="keyword">end</span>
0414 
0415 
0416 <span class="comment">% --- Executes on selection change in popupmenu_esFitMethod.</span>
0417 <a name="_sub27" href="#_subfunctions" class="code">function popupmenu_esFitMethod_Callback(hObject, eventdata, handles)</a>
0418 
0419 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0420 <a name="_sub28" href="#_subfunctions" class="code">function popupmenu_esFitMethod_CreateFcn(hObject, eventdata, handles)</a>
0421 
0422 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0423     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0424 <span class="keyword">end</span>
0425 
0426 <a name="_sub29" href="#_subfunctions" class="code">function edit_opt_Callback(hObject, eventdata, handles)</a>
0427 
0428 
0429 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0430 <a name="_sub30" href="#_subfunctions" class="code">function edit_opt_CreateFcn(hObject, eventdata, handles)</a>
0431 
0432 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0433     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0434 <span class="keyword">end</span>
0435 
0436 
0437 <span class="comment">% oooooo     oooo                           .o</span>
0438 <span class="comment">%  `888.     .8'                          o888</span>
0439 <span class="comment">%   `888.   .8'    .oooo.   oooo d8b       888</span>
0440 <span class="comment">%    `888. .8'    `P  )88b  `888&quot;&quot;8P       888</span>
0441 <span class="comment">%     `888.8'      .oP&quot;888   888           888</span>
0442 <span class="comment">%      `888'      d8(  888   888           888</span>
0443 <span class="comment">%       `8'       `Y888&quot;&quot;8o d888b         o888o</span>
0444 <span class="comment">%</span>
0445 
0446 <span class="comment">% --- Executes on selection change in edit_var1.</span>
0447 <a name="_sub31" href="#_subfunctions" class="code">function edit_var1_Callback(hObject, eventdata, handles)</a>
0448 
0449 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0450 <a name="_sub32" href="#_subfunctions" class="code">function edit_var1_CreateFcn(hObject, eventdata, handles)</a>
0451 
0452 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0453     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0454 <span class="keyword">end</span>
0455 
0456 <span class="comment">% --- Executes on button press in checkbox_var1.</span>
0457 <a name="_sub33" href="#_subfunctions" class="code">function checkbox_var1_Callback(hObject, eventdata, handles)</a>
0458 
0459 <span class="keyword">switch</span> get(handles.checkbox_var1,<span class="string">'Value'</span>)
0460     <span class="keyword">case</span> 0
0461         set(handles.checkbox_var2,<span class="string">'Value'</span>,0);
0462         set(handles.checkbox_var3,<span class="string">'Value'</span>,0);
0463     <span class="keyword">case</span> 1
0464         
0465 <span class="keyword">end</span>
0466 
0467 <span class="comment">% oooooo     oooo                           .oooo.</span>
0468 <span class="comment">%  `888.     .8'                          .dP&quot;&quot;Y88b</span>
0469 <span class="comment">%   `888.   .8'    .oooo.   oooo d8b            ]8P'</span>
0470 <span class="comment">%    `888. .8'    `P  )88b  `888&quot;&quot;8P          .d8P'</span>
0471 <span class="comment">%     `888.8'      .oP&quot;888   888            .dP'</span>
0472 <span class="comment">%      `888'      d8(  888   888          .oP     .o</span>
0473 <span class="comment">%       `8'       `Y888&quot;&quot;8o d888b         8888888888</span>
0474 <span class="comment">%</span>
0475 
0476 <span class="comment">% --- Executes on selection change in edit_var2.</span>
0477 <a name="_sub34" href="#_subfunctions" class="code">function edit_var2_Callback(hObject, eventdata, handles)</a>
0478 
0479 
0480 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0481 <a name="_sub35" href="#_subfunctions" class="code">function edit_var2_CreateFcn(hObject, eventdata, handles)</a>
0482 
0483 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0484     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0485 <span class="keyword">end</span>
0486 
0487 <span class="comment">% --- Executes on button press in checkbox_var2.</span>
0488 <a name="_sub36" href="#_subfunctions" class="code">function checkbox_var2_Callback(hObject, eventdata, handles)</a>
0489 
0490 <span class="keyword">switch</span> get(handles.checkbox_var2,<span class="string">'Value'</span>)
0491     <span class="keyword">case</span> 0
0492         set(handles.checkbox_var3,<span class="string">'Value'</span>,0);
0493     <span class="keyword">case</span> 1
0494         set(handles.checkbox_var1,<span class="string">'Value'</span>,1);
0495 <span class="keyword">end</span>
0496 
0497 <span class="comment">% oooooo     oooo                           .oooo.</span>
0498 <span class="comment">%  `888.     .8'                          .dP&quot;&quot;Y88b</span>
0499 <span class="comment">%   `888.   .8'    .oooo.   oooo d8b            ]8P'</span>
0500 <span class="comment">%    `888. .8'    `P  )88b  `888&quot;&quot;8P          &lt;88b.</span>
0501 <span class="comment">%     `888.8'      .oP&quot;888   888               `88b.</span>
0502 <span class="comment">%      `888'      d8(  888   888          o.   .88P</span>
0503 <span class="comment">%       `8'       `Y888&quot;&quot;8o d888b         `8bd88P'</span>
0504 <span class="comment">%</span>
0505 
0506 <span class="comment">% --- Executes on selection change in edit_var3.</span>
0507 <a name="_sub37" href="#_subfunctions" class="code">function edit_var3_Callback(hObject, eventdata, handles)</a>
0508 
0509 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0510 <a name="_sub38" href="#_subfunctions" class="code">function edit_var3_CreateFcn(hObject, eventdata, handles)</a>
0511 
0512 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0513     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0514 <span class="keyword">end</span>
0515 
0516 <span class="comment">% --- Executes on button press in checkbox_var3.</span>
0517 <a name="_sub39" href="#_subfunctions" class="code">function checkbox_var3_Callback(hObject, eventdata, handles)</a>
0518 
0519 <span class="keyword">switch</span> get(handles.checkbox_var3,<span class="string">'Value'</span>)
0520     <span class="keyword">case</span> 0
0521         <span class="comment">% Do nothing</span>
0522     <span class="keyword">case</span> 1
0523         set(handles.checkbox_var1,<span class="string">'Value'</span>,1);
0524         set(handles.checkbox_var2,<span class="string">'Value'</span>,1);
0525 <span class="keyword">end</span>
0526 
0527 
0528 <span class="comment">% ooooo              .o88o.</span>
0529 <span class="comment">% `888'              888 `&quot;</span>
0530 <span class="comment">%  888  ooo. .oo.   o888oo   .ooooo.</span>
0531 <span class="comment">%  888  `888P&quot;Y88b   888    d88' `88b</span>
0532 <span class="comment">%  888   888   888   888    888   888</span>
0533 <span class="comment">%  888   888   888   888    888   888</span>
0534 <span class="comment">% o888o o888o o888o o888o   `Y8bod8P'</span>
0535 <span class="comment">%</span>
0536                                     
0537 <span class="comment">% --- Executes on selection change in edit_info.</span>
0538 <a name="_sub40" href="#_subfunctions" class="code">function edit_info_Callback(hObject, eventdata, handles)</a>
0539 
0540 <span class="comment">% --- Executes during object creation, after setting all properties.</span>
0541 <a name="_sub41" href="#_subfunctions" class="code">function edit_info_CreateFcn(hObject, eventdata, handles)</a>
0542 
0543 <span class="keyword">if</span> ispc &amp;&amp; isequal(get(hObject,<span class="string">'BackgroundColor'</span>), get(0,<span class="string">'defaultUicontrolBackgroundColor'</span>))
0544     set(hObject,<span class="string">'BackgroundColor'</span>,<span class="string">'white'</span>);
0545 <span class="keyword">end</span>
0546 
0547 <span class="comment">% oooooooooooo                                       .    o8o</span>
0548 <span class="comment">% `888'     `8                                     .o8    `&quot;'</span>
0549 <span class="comment">%  888         oooo  oooo  ooo. .oo.    .ooooo.  .o888oo oooo   .ooooo.  ooo. .oo.    .oooo.o</span>
0550 <span class="comment">%  888oooo8    `888  `888  `888P&quot;Y88b  d88' `&quot;Y8   888   `888  d88' `88b `888P&quot;Y88b  d88(  &quot;8</span>
0551 <span class="comment">%  888    &quot;     888   888   888   888  888         888    888  888   888  888   888  `&quot;Y88b.</span>
0552 <span class="comment">%  888          888   888   888   888  888   .o8   888 .  888  888   888  888   888  o.  )88b</span>
0553 <span class="comment">% o888o         `V88V&quot;V8P' o888o o888o `Y8bod8P'   &quot;888&quot; o888o `Y8bod8P' o888o o888o 8&quot;&quot;888P'</span>
0554                                                                                             
0555 
0556 <a name="_sub42" href="#_subfunctions" class="code">function defaultSelection(hObject, eventdata, handles)</a>
0557 
0558 <span class="comment">% Clear all edit boxes</span>
0559 set(handles.edit_system,<span class="string">'String'</span>,<span class="string">''</span>);
0560 set(handles.edit_exp ,<span class="string">'String'</span>,<span class="string">''</span>);
0561 set(handles.edit_var1,<span class="string">'String'</span>,<span class="string">''</span>);
0562 set(handles.edit_var2,<span class="string">'String'</span>,<span class="string">''</span>);
0563 set(handles.edit_var3,<span class="string">'String'</span>,<span class="string">''</span>);
0564 
0565 
0566 <span class="comment">% Get listbox</span>
0567 <span class="keyword">switch</span> get(handles.popupmenu_defaults,<span class="string">'Value'</span>)
0568     <span class="keyword">case</span> 1  <span class="comment">% Nitroxide</span>
0569         set(handles.edit_system,<span class="string">'String'</span>,[<span class="keyword">...</span>
0570         <span class="string">'Sys.g = [2.025 2.005 1.985];'</span>;<span class="keyword">...</span>
0571         <span class="string">'Sys.Nucs = ''14N'';           '</span>;<span class="keyword">...</span>
0572         <span class="string">'Sys.A = 45;                 '</span>;<span class="keyword">...</span>
0573         <span class="string">'Sys.n = 1;                  '</span>;<span class="keyword">...</span>
0574         <span class="string">'Sys.lwpp = 0.25;            '</span>]);
0575     
0576         set(handles.edit_var1,<span class="string">'String'</span>,[<span class="keyword">...</span>
0577         <span class="string">'Var.g = [0.005 0.005 0.005];'</span>;<span class="keyword">...</span>
0578         <span class="string">'Var.A = 0.5;                '</span>;<span class="keyword">...</span>
0579         <span class="string">'Var.lwpp = 0.05;            '</span>]);
0580     
0581         set(handles.edit_var2,<span class="string">'String'</span>,[<span class="keyword">...</span>
0582         <span class="string">'Var.g = [0.001 0.001 0.001];'</span>;<span class="keyword">...</span>
0583         <span class="string">'Var.A = 0.1;                '</span>;<span class="keyword">...</span>
0584         <span class="string">'Var.lwpp = 0.01;            '</span>]);
0585     
0586         set(handles.edit_var3,<span class="string">'String'</span>,[<span class="keyword">...</span>
0587         <span class="string">'Var.g = [0.0005 0.0005 0.0005];'</span>;<span class="keyword">...</span>
0588         <span class="string">'Var.A = 0.001;                 '</span>;<span class="keyword">...</span>
0589         <span class="string">'Var.lwpp = 0.001;              '</span>]);
0590     
0591     <span class="keyword">case</span> 2  <span class="comment">% Fremy's</span>
0592         set(handles.edit_system,<span class="string">'String'</span>,[<span class="keyword">...</span>
0593         <span class="string">'Sys.g = [2.00785 2.00590 2.00265];'</span>;<span class="keyword">...</span>
0594         <span class="string">'Sys.Nucs = ''14N'';                 '</span>;<span class="keyword">...</span>
0595         <span class="string">'Sys.A = [15.4137 14.0125 80.4316];'</span>;<span class="keyword">...</span>
0596         <span class="string">'Sys.n = 1;                        '</span>;<span class="keyword">...</span>
0597         <span class="string">'Sys.lw = [0 0.03];                '</span>]);
0598     
0599         set(handles.edit_var1,<span class="string">'String'</span>,[<span class="keyword">...</span>
0600         <span class="string">'Var.g = [0.005 0.005 0.005];'</span>;<span class="keyword">...</span>
0601         <span class="string">'Var.lwpp = 0.001;           '</span>]);
0602     
0603         
0604     <span class="keyword">case</span> 3  <span class="comment">% DPPH</span>
0605          set(handles.edit_system,<span class="string">'String'</span>,[<span class="keyword">...</span>
0606         <span class="string">'Sys.g = 2.0036;    '</span>;<span class="keyword">...</span>
0607         <span class="string">'Sys.Nucs = ''14N'';  '</span>;<span class="keyword">...</span>
0608         <span class="string">'Sys.n = 1;         '</span>;<span class="keyword">...</span>
0609         <span class="string">'Sys.lw = 0 0.005;  '</span>]);
0610     
0611     set(handles.edit_var1,<span class="string">'String'</span>,[<span class="keyword">...</span>
0612         <span class="string">'Var.g = 0.005;'</span>]);
0613     
0614 <span class="keyword">end</span>
0615 
0616 <span class="comment">% --- Executes on button press in button_RUN.</span>
0617 <a name="_sub43" href="#_subfunctions" class="code">function button_RUN_Callback(hObject, eventdata, handles)</a>
0618 
0619 <span class="comment">% Check for EasySpin</span>
0620 <span class="keyword">if</span> exist(<span class="string">'esfit'</span>) == 0
0621     msgbox(<span class="string">'EasySpin could not be found. Please check that it is installed and on an active path.'</span>,<span class="string">'EasyRefiner: RUN'</span>,<span class="string">'error'</span>);
0622     <span class="keyword">return</span>
0623 <span class="keyword">end</span>
0624 
0625 
0626 <span class="comment">% Message user</span>
0627 info = [sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'EASYREFINER INITIALIZING:'</span>])];
0628 set(handles.edit_info,<span class="string">'String'</span>,info);
0629 
0630 info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Loading variables...'</span>])];
0631 set(handles.edit_info,<span class="string">'String'</span>,info);
0632 
0633 <span class="comment">% Check file has been loaded, otherwise abort</span>
0634 <span class="keyword">if</span> strcmp(get(handles.listbox_files,<span class="string">'String'</span>), <span class="string">'-- No file loaded --'</span>)
0635     info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'No files loaded, aborting'</span>])];
0636     set(handles.edit_info,<span class="string">'String'</span>,info);
0637     <span class="keyword">return</span>
0638 <span class="keyword">end</span>
0639 
0640 <span class="comment">% Get all variables</span>
0641 <span class="keyword">global</span> ER
0642 var1On  = get(handles.checkbox_var1,<span class="string">'Value'</span>);
0643 var2On  = get(handles.checkbox_var2,<span class="string">'Value'</span>);
0644 var3On  = get(handles.checkbox_var3,<span class="string">'Value'</span>);
0645 figOpen = get(handles.checkbox_figureOpen,<span class="string">'Value'</span>);
0646 figSave = get(handles.checkbox_figureSave,<span class="string">'Value'</span>);
0647 log     = get(handles.checkbox_log,<span class="string">'Value'</span>);
0648 outAdd  = get(handles.edit_outputAddress,<span class="string">'String'</span>);
0649 
0650 <span class="keyword">if</span> get(handles.checkbox_delay,<span class="string">'Value'</span>) == 1
0651     delay = str2num(get(handles.edit_delay,<span class="string">'String'</span>));
0652 <span class="keyword">else</span>
0653     delay = 0;
0654 <span class="keyword">end</span>
0655 
0656 <span class="comment">% Get strings from edit boxes</span>
0657 sSys    = get(handles.edit_system,<span class="string">'String'</span>);
0658 sExp    = get(handles.edit_exp,<span class="string">'String'</span>);
0659 sOpt    = get(handles.edit_opt,<span class="string">'String'</span>);
0660 sVar1   = get(handles.edit_var1,<span class="string">'String'</span>);
0661 sVar2   = get(handles.edit_var2,<span class="string">'String'</span>);
0662 sVar3   = get(handles.edit_var3,<span class="string">'String'</span>);
0663 
0664 <span class="comment">% Fitting options</span>
0665 <span class="keyword">switch</span> get(handles.popupmenu_esFitting,<span class="string">'Value'</span>);
0666     <span class="keyword">case</span> 1  <span class="comment">% Garlic</span>
0667         Fit = <span class="string">'garlic'</span>;
0668     <span class="keyword">case</span> 2  <span class="comment">% Chili</span>
0669         Fit = <span class="string">'chili'</span>;
0670     <span class="keyword">case</span> 3  <span class="comment">% Pepper</span>
0671         Fit = <span class="string">'pepper'</span>;
0672 <span class="keyword">end</span>
0673 
0674 <span class="comment">% Fitting method</span>
0675 <span class="keyword">switch</span> get(handles.popupmenu_esFitMethod,<span class="string">'Value'</span>)
0676     <span class="keyword">case</span> 1
0677         FitOpt.Method = <span class="string">'simplex'</span>;
0678         Opt = [];
0679     <span class="keyword">case</span> 2
0680         FitOpt.Method = <span class="string">'levmar'</span>;
0681         Opt = [];
0682     <span class="keyword">case</span> 3
0683         FitOpt.Method = <span class="string">'montecarlo'</span>;
0684         Opt = [];
0685     <span class="keyword">case</span> 4
0686         FitOpt.Method = <span class="string">'genetic'</span>;
0687         Opt = [];
0688     <span class="keyword">case</span> 5
0689         FitOpt.Method = <span class="string">'grid'</span>;
0690         Opt = [];
0691 <span class="keyword">end</span>
0692 
0693 
0694 
0695 info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Fitting with '</span> Fit ])];
0696 info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) FitOpt.Method <span class="string">' method selected'</span>])];
0697 set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0698 
0699 info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Variables loaded!'</span>])];
0700 set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0701 info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Beginning fitting...'</span>])];
0702 set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0703 
0704 files = numel(ER.fileNum);
0705 
0706 <span class="comment">% Start timers</span>
0707 timeBegin = tic;
0708 wb = waitbar(0,sprintf(<span class="string">'Completed 0 of %1d'</span>,files));
0709 
0710 <span class="comment">% Begin fitting</span>
0711 <span class="keyword">for</span> k = 1:files
0712         
0713     <span class="comment">% Evaluate system and options line by line</span>
0714     <span class="keyword">for</span> l = 1:size(sSys,1)
0715         eval(sSys(l,:));
0716     <span class="keyword">end</span>
0717     
0718     <span class="keyword">for</span> l = 1:size(sOpt,1)
0719         eval(sOpt(l,:));
0720     <span class="keyword">end</span>
0721     
0722     <span class="comment">% Evaluate experiment</span>
0723     <span class="keyword">for</span> l = 1:size(sExp,1)
0724         eval(sExp(l,:));
0725     <span class="keyword">end</span>
0726     
0727     <span class="comment">% Pull mw frequency from file's info and evaluate</span>
0728     eval([<span class="string">'Exp.mwFreq = '</span> num2str(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.MWFQ/10^9) <span class="string">';'</span>]);
0729     eval([<span class="string">'Exp.Range = ['</span> num2str(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).x(1)/10) <span class="string">' '</span> num2str(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).x(end)/10) <span class="string">'];'</span>]);
0730    
0731     timeVar1 = tic;
0732     
0733     info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Beginning file '</span> ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL])];
0734     set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0735     
0736     <span class="keyword">switch</span> var1On
0737         <span class="keyword">case</span> 0
0738             <span class="comment">% If no variable selected</span>
0739             eval([<span class="string">'[B,spc] = '</span> Fit <span class="string">'('</span> Sys <span class="string">','</span> Exp <span class="string">');'</span>]);
0740         <span class="keyword">case</span> 1
0741             <span class="comment">% If var1 ticked, evaluate</span>
0742             <span class="keyword">for</span> l = 1:size(sVar1,1)
0743                 eval(sVar1(l,:));
0744             <span class="keyword">end</span>
0745             
0746             info = [info;sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Starting round 1'</span>])];
0747             set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0748             
0749             <span class="comment">% Have to autozero spectra for EasySpin</span>
0750             m = mean([(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).y(end-4:<span class="keyword">end</span>,1)) ; (ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).y(1:5,1))]);
0751             ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).y(:,1) = ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).y(:,1) - (m);
0752                        
0753             <span class="comment">% Call EasySpin</span>
0754             <span class="keyword">try</span>
0755                 eval([<span class="string">'[bestsys,bestspc] = esfit('''</span> Fit <span class="string">''', ER.data.File'</span> num2str(k) <span class="string">'.y , Sys, Var, Exp , Opt, FitOpt);'</span>])
0756             <span class="keyword">catch</span>
0757                 info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'FAILED round 1 of '</span> ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL])];
0758                 <span class="keyword">continue</span>
0759             <span class="keyword">end</span>
0760             
0761             info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Completed round 1 of '</span> ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL])];
0762             info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Round 1 time taken: '</span> num2str(round(toc(timeVar1))) <span class="string">' s'</span>])];
0763             set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0764             
0765             
0766             <span class="comment">% Save variables</span>
0767             Results.(strcat(<span class="string">'File'</span>,num2str(k))).r1.bestsys = bestsys;
0768             Results.(strcat(<span class="string">'File'</span>,num2str(k))).r1.bestspc = bestspc;
0769             
0770             <span class="comment">% Save the figure?</span>
0771             <span class="keyword">switch</span> figSave
0772                 <span class="keyword">case</span> 0
0773                     <span class="comment">% Do nothing</span>
0774                 <span class="keyword">case</span> 1
0775                     <span class="comment">% Save the figure</span>
0776                     saveas(gcf,[outAdd <span class="string">'/'</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">'r1.fig'</span>]);
0777             <span class="keyword">end</span>
0778             
0779             close(gcf);
0780             
0781             <span class="comment">% Keep the figure open?</span>
0782             <span class="keyword">switch</span> figOpen
0783                 <span class="keyword">case</span> 0
0784                     <span class="comment">% Do nothing</span>
0785                 <span class="keyword">case</span> 1
0786                     openfig([outAdd <span class="string">'/'</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">'r1.fig'</span>],<span class="string">'new'</span>);
0787                     set(gcf,<span class="string">'Name'</span>,[<span class="string">'EasyRefiner - '</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">' - Round 1'</span>]);
0788             <span class="keyword">end</span>
0789             
0790             <span class="comment">% Delay between fitting</span>
0791             <span class="keyword">switch</span> delay
0792                 <span class="keyword">case</span> 0
0793                     
0794                 <span class="keyword">otherwise</span>
0795                     pause(delay)
0796             <span class="keyword">end</span>
0797     <span class="keyword">end</span>
0798     
0799     <span class="keyword">switch</span> var2On
0800         <span class="keyword">case</span> 0
0801             <span class="comment">% Do nothing</span>
0802         <span class="keyword">case</span> 1
0803             timeVar2 = tic;
0804 
0805             <span class="comment">% Start round 2</span>
0806             info = [info;sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Starting round 2'</span>])];
0807             set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0808             
0809             <span class="comment">% Evaluate variables</span>
0810             <span class="keyword">for</span> l = 1:size(sVar2,1)
0811                 eval(sVar2(l,:));
0812             <span class="keyword">end</span>
0813             
0814             <span class="comment">% Call EasySpin</span>
0815             eval([<span class="string">'[bestsys,bestspc] = esfit('''</span> Fit <span class="string">''', ER.data.File'</span> num2str(k) <span class="string">'.y , bestsys, Var, Exp , Opt, FitOpt);'</span>])
0816             
0817             <span class="comment">% Report to user</span>
0818             info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Completed round 2 of '</span> ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL])];
0819             info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Round 2 time taken: '</span> num2str(round(toc(timeVar2))) <span class="string">' s'</span>])];
0820             set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0821             
0822             <span class="comment">% Save variables</span>
0823             Results.(strcat(<span class="string">'File'</span>,num2str(k))).r2.bestsys = bestsys;
0824             Results.(strcat(<span class="string">'File'</span>,num2str(k))).r2.bestspc = bestspc;
0825             
0826             <span class="comment">% Save the figure?</span>
0827             <span class="keyword">switch</span> figSave
0828                 <span class="keyword">case</span> 0
0829                     <span class="comment">% Do nothing</span>
0830                 <span class="keyword">case</span> 1
0831                     <span class="comment">% Save the figure</span>
0832                     saveas(gcf,[outAdd <span class="string">'/'</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">'r2.fig'</span>]);
0833             <span class="keyword">end</span>
0834             
0835             close(gcf);
0836             
0837             <span class="comment">% Keep the figure open?</span>
0838             <span class="keyword">switch</span> figOpen
0839                 <span class="keyword">case</span> 0
0840                     <span class="comment">% Do nothing</span>
0841                 <span class="keyword">case</span> 1
0842                     openfig([outAdd <span class="string">'/'</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">'r2.fig'</span>],<span class="string">'new'</span>);
0843                     set(gcf,<span class="string">'Name'</span>,[<span class="string">'EasyRefiner - '</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">' - Round 2'</span>]);
0844             <span class="keyword">end</span>
0845             
0846             <span class="comment">% Delay between fitting</span>
0847             <span class="keyword">switch</span> delay
0848                 <span class="keyword">case</span> 0
0849                     
0850                 <span class="keyword">otherwise</span>
0851                     pause(delay)
0852             <span class="keyword">end</span>
0853     <span class="keyword">end</span>
0854     
0855     <span class="keyword">switch</span> var3On
0856         <span class="keyword">case</span> 0
0857             <span class="comment">% Do nothing</span>
0858         <span class="keyword">case</span> 1
0859             timeVar3 = tic;
0860 
0861             <span class="comment">% Start round 3</span>
0862             info = [info;sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Starting round 3'</span>])];
0863             set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0864             
0865             <span class="comment">% Evaluate variables</span>
0866             <span class="keyword">for</span> l = 1:size(sVar3,1)
0867                 eval(sVar3(l,:));
0868             <span class="keyword">end</span>
0869             
0870             <span class="comment">% Call EasySpin</span>
0871             eval([<span class="string">'[bestsys,bestspc] = esfit('''</span> Fit <span class="string">''', ER.data.File'</span> num2str(k) <span class="string">'.y , bestsys, Var, Exp , Opt, FitOpt);'</span>])
0872             
0873             <span class="comment">% Report to user</span>
0874             info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Completed round 3 of '</span> ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL])];
0875             info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Round 3 time taken: '</span> num2str(round(toc(timeVar3))) <span class="string">' s'</span>])];
0876             set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0877             
0878             <span class="comment">% Save variables</span>
0879             Results.(strcat(<span class="string">'File'</span>,num2str(k))).r2.bestsys = bestsys;
0880             Results.(strcat(<span class="string">'File'</span>,num2str(k))).r2.bestspc = bestspc;
0881             
0882             <span class="comment">% Save the figure?</span>
0883             <span class="keyword">switch</span> figSave
0884                 <span class="keyword">case</span> 0
0885                     <span class="comment">% Do nothing</span>
0886                 <span class="keyword">case</span> 1
0887                     <span class="comment">% Save the figure</span>
0888                     saveas(gcf,[outAdd <span class="string">'/'</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">'r3.fig'</span>]);
0889             <span class="keyword">end</span>
0890             
0891             close(gcf);
0892             
0893             <span class="comment">% Keep the figure open?</span>
0894             <span class="keyword">switch</span> figOpen
0895                 <span class="keyword">case</span> 0
0896                     <span class="comment">% Do nothing</span>
0897                 <span class="keyword">case</span> 1
0898                     openfig([outAdd <span class="string">'/'</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">'r3.fig'</span>],<span class="string">'new'</span>);
0899                     set(gcf,<span class="string">'Name'</span>,[<span class="string">'EasyRefiner - '</span> regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>) <span class="string">' - Round 3'</span>]);
0900             <span class="keyword">end</span>
0901             
0902             <span class="comment">% Delay between fitting</span>
0903             <span class="keyword">switch</span> delay
0904                 <span class="keyword">case</span> 0
0905                     
0906                 <span class="keyword">otherwise</span>
0907                     pause(delay)
0908             <span class="keyword">end</span>
0909     <span class="keyword">end</span>
0910      
0911     <span class="comment">% Message user for file completion</span>
0912     info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Completed file '</span> ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL])];
0913     info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'File time taken: '</span> num2str(round(toc(timeVar1))) <span class="string">' s'</span>])];
0914     set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0915     
0916     <span class="comment">% Update progress bar</span>
0917     wb = waitbar((k/files)-(1/files),wb,sprintf(<span class="string">'Completed %1d of %1d'</span>,k,files));
0918     
0919 <span class="keyword">end</span>
0920 
0921 delete(wb);
0922 
0923 <span class="comment">% Process the outputs</span>
0924 out =[];
0925 
0926 <span class="keyword">for</span> k = 1:files
0927     <span class="comment">% Create nice array of data for plotting</span>
0928     
0929     <span class="comment">% Column 1 and 2 are original data</span>
0930     ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).Plots(:,1) = ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).x;
0931     ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).Plots(:,2) = ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).y;
0932     <span class="comment">% Column 3 and 4 is round 1</span>
0933     ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).Plots(:,3) = ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).x;
0934     ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).Plots(:,4) = (Results.(strcat(<span class="string">'File'</span>,num2str(k))).r1.bestspc)';
0935     
0936     <span class="keyword">if</span> isfield(Results.(strcat(<span class="string">'File'</span>,num2str(k))),<span class="string">'r2'</span>)
0937         <span class="comment">% Column 5 and 6 is round 2</span>
0938         ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).Plots(:,5) = ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).x;
0939         ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).Plots(:,6) = (Results.(strcat(<span class="string">'File'</span>,num2str(k))).r2.bestspc)';
0940         
0941         <span class="keyword">if</span> isfield(Results.(strcat(<span class="string">'File'</span>,num2str(k))),<span class="string">'r3'</span>)
0942             <span class="comment">% Column 7 and 8 is round 3</span>
0943             ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).Plots(:,7) = ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).x;
0944             ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).Plots(:,8) = (Results.(strcat(<span class="string">'File'</span>,num2str(k))).r3.bestspc)';
0945         <span class="keyword">end</span>
0946     <span class="keyword">end</span>
0947     
0948     <span class="comment">% Rename FileX to out.{FileTitle}</span>
0949     out.(regexprep(ER.data.(strcat(<span class="string">'File'</span>,num2str(k))).info.TITL,<span class="string">''''</span>,<span class="string">''</span>)) = ER.data.(strcat(<span class="string">'File'</span>,num2str(k)));
0950 <span class="keyword">end</span>
0951 
0952 <span class="comment">% Save the results</span>
0953 save([outAdd <span class="string">'/'</span> datestr(now, <span class="string">'dd-mm-yy_HH:MM_'</span>) <span class="string">'EasyRefiner_Results.mat'</span>],<span class="string">'out'</span>);
0954 <span class="comment">% Put output to base workspace</span>
0955 assignin(<span class="string">'base'</span>,<span class="string">'EasyRefiner_Results'</span>,out);
0956 
0957 <span class="comment">% Message user for queue completion</span>
0958 info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Completed queue!'</span>])];
0959 info = [info ; sprintf(<span class="string">'%-50s'</span>,[datestr(now, <span class="string">'dd-mm-yy HH:MM:SS '</span>) <span class="string">'Queue time taken: '</span> num2str(round(toc(timeBegin))) <span class="string">' s'</span>])];
0960 set(handles.edit_info,<span class="string">'String'</span>,info(end-2:<span class="keyword">end</span> , :));
0961 
0962 <span class="keyword">switch</span> log
0963     <span class="keyword">case</span> 0
0964         <span class="comment">% Do nothing</span>
0965     <span class="keyword">case</span> 1
0966         <span class="comment">% Save out info</span>
0967         logFile = fopen([outAdd <span class="string">'/'</span> datestr(now, <span class="string">'dd-mm-yy_HH:MM_'</span>) <span class="string">'EasyRefiner_Log.txt'</span>],<span class="string">'w'</span>);
0968         
0969         <span class="keyword">for</span> k = 1:size(info,1)
0970             fprintf(logFile,<span class="string">'%-50s\n'</span>,info(k,:));
0971         <span class="keyword">end</span>
0972         
0973         fclose(logFile);
0974 <span class="keyword">end</span>
0975 
0976</pre></div>
<hr><address>Generated on Wed 06-Feb-2013 17:24:48 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>