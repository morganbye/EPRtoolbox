<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of BrukerRead</title>
  <meta name="keywords" content="BrukerRead">
  <meta name="description" content="BRUKERREAD Open Bruker BE3ST files (.DTA / .DSC , .spc / .par) into the">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">misc</a> &gt; BrukerRead.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for misc&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>BrukerRead
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>BRUKERREAD Open Bruker BE3ST files (.DTA / .DSC , .spc / .par) into the</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function varargout = BrukerRead(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> BRUKERREAD Open Bruker BE3ST files (.DTA / .DSC , .spc / .par) into the
 MATLAB workspace.

 BRUKERREAD ()
 BRUKERREAD ('/path/to/file')
 BRUKERREAD ('plot')
 BRUKERREAD ('/path/to/file','plot')
 [x, y] = BRUKERREAD (...)
 [x, y, info] = BRUKERREAD (...)
 [x, y, z] = BRUKERREAD (...)
 [x, y, z, info] = BRUKERREAD (...)

 BRUKERREAD when run without any inputs, opens a GUI so that the user can
 open the file themselves. BRUKERREAD can also accept a path to a file as
 an input if the path is put in 'quotes' and the extension (.DTA) is left
 off.

 BRUKERREAD now also works with Bruker .spc/.par from EMX machines -
 thanks to Muege Aksoyoglu (Uni. Freiburg, DE) who kindly donated some
 .spc/.par files for testing

 BRUKERREAD can be run with the optional 'plot' input, so that the file
 being loaded is automatically plotted into a new figure

 BRUKERREAD outputs a x matrix (magnetic field / time), a y matrix
 (intensity) and an optional info field.

 If no outputs are selected then the file is plotted with no variables
 being passed to the MATLAB workspace

 BRUKERREAD is fully functional and extensively tested with cw experiments
 and 3 dimensional cw experiments where there is an additional .YGF file -
 such as power saturation experiments. BRUKERREAD provides functionality
 for pulsed experiments, it has been extensively tested with field swept
 echoes, fourier induced decays and PELDOR traces. HYSCORE and ENDOR
 functionality has been added in version 13.01 but has had little testing.
 Other complex pulsed experiments are untested and may have varying
 results but should yield complete arrays. Please email me if you come
 across any errors.

 Inputs:
    input1     - a string input to the path of a file
    input2     - 'plot' draws a plot of the imported file

 Outputs:
    output0    - plot
                   A new figure showing the data
    output1    - x axis
                   Magnetic field
    output2    - y axis
                   Intensity
    output3    - information
                   Array of information about the loaded file
    output4    - z axis
                   For 3 dimensional pulsed experiments - such as HYSCORE,
                   then the intensity is in the 3rd &quot;z&quot; dimension

 Example: 
    [x,y] = BrukerRead
               GUI load a file

    [x,y,info] = BrukerRead('/path/to/file.DTA','plot')
               load x,y and info of file.DTA with to the workspace and 
               plot x,y as a new figure

 Other m-files required:   none

 Subfunctions:             none

 MAT-files required:       none


 See also: EPRTOOLBOX CWPLOTTER</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="EasyRefiner.html" class="code" title="function varargout = EasyRefiner(varargin)">EasyRefiner</a>	EASYREFINER a simple GUI interface for refining EasySpin simulations</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = BrukerRead(varargin)</a>
0002 
0003 <span class="comment">% BRUKERREAD Open Bruker BE3ST files (.DTA / .DSC , .spc / .par) into the</span>
0004 <span class="comment">% MATLAB workspace.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% BRUKERREAD ()</span>
0007 <span class="comment">% BRUKERREAD ('/path/to/file')</span>
0008 <span class="comment">% BRUKERREAD ('plot')</span>
0009 <span class="comment">% BRUKERREAD ('/path/to/file','plot')</span>
0010 <span class="comment">% [x, y] = BRUKERREAD (...)</span>
0011 <span class="comment">% [x, y, info] = BRUKERREAD (...)</span>
0012 <span class="comment">% [x, y, z] = BRUKERREAD (...)</span>
0013 <span class="comment">% [x, y, z, info] = BRUKERREAD (...)</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% BRUKERREAD when run without any inputs, opens a GUI so that the user can</span>
0016 <span class="comment">% open the file themselves. BRUKERREAD can also accept a path to a file as</span>
0017 <span class="comment">% an input if the path is put in 'quotes' and the extension (.DTA) is left</span>
0018 <span class="comment">% off.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% BRUKERREAD now also works with Bruker .spc/.par from EMX machines -</span>
0021 <span class="comment">% thanks to Muege Aksoyoglu (Uni. Freiburg, DE) who kindly donated some</span>
0022 <span class="comment">% .spc/.par files for testing</span>
0023 <span class="comment">%</span>
0024 <span class="comment">% BRUKERREAD can be run with the optional 'plot' input, so that the file</span>
0025 <span class="comment">% being loaded is automatically plotted into a new figure</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% BRUKERREAD outputs a x matrix (magnetic field / time), a y matrix</span>
0028 <span class="comment">% (intensity) and an optional info field.</span>
0029 <span class="comment">%</span>
0030 <span class="comment">% If no outputs are selected then the file is plotted with no variables</span>
0031 <span class="comment">% being passed to the MATLAB workspace</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% BRUKERREAD is fully functional and extensively tested with cw experiments</span>
0034 <span class="comment">% and 3 dimensional cw experiments where there is an additional .YGF file -</span>
0035 <span class="comment">% such as power saturation experiments. BRUKERREAD provides functionality</span>
0036 <span class="comment">% for pulsed experiments, it has been extensively tested with field swept</span>
0037 <span class="comment">% echoes, fourier induced decays and PELDOR traces. HYSCORE and ENDOR</span>
0038 <span class="comment">% functionality has been added in version 13.01 but has had little testing.</span>
0039 <span class="comment">% Other complex pulsed experiments are untested and may have varying</span>
0040 <span class="comment">% results but should yield complete arrays. Please email me if you come</span>
0041 <span class="comment">% across any errors.</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% Inputs:</span>
0044 <span class="comment">%    input1     - a string input to the path of a file</span>
0045 <span class="comment">%    input2     - 'plot' draws a plot of the imported file</span>
0046 <span class="comment">%</span>
0047 <span class="comment">% Outputs:</span>
0048 <span class="comment">%    output0    - plot</span>
0049 <span class="comment">%                   A new figure showing the data</span>
0050 <span class="comment">%    output1    - x axis</span>
0051 <span class="comment">%                   Magnetic field</span>
0052 <span class="comment">%    output2    - y axis</span>
0053 <span class="comment">%                   Intensity</span>
0054 <span class="comment">%    output3    - information</span>
0055 <span class="comment">%                   Array of information about the loaded file</span>
0056 <span class="comment">%    output4    - z axis</span>
0057 <span class="comment">%                   For 3 dimensional pulsed experiments - such as HYSCORE,</span>
0058 <span class="comment">%                   then the intensity is in the 3rd &quot;z&quot; dimension</span>
0059 <span class="comment">%</span>
0060 <span class="comment">% Example:</span>
0061 <span class="comment">%    [x,y] = BrukerRead</span>
0062 <span class="comment">%               GUI load a file</span>
0063 <span class="comment">%</span>
0064 <span class="comment">%    [x,y,info] = BrukerRead('/path/to/file.DTA','plot')</span>
0065 <span class="comment">%               load x,y and info of file.DTA with to the workspace and</span>
0066 <span class="comment">%               plot x,y as a new figure</span>
0067 <span class="comment">%</span>
0068 <span class="comment">% Other m-files required:   none</span>
0069 <span class="comment">%</span>
0070 <span class="comment">% Subfunctions:             none</span>
0071 <span class="comment">%</span>
0072 <span class="comment">% MAT-files required:       none</span>
0073 <span class="comment">%</span>
0074 <span class="comment">%</span>
0075 <span class="comment">% See also: EPRTOOLBOX CWPLOTTER</span>
0076 
0077 
0078 <span class="comment">%                                        _                             _</span>
0079 <span class="comment">%                                       | |                           | |</span>
0080 <span class="comment">%  _ __ ___   ___  _ __ __ _  __ _ _ __ | |__  _   _  ___   _ __   ___| |_</span>
0081 <span class="comment">% | '_ ` _ \ / _ \| '__/ _` |/ _` | '_ \| '_ \| | | |/ _ \ | '_ \ / _ \ __|</span>
0082 <span class="comment">% | | | | | | (_) | | | (_| | (_| | | | | |_) | |_| |  __/_| | | |  __/ |_</span>
0083 <span class="comment">% |_| |_| |_|\___/|_|  \__, |\__,_|_| |_|_.__/ \__, |\___(_)_| |_|\___|\__|</span>
0084 <span class="comment">%                       __/ |                   __/ |</span>
0085 <span class="comment">%                      |___/                   |___/</span>
0086 <span class="comment">%</span>
0087 <span class="comment">%</span>
0088 <span class="comment">% M. Bye v13.04</span>
0089 <span class="comment">%</span>
0090 <span class="comment">% Author:       Morgan Bye</span>
0091 <span class="comment">% Work address: Henry Wellcome Unit for Biological EPR</span>
0092 <span class="comment">%               University of East Anglia</span>
0093 <span class="comment">%               NORWICH, UK</span>
0094 <span class="comment">% Email:        morgan.bye@uea.ac.uk</span>
0095 <span class="comment">% Website:      http://www.morganbye.net/eprtoolbox/brukerread</span>
0096 <span class="comment">% Mar 2013;     Last revision: 18-March-2013</span>
0097 <span class="comment">%</span>
0098 <span class="comment">% Approximate coding time of file:</span>
0099 <span class="comment">%               12 hours</span>
0100 <span class="comment">%</span>
0101 <span class="comment">%</span>
0102 <span class="comment">% Version history:</span>
0103 <span class="comment">% Mar 13        &gt; Minor edits to help compatibility with the EasySpin's</span>
0104 <span class="comment">%                   &quot;eprsave&quot;. This is not a fix as the function does not</span>
0105 <span class="comment">%                   export several key components for a spectrum (such as</span>
0106 <span class="comment">%                   experiment type, microwave power, etc). But 'plot'</span>
0107 <span class="comment">%                   input argument works - using the assumption that the</span>
0108 <span class="comment">%                   spectra is a standard CW experiment.</span>
0109 <span class="comment">%</span>
0110 <span class="comment">% Dec 12        &gt; Major update for HYSCORE experiment handling</span>
0111 <span class="comment">%               &gt; Bug fixes and better handling for ENDOR, ESEEM, DONUT</span>
0112 <span class="comment">%                   experiment handling especially in figure plotting</span>
0113 <span class="comment">%</span>
0114 <span class="comment">% Jun 12        &gt; Muege Aksoyoglu (Uni. Freiburg, DE) kindly donated some</span>
0115 <span class="comment">%                   .spc/.par files from an EMX machine allowing for</span>
0116 <span class="comment">%                   support for these files</span>
0117 <span class="comment">%               &gt; GUI load window updated to &quot;Bruker files&quot; instead of</span>
0118 <span class="comment">%                   seperate options for DTA and spc</span>
0119 <span class="comment">%               &gt; if statements for DTA/spc changed to switch statements</span>
0120 <span class="comment">%                   for cleaner code</span>
0121 <span class="comment">%</span>
0122 <span class="comment">% Apr 12        &gt; Better handling of pulse experiments</span>
0123 <span class="comment">%               &gt; Inputs changed so that 'plot' can be used by itself</span>
0124 <span class="comment">%               &gt; Figure plotting reconfigured and improved</span>
0125 <span class="comment">%                       - imaginary channel for pulse experiments</span>
0126 <span class="comment">%                       - legend is displayed for real/imaginary channels</span>
0127 <span class="comment">%                       - x-axis corrected for time or mag field depending</span>
0128 <span class="comment">%                       on FSE or FID experiment with correct units/label</span>
0129 <span class="comment">%</span>
0130 <span class="comment">% Feb 12        Minor edit - fix for occasional file load by command line</span>
0131 <span class="comment">%               error</span>
0132 <span class="comment">%</span>
0133 <span class="comment">% Dec 11        Plotted figures have file names included in header</span>
0134 <span class="comment">%</span>
0135 <span class="comment">% Oct 11        &gt; &quot;Return&quot; catch statement if user cancels a file load</span>
0136 <span class="comment">%                   using the GUI</span>
0137 <span class="comment">%               &gt; Fixed bug with 'plot' input parameter</span>
0138 <span class="comment">%</span>
0139 <span class="comment">% Sept 11       Changed fid/fopen name reference system so that files are</span>
0140 <span class="comment">%               still loaded even if not in the same location as MATLAB's</span>
0141 <span class="comment">%               &quot;Current Folder&quot;. Only a problem occasionally when called</span>
0142 <span class="comment">%               from another script.</span>
0143 
0144 <span class="comment">%                         Input arguments</span>
0145 <span class="comment">% ========================================================================</span>
0146 
0147 <span class="keyword">switch</span> nargin
0148     <span class="keyword">case</span> 0
0149         <span class="comment">% GUI get file</span>
0150         [file , directory] = uigetfile({<span class="string">'*.DTA;*.spc'</span>,<span class="string">'Bruker File (*.DTA,*.spc)'</span>; <span class="keyword">...</span>
0151             <span class="string">'*.*'</span>,  <span class="string">'All Files (*.*)'</span>},<span class="keyword">...</span>
0152             <span class="string">'Load Bruker file'</span>);
0153         
0154         <span class="comment">% if user cancels command nothing happens</span>
0155         <span class="keyword">if</span> isequal(file,0) <span class="comment">%|| isequal(directory,0)</span>
0156             <span class="keyword">return</span>
0157         <span class="keyword">end</span>
0158                 
0159         <span class="comment">% File name/path manipulation</span>
0160         address = [directory,file];
0161         [~, name,extension] = fileparts(address);
0162         
0163         graph = <span class="string">''</span>;
0164         
0165         
0166     <span class="keyword">case</span> 1
0167         <span class="comment">% If input is 'plot'</span>
0168         <span class="keyword">if</span> strcmp(varargin{1},<span class="string">'plot'</span>)
0169             graph = <span class="string">'plot'</span>;
0170             
0171             <span class="comment">% GUI get file</span>
0172             [file , directory] = uigetfile({<span class="string">'*.DTA'</span>,<span class="string">'Bruker BES3T File (*.DTA)'</span>; <span class="keyword">...</span>
0173             <span class="string">'*.spc'</span>,<span class="string">'Bruker Spc File (*.spc)'</span>; <span class="keyword">...</span>
0174             <span class="string">'*.*'</span>,  <span class="string">'All Files (*.*)'</span>},<span class="string">'Load Bruker file'</span>);
0175         
0176             <span class="comment">% if user cancels command nothing happens</span>
0177             <span class="keyword">if</span> isequal(file,0) <span class="comment">%|| isequal(directory,0)</span>
0178                 <span class="keyword">return</span>
0179             <span class="keyword">end</span>
0180                 
0181             <span class="comment">% File name/path manipulation</span>
0182             address = [directory,file];
0183             [~, name,extension] = fileparts(address);
0184             
0185         <span class="comment">% Or if input is a path</span>
0186         <span class="keyword">else</span>
0187             address = varargin{1};
0188             [directory,name,extension] = fileparts(address);
0189             graph = <span class="string">''</span>;
0190         <span class="keyword">end</span>
0191         
0192     <span class="keyword">case</span> 2
0193         address = varargin{1};
0194         [directory,name,extension] = fileparts(address);
0195         graph = varargin{2};
0196 <span class="keyword">end</span>
0197 
0198 <span class="comment">%                         Parameter files</span>
0199 <span class="comment">% ========================================================================</span>
0200 
0201 <span class="comment">% Load .dsc/.par file</span>
0202 <span class="comment">% ===================</span>
0203 <span class="keyword">switch</span> extension
0204     <span class="keyword">case</span> <span class="string">'.spc'</span>
0205     filepar = [ directory <span class="string">'/'</span> name <span class="string">'.par'</span>];
0206     fid = fopen( filepar , <span class="string">'r'</span>);
0207     
0208     delimiter = 10;
0209     
0210     <span class="keyword">case</span> <span class="string">'.DTA'</span>
0211     filedsc = [directory <span class="string">'/'</span> name <span class="string">'.DSC'</span>];
0212     fid = fopen( filedsc , <span class="string">'r'</span>);
0213     
0214     delimiter = 10;
0215 <span class="keyword">end</span>
0216 
0217 <span class="comment">% Get characters from file</span>
0218 [string , string_characters] = fscanf( fid , <span class="string">'%c'</span> );
0219 
0220 <span class="comment">% Close file, free up memory</span>
0221 fclose(fid);
0222 
0223 <span class="comment">% Convert character array into useful string array (insert line breaks)</span>
0224 parameters = [];
0225 
0226 <span class="keyword">while</span> isempty(string) == 0;
0227     [token, string] = strtok(string,char(delimiter));
0228     parameters = str2mat(parameters,token);
0229 <span class="keyword">end</span>
0230 
0231 <span class="comment">% Do basic reading of info file to decide on how to proceed with number</span>
0232 <span class="comment">% crunching.</span>
0233 
0234 <span class="keyword">switch</span> extension
0235     <span class="keyword">case</span> <span class="string">'.spc'</span>
0236         info.EXPT = <span class="string">'CW'</span>;
0237         
0238     <span class="keyword">case</span> <span class="string">'.DTA'</span>
0239         
0240         info.EXPT  = strtrim(regexprep(parameters((strmatch(<span class="string">'EXPT'</span>,parameters)),:),<span class="string">'EXPT'</span>,<span class="string">''</span>));
0241         info.XTYP  = strtrim(regexprep(parameters((strmatch(<span class="string">'XTYP'</span>,parameters)),:),<span class="string">'XTYP'</span>,<span class="string">''</span>));
0242         info.YTYP  = strtrim(regexprep(parameters((strmatch(<span class="string">'YTYP'</span>,parameters)),:),<span class="string">'YTYP'</span>,<span class="string">''</span>));
0243         info.IRNAM = strtrim(regexprep(parameters((strmatch(<span class="string">'IRNAM'</span>,parameters)),:),<span class="string">'IRNAM'</span>,<span class="string">''</span>));
0244         info.XNAM  = strtrim(regexprep(parameters((strmatch(<span class="string">'XNAM'</span>,parameters)),:),<span class="string">'XNAM'</span>,<span class="string">''</span>));
0245         info.XUNI  = strtrim(regexprep(parameters((strmatch(<span class="string">'XUNI'</span>,parameters)),:),<span class="string">'XUNI'</span>,<span class="string">''</span>));
0246         info.YUNI  = strtrim(regexprep(parameters((strmatch(<span class="string">'YUNI'</span>,parameters)),:),<span class="string">'YUNI'</span>,<span class="string">''</span>));
0247         info.TITL  = strtrim(regexprep(parameters((strmatch(<span class="string">'TITL'</span>,parameters)),:),<span class="string">'TITL'</span>,<span class="string">''</span>));
0248 <span class="keyword">end</span>
0249 
0250 
0251 <span class="comment">%                            Data files</span>
0252 <span class="comment">% ========================================================================</span>
0253 
0254 
0255 <span class="comment">% Load .dta/.spc file</span>
0256 <span class="keyword">switch</span> extension
0257     <span class="keyword">case</span> <span class="string">'.spc'</span>
0258         fid   = fopen( [directory <span class="string">'/'</span> name <span class="string">'.spc'</span>], <span class="string">'r'</span>);
0259         [y,n] = fread(fid,inf,<span class="string">'float'</span>);
0260         
0261     <span class="keyword">case</span> <span class="string">'.DTA'</span>
0262         fid   = fopen( [directory <span class="string">'/'</span> name <span class="string">'.DTA'</span>], <span class="string">'r'</span>,<span class="string">'ieee-be.l64'</span>);
0263         [y,n] = fread(fid,inf,<span class="string">'float64'</span>);
0264 <span class="keyword">end</span>
0265 
0266 fclose(fid);
0267 
0268 
0269 <span class="comment">%                      Magnetic field / X - axis</span>
0270 <span class="comment">% ========================================================================</span>
0271 
0272 
0273 <span class="keyword">switch</span> extension
0274     <span class="keyword">case</span> <span class="string">'.spc'</span>
0275         
0276         <span class="comment">% Mag field centre point</span>
0277         MagField.centre = str2num(regexprep(parameters((strmatch(<span class="string">'HCF'</span>,parameters)),:),<span class="string">'HCF'</span>,<span class="string">''</span>));
0278         
0279         <span class="comment">% Mag field sweep width</span>
0280         MagField.width  = str2num(regexprep(parameters((strmatch(<span class="string">'HSW'</span>,parameters)),:),<span class="string">'HSW'</span>,<span class="string">''</span>));
0281         
0282         <span class="comment">% Mag field data points</span>
0283         MagField.points = str2num(regexprep(parameters((strmatch(<span class="string">'ANZ'</span>,parameters)),:),<span class="string">'ANZ'</span>,<span class="string">''</span>));
0284         
0285         MagField.min      = MagField.centre - (MagField.width / 2);
0286         MagField.sampling = MagField.width / MagField.points;
0287         
0288         <span class="keyword">for</span> k = 1:MagField.points
0289             x(k) = MagField.min + (MagField.sampling * ((k)-1));
0290         <span class="keyword">end</span>
0291         
0292         x = x';
0293         
0294     <span class="keyword">case</span> <span class="string">'.DTA'</span>    
0295 
0296         <span class="comment">% =================================</span>
0297         <span class="comment">% a = strmatch('XMIN',basic_info)  % find line of XMIN</span>
0298         <span class="comment">% mag_start = basic_info(a,:);     % read that line</span>
0299         <span class="comment">% regexprep(mag_start,'XMIN','')   % delete XMIN from that line</span>
0300         <span class="comment">% str2num                          % convert string to number</span>
0301         <span class="comment">%</span>
0302         <span class="comment">% in a shell this could easily be done with &quot;awk&quot;</span>
0303         <span class="comment">% =================================</span>
0304         
0305         <span class="comment">% Mag field start</span>
0306         MagField.min = str2num(regexprep(parameters((strmatch(<span class="string">'XMIN'</span>,parameters)),:),<span class="string">'XMIN'</span>,<span class="string">''</span>));
0307         
0308         <span class="comment">% Mag field width</span>
0309         MagField.width = str2num(regexprep(parameters((strmatch(<span class="string">'XWID'</span>,parameters)),:),<span class="string">'XWID'</span>,<span class="string">''</span>));
0310         
0311         <span class="comment">% Mag number of data points</span>
0312         MagField.points = str2num(regexprep(parameters((strmatch(<span class="string">'XPTS'</span>,parameters)),:),<span class="string">'XPTS'</span>,<span class="string">''</span>));
0313         
0314         
0315         MagField.max = MagField.min + MagField.width;
0316         MagField.sampling = MagField.width / MagField.points;
0317         
0318         <span class="keyword">for</span> k = 1:MagField.points
0319             x(k) = MagField.min + (MagField.sampling * ((k)-1));
0320         <span class="keyword">end</span>
0321         
0322         x = x';
0323         
0324 <span class="keyword">end</span>
0325 
0326 <span class="comment">%                          Data / Y - axis</span>
0327 <span class="comment">% ========================================================================</span>
0328 
0329 <span class="comment">% Some work required for Pulsed experiments, cw experiments fine</span>
0330 
0331 <span class="keyword">if</span> strcmp(info.EXPT,<span class="string">'PLS'</span>)
0332     
0333     <span class="comment">% PELDOR, FSE and FID require splitting into real and imaginary</span>
0334     <span class="comment">% channels, these should have no Y axis data.</span>
0335     
0336     <span class="keyword">if</span> strcmp(info.YTYP,<span class="string">'NODATA'</span>)
0337     
0338         z = reshape(y,2,[]);
0339         clear y;
0340         y.real = z(1,:)';
0341         y.imag = z(2,:)';
0342     
0343     <span class="comment">% HYSCORE obviously have Y axis data collection and require splitting</span>
0344     
0345     <span class="keyword">elseif</span> strcmp(info.YTYP,<span class="string">'IDX'</span>)
0346         
0347         z = y;
0348         clear y
0349         
0350         <span class="comment">% Create Y-axis</span>
0351         <span class="comment">% =============</span>
0352         
0353         <span class="comment">% Y start</span>
0354         Y.min    = str2num(regexprep(parameters((strmatch(<span class="string">'YMIN'</span>,parameters)),:),<span class="string">'YMIN'</span>,<span class="string">''</span>));
0355         
0356         <span class="comment">% Y width</span>
0357         Y.width  = str2num(regexprep(parameters((strmatch(<span class="string">'YWID'</span>,parameters)),:),<span class="string">'YWID'</span>,<span class="string">''</span>));
0358         
0359         <span class="comment">% Y number of data points</span>
0360         Y.points = str2num(regexprep(parameters((strmatch(<span class="string">'YPTS'</span>,parameters)),:),<span class="string">'YPTS'</span>,<span class="string">''</span>));
0361         
0362         <span class="comment">% Create other Y points</span>
0363         Y.max = Y.min + Y.width;
0364         Y.sampling = Y.width / Y.points;
0365         
0366         <span class="comment">% Create Y</span>
0367         <span class="keyword">for</span> k = 1:Y.points
0368             y(k) = Y.min + (Y.sampling * ((k)-1));
0369         <span class="keyword">end</span>
0370         
0371         y = y';
0372         
0373         <span class="comment">% Format Z-axis</span>
0374         <span class="comment">% =============</span>
0375         
0376         z = reshape(z,size(y,1),[]);
0377         
0378     <span class="keyword">end</span>
0379 <span class="keyword">end</span>
0380     
0381 
0382 
0383 
0384 <span class="comment">%                         YGF files / Z - axis</span>
0385 <span class="comment">% ========================================================================</span>
0386 
0387 
0388 <span class="comment">% search directory for .YGF file</span>
0389 <span class="keyword">if</span> exist([directory name <span class="string">'.YGF'</span>],<span class="string">'file'</span>)
0390     
0391     <span class="comment">% if exist, load .YGF , convert to usable matrix</span>
0392     fid = fopen( [directory name <span class="string">'.YGF'</span>], <span class="string">'r'</span>,<span class="string">'ieee-be.l64'</span>);
0393     [info.z_axis,info.z_axis_points] = fread(fid,inf,<span class="string">'float64'</span>);
0394     
0395     <span class="comment">% find number of data points</span>
0396     MagField.points = str2num(regexprep(parameters((strmatch(<span class="string">'XPTS'</span>,parameters)),:),<span class="string">'XPTS'</span>,<span class="string">''</span>));
0397     <span class="comment">% reshape the y-axis into columns using number of data points</span>
0398     y = reshape(y, MagField.points , []);
0399     
0400 <span class="keyword">end</span>
0401 
0402 
0403 
0404 <span class="comment">%                         Output arguments</span>
0405 <span class="comment">% ========================================================================</span>
0406 
0407 <span class="comment">% Output results according to requests</span>
0408 <span class="keyword">switch</span> nargout
0409     <span class="keyword">case</span> 0
0410         graph = <span class="string">'plot'</span>;
0411     <span class="keyword">case</span> 1
0412         varargout{1} = y;
0413     <span class="keyword">case</span> 2
0414         varargout{1} = x;
0415         varargout{2} = y;
0416     <span class="keyword">case</span> 3
0417         <span class="keyword">if</span> strcmp(info.EXPT,<span class="string">'PLS'</span>) &amp;&amp; strcmp(info.YTYP,<span class="string">'IDX'</span>)
0418             varargout{1} = x;
0419             varargout{2} = y;
0420             varargout{3} = z;
0421         <span class="keyword">else</span>
0422             <span class="keyword">switch</span> extension
0423                 <span class="keyword">case</span> <span class="string">'.spc'</span>
0424                     info.MWFQ = str2num(regexprep(parameters((strmatch(<span class="string">'MF'</span> ,parameters)),:),<span class="string">'MF'</span> ,<span class="string">''</span>));
0425                     info.MWPW = str2num(regexprep(parameters((strmatch(<span class="string">'MP'</span> ,parameters)),:),<span class="string">'MP'</span> ,<span class="string">''</span>));
0426                     
0427                     info.CenterField    = str2num(regexprep(parameters((strmatch(<span class="string">'HCF'</span>,parameters)),:),<span class="string">'HCF'</span>,<span class="string">''</span>));
0428                     info.SweepWidth     = str2num(regexprep(parameters((strmatch(<span class="string">'HSW'</span>,parameters)),:),<span class="string">'HSW'</span>,<span class="string">''</span>));
0429                     
0430                 <span class="keyword">case</span> <span class="string">'.DTA'</span>
0431                     
0432                     <span class="comment">% create info parameters, only done if requested to minimise</span>
0433                     <span class="comment">% computation time of function</span>
0434                     info.DSRC = strtrim(regexprep(parameters((strmatch(<span class="string">'DSRC'</span>,parameters)),:),<span class="string">'DSRC'</span>,<span class="string">''</span>));
0435                     info.BSEQ = strtrim(regexprep(parameters((strmatch(<span class="string">'BSEQ'</span>,parameters)),:),<span class="string">'BSEQ'</span>,<span class="string">''</span>));
0436                     info.IKKF = strtrim(regexprep(parameters((strmatch(<span class="string">'IKKF'</span>,parameters)),:),<span class="string">'IKKF'</span>,<span class="string">''</span>));
0437                     info.XTYP = strtrim(regexprep(parameters((strmatch(<span class="string">'XTYP'</span>,parameters)),:),<span class="string">'XTYP'</span>,<span class="string">''</span>));
0438                     info.YTYP = strtrim(regexprep(parameters((strmatch(<span class="string">'YTYP'</span>,parameters)),:),<span class="string">'YTYP'</span>,<span class="string">''</span>));
0439                     info.ZTYP = strtrim(regexprep(parameters((strmatch(<span class="string">'ZTYP'</span>,parameters)),:),<span class="string">'ZTYP'</span>,<span class="string">''</span>));
0440                     
0441                     info.IRFMT = strtrim(regexprep(parameters((strmatch(<span class="string">'IRFMT'</span>,parameters)),:),<span class="string">'IRFMT'</span>,<span class="string">''</span>));
0442                     
0443                     info.XMIN = str2num(regexprep(parameters((strmatch(<span class="string">'XMIN'</span>,parameters)),:),<span class="string">'XMIN'</span>,<span class="string">''</span>));
0444                     info.XWID = str2num(regexprep(parameters((strmatch(<span class="string">'XWID'</span>,parameters)),:),<span class="string">'XWID'</span>,<span class="string">''</span>));
0445                     info.XPTS = str2num(regexprep(parameters((strmatch(<span class="string">'XPTS'</span>,parameters)),:),<span class="string">'XPTS'</span>,<span class="string">''</span>));
0446                     
0447                     <span class="comment">% info.TITL = strtrim(regexprep(parameters((strmatch('TITL',parameters)),:),'TITL',''));</span>
0448                     info.IRUNI = strtrim(regexprep(parameters((strmatch(<span class="string">'IRUNI'</span>,parameters)),:),<span class="string">'IRUNI'</span>,<span class="string">''</span>));
0449                     
0450                     info.OPER = strtrim(regexprep(parameters((strmatch(<span class="string">'OPER'</span>,parameters)),:),<span class="string">'OPER'</span>,<span class="string">''</span>));
0451                     info.DATE = strtrim(regexprep(parameters((strmatch(<span class="string">'DATE'</span>,parameters)),:),<span class="string">'DATE'</span>,<span class="string">''</span>));
0452                     info.TIME = strtrim(regexprep(parameters((strmatch(<span class="string">'TIME'</span>,parameters)),:),<span class="string">'TIME'</span>,<span class="string">''</span>));
0453                     info.CMNT = strtrim(regexprep(parameters((strmatch(<span class="string">'CMNT'</span>,parameters)),:),<span class="string">'CMNT'</span>,<span class="string">''</span>));
0454                     info.SAMP = strtrim(regexprep(parameters((strmatch(<span class="string">'SAMP'</span>,parameters)),:),<span class="string">'SAMP'</span>,<span class="string">''</span>));
0455                     info.SFOR = strtrim(regexprep(parameters((strmatch(<span class="string">'SFOR'</span>,parameters)),:),<span class="string">'SFOR'</span>,<span class="string">''</span>));
0456                     info.STAG = strtrim(regexprep(parameters((strmatch(<span class="string">'STAG'</span>,parameters)),:),<span class="string">'STAG'</span>,<span class="string">''</span>));
0457                     info.OXS1 = strtrim(regexprep(parameters((strmatch(<span class="string">'OXS1'</span>,parameters)),:),<span class="string">'OXS1'</span>,<span class="string">''</span>));
0458                     info.AXS1 = strtrim(regexprep(parameters((strmatch(<span class="string">'AXS1'</span>,parameters)),:),<span class="string">'AXS1'</span>,<span class="string">''</span>));
0459                     info.AXS2 = strtrim(regexprep(parameters((strmatch(<span class="string">'AXS2'</span>,parameters)),:),<span class="string">'AXS2'</span>,<span class="string">''</span>));
0460                     info.AXS3 = strtrim(regexprep(parameters((strmatch(<span class="string">'AXS3'</span>,parameters)),:),<span class="string">'AXS3'</span>,<span class="string">''</span>));
0461                     info.A1CT = str2num(regexprep(parameters((strmatch(<span class="string">'A1CT'</span>,parameters)),:),<span class="string">'A1CT'</span>,<span class="string">''</span>));
0462                     info.A1SW = str2num(regexprep(parameters((strmatch(<span class="string">'A1SW'</span>,parameters)),:),<span class="string">'A1SW'</span>,<span class="string">''</span>));
0463                     info.MWFQ = str2num(regexprep(parameters((strmatch(<span class="string">'MWFQ'</span>,parameters)),:),<span class="string">'MWFQ'</span>,<span class="string">''</span>));
0464                     info.MWPW = str2num(regexprep(parameters((strmatch(<span class="string">'MWPW'</span>,parameters)),:),<span class="string">'MWPW'</span>,<span class="string">''</span>));
0465                     info.AVGS = str2num(regexprep(parameters((strmatch(<span class="string">'AVGS'</span>,parameters)),:),<span class="string">'AVGS'</span>,<span class="string">''</span>));
0466                     
0467                     info.CenterField = strtrim(regexprep(parameters((strmatch(<span class="string">'CenterField'</span>,parameters)),:),<span class="string">'CenterField'</span>,<span class="string">''</span>));
0468                     info.FieldFlyback = strtrim(regexprep(parameters((strmatch(<span class="string">'FieldFlyback'</span>,parameters)),:),<span class="string">'FieldFlyback'</span>,<span class="string">''</span>));
0469                     info.FieldWait = strtrim(regexprep(parameters((strmatch(<span class="string">'FieldWait'</span>,parameters)),:),<span class="string">'FieldWait'</span>,<span class="string">''</span>));
0470                     info.GFactor = str2num(regexprep(parameters((strmatch(<span class="string">'GFactor'</span>,parameters)),:),<span class="string">'GFactor'</span>,<span class="string">''</span>));
0471                     info.SetToSampleG = strtrim(regexprep(parameters((strmatch(<span class="string">'SetToSampleG'</span>,parameters)),:),<span class="string">'SetToSampleG'</span>,<span class="string">''</span>));
0472                     info.SweepDirection = strtrim(regexprep(parameters((strmatch(<span class="string">'SweepDirection'</span>,parameters)),:),<span class="string">'SweepDirection'</span>,<span class="string">''</span>));
0473                     
0474                     info.FrequencyMon = strtrim(regexprep(parameters((strmatch(<span class="string">'FrequencyMon'</span>,parameters)),:),<span class="string">'FrequencyMon'</span>,<span class="string">''</span>));
0475                     info.QMonitBridge = strtrim(regexprep(parameters((strmatch(<span class="string">'QMonitBridge'</span>,parameters)),:),<span class="string">'QMonitBridge'</span>,<span class="string">''</span>));
0476                     <span class="comment">% Power is different because strmatch for 'Power' finds Power and</span>
0477                     <span class="comment">% PowerAtten</span>
0478                     info.Power = parameters((strmatch(<span class="string">'Power'</span>,parameters)),:);
0479                     info.Power = strtrim(regexprep((info.Power(1,:)),<span class="string">'Power'</span>,<span class="string">''</span>));
0480                     info.PowerAtten = strtrim(regexprep(parameters((strmatch(<span class="string">'PowerAtten'</span>,parameters)),:),<span class="string">'PowerAtten'</span>,<span class="string">''</span>));
0481                     info.BaselineCorr = strtrim(regexprep(parameters((strmatch(<span class="string">'BaselineCorr'</span>,parameters)),:),<span class="string">'BaselineCorr'</span>,<span class="string">''</span>));
0482                     info.NbScansAcc = str2num(regexprep(parameters((strmatch(<span class="string">'NbScansAcc'</span>,parameters)),:),<span class="string">'NbScansAcc'</span>,<span class="string">''</span>));
0483                     info.NbScansDone = str2num(regexprep(parameters((strmatch(<span class="string">'NbScansDone'</span>,parameters)),:),<span class="string">'NbScansDone'</span>,<span class="string">''</span>));
0484                     info.NbScansToDo = str2num(regexprep(parameters((strmatch(<span class="string">'NbScansToDo'</span>,parameters)),:),<span class="string">'NbScansToDo'</span>,<span class="string">''</span>));
0485                     
0486                     
0487                     <span class="comment">% Experiment dependent parameters</span>
0488                     <span class="keyword">switch</span> info.EXPT
0489                         <span class="keyword">case</span> <span class="string">'PLS'</span>
0490                             <span class="comment">% documentation text</span>
0491                             info.IIFMT = strtrim(regexprep(parameters((strmatch(<span class="string">'IIFMT'</span>,parameters)),:),<span class="string">'IIFMT'</span>,<span class="string">''</span>));
0492                             info.IIUNI = strtrim(regexprep(parameters((strmatch(<span class="string">'IIUNI'</span>,parameters)),:),<span class="string">'IIUNI'</span>,<span class="string">''</span>));
0493                             
0494                             info.Delay = parameters((strmatch(<span class="string">'Delay'</span>,parameters)),:);
0495                             info.Delay = strtrim(regexprep((info.Delay(1,:)),<span class="string">'Delay'</span>,<span class="string">''</span>));
0496                             <span class="comment">% cw bridge</span>
0497                             info.AcqFineTuning = strtrim(regexprep(parameters((strmatch(<span class="string">'AcqFineTuning'</span>,parameters)),:),<span class="string">'AcqFineTuning'</span>,<span class="string">''</span>));
0498                             info.AcqScanFTuning = strtrim(regexprep(parameters((strmatch(<span class="string">'AcqScanFTuning'</span>,parameters)),:),<span class="string">'AcqScanFTuning'</span>,<span class="string">''</span>));
0499                             info.AcqSliceFTuning = strtrim(regexprep(parameters((strmatch(<span class="string">'AcqSliceFTuning'</span>,parameters)),:),<span class="string">'AcqSliceFTuning'</span>,<span class="string">''</span>));
0500                             <span class="comment">% endor</span>
0501                             info.EIEENDORFreq = strtrim(regexprep(parameters((strmatch(<span class="string">'EIEENDORFreq'</span>,parameters)),:),<span class="string">'EIEENDORFreq'</span>,<span class="string">''</span>));
0502                             info.EIEIsotope = strtrim(regexprep(parameters((strmatch(<span class="string">'EIEIsotope'</span>,parameters)),:),<span class="string">'EIEIsotope'</span>,<span class="string">''</span>));
0503                             info.EIERFSweepDir = strtrim(regexprep(parameters((strmatch(<span class="string">'EIERFSweepDir'</span>,parameters)),:),<span class="string">'EIERFSweepDir'</span>,<span class="string">''</span>));
0504                             info.EIEStaticField = strtrim(regexprep(parameters((strmatch(<span class="string">'EIEStaticField'</span>,parameters)),:),<span class="string">'EIEStaticField'</span>,<span class="string">''</span>));
0505                             info.EIEStaticRF = strtrim(regexprep(parameters((strmatch(<span class="string">'EIEStaticRF'</span>,parameters)),:),<span class="string">'EIEStaticRF'</span>,<span class="string">''</span>));
0506                             info.ENDORType = strtrim(regexprep(parameters((strmatch(<span class="string">'ENDORType'</span>,parameters)),:),<span class="string">'ENDORType'</span>,<span class="string">''</span>));
0507                             info.RF1Atten = strtrim(regexprep(parameters((strmatch(<span class="string">'RF1Atten'</span>,parameters)),:),<span class="string">'RF1Atten'</span>,<span class="string">''</span>));
0508                             info.RF1FreqPos = strtrim(regexprep(parameters((strmatch(<span class="string">'RF1FreqPos'</span>,parameters)),:),<span class="string">'RF1FreqPos'</span>,<span class="string">''</span>));
0509                             info.RF1StartFreq = strtrim(regexprep(parameters((strmatch(<span class="string">'RF1StartFreq'</span>,parameters)),:),<span class="string">'RF1StartFreq'</span>,<span class="string">''</span>));
0510                             info.RF1SweepWidth = strtrim(regexprep(parameters((strmatch(<span class="string">'RF1SweepWidth'</span>,parameters)),:),<span class="string">'RF1SweepWidth'</span>,<span class="string">''</span>));
0511                             info.RF2Atten = strtrim(regexprep(parameters((strmatch(<span class="string">'RF2Atten'</span>,parameters)),:),<span class="string">'RF2Atten'</span>,<span class="string">''</span>));
0512                             info.RF2FreqPos = strtrim(regexprep(parameters((strmatch(<span class="string">'RF2FreqPos'</span>,parameters)),:),<span class="string">'RF2FreqPos'</span>,<span class="string">''</span>));
0513                             info.RF2StartFreq = strtrim(regexprep(parameters((strmatch(<span class="string">'RF2StartFreq'</span>,parameters)),:),<span class="string">'RF2StartFreq'</span>,<span class="string">''</span>));
0514                             info.RF2SweepWidth = strtrim(regexprep(parameters((strmatch(<span class="string">'RF2SweepWidth'</span>,parameters)),:),<span class="string">'RF2SweepWidth'</span>,<span class="string">''</span>));
0515                             info.RFSrcMixing = strtrim(regexprep(parameters((strmatch(<span class="string">'RFSrcMixing'</span>,parameters)),:),<span class="string">'RFSrcMixing'</span>,<span class="string">''</span>));
0516                             info.SumAtten = parameters((strmatch(<span class="string">'SumAtten'</span>,parameters)),:);
0517                             info.SumAtten = strtrim(regexprep((info.Power(1,:)),<span class="string">'SumAtten'</span>,<span class="string">''</span>));
0518                             info.SumAttenStart = strtrim(regexprep(parameters((strmatch(<span class="string">'SumAttenStart'</span>,parameters)),:),<span class="string">'SumAttenStart'</span>,<span class="string">''</span>));
0519                             info.SumAttenWidth = strtrim(regexprep(parameters((strmatch(<span class="string">'SumAttenWidth'</span>,parameters)),:),<span class="string">'SumAttenWidth'</span>,<span class="string">''</span>));
0520                             <span class="comment">% fieldCtrl</span>
0521                             info.FieldResol = str2num(regexprep(parameters((strmatch(<span class="string">'FieldResol'</span>,parameters)),:),<span class="string">'FieldResol'</span>,<span class="string">''</span>));
0522                             <span class="comment">% ftBridge</span>
0523                             info.Attenuation = strtrim(regexprep(parameters((strmatch(<span class="string">'Attenuation'</span>,parameters)),:),<span class="string">'Attenuation'</span>,<span class="string">''</span>));
0524                             info.ELDORAtt = strtrim(regexprep(parameters((strmatch(<span class="string">'ELDORAtt'</span>,parameters)),:),<span class="string">'ELDORAtt'</span>,<span class="string">''</span>));
0525                             info.FrequencyA = strtrim(regexprep(parameters((strmatch(<span class="string">'FrequencyA'</span>,parameters)),:),<span class="string">'FrequencyA'</span>,<span class="string">''</span>));
0526                             info.VideoBW = strtrim(regexprep(parameters((strmatch(<span class="string">'VideoBW'</span>,parameters)),:),<span class="string">'VideoBW'</span>,<span class="string">''</span>));
0527                             info.VideoGain = strtrim(regexprep(parameters((strmatch(<span class="string">'VideoGain'</span>,parameters)),:),<span class="string">'VideoGain'</span>,<span class="string">''</span>));
0528                             <span class="comment">% ftEpr</span>
0529                             info.AutoTimeOut = strtrim(regexprep(parameters((strmatch(<span class="string">'AutoTimeOut'</span>,parameters)),:),<span class="string">'AutoTimeOut'</span>,<span class="string">''</span>));
0530                             info.AveragesPerScan = str2num(regexprep(parameters((strmatch(<span class="string">'AveragesPerScan'</span>,parameters)),:),<span class="string">'AveragesPerScan'</span>,<span class="string">''</span>));
0531                             info.ELDORFreqStart = strtrim(regexprep(parameters((strmatch(<span class="string">'ELDORFreqStart'</span>,parameters)),:),<span class="string">'ELDORFreqStart'</span>,<span class="string">''</span>));
0532                             info.ELDORFreqWidth = strtrim(regexprep(parameters((strmatch(<span class="string">'ELDORFreqWidth'</span>,parameters)),:),<span class="string">'ELDORFreqWidth'</span>,<span class="string">''</span>));
0533                             info.FTAcqModeSlct = strtrim(regexprep(parameters((strmatch(<span class="string">'FTAcqModeSlct'</span>,parameters)),:),<span class="string">'FTAcqModeSlct'</span>,<span class="string">''</span>));
0534                             info.PPExtTrg = parameters((strmatch(<span class="string">'PPExtTrg'</span>,parameters)),:);
0535                             info.PPExtTrg = strtrim(regexprep((info.PPExtTrg(1,:)),<span class="string">'PPExtTrg'</span>,<span class="string">''</span>));
0536                             info.PPExtTrgSlope = strtrim(regexprep(parameters((strmatch(<span class="string">'PPExtTrgSlope'</span>,parameters)),:),<span class="string">'PPExtTrgSlope'</span>,<span class="string">''</span>));
0537                             info.PlsSPELEXPSlct = strtrim(regexprep(parameters((strmatch(<span class="string">'PlsSPELEXPSlct'</span>,parameters)),:),<span class="string">'PlsSPELEXPSlct'</span>,<span class="string">''</span>));
0538                             info.ReplaceMode = parameters((strmatch(<span class="string">'ReplaceMode'</span>,parameters)),:);
0539                             info.ReplaceMode_ftEpr = strtrim(regexprep((info.ReplaceMode(1,:)),<span class="string">'ReplaceMode'</span>,<span class="string">''</span>));
0540                             info.ReplaceMode_recorder = strtrim(regexprep((info.ReplaceMode(2,:)),<span class="string">'ReplaceMode'</span>,<span class="string">''</span>));
0541                             clear info.ReplaceMode
0542                             info.ShotRepTime = strtrim(regexprep(parameters((strmatch(<span class="string">'ShotRepTime'</span>,parameters)),:),<span class="string">'ShotRepTime'</span>,<span class="string">''</span>));
0543                             info.ShotsPLoop = strtrim(regexprep(parameters((strmatch(<span class="string">'ShotsPLoop'</span>,parameters)),:),<span class="string">'ShotsPLoop'</span>,<span class="string">''</span>));
0544                             info.SptProgress = strtrim(regexprep(parameters((strmatch(<span class="string">'SptProgress'</span>,parameters)),:),<span class="string">'SptProgress'</span>,<span class="string">''</span>));
0545                             info.SweepsPExp = strtrim(regexprep(parameters((strmatch(<span class="string">'SweepsPExp'</span>,parameters)),:),<span class="string">'SweepsPExp'</span>,<span class="string">''</span>));
0546                             info.TriggerTimeOut = strtrim(regexprep(parameters((strmatch(<span class="string">'TriggerTimeOut'</span>,parameters)),:),<span class="string">'TriggerTimeOut'</span>,<span class="string">''</span>));
0547                             info.XAxisQuant = strtrim(regexprep(parameters((strmatch(<span class="string">'XAxisQuant'</span>,parameters)),:),<span class="string">'XAxisQuant'</span>,<span class="string">''</span>));
0548                             info.XSpecRes = str2num(regexprep(parameters((strmatch(<span class="string">'XSpecRes'</span>,parameters)),:),<span class="string">'XSpecRes'</span>,<span class="string">''</span>));
0549                             info.YAxisQuant = strtrim(regexprep(parameters((strmatch(<span class="string">'YAxisQuant'</span>,parameters)),:),<span class="string">'YAxisQuant'</span>,<span class="string">''</span>));
0550                             info.YSpecRes = str2num(regexprep(parameters((strmatch(<span class="string">'YSpecRes'</span>,parameters)),:),<span class="string">'YSpecRes'</span>,<span class="string">''</span>));
0551                             
0552                             
0553                         <span class="keyword">case</span> <span class="string">'CW'</span>
0554                             <span class="comment">% document text</span>
0555                             info.YFMT = strtrim(regexprep(parameters((strmatch(<span class="string">'YFMT'</span>,parameters)),:),<span class="string">'YFMT'</span>,<span class="string">''</span>));
0556                             info.YNAM = strtrim(regexprep(parameters((strmatch(<span class="string">'YNAM'</span>,parameters)),:),<span class="string">'YNAM'</span>,<span class="string">''</span>));
0557                             info.YUNI = strtrim(regexprep(parameters((strmatch(<span class="string">'YUNI'</span>,parameters)),:),<span class="string">'YUNI'</span>,<span class="string">''</span>));
0558                             <span class="comment">% standard parameter</span>
0559                             info.RESO = strtrim(regexprep(parameters((strmatch(<span class="string">'RESO'</span>,parameters)),:),<span class="string">'RESO'</span>,<span class="string">''</span>));
0560                             info.SPTP = str2num(regexprep(parameters((strmatch(<span class="string">'SPTP'</span>,parameters)),:),<span class="string">'SPTP'</span>,<span class="string">''</span>));
0561                             info.RCAG = str2num(regexprep(parameters((strmatch(<span class="string">'RCAG'</span>,parameters)),:),<span class="string">'RCAG'</span>,<span class="string">''</span>));
0562                             info.RCHM = str2num(regexprep(parameters((strmatch(<span class="string">'RCHM'</span>,parameters)),:),<span class="string">'RCHM'</span>,<span class="string">''</span>));
0563                             info.B0MA = str2num(regexprep(parameters((strmatch(<span class="string">'B0MA'</span>,parameters)),:),<span class="string">'B0MA'</span>,<span class="string">''</span>));
0564                             info.B0MF = str2num(regexprep(parameters((strmatch(<span class="string">'B0MF'</span>,parameters)),:),<span class="string">'B0MF'</span>,<span class="string">''</span>));
0565                             info.RCPH = str2num(regexprep(parameters((strmatch(<span class="string">'RCPH'</span>,parameters)),:),<span class="string">'RCPH'</span>,<span class="string">''</span>));
0566                             info.RCOF = str2num(regexprep(parameters((strmatch(<span class="string">'RCOF'</span>,parameters)),:),<span class="string">'RCOF'</span>,<span class="string">''</span>));
0567                             info.A1RS = str2num(regexprep(parameters((strmatch(<span class="string">'A1RS'</span>,parameters)),:),<span class="string">'A1RS'</span>,<span class="string">''</span>));
0568                             info.RCTC = str2num(regexprep(parameters((strmatch(<span class="string">'RCTC'</span>,parameters)),:),<span class="string">'RCTC'</span>,<span class="string">''</span>));
0569                             <span class="comment">% mwBridge</span>
0570                             info.AcqFineTuning = strtrim(regexprep(parameters((strmatch(<span class="string">'AcqFineTuning'</span>,parameters)),:),<span class="string">'AcqFineTuning'</span>,<span class="string">''</span>));
0571                             <span class="comment">% fieldCtrl</span>
0572                             <span class="comment">%            info.SweepWidth = parameters((strmatch('SweepWidth',parameters)),:);</span>
0573                             <span class="comment">%            info.SweepWidth_fieldCtrl = strtrim(regexprep((info.SweepWidth(1,:)),'SweepWidth',''));</span>
0574                             <span class="comment">%            info.SweepWidth_ramp2 = strtrim(regexprep((info.SweepWidth(2,:)),'SweepWidth',''));</span>
0575                             clear info.SweepWidth
0576                             info.Delay = strtrim(regexprep(parameters((strmatch(<span class="string">'Delay'</span>,parameters,<span class="string">'exact'</span>)),:),<span class="string">'Delay'</span>,<span class="string">''</span>));
0577                             info.ReplaceMode = strtrim(regexprep(parameters((strmatch(<span class="string">'ReplaceMode'</span>,parameters)),:),<span class="string">'ReplaceMode'</span>,<span class="string">''</span>));
0578                             <span class="comment">% signalChannel</span>
0579                             info.AFCTrap = strtrim(regexprep(parameters((strmatch(<span class="string">'AFCTrap'</span>,parameters)),:),<span class="string">'AFCTrap'</span>,<span class="string">''</span>));
0580                             info.Calibrated = strtrim(regexprep(parameters((strmatch(<span class="string">'Calibrated'</span>,parameters)),:),<span class="string">'Calibrated'</span>,<span class="string">''</span>));
0581                             info.ConvTime = strtrim(regexprep(parameters((strmatch(<span class="string">'ConvTime'</span>,parameters)),:),<span class="string">'ConvTime'</span>,<span class="string">''</span>));
0582                             info.DModAFCTrap = strtrim(regexprep(parameters((strmatch(<span class="string">'DModAFCTrap'</span>,parameters)),:),<span class="string">'DModAFCTrap'</span>,<span class="string">''</span>));
0583                             info.DModAmp = strtrim(regexprep(parameters((strmatch(<span class="string">'DModAmp'</span>,parameters)),:),<span class="string">'DModAmp'</span>,<span class="string">''</span>));
0584                             info.DModCalibrated = strtrim(regexprep(parameters((strmatch(<span class="string">'DModCalibrated'</span>,parameters)),:),<span class="string">'DModCalibrated'</span>,<span class="string">''</span>));
0585                             info.DModDetectSCT = strtrim(regexprep(parameters((strmatch(<span class="string">'DModDetectSCT'</span>,parameters)),:),<span class="string">'DModDetectSCT'</span>,<span class="string">''</span>));
0586                             info.DModEliDelay = strtrim(regexprep(parameters((strmatch(<span class="string">'DModEliDelay'</span>,parameters)),:),<span class="string">'DModEliDelay'</span>,<span class="string">''</span>));
0587                             info.DModExtLockIn = strtrim(regexprep(parameters((strmatch(<span class="string">'DModExtLockIn'</span>,parameters)),:),<span class="string">'DModExtLockIn'</span>,<span class="string">''</span>));
0588                             info.DModExtTrigger = strtrim(regexprep(parameters((strmatch(<span class="string">'DModExtTrigger'</span>,parameters)),:),<span class="string">'DModExtTrigger'</span>,<span class="string">''</span>));
0589                             info.DModFieldMod = strtrim(regexprep(parameters((strmatch(<span class="string">'DModFieldMod'</span>,parameters)),:),<span class="string">'DModFieldMod'</span>,<span class="string">''</span>));
0590                             info.DModGain = strtrim(regexprep(parameters((strmatch(<span class="string">'DModGain'</span>,parameters)),:),<span class="string">'DModGain'</span>,<span class="string">''</span>));
0591                             info.DModHighPass = strtrim(regexprep(parameters((strmatch(<span class="string">'DModHighPass'</span>,parameters)),:),<span class="string">'DModHighPass'</span>,<span class="string">''</span>));
0592                             info.DModIntegrator = strtrim(regexprep(parameters((strmatch(<span class="string">'DModIntegrator'</span>,parameters)),:),<span class="string">'DModIntegrator'</span>,<span class="string">''</span>));
0593                             info.DModModOutput = strtrim(regexprep(parameters((strmatch(<span class="string">'DModModOutput'</span>,parameters)),:),<span class="string">'DModModOutput'</span>,<span class="string">''</span>));
0594                             info.DModSignalInput = strtrim(regexprep(parameters((strmatch(<span class="string">'DModSignalInput'</span>,parameters)),:),<span class="string">'DModSignalInput'</span>,<span class="string">''</span>));
0595                             info.DModTimeConst = strtrim(regexprep(parameters((strmatch(<span class="string">'DModTimeConst'</span>,parameters)),:),<span class="string">'DModTimeConst'</span>,<span class="string">''</span>));
0596                             info.DoubleModFreq = strtrim(regexprep(parameters((strmatch(<span class="string">'DoubleModFreq'</span>,parameters)),:),<span class="string">'DoubleModFreq'</span>,<span class="string">''</span>));
0597                             info.DoubleModPhase = strtrim(regexprep(parameters((strmatch(<span class="string">'DoubleModPhase'</span>,parameters)),:),<span class="string">'DoubleModPhase'</span>,<span class="string">''</span>));
0598                             info.DoubleMode = strtrim(regexprep(parameters((strmatch(<span class="string">'DoubleMode'</span>,parameters)),:),<span class="string">'DoubleMode'</span>,<span class="string">''</span>));
0599                             info.EliDelay = strtrim(regexprep(parameters((strmatch(<span class="string">'EliDelay'</span>,parameters)),:),<span class="string">'EliDelay'</span>,<span class="string">''</span>));
0600                             info.ExtLockIn = strtrim(regexprep(parameters((strmatch(<span class="string">'ExtLockIn'</span>,parameters)),:),<span class="string">'ExtLockIn'</span>,<span class="string">''</span>));
0601                             info.ExtTrigger = strtrim(regexprep(parameters((strmatch(<span class="string">'ExtTrigger'</span>,parameters)),:),<span class="string">'ExtTrigger'</span>,<span class="string">''</span>));
0602                             info.Gain = strtrim(regexprep(parameters((strmatch(<span class="string">'Gain'</span>,parameters)),:),<span class="string">'Gain'</span>,<span class="string">''</span>));
0603                             info.Harmonic = str2num(regexprep(parameters((strmatch(<span class="string">'Harmonic'</span>,parameters)),:),<span class="string">'Harmonic'</span>,<span class="string">''</span>));
0604                             info.HighPass = strtrim(regexprep(parameters((strmatch(<span class="string">'HighPass'</span>,parameters)),:),<span class="string">'HighPass'</span>,<span class="string">''</span>));
0605                             info.Integrator = strtrim(regexprep(parameters((strmatch(<span class="string">'Integrator'</span>,parameters)),:),<span class="string">'Integrator'</span>,<span class="string">''</span>));
0606                             info.ModAmp = strtrim(regexprep(parameters((strmatch(<span class="string">'ModAmp'</span>,parameters)),:),<span class="string">'ModAmp'</span>,<span class="string">''</span>));
0607                             info.ModFreq = strtrim(regexprep(parameters((strmatch(<span class="string">'ModFreq'</span>,parameters)),:),<span class="string">'ModFreq'</span>,<span class="string">''</span>));
0608                             info.ModInput = strtrim(regexprep(parameters((strmatch(<span class="string">'ModInput'</span>,parameters)),:),<span class="string">'ModInput'</span>,<span class="string">''</span>));
0609                             info.ModOutput = strtrim(regexprep(parameters((strmatch(<span class="string">'ModOutput'</span>,parameters)),:),<span class="string">'ModOutput'</span>,<span class="string">''</span>));
0610                             info.ModPhase = str2num(regexprep(parameters((strmatch(<span class="string">'ModPhase'</span>,parameters)),:),<span class="string">'ModPhase'</span>,<span class="string">''</span>));
0611                             info.Offset = strtrim(regexprep(parameters((strmatch(<span class="string">'Offset'</span>,parameters)),:),<span class="string">'Offset'</span>,<span class="string">''</span>));
0612                             info.QuadMode = strtrim(regexprep(parameters((strmatch(<span class="string">'QuadMode'</span>,parameters)),:),<span class="string">'QuadMode'</span>,<span class="string">''</span>));
0613                             info.QuadPhase = str2num(regexprep(parameters((strmatch(<span class="string">'QuadPhase'</span>,parameters)),:),<span class="string">'QuadPhase'</span>,<span class="string">''</span>));
0614                             info.Resolution = str2num(regexprep(parameters((strmatch(<span class="string">'Resolution'</span>,parameters)),:),<span class="string">'Resolution'</span>,<span class="string">''</span>));
0615                             info.Resonator = str2num(regexprep(parameters((strmatch(<span class="string">'Resonator'</span>,parameters)),:),<span class="string">'Resonator'</span>,<span class="string">''</span>));
0616                             info.SctNorm = strtrim(regexprep(parameters((strmatch(<span class="string">'SctNorm'</span>,parameters)),:),<span class="string">'SctNorm'</span>,<span class="string">''</span>));
0617                             info.SctRevision = strtrim(regexprep(parameters((strmatch(<span class="string">'SctRevision'</span>,parameters)),:),<span class="string">'SctRevision'</span>,<span class="string">''</span>));
0618                             info.SignalInput = strtrim(regexprep(parameters((strmatch(<span class="string">'SignalInput'</span>,parameters)),:),<span class="string">'SignalInput'</span>,<span class="string">''</span>));
0619                             info.SweepTime = strtrim(regexprep(parameters((strmatch(<span class="string">'SweepTime'</span>,parameters)),:),<span class="string">'SweepTime'</span>,<span class="string">''</span>));
0620                             info.TimeConst = strtrim(regexprep(parameters((strmatch(<span class="string">'TimeConst'</span>,parameters)),:),<span class="string">'TimeConst'</span>,<span class="string">''</span>));
0621                             info.TuneCaps = str2num(regexprep(parameters((strmatch(<span class="string">'TuneCaps'</span>,parameters)),:),<span class="string">'TuneCaps'</span>,<span class="string">''</span>));
0622                     <span class="keyword">end</span>
0623             <span class="keyword">end</span>
0624             
0625             varargout{1} = x;
0626             varargout{2} = y;
0627             varargout{3} = info;
0628         <span class="keyword">end</span>
0629         
0630     <span class="keyword">case</span> 4
0631         
0632         <span class="comment">% Generate info section</span>
0633         info.DSRC = strtrim(regexprep(parameters((strmatch(<span class="string">'DSRC'</span>,parameters)),:),<span class="string">'DSRC'</span>,<span class="string">''</span>));
0634         info.BSEQ = strtrim(regexprep(parameters((strmatch(<span class="string">'BSEQ'</span>,parameters)),:),<span class="string">'BSEQ'</span>,<span class="string">''</span>));
0635         info.IKKF = strtrim(regexprep(parameters((strmatch(<span class="string">'IKKF'</span>,parameters)),:),<span class="string">'IKKF'</span>,<span class="string">''</span>));
0636         info.ZTYP = strtrim(regexprep(parameters((strmatch(<span class="string">'ZTYP'</span>,parameters)),:),<span class="string">'ZTYP'</span>,<span class="string">''</span>));
0637         
0638         info.IRFMT = strtrim(regexprep(parameters((strmatch(<span class="string">'IRFMT'</span>,parameters)),:),<span class="string">'IRFMT'</span>,<span class="string">''</span>));
0639         info.IRUNI = strtrim(regexprep(parameters((strmatch(<span class="string">'IRUNI'</span>,parameters)),:),<span class="string">'IRUNI'</span>,<span class="string">''</span>));
0640         info.OPER = strtrim(regexprep(parameters((strmatch(<span class="string">'OPER'</span>,parameters)),:),<span class="string">'OPER'</span>,<span class="string">''</span>));
0641         info.DATE = strtrim(regexprep(parameters((strmatch(<span class="string">'DATE'</span>,parameters)),:),<span class="string">'DATE'</span>,<span class="string">''</span>));
0642         info.TIME = strtrim(regexprep(parameters((strmatch(<span class="string">'TIME'</span>,parameters)),:),<span class="string">'TIME'</span>,<span class="string">''</span>));
0643         info.CMNT = strtrim(regexprep(parameters((strmatch(<span class="string">'CMNT'</span>,parameters)),:),<span class="string">'CMNT'</span>,<span class="string">''</span>));
0644         info.SAMP = strtrim(regexprep(parameters((strmatch(<span class="string">'SAMP'</span>,parameters)),:),<span class="string">'SAMP'</span>,<span class="string">''</span>));
0645         info.SFOR = strtrim(regexprep(parameters((strmatch(<span class="string">'SFOR'</span>,parameters)),:),<span class="string">'SFOR'</span>,<span class="string">''</span>));
0646         info.STAG = strtrim(regexprep(parameters((strmatch(<span class="string">'STAG'</span>,parameters)),:),<span class="string">'STAG'</span>,<span class="string">''</span>));
0647         info.OXS1 = strtrim(regexprep(parameters((strmatch(<span class="string">'OXS1'</span>,parameters)),:),<span class="string">'OXS1'</span>,<span class="string">''</span>));
0648         info.AXS1 = strtrim(regexprep(parameters((strmatch(<span class="string">'AXS1'</span>,parameters)),:),<span class="string">'AXS1'</span>,<span class="string">''</span>));
0649         info.AXS2 = strtrim(regexprep(parameters((strmatch(<span class="string">'AXS2'</span>,parameters)),:),<span class="string">'AXS2'</span>,<span class="string">''</span>));
0650         info.AXS3 = strtrim(regexprep(parameters((strmatch(<span class="string">'AXS3'</span>,parameters)),:),<span class="string">'AXS3'</span>,<span class="string">''</span>));
0651         info.A1CT = str2num(regexprep(parameters((strmatch(<span class="string">'A1CT'</span>,parameters)),:),<span class="string">'A1CT'</span>,<span class="string">''</span>));
0652         info.A1SW = str2num(regexprep(parameters((strmatch(<span class="string">'A1SW'</span>,parameters)),:),<span class="string">'A1SW'</span>,<span class="string">''</span>));
0653         info.MWFQ = str2num(regexprep(parameters((strmatch(<span class="string">'MWFQ'</span>,parameters)),:),<span class="string">'MWFQ'</span>,<span class="string">''</span>));
0654         info.MWPW = str2num(regexprep(parameters((strmatch(<span class="string">'MWPW'</span>,parameters)),:),<span class="string">'MWPW'</span>,<span class="string">''</span>));
0655         info.AVGS = str2num(regexprep(parameters((strmatch(<span class="string">'AVGS'</span>,parameters)),:),<span class="string">'AVGS'</span>,<span class="string">''</span>));
0656         
0657         info.CenterField = strtrim(regexprep(parameters((strmatch(<span class="string">'CenterField'</span>,parameters)),:),<span class="string">'CenterField'</span>,<span class="string">''</span>));
0658         info.FieldFlyback = strtrim(regexprep(parameters((strmatch(<span class="string">'FieldFlyback'</span>,parameters)),:),<span class="string">'FieldFlyback'</span>,<span class="string">''</span>));
0659         info.FieldWait = strtrim(regexprep(parameters((strmatch(<span class="string">'FieldWait'</span>,parameters)),:),<span class="string">'FieldWait'</span>,<span class="string">''</span>));
0660         info.GFactor = str2num(regexprep(parameters((strmatch(<span class="string">'GFactor'</span>,parameters)),:),<span class="string">'GFactor'</span>,<span class="string">''</span>));
0661         info.SetToSampleG = strtrim(regexprep(parameters((strmatch(<span class="string">'SetToSampleG'</span>,parameters)),:),<span class="string">'SetToSampleG'</span>,<span class="string">''</span>));
0662         info.SweepDirection = strtrim(regexprep(parameters((strmatch(<span class="string">'SweepDirection'</span>,parameters)),:),<span class="string">'SweepDirection'</span>,<span class="string">''</span>));
0663         
0664         info.FrequencyMon = strtrim(regexprep(parameters((strmatch(<span class="string">'FrequencyMon'</span>,parameters)),:),<span class="string">'FrequencyMon'</span>,<span class="string">''</span>));
0665         info.QMonitBridge = strtrim(regexprep(parameters((strmatch(<span class="string">'QMonitBridge'</span>,parameters)),:),<span class="string">'QMonitBridge'</span>,<span class="string">''</span>));
0666         <span class="comment">% Power is different because strmatch for 'Power' finds Power and</span>
0667         <span class="comment">% PowerAtten</span>
0668         info.Power = parameters((strmatch(<span class="string">'Power'</span>,parameters)),:);
0669         info.Power = strtrim(regexprep((info.Power(1,:)),<span class="string">'Power'</span>,<span class="string">''</span>));
0670         info.PowerAtten = strtrim(regexprep(parameters((strmatch(<span class="string">'PowerAtten'</span>,parameters)),:),<span class="string">'PowerAtten'</span>,<span class="string">''</span>));
0671         info.BaselineCorr = strtrim(regexprep(parameters((strmatch(<span class="string">'BaselineCorr'</span>,parameters)),:),<span class="string">'BaselineCorr'</span>,<span class="string">''</span>));
0672         info.NbScansAcc = str2num(regexprep(parameters((strmatch(<span class="string">'NbScansAcc'</span>,parameters)),:),<span class="string">'NbScansAcc'</span>,<span class="string">''</span>));
0673         info.NbScansDone = str2num(regexprep(parameters((strmatch(<span class="string">'NbScansDone'</span>,parameters)),:),<span class="string">'NbScansDone'</span>,<span class="string">''</span>));
0674         info.NbScansToDo = str2num(regexprep(parameters((strmatch(<span class="string">'NbScansToDo'</span>,parameters)),:),<span class="string">'NbScansToDo'</span>,<span class="string">''</span>));
0675         
0676         <span class="comment">% Pulsed information</span>
0677         <span class="comment">% documentation text</span>
0678         info.IIFMT = strtrim(regexprep(parameters((strmatch(<span class="string">'IIFMT'</span>,parameters)),:),<span class="string">'IIFMT'</span>,<span class="string">''</span>));
0679         info.IIUNI = strtrim(regexprep(parameters((strmatch(<span class="string">'IIUNI'</span>,parameters)),:),<span class="string">'IIUNI'</span>,<span class="string">''</span>));
0680         
0681         info.Delay = parameters((strmatch(<span class="string">'Delay'</span>,parameters)),:);
0682         info.Delay = strtrim(regexprep((info.Delay(1,:)),<span class="string">'Delay'</span>,<span class="string">''</span>));
0683         <span class="comment">% cw bridge</span>
0684         info.AcqFineTuning = strtrim(regexprep(parameters((strmatch(<span class="string">'AcqFineTuning'</span>,parameters)),:),<span class="string">'AcqFineTuning'</span>,<span class="string">''</span>));
0685         info.AcqScanFTuning = strtrim(regexprep(parameters((strmatch(<span class="string">'AcqScanFTuning'</span>,parameters)),:),<span class="string">'AcqScanFTuning'</span>,<span class="string">''</span>));
0686         info.AcqSliceFTuning = strtrim(regexprep(parameters((strmatch(<span class="string">'AcqSliceFTuning'</span>,parameters)),:),<span class="string">'AcqSliceFTuning'</span>,<span class="string">''</span>));
0687         <span class="comment">% endor</span>
0688         info.EIEENDORFreq = strtrim(regexprep(parameters((strmatch(<span class="string">'EIEENDORFreq'</span>,parameters)),:),<span class="string">'EIEENDORFreq'</span>,<span class="string">''</span>));
0689         info.EIEIsotope = strtrim(regexprep(parameters((strmatch(<span class="string">'EIEIsotope'</span>,parameters)),:),<span class="string">'EIEIsotope'</span>,<span class="string">''</span>));
0690         info.EIERFSweepDir = strtrim(regexprep(parameters((strmatch(<span class="string">'EIERFSweepDir'</span>,parameters)),:),<span class="string">'EIERFSweepDir'</span>,<span class="string">''</span>));
0691         info.EIEStaticField = strtrim(regexprep(parameters((strmatch(<span class="string">'EIEStaticField'</span>,parameters)),:),<span class="string">'EIEStaticField'</span>,<span class="string">''</span>));
0692         info.EIEStaticRF = strtrim(regexprep(parameters((strmatch(<span class="string">'EIEStaticRF'</span>,parameters)),:),<span class="string">'EIEStaticRF'</span>,<span class="string">''</span>));
0693         info.ENDORType = strtrim(regexprep(parameters((strmatch(<span class="string">'ENDORType'</span>,parameters)),:),<span class="string">'ENDORType'</span>,<span class="string">''</span>));
0694         info.RF1Atten = strtrim(regexprep(parameters((strmatch(<span class="string">'RF1Atten'</span>,parameters)),:),<span class="string">'RF1Atten'</span>,<span class="string">''</span>));
0695         info.RF1FreqPos = strtrim(regexprep(parameters((strmatch(<span class="string">'RF1FreqPos'</span>,parameters)),:),<span class="string">'RF1FreqPos'</span>,<span class="string">''</span>));
0696         info.RF1StartFreq = strtrim(regexprep(parameters((strmatch(<span class="string">'RF1StartFreq'</span>,parameters)),:),<span class="string">'RF1StartFreq'</span>,<span class="string">''</span>));
0697         info.RF1SweepWidth = strtrim(regexprep(parameters((strmatch(<span class="string">'RF1SweepWidth'</span>,parameters)),:),<span class="string">'RF1SweepWidth'</span>,<span class="string">''</span>));
0698         info.RF2Atten = strtrim(regexprep(parameters((strmatch(<span class="string">'RF2Atten'</span>,parameters)),:),<span class="string">'RF2Atten'</span>,<span class="string">''</span>));
0699         info.RF2FreqPos = strtrim(regexprep(parameters((strmatch(<span class="string">'RF2FreqPos'</span>,parameters)),:),<span class="string">'RF2FreqPos'</span>,<span class="string">''</span>));
0700         info.RF2StartFreq = strtrim(regexprep(parameters((strmatch(<span class="string">'RF2StartFreq'</span>,parameters)),:),<span class="string">'RF2StartFreq'</span>,<span class="string">''</span>));
0701         info.RF2SweepWidth = strtrim(regexprep(parameters((strmatch(<span class="string">'RF2SweepWidth'</span>,parameters)),:),<span class="string">'RF2SweepWidth'</span>,<span class="string">''</span>));
0702         info.RFSrcMixing = strtrim(regexprep(parameters((strmatch(<span class="string">'RFSrcMixing'</span>,parameters)),:),<span class="string">'RFSrcMixing'</span>,<span class="string">''</span>));
0703         info.SumAtten = parameters((strmatch(<span class="string">'SumAtten'</span>,parameters)),:);
0704         info.SumAtten = strtrim(regexprep((info.Power(1,:)),<span class="string">'SumAtten'</span>,<span class="string">''</span>));
0705         info.SumAttenStart = strtrim(regexprep(parameters((strmatch(<span class="string">'SumAttenStart'</span>,parameters)),:),<span class="string">'SumAttenStart'</span>,<span class="string">''</span>));
0706         info.SumAttenWidth = strtrim(regexprep(parameters((strmatch(<span class="string">'SumAttenWidth'</span>,parameters)),:),<span class="string">'SumAttenWidth'</span>,<span class="string">''</span>));
0707         <span class="comment">% fieldCtrl</span>
0708         info.FieldResol = str2num(regexprep(parameters((strmatch(<span class="string">'FieldResol'</span>,parameters)),:),<span class="string">'FieldResol'</span>,<span class="string">''</span>));
0709         <span class="comment">% ftBridge</span>
0710         info.Attenuation = strtrim(regexprep(parameters((strmatch(<span class="string">'Attenuation'</span>,parameters)),:),<span class="string">'Attenuation'</span>,<span class="string">''</span>));
0711         info.ELDORAtt = strtrim(regexprep(parameters((strmatch(<span class="string">'ELDORAtt'</span>,parameters)),:),<span class="string">'ELDORAtt'</span>,<span class="string">''</span>));
0712         info.FrequencyA = strtrim(regexprep(parameters((strmatch(<span class="string">'FrequencyA'</span>,parameters)),:),<span class="string">'FrequencyA'</span>,<span class="string">''</span>));
0713         info.VideoBW = strtrim(regexprep(parameters((strmatch(<span class="string">'VideoBW'</span>,parameters)),:),<span class="string">'VideoBW'</span>,<span class="string">''</span>));
0714         info.VideoGain = strtrim(regexprep(parameters((strmatch(<span class="string">'VideoGain'</span>,parameters)),:),<span class="string">'VideoGain'</span>,<span class="string">''</span>));
0715         <span class="comment">% ftEpr</span>
0716         info.AutoTimeOut = strtrim(regexprep(parameters((strmatch(<span class="string">'AutoTimeOut'</span>,parameters)),:),<span class="string">'AutoTimeOut'</span>,<span class="string">''</span>));
0717         info.AveragesPerScan = str2num(regexprep(parameters((strmatch(<span class="string">'AveragesPerScan'</span>,parameters)),:),<span class="string">'AveragesPerScan'</span>,<span class="string">''</span>));
0718         info.ELDORFreqStart = strtrim(regexprep(parameters((strmatch(<span class="string">'ELDORFreqStart'</span>,parameters)),:),<span class="string">'ELDORFreqStart'</span>,<span class="string">''</span>));
0719         info.ELDORFreqWidth = strtrim(regexprep(parameters((strmatch(<span class="string">'ELDORFreqWidth'</span>,parameters)),:),<span class="string">'ELDORFreqWidth'</span>,<span class="string">''</span>));
0720         info.FTAcqModeSlct = strtrim(regexprep(parameters((strmatch(<span class="string">'FTAcqModeSlct'</span>,parameters)),:),<span class="string">'FTAcqModeSlct'</span>,<span class="string">''</span>));
0721         info.PPExtTrg = parameters((strmatch(<span class="string">'PPExtTrg'</span>,parameters)),:);
0722         info.PPExtTrg = strtrim(regexprep((info.PPExtTrg(1,:)),<span class="string">'PPExtTrg'</span>,<span class="string">''</span>));
0723         info.PPExtTrgSlope = strtrim(regexprep(parameters((strmatch(<span class="string">'PPExtTrgSlope'</span>,parameters)),:),<span class="string">'PPExtTrgSlope'</span>,<span class="string">''</span>));
0724         info.PlsSPELEXPSlct = strtrim(regexprep(parameters((strmatch(<span class="string">'PlsSPELEXPSlct'</span>,parameters)),:),<span class="string">'PlsSPELEXPSlct'</span>,<span class="string">''</span>));
0725         info.ReplaceMode = parameters((strmatch(<span class="string">'ReplaceMode'</span>,parameters)),:);
0726         info.ReplaceMode_ftEpr = strtrim(regexprep((info.ReplaceMode(1,:)),<span class="string">'ReplaceMode'</span>,<span class="string">''</span>));
0727         info.ReplaceMode_recorder = strtrim(regexprep((info.ReplaceMode(2,:)),<span class="string">'ReplaceMode'</span>,<span class="string">''</span>));
0728         clear info.ReplaceMode
0729         info.ShotRepTime = strtrim(regexprep(parameters((strmatch(<span class="string">'ShotRepTime'</span>,parameters)),:),<span class="string">'ShotRepTime'</span>,<span class="string">''</span>));
0730         info.ShotsPLoop = strtrim(regexprep(parameters((strmatch(<span class="string">'ShotsPLoop'</span>,parameters)),:),<span class="string">'ShotsPLoop'</span>,<span class="string">''</span>));
0731         info.SptProgress = strtrim(regexprep(parameters((strmatch(<span class="string">'SptProgress'</span>,parameters)),:),<span class="string">'SptProgress'</span>,<span class="string">''</span>));
0732         info.SweepsPExp = strtrim(regexprep(parameters((strmatch(<span class="string">'SweepsPExp'</span>,parameters)),:),<span class="string">'SweepsPExp'</span>,<span class="string">''</span>));
0733         info.TriggerTimeOut = strtrim(regexprep(parameters((strmatch(<span class="string">'TriggerTimeOut'</span>,parameters)),:),<span class="string">'TriggerTimeOut'</span>,<span class="string">''</span>));
0734         info.XAxisQuant = strtrim(regexprep(parameters((strmatch(<span class="string">'XAxisQuant'</span>,parameters)),:),<span class="string">'XAxisQuant'</span>,<span class="string">''</span>));
0735         info.XSpecRes = str2num(regexprep(parameters((strmatch(<span class="string">'XSpecRes'</span>,parameters)),:),<span class="string">'XSpecRes'</span>,<span class="string">''</span>));
0736         info.YAxisQuant = strtrim(regexprep(parameters((strmatch(<span class="string">'YAxisQuant'</span>,parameters)),:),<span class="string">'YAxisQuant'</span>,<span class="string">''</span>));
0737         info.YSpecRes = str2num(regexprep(parameters((strmatch(<span class="string">'YSpecRes'</span>,parameters)),:),<span class="string">'YSpecRes'</span>,<span class="string">''</span>));
0738         
0739 
0740         varargout{1} = x;
0741         varargout{2} = y;
0742         varargout{3} = z;
0743         varargout{4} = info;
0744         
0745     <span class="keyword">otherwise</span>
0746         varargout{1} = x;
0747         varargout{2} = y;
0748 <span class="keyword">end</span>
0749 
0750 <span class="comment">%                         Figure plotting</span>
0751 <span class="comment">% ========================================================================</span>
0752 
0753 <span class="comment">% Check if figure plotting is selected</span>
0754 <span class="keyword">if</span> isequal(graph,<span class="string">'plot'</span>)
0755     figure(<span class="string">'name'</span> , [<span class="string">'BrukerRead: '</span> name], <span class="string">'NumberTitle'</span>,<span class="string">'off'</span>);
0756     set(gcf,<span class="string">'color'</span>, <span class="string">'white'</span>);
0757     axis tight;
0758     
0759     <span class="comment">% PULSE EXPERIMENTS</span>
0760     <span class="keyword">switch</span> info.EXPT
0761         <span class="keyword">case</span> <span class="string">'PLS'</span>
0762             <span class="keyword">switch</span> info.XNAM
0763                     <span class="comment">% For FSEs</span>
0764                 <span class="keyword">case</span> <span class="string">'''Field'''</span>
0765                     plot(x/10,y.real,<span class="string">'k-'</span> , x/10,y.imag,<span class="string">'r-'</span>);
0766                     xlabel(<span class="string">'Magnetic Field / mT'</span>);
0767                     ylabel(<span class="string">'Intensity'</span>);
0768                     legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>);
0769                     
0770                     <span class="comment">% For FIDs</span>
0771                 <span class="keyword">case</span> <span class="string">'''Time'''</span>
0772                     <span class="keyword">if</span> isfield(y,<span class="string">'real'</span>)
0773                         plot(x,y.real,<span class="string">'k-'</span> , x,y.imag,<span class="string">'r-'</span>);
0774                         legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>);
0775                     <span class="keyword">else</span>
0776                         plot(x,y);
0777                     <span class="keyword">end</span>
0778                     xlabel(<span class="string">'Time / ns'</span>);
0779                     ylabel(<span class="string">'Intensity'</span>);
0780                     
0781                     
0782                     <span class="comment">% For ENDOR</span>
0783                 <span class="keyword">case</span> <span class="string">'''RF'''</span>
0784                     plot(x,y.real,<span class="string">'k-'</span> , x,y.imag,<span class="string">'r-'</span>);
0785                     xlabel(<span class="string">'Radio frequency / MHz'</span>);
0786                     ylabel(<span class="string">'Intensity'</span>);
0787                     legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>);
0788                     
0789                 <span class="comment">% For some reason HYSCORE and ESEEM experiments do not have</span>
0790                 <span class="comment">% an XNAM field so we need to use XUNI to distinguish</span>
0791                 <span class="comment">% between experiments.</span>
0792                 <span class="keyword">otherwise</span>
0793                     <span class="keyword">switch</span> info.XUNI
0794                         <span class="comment">% For HYSCORE</span>
0795                         <span class="keyword">case</span> <span class="string">'''GHz'''</span>
0796                             contour(x*1000,y*1000,z);
0797                             xlabel(<span class="string">'\nu_1 / MHz'</span>);
0798                             ylabel(<span class="string">'\nu_2 / MHz'</span>);
0799                             axis normal;
0800                         
0801                         <span class="comment">% ESEEM</span>
0802                         <span class="keyword">case</span> <span class="string">'&quot;ns&quot;'</span>
0803                             plot(x,y.real,<span class="string">'k-'</span> , x,y.imag,<span class="string">'r-'</span>);
0804                             xlabel(<span class="string">'Time / ns'</span>);
0805                             ylabel(<span class="string">'Intensity'</span>);
0806                             legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>);
0807                             
0808                         <span class="comment">% DONUT</span>
0809                         <span class="keyword">case</span> <span class="string">'''ns'''</span>
0810                             plot(x,y.real,<span class="string">'k-'</span> , x,y.imag,<span class="string">'r-'</span>);
0811                             xlabel(<span class="string">'Time / ns'</span>);
0812                             ylabel(<span class="string">'Intensity'</span>);
0813                             legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>);
0814                             
0815                         <span class="comment">% Try plotting for other experiments (ie ENDOR)</span>
0816                         <span class="keyword">otherwise</span>
0817                             <span class="keyword">try</span>
0818                                 plot(x,y.real,<span class="string">'k-'</span> , x,y.imag,<span class="string">'r-'</span>);
0819                                 legend(<span class="string">'Real'</span>,<span class="string">'Imaginary'</span>)
0820                             <span class="keyword">end</span>
0821                     <span class="keyword">end</span>
0822             <span class="keyword">end</span>
0823             
0824     <span class="comment">% CW EXPERIMENTS</span>
0825         <span class="keyword">case</span> <span class="string">'CW'</span>
0826             plot(x/10,y);
0827             xlabel(<span class="string">'Magnetic Field / mT'</span>);
0828             
0829         <span class="keyword">otherwise</span>
0830             <span class="keyword">try</span>
0831                 plot(x/10,y);
0832                 xlabel(<span class="string">'Magnetic Field / mT'</span>);
0833             <span class="keyword">end</span>
0834             
0835     <span class="keyword">end</span>
0836     
0837 <span class="keyword">end</span>
0838 
0839 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 05-Apr-2013 12:00:44 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>